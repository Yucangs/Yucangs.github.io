<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>leetcode/Leaf-SimilarTrees</title>
    <url>/2020/07/12/leetcode/Leaf-SimilarTrees/</url>
    <content><![CDATA[<h2 id="Leaf-Similar-Trees"><a href="#Leaf-Similar-Trees" class="headerlink" title="Leaf-Similar Trees"></a>Leaf-Similar Trees</h2><p><img src="https://imgur.com/oKTCKO0.png" alt=""></p>
<p>åˆ¤æ–­æ ‘åº•æ˜¯å¦ç›¸åŒ</p>
<a id="more"></a>



<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>è¿™æ˜¯ä¸€é“å¾ˆç®€å•çš„é¢˜, å®ç°å¹¶ä¸éš¾, é—®é¢˜æ˜¯æ€ä¹ˆæ›´å¥½åœ°å®ç°.</p>
<p>æ·±åº¦/å¹¿åº¦éƒ½æ— æ³•åšåˆ°â€ä¸€è§¦å³å‘â€(åç¨‹/å¤šçº¿ç¨‹æˆ–è®¸å¯ä»¥). æ‰€éœ€éœ€è¦æ‰‹åŠ¨æ¥è®°å½•ä¸€ä¸‹.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">leafSimilar</span><span class="params">(TreeNode* root1, TreeNode* root2)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">array</span>&lt;TreeNode*, 200&gt; t1 &#123; root1 &#125;;</span><br><span class="line">        <span class="built_in">array</span>&lt;TreeNode*, 200&gt; t2 &#123; root2 &#125;;</span><br><span class="line">        <span class="keyword">int</span> i1 = <span class="number">0</span>, i2 = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// get bottom</span></span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (root1-&gt;left) &#123;</span><br><span class="line">                    root1 = root1-&gt;left;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root1-&gt;right) &#123;</span><br><span class="line">                    root1 = root1-&gt;right;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                t1[++i1] = root1;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (root2-&gt;left) &#123;</span><br><span class="line">                    root2 = root2-&gt;left;</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (root2-&gt;right) &#123;</span><br><span class="line">                    root2 = root2-&gt;right;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                t2[++i2] = root2;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (t1[i1]-&gt;val != t2[i2]-&gt;val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// get next root</span></span><br><span class="line">            <span class="keyword">while</span> (i1 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t1[i1] != t1[i1 - <span class="number">1</span>]-&gt;right &amp;&amp; t1[i1 - <span class="number">1</span>]-&gt;right) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                --i1;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> (i2 &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (t2[i2] != t2[i2 - <span class="number">1</span>]-&gt;right &amp;&amp; t2[i2 - <span class="number">1</span>]-&gt;right) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                --i2;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!(i1 || i2)) &#123;	<span class="comment">// all zero</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(i1 &amp;&amp; i2)) &#123;	<span class="comment">// someone is zero but another not</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            root1 = t1[--i1]-&gt;right;</span><br><span class="line">            t1[++i1] = root1;</span><br><span class="line">            root2 = t2[--i2]-&gt;right;</span><br><span class="line">            t2[++i2] = root2;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»£ç é‡æ˜¯å¤šäº†ç‚¹, ä½†æ˜¯æ²¡æœ‰ä½¿ç”¨é«˜çº§æ•°æ®ç»“æ„, æ²¡æœ‰é€’å½’. èƒ½å¤Ÿâ€ä¸€è§¦å³å‘â€.</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/AdcantageShuffule</title>
    <url>/2020/07/11/leetcode/AdcantageShuffule/</url>
    <content><![CDATA[<h2 id="Adcantage-Shuffule"><a href="#Adcantage-Shuffule" class="headerlink" title="Adcantage Shuffule"></a>Adcantage Shuffule</h2><p><img src="https://imgur.com/9rXehx8.png" alt=""></p>
<a id="more"></a>



<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>é‡è¦çš„æ˜¯é¡ºåº, å¦‚æœæœ‰é¡ºåº, å¯ä»¥èŠ‚çœå¾ˆå¤šæ€§èƒ½. å³ä½¿éœ€è¦æ’åº, ä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„.</p>
<p>å…¶æ¬¡å°±æ˜¯ç»“æœéœ€è¦åŸå§‹é¡ºåº, é‚£ä¹ˆå¯èƒ½å°±è¦éœ€è¦ä¸€ä¸ªå€¼-ç´¢å¼•çš„ç»“æ„. ä½†æ˜¯è¿™å¯èƒ½å¤æ‚åº¦å¤ªé«˜äº†. </p>
<p>æ‰€ä»¥æˆ‘é€‰æ‹©æ’åº, ä½†ä¸ç”Ÿäº§å€¼-ç´¢å¼•çš„ç»“æ„.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; advantageCount(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; B) &#123;</span><br><span class="line">        sort(A.<span class="built_in">begin</span>(), A.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; ; ++i) &#123;</span><br><span class="line">            <span class="keyword">while</span> (b &lt; A.<span class="built_in">size</span>() &amp;&amp; A[b] &lt;= B[i]) &#123;</span><br><span class="line">                ++b;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            b = b == A.<span class="built_in">size</span>() ? <span class="number">0</span> : b;</span><br><span class="line">            ret.push_back(A[b]);</span><br><span class="line">            <span class="keyword">if</span> (i + <span class="number">1</span> &gt;= B.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            A.erase(A.<span class="built_in">begin</span>() + b);</span><br><span class="line">            <span class="keyword">if</span> (B[i + <span class="number">1</span>] &lt; B[i]) &#123;</span><br><span class="line">                b = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">std</span>::<span class="built_in">move</span>(ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>è™½ç„¶å…‹é¢„è§çš„ä½æ•ˆç‡, ä½†æ˜¯ä»£ç æ•´ä½“å¾ˆç®€æ´, è¾¾åˆ°äº†æˆ‘æƒ³è¦çš„éƒ¨åˆ†æ•ˆæœ, ä½†æ˜¯æ•ˆç‡å¾ˆä½. </p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; advantageCount(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; A, <span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; B)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> N = <span class="keyword">static_cast</span>&lt;<span class="keyword">int</span>&gt;(A.<span class="built_in">size</span>());</span><br><span class="line">        <span class="built_in">vector</span>&lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&gt; copyB(N);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            copyB[i] = &#123;B[i], i&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">        sort(copyB.<span class="built_in">begin</span>(), copyB.<span class="built_in">end</span>(), [] (<span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; lhs, <span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; rhs) -&gt; <span class="keyword">bool</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> lhs.first &gt; rhs.first;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; copyA(A);</span><br><span class="line">        sort(copyA.<span class="built_in">begin</span>(), copyA.<span class="built_in">end</span>());</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret(N);</span><br><span class="line">        <span class="keyword">int</span> first = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> last = N - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;&amp; item : copyB)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (copyA[last] &gt; item.first)</span><br><span class="line">            &#123;</span><br><span class="line">                ret[item.second] = copyA[last];</span><br><span class="line">                --last;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                ret[item.second] = copyA[first];</span><br><span class="line">                ++first;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»–çš„æ–¹æ³•å’Œæˆ‘é¢„æ–™çš„å·®ä¸å¤š, æ˜¯ä¸¤ä¸ªé¡ºåºæ•°ç»„. </p>
<p>emmâ€¦ æˆ–è®¸æˆ‘æœ‰ç‚¹è¿‡äº†? æˆ‘æ˜¯æƒ³åˆ°å€¼-ç´¢å¼•çš„æ—¶å€™ç«‹é©¬æ‰“æ–­äº†è¿™ä¸ªæƒ³æ³•. å› ä¸ºè§‰å¾—æœ‰ç‚¹å¤æ‚äº†. å¦‚æœæˆ‘ç»§ç»­æƒ³çš„è¯, åº”è¯¥å·®ä¸å¤šå°±è¿™ä¸ªæ ·å­å§?</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/AllNodesDistanceKinBinaryTree</title>
    <url>/2020/07/09/leetcode/AllNodesDistanceKinBinaryTree/</url>
    <content><![CDATA[<h2 id="All-Nodes-Distance-K-in-Binary-Tree"><a href="#All-Nodes-Distance-K-in-Binary-Tree" class="headerlink" title="All Nodes Distance K in Binary Tree"></a>All Nodes Distance K in Binary Tree</h2><p><img src="https://imgur.com/vYXJZGL.png" alt=""></p>
<p>æ‰¾å‡ºæ ‘ä¸­è·ç¦»æŒ‡å®šèŠ‚ç‚¹è·ç¦»ä¸º n çš„èŠ‚ç‚¹</p>
<a id="more"></a>



<h3 id="my-solutions"><a href="#my-solutions" class="headerlink" title="my solutions"></a>my solutions</h3><p>emmâ€¦ </p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åˆ¶ä½œä¸€ä¸ªæ˜ å°„, å…¶ä¸­ key ä¸ºèŠ‚ç‚¹å€¼, val ä¸ºæ‰€æœ‰ä¸ key ç›¸é‚»çš„èŠ‚ç‚¹å€¼é›†åˆ.</p>
<p>è¿™ç§æ–¹æ³•é€‚ç”¨äºå¤šæ¬¡æŸ¥è¯¢, å› ä¸ºéœ€è¦åˆ¶ä½œä¸€ä¸ªå®Œæ•´çš„æ˜ å°„è¡¨, æ‰€ä»¥ä¸æ¨è :(</p>
<p>ç¬¬äºŒç§æ˜¯è®©æ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ª parent, èŠ‚ç‚¹ä¾¿åˆ©çš„éº»çƒ¦ä¹‹å¤„å°±åœ¨äºä»–æ²¡æœ‰ parent èŠ‚ç‚¹. æ ‡å‡†åº“çš„èŠ‚ç‚¹éƒ½æ˜¯æœ‰ parent èŠ‚ç‚¹çš„(é™¤æŒ‡å®šçš„ froward_list å¤– = =), è¶³ä»¥è¯´æ˜æœ‰ parent ä¸ä»…å¯¹äºç¼–ç¨‹, åŒæ—¶å¯¹äºæ•ˆç‡ä¹Ÿæœ‰å¾ˆå¤§æå‡.</p>
<p>ä½†è¿™ä¹Ÿç±»ä¼¼äºç¬¬ä¸€ç§, è¿™ç§æ›´åŠ è½»é‡çº§, ä½†ä¾¿åˆ©å¯»æ‰¾çš„æ—¶å€™ä¼šæ¯”ç¬¬ä¸€ç§ç¨å¾®éº»çƒ¦ä¸€äº›.</p>
<p>æˆ‘é‡‡ç”¨äº†ç¬¬äºŒç§çš„éƒ¨åˆ†æ¦‚å¿µ. </p>
<p>ä»”ç»†åˆ†æä¸€ä¸‹è¿™ä¸ªé¢˜çš„è¯, èŠ‚ç‚¹ç›¸é‚»èŠ‚ç‚¹åªæœ‰ä¸¤ç§å¯èƒ½, çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹. å­èŠ‚ç‚¹çš„ä¾¿åˆ©éå¸¸ç®€å•, å¹¿åº¦ä¼˜å…ˆæ‰¾åˆ°åŒæ ·æ·±åº¦çš„å­èŠ‚ç‚¹å°±å¥½, é—®é¢˜åœ¨äºçˆ¶èŠ‚ç‚¹. è€Œå¦‚æœæ‰¾å‡ºçˆ¶èŠ‚ç‚¹çš„ç®€å•è§„å¾‹çš„è¯, è¿™é¢˜ä¹Ÿæ¯”è¾ƒç®€å•äº†. å‡è®¾è·ç¦»ä¸º N, ä»çˆ¶èŠ‚ç‚¹å¼€å§‹, é™¤ç‰¹å®šå­èŠ‚ç‚¹å¤–çš„æ·±åº¦ä¸º N - 1 çš„èŠ‚ç‚¹å°±æ˜¯å€¼çš„ä¸€éƒ¨åˆ†, ä¸€æ¬¡ç±»æ¨, pp(çˆ¶çˆ¶)èŠ‚ç‚¹åˆ™æ˜¯ N - 2, ç›´åˆ°ä¸º 0 ä¸ºæ­¢, å°±èƒ½éå†å‡ºæ‰€æœ‰çš„é›†.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; distanceK(TreeNode* root, TreeNode* target, <span class="keyword">int</span> K) &#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;TreeNode*&gt; s;</span><br><span class="line">        dfs(root, s, target);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret;</span><br><span class="line">        TreeNode *l = s.top();</span><br><span class="line">        getN(l, ret, K--);</span><br><span class="line">        s.pop();</span><br><span class="line">        <span class="keyword">while</span> (K &gt;= <span class="number">0</span> &amp;&amp; !s.empty()) &#123;</span><br><span class="line">            TreeNode *c = s.top()-&gt;left == l ? s.top()-&gt;right : s.top()-&gt;left;</span><br><span class="line">            <span class="keyword">if</span> (!K) &#123;</span><br><span class="line">                ret.push_back(s.top()-&gt;val);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            getN(c, ret, K-- - <span class="number">1</span>);</span><br><span class="line">            l = s.top();</span><br><span class="line">            s.pop();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getN</span><span class="params">(TreeNode *n, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec, <span class="keyword">int</span> d)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!n) &#123; </span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!d) &#123;</span><br><span class="line">            vec.push_back(n-&gt;val);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;TreeNode*&gt; t &#123; n &#125;;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="built_in">vector</span>&lt;TreeNode*&gt; c;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> v : t) &#123;</span><br><span class="line">                <span class="keyword">if</span> (v-&gt;left) &#123;</span><br><span class="line">                    c.push_back(v-&gt;left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (v-&gt;right) &#123;</span><br><span class="line">                    c.push_back(v-&gt;right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (!--d) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> v : c) &#123;</span><br><span class="line">                    vec.push_back(v-&gt;val);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(c, t);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">dfs</span><span class="params">(TreeNode *n, <span class="built_in">stack</span>&lt;TreeNode*&gt;&amp; s, TreeNode *t)</span> </span>&#123;</span><br><span class="line">        s.push(n);</span><br><span class="line">        <span class="keyword">if</span> (!n) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n == t) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (dfs(n-&gt;left, s, t)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s.pop();</span><br><span class="line">        <span class="keyword">if</span> (dfs(n-&gt;right, s, t)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        s.pop();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgur.com/4j9XLua.png" alt=""></p>
<p>ä»£ç ä¸‘æ˜¯ä¸‘äº†ç‚¹ = =, ä¸è¿‡æˆ‘å…¶ä»–ç®—æ³•ä¹Ÿæ²¡å¥½åˆ°å“ªé‡Œå»â€¦ (è¿™æ˜¯å¿…è¦çš„æŸå¤±ä¹ˆ?)</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TreeNode2</span> &#123;</span></span><br><span class="line">        <span class="keyword">int</span> val;</span><br><span class="line">        TreeNode2 *left;</span><br><span class="line">        TreeNode2 *right;</span><br><span class="line">        TreeNode2 *ahead;</span><br><span class="line">        <span class="keyword">bool</span> checked;</span><br><span class="line">        TreeNode2(<span class="keyword">int</span> x) : val(x), left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>) ,ahead(<span class="literal">NULL</span>),checked(<span class="literal">false</span>)&#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    TreeNode2* target2;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">findahead</span><span class="params">(TreeNode* node,TreeNode2* newnode,TreeNode* target)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">        TreeNode2 *leftnode;</span><br><span class="line">        TreeNode2 *rightnode;</span><br><span class="line">        <span class="keyword">if</span> (newnode-&gt;val ==  target-&gt;val) <span class="keyword">this</span>-&gt;target2 = newnode;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;left != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            leftnode = <span class="keyword">new</span> TreeNode2(node-&gt;left-&gt;val);</span><br><span class="line">            newnode-&gt;left = leftnode;</span><br><span class="line">            newnode-&gt;left-&gt;ahead = newnode;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;right != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            rightnode = <span class="keyword">new</span> TreeNode2(node-&gt;right-&gt;val);</span><br><span class="line">            newnode-&gt;right = rightnode;</span><br><span class="line">            newnode-&gt;right-&gt;ahead = newnode;</span><br><span class="line">        &#125;</span><br><span class="line">        findahead(node-&gt;left,leftnode,target);</span><br><span class="line">        findahead(node-&gt;right,rightnode,target);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(TreeNode2* node,<span class="keyword">int</span> <span class="built_in">step</span>,<span class="keyword">int</span>&amp; k,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; res)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">NULL</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;checked == <span class="literal">true</span>) <span class="keyword">return</span>;</span><br><span class="line">        node-&gt;checked = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="built_in">step</span>) res.push_back(node-&gt;val);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">step</span> &gt; k) <span class="keyword">return</span>;</span><br><span class="line">        dfs(node-&gt;left,<span class="built_in">step</span> + <span class="number">1</span>,k,res);</span><br><span class="line">        dfs(node-&gt;right,<span class="built_in">step</span> + <span class="number">1</span>,k,res);</span><br><span class="line">        dfs(node-&gt;ahead,<span class="built_in">step</span> + <span class="number">1</span>,k,res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; distanceK(TreeNode* root, TreeNode* target, <span class="keyword">int</span> K) &#123;</span><br><span class="line">        <span class="comment">//constuct ahead</span></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        TreeNode2* newroot = <span class="keyword">new</span> TreeNode2(root-&gt;val);</span><br><span class="line">        findahead(root,newroot,target);</span><br><span class="line">        dfs(<span class="keyword">this</span>-&gt;target2,<span class="number">0</span>,K,res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å®ƒæ–°å»ºäº†ä¸€ä¸ªèŠ‚ç‚¹, å…¶ä¸­åŒ…å« left, right, ahead æŒ‡é’ˆ :(</p>
<p>è¿™ä¼šè®©æŸ¥æ‰¾å˜å¾—ç®€å•, ä½†æˆ‘å¹¶ä¸è®¤å¯è¿™ç§æ–¹å¼ = =.</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/onMy...</title>
    <url>/2020/06/25/leetcode/onMy.../</url>
    <content><![CDATA[<h2 id="on-my-â€¦"><a href="#on-my-â€¦" class="headerlink" title="on my â€¦"></a>on my â€¦</h2><p><img src="https://imgur.com/XKsKdeU.png" alt=""></p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">isNStraightHand</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; hand, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">div_t</span> di = div(hand.<span class="built_in">size</span>(), W);</span><br><span class="line">      <span class="keyword">if</span> (di.rem) &#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; hds;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">auto</span> v : hand) &#123;</span><br><span class="line">          ++hds[v];</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span> (!hds.empty()) &#123;</span><br><span class="line">          <span class="keyword">auto</span> it = *hds.<span class="built_in">begin</span>();</span><br><span class="line">          <span class="keyword">for</span> (<span class="keyword">int</span> l = it.second, b = it.first, e = it.first + W; </span><br><span class="line">               b &lt; e; ++b) &#123;</span><br><span class="line">              hds[b] -= l;</span><br><span class="line">              <span class="keyword">if</span> (hds[b] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">              &#125; <span class="keyword">else</span> <span class="keyword">if</span> (hds[b] == <span class="number">0</span>) &#123;</span><br><span class="line">                  hds.erase(b);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»€ä¹ˆä¹Ÿä¸æƒ³è¯´ :(</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">isNStraightHand</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; hand, <span class="keyword">int</span> W)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v(W);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (W == <span class="number">3</span> &amp;&amp; hand[<span class="number">0</span>] == <span class="number">2</span> &amp;&amp; hand[<span class="number">1</span>] == <span class="number">4</span>) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> h: hand) &#123;</span><br><span class="line">        v[h%W]++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> cnt = v[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;W; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(v[i] != cnt) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgur.com/LyEoIRH.png" alt=""></p>
<p>è™½ç„¶è¿™ä¸ªç®—æ³•å·é¸¡(æœ€å¼€å§‹é‚£ä¸ª if åˆ¤æ–­æ˜æ˜¾å…·æœ‰é’ˆå¯¹æ€§, åœ¨è¾“å…¥æ˜¯ [2,4,3] çš„æƒ…å†µä¸‹ä¼šä¸æ­£ç¡®)  </p>
<p>ä½†æ˜¯ä¾æ—§å¯¹æˆ‘é€ æˆäº†å¾ˆå¤§æ‰“å‡»â€¦ </p>
<p>æœ€å¼€å§‹æˆ‘çš„ç®—æ³•æ˜¯æƒ³äº†ä¸€æ®µæ—¶é—´çš„, æ€ä¹ˆç®€å•, æ€ä¹ˆé«˜æ•ˆ.  </p>
<p>å•Šâ€¦ æˆ‘ä¸ºä½•æ€»æ˜¯æ¬ ç¼ºè¿™ç§çœ‹é€é—®é¢˜æœ¬è´¨çš„èƒ½åŠ›å‘¢â€¦</p>
<p>æˆ‘çš„ç®—æ³•ä¸æ­¢è¿”å› bool è¿˜å¯ä»¥å¾—åˆ°æœ€åçš„é›†, æˆ‘åªèƒ½å¦‚æ­¤å®‰æ…°è‡ªå·±</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/MostProfitAssigningWork</title>
    <url>/2020/06/11/leetcode/MostProfitAssigningWork/</url>
    <content><![CDATA[<h2 id="Most-Profit-Assigning-Work"><a href="#Most-Profit-Assigning-Work" class="headerlink" title="Most Profit Assigning Work"></a>Most Profit Assigning Work</h2><p>æ‘¸äº†ä¸¤ä¸ªæœˆé±¼çš„èƒ¡æ±‰ä¸‰æˆ‘åˆå›æ¥äº†! ( â€¢Ì€ Ï‰ â€¢Ì )âœ§ (å…¶å®ä¹Ÿä¸ç®—æ‘¸é±¼, åªæ˜¯æ‡’å¾—å†™ç¬”è®°äº†è€Œå·²)</p>
<a id="more"></a>


<p><img src="https://imgur.com/cm6DHwt.png" alt=""></p>
<p>ä»»åŠ¡éš¾åº¦, ä»»åŠ¡æŠ¥é…¬, å·¥ä½œèƒ½åŠ›, æ±‚å‡ºæœ€å¤§å·¥ä½œåˆ©ç›Š.</p>
<h3 id="my-solutions"><a href="#my-solutions" class="headerlink" title="my solutions"></a>my solutions</h3><p>worker å¯ä»¥æ’ä¸ªåº, å¯ä»¥èŠ‚çœæ•ˆç‡. é—®é¢˜æ˜¯ dif(difficulty) å’Œ pro(profit) å¦‚ä½•å¤„ç†. ä»–ä»¬æ˜¯æƒ³å¯¹äºçš„ä¸œè¥¿, ç›´æ¥æ’åºä¼šå‡ºé”™. è€Œä¸å¤„ç†çš„è¯æ•ˆç‡æ— æ³•æé«˜. :( </p>
<p>ä¸€ç§ç›´æ¥çš„æ–¹æ³•æ˜¯ map. å¾ˆé€‚ç”¨äºè¿™ç§å…³è”å‹æ•°æ®ç»“æ„. äºæ˜¯ä¹, ç®€å•å®ç°äº†ä¸€ç§ map çš„è§£æ³•.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfitAssignment</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; difficulty, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; profit, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; worker)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt; prof;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; profit.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            prof[difficulty[i]] = <span class="built_in">max</span>(</span><br><span class="line">                prof[difficulty[i]], profit[i]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(difficulty.<span class="built_in">begin</span>(), difficulty.<span class="built_in">end</span>());</span><br><span class="line">        sort(worker.<span class="built_in">begin</span>(), worker.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>, e = <span class="number">0</span>, lbp = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> abi : worker) &#123;</span><br><span class="line">            <span class="keyword">while</span> (e &lt; difficulty.<span class="built_in">size</span>() &amp;&amp; abi &gt;= difficulty[e]) &#123;</span><br><span class="line">                ++e;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt; e; ++i) &#123;</span><br><span class="line">                lbp = <span class="built_in">max</span>(prof[difficulty[i]], lbp);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// printf("%d ", lbp);</span></span><br><span class="line">            sum += lbp;</span><br><span class="line">            b = e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgur.com/rleXObP.png" alt=""></p>
<p>è€å¤«å·²ç»ä¸æ˜¯ä»¥å‰çš„è€å¤«äº†. map å…¶å®ä¹Ÿå¹¶ä¸é«˜æ•ˆ. å³ä½¿æ˜¯çº¢é»‘æ ‘, å…ƒç´ çš„æœç´¢ä¹Ÿæ˜¯æœ‰å¾ˆå¤§æ¶ˆè€—çš„ :( </p>
<p>(é‚£ä¹ˆæœ‰æ²¡æœ‰é‚£ä¹ˆä¸€ç§ä¼˜ç¾çš„æ•°æ®ç»“æ„, å…¶æœ‰åª²ç¾ vector çš„çº¿æ€§è¿­ä»£, åˆå»é™¤äº† vector çš„å·¨å¤§æ¶ˆè€—å‘¢? æœ‰çš„! ç†è®ºä¸Šå®Œç¾çš„ hash ! ä½†æ˜¯è¦è¾¾åˆ°å®Œç¾, å…¶è¦è§£å†³çš„é¦–è¦é—®é¢˜å°±æ˜¯ç¢°æ’ ï¼ˆï¼›Â´Ğ´ï½€ï¼‰ã‚ ä½†è¿™çœŸçš„ä¸æ˜¯ä¸€ä¸ªå¯ä»¥å®Œç¾è§£å†³çš„é—®é¢˜)</p>
<p>æ‰€ä»¥, è€å¤«æ‚Ÿåˆ°äº†ä¸€ä¸ªé“ç†! å¤æ‚çš„æ•°æ®ç»“æ„å¯ä»¥è§£å†³å¤æ‚çš„é—®é¢˜, ä½†å…¶æ•ˆç‡è¿œæ¯”ä¸ä¸Šç®€å•çš„æ•°æ®ç»“æ„. å¦‚æœä¸€ä¸ªé—®é¢˜å¯ä»¥ç”¨ç®€å•çš„æ•°æ®ç»“æ„æ¥è§£å†³, é‚£ä¹ˆè¿™ä¸ªè§£æ³•å¿…ç„¶å¾ˆä¼˜è¶Š. æ•°æ®ç»“æ„çš„æœ¬è´¨æ˜¯ç”¨ä¸€ç§ç‰¹æ€§å»æ¨¡æ‹Ÿä½ æ‰€éœ€è¦çš„ç‰¹æ€§. è€Œè¿™ç§ç‰¹æ€§å®ç°ä¸Šçš„ä¸åŒå¸¦æ¥äº†æ•°æ®ç»“æ„çš„å¤æ‚ç¨‹åº¦çš„ä¸åŒ. æ¯”å¦‚ç°åœ¨æˆ‘æ‰€éœ€è¦çš„ pro å’Œ dif çš„å…³è”æ€§. æ‰€ä»¥æˆ‘ç”¨åˆ°äº† map. (å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ª pair çš„ vector æ¥å®ç°, å…¶é‡å¿ƒåˆè½¬å‘äº† pair)</p>
<p>é‚£ä¹ˆ, å¦‚ä½•ç”¨ç®€å•çš„æ•°æ®ç»“æ„è§£å†³å¤æ‚çš„é—®é¢˜å‘¢? å¥½é—®é¢˜! åœ¨ä¸‹ä¹Ÿå¹¶ä¸æ˜¯å¾ˆæ¸…æ¥š (ã£ Â°Ğ” Â°;)ã£ !. ä¸è¿‡æœ‰ä¸€äº›å¿ƒå¾—. å¦‚æœç¡¬è¦è¯´çš„è¯, æ˜¯é€»è¾‘! å°±æ‹¿é€’å½’å’Œè¿­ä»£æ¥è·ç¦», é€’å½’çš„å®ç°å¾€å¾€ä¼šæ¯”è¿­ä»£ç®€å•å¾ˆå¤š, è€Œè¿­ä»£ä¸ºäº†è¿½è¸ªå…ƒç´ çš„æ”¹å˜, ä¼šç”¨åˆ°ä¸€äº›è¾ƒä¸ºå¤æ‚çš„æ•°æ®ç»“æ„. (ä½†æ˜¯é—®é¢˜æ˜¯, è¿­ä»£å¾€å¾€æ¯”é€’å½’æ›´é«˜æ•ˆ, å› ä¸ºè¿­ä»£æœ¬èº«çš„å‡½æ•°è°ƒç”¨å’Œå…ƒç´ ä¼ é€’å°±æ˜¯ä¸€ç§å·¨å¤§çš„æ¶ˆè€— ã€’â–½ã€’) æ‰€ä»¥, å¯¹äºè¿™ä¸ªé—®é¢˜, åœ¨ä¸‹è¿˜åœ¨æ‘¸ç´¢ä¸­! </p>
<p>å¥½äº†, è¯´å›æ¥, æœ€ååœ¨ä¸‹æƒ³åˆ°çš„èƒ½å¤Ÿä¸ä½¿ç”¨é¢å¤–çš„å¤æ‚æ•°æ®ç»“æ„çš„æ–¹æ³•æ˜¯: ä¿®æ”¹ pro å’Œ fit (é¢‡æœ‰ç‚¹è§£å†³ä¸äº†é—®é¢˜, è§£å†³æé—®é¢˜çš„äººçš„æ„æ€â€¦ æˆ–è€…è¯´å¥½å¬ç‚¹, ä»æºå¤´è§£å†³é—®é¢˜?) </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfitAssignment</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; difficulty, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; profit, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; worker)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pro &#123; profit[<span class="number">0</span>] &#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dif &#123; difficulty[<span class="number">0</span>] &#125;;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = profit.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, s = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> d = difficulty[i];</span><br><span class="line">            <span class="keyword">int</span> p = profit[i];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (s &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p &gt; pro[s]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (d &lt; dif[s]) &#123;</span><br><span class="line">                        pro.erase(pro.<span class="built_in">begin</span>() + s);</span><br><span class="line">                        dif.erase(dif.<span class="built_in">begin</span>() + s);</span><br><span class="line">                        --s;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        pro.insert(pro.<span class="built_in">begin</span>() + s + <span class="number">1</span>, p);</span><br><span class="line">                        dif.insert(dif.<span class="built_in">begin</span>() + s + <span class="number">1</span>, d);</span><br><span class="line">                        s = dif.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (d &lt; dif[s]) &#123;</span><br><span class="line">                        --s;</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        s = dif.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (s == <span class="number">-1</span>) &#123;</span><br><span class="line">                pro.insert(pro.<span class="built_in">begin</span>(), p);</span><br><span class="line">                dif.insert(dif.<span class="built_in">begin</span>(), d);</span><br><span class="line">                s = dif.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(worker.<span class="built_in">begin</span>(), worker.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>, e = <span class="number">0</span>, lbp = <span class="number">0</span>, sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> abi : worker) &#123;</span><br><span class="line">            <span class="keyword">while</span> (e &lt; dif.<span class="built_in">size</span>() &amp;&amp; abi &gt;= dif[e]) &#123;</span><br><span class="line">                ++e;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt; e; ++i) &#123;</span><br><span class="line">                lbp = <span class="built_in">max</span>(pro[i], lbp);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sum += lbp;</span><br><span class="line">            b = e;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgur.com/kfJgo5e.png" alt=""></p>
<p>åœ¨ä¸‹è™½ç„¶å¯¹è¿™ç§é‡çº§çš„ä»£ç å¹¶ä¸æ»¡æ„, ä½†æ˜¯å¥½åƒæš‚æ—¶æƒ³ä¸åˆ°ä»€ä¹ˆä¸ç”¨åˆ°å¤æ‚æ•°æ®ç»“æ„, åˆèƒ½æ¯”è¾ƒé«˜æ•ˆè§£å†³é—®é¢˜çš„åŠæ³•äº†â€¦ ï¼ˆï¼›Â´Ğ´ï½€ï¼‰ã‚ åœ¨ä¸‹è¿˜æ˜¯å¤ªèœäº†â€¦ </p>
<p>ç¬¬äºŒä¸ªå¾ªç¯å‡ ä¹æ²¡å˜, æ ¸å¿ƒæ˜¯ç¬¬ä¸€ä¸ªå¾ªç¯å¯¹äºæ•°æ®çš„å¤„ç†, å¤§æ¦‚æ˜¯è¿™ä¹ˆä¸€ä¸ªé€»è¾‘:</p>
<ol>
<li><p>å½“å‰ profit å¤§äºå¯¹æ¯”å…ƒç´ çš„ profit</p>
<ol>
<li><p>å½“å‰ difficulty å°äºå¯¹æ¯”å…ƒç´ çš„ difficulty</p>
<p>è¿™ç§æƒ…å†µçš„è¯, å¯¹æ¯”å…ƒç´ å°±æ²¡æœ‰å­˜åœ¨çš„æ„ä¹‰äº†. åˆ é™¤</p>
</li>
<li><p>å½“å‰ difficulty å¤§äºç­‰äºå¯¹æ¯”å…ƒç´ çš„ difficulty</p>
<p>æ’å…¥!</p>
</li>
</ol>
</li>
<li><p>å½“å‰ profit å°äºç­‰äºå¯¹æ¯”å…ƒç´ çš„ profit </p>
<ol>
<li><p>å½“å‰ difficulty å°äºå¯¹æ¯”å…ƒç´ çš„ difficulty</p>
<p>å¯¹æ¯”å…ƒç´ æœ‰å­˜åœ¨çš„ä»·å€¼, ç»§ç»­ä¾¿åˆ©å…¶ä»–çš„å¯¹æ¯”å…ƒç´ </p>
</li>
<li><p>å½“å‰ difficulty å¤§äºç­‰äºå¯¹æ¯”å…ƒç´ çš„ difficulty</p>
<p>å½“å‰å…ƒç´ æ— å­˜åœ¨ä»·å€¼, è·³è¿‡.</p>
</li>
</ol>
</li>
</ol>
<p>ç»è¿‡è¿™äº›ä¿®æ”¹ä¹‹å, å…ƒç´ çš„é‡ä¼šå¤§å¤§å‡å°‘(å…¶ä¸­ä¸€ä¸ªæ¡ˆä¾‹å¥½åƒç›´æ¥å°‘äº†ä¸€å€ä»¥ä¸Š) </p>
<p>ä½†æ˜¯, â€¦ è¿™ä¸ªå¾ªç¯çš„æ¶ˆè€—è¿˜æ˜¯æ¯”è¾ƒå¤§çš„, æ•´ä½“çš„ä»£ç é‡å¤ªå¤šäº†. è¿™ä¸ªå¾ªç¯çš„ç†è§£éš¾åº¦ä¹Ÿæ¯”è¾ƒå¤§. æ‰€ä»¥å¹¶ä¸æ˜¯ä¸€ä¸ªæ»¡æ„çš„è§£æ³•â€¦</p>
<h3 id="the-best-solutions"><a href="#the-best-solutions" class="headerlink" title="the best solutions"></a>the best solutions</h3><p>ä¸è´´äº†, ä»–æ˜¯ç”¨ pair + sort è§£å†³çš„. æ¯«æ— æ–°æ„! (è™½ç„¶çš„ç¡®æ¯”è¾ƒå¥½â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>other/vector</title>
    <url>/2020/04/21/other/vector/</url>
    <content><![CDATA[<p>emmâ€¦  </p>
<p>ç½‘ç»œçœ‹è¿‡äº†, å¤šçº¿ç¨‹çœ‹è¿‡äº†, æ“ä½œç³»ç»Ÿçœ‹è¿‡äº†, mysqlçœ‹è¿‡äº†, linuxçœ‹è¿‡äº†, æ•°æ®ç»“æ„å’Œç®—æ³•ä¹Ÿçœ‹è¿‡äº†â€¦  </p>
<p>å¤§å¤šéœ€è¦çš„ä¸œè¥¿æˆ‘éƒ½æœ‰çœ‹è¿‡ (è™½ç„¶è¿˜éœ€å¤§é‡è®­ç»ƒğŸ’ª), æƒ³äº†æƒ³, æ˜¯æ—¶å€™çœ‹æºç äº†.</p>
<a id="more"></a>



<p>ç¬¬ä¸€æ¬¡çœ‹æºç åº”è¯¥æ˜¯åœ¨ä¸€å¹´å‰, å½“æ—¶ç»“åˆ&lt;STLæºç å‰–æ&gt;, æ²¡çœ‹å‡ é¡µå°±æ­‡æ°”äº†, ä¸çŸ¥é“é‚£é‡Œå»æ‰¾æºç . ä¹Ÿä¸çŸ¥é“æ€ä¹ˆå…¥æ‰‹. éšç€è‡ªå·±ä¸æ–­è¿›æ­¥, è¿™äº›é—®é¢˜ä¹Ÿå˜å¾—å¯ä»¥è§£å†³äº†. </p>
<h1 id="prepare"><a href="#prepare" class="headerlink" title="prepare"></a>prepare</h1><p>é¦–å…ˆ, æºç é€‰ç”¨å“ªå¥—å‘¢? æƒ³äº†æƒ³è¿˜æ˜¯ boost å¥½äº†. </p>
<p>ç„¶å, ä¹¦ç±çš„è¯, å°±ä¸è¯»ä¹‹å‰é‚£æœ¬ä¹¦äº†, ç½‘ä¸Šæœäº†ç›¸å…³ä¹¦ç±, å¾ˆå°‘, çœ‹äº†çœ‹æ„Ÿè§‰å¹¶ä¸é€‚åˆ. æ‰€ä»¥é€‰ç”¨äº† boost çš„å®˜æ–¹æ–‡æ¡£. </p>
<p>ä¸€å¼€å§‹å°±é‡åˆ°äº†ä¹‹å‰çš„é—®é¢˜: ä¸çŸ¥é“ä»å“ªé‡Œå¼€å§‹. æƒ³å»çœ‹çœ‹ vector çš„å®ç°. ä½†æ˜¯ä¸€æœæ–‡æ¡£, æœ‰å¾ˆå¤šå‡ºéƒ½æœ‰ vector å…³é”®å­—. </p>
<p><img src="https://imgur.com/hiPhoqN.png" alt=""></p>
<p>è„‘å£³ç–¼â€¦ </p>
<p>å¥½åœ¨è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡å®˜æ–¹æ–‡æ¡£ä¸Šæ¥è§£å†³:</p>
<p><img src="https://imgur.com/RzQNqTM.png" alt=""></p>
<p>æ‰¾åˆ°ç›¸å…³çš„ä½ç½®å°±å¥½äº†, æ‰€ä»¥, å°±å…ˆä» vector å¼€å§‹å§ :)</p>
<h1 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h1><p><img src="https://imgur.com/plUq8uw.png" alt=""></p>
<p>æŒ‰ç…§æ–‡æ¡£è®°è½½, vector çš„é»˜è®¤å®¹å™¨ç±»å‹æ˜¯ unbounded_array.  è¿™ç‚¹ boost åšå¾—ä¸å¤ªå‹å¥½. å› ä¸ºè¿™ä¸ªé»˜è®¤ç±»å‹åœ¨ fwd.hpp æ–‡ä»¶ä¸­æ‰èƒ½çœ‹åˆ°. (åœ¨æ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€è¡Œ â€œfwd.hpp is essentially used to forward declare the main typesâ€ åº”è¯¥åœ¨å¾ˆå¤šåœ°æ–¹éƒ½ä¼šæœ‰)</p>
<p><img src="https://imgur.com/1fq6OUm.png" alt=""></p>
<p>vector æ‰€ç»§æ‰¿çš„çˆ¶ç±»ç»æŸ¥çœ‹, å¹¶æ— å¤ªå¤§çš„å®è´¨æ”¹å˜.</p>
<p><img src="https://imgur.com/ZfvVlB6.png" alt=""></p>
<p>å®ƒçš„åå­—æˆ–è®¸æœ‰æ­§ä¹‰, å› ä¸ºå®¹å™¨æ˜¯ç”± A å†³å®šçš„, å…¶çˆ¶ç±»æä¾›çš„æ˜¯ä¸€äº›åŠŸèƒ½æ€§å‡½æ•°, å¹¶æ— å®é™…æ•°æ®æˆå‘˜.</p>
<p>ä¸€å¼€å§‹æ˜¯ä¸€äº›ç±»å‹çš„å®šä¹‰:</p>
<p><img src="https://imgur.com/ELEQXYC.png" alt=""></p>
<p>å…¶ä¸­æ¯”è¾ƒä»¤äººåœ¨æ„çš„æ˜¯:</p>
<ul>
<li><p>difference_type</p>
   <figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line">     reference <span class="keyword">operator</span> [] (difference_type n) <span class="keyword">const</span> &#123;</span><br><span class="line">     <span class="keyword">return</span> *(it_ + n);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>   è¿™ä¸ªç±»å‹å®é™…æ˜¯å…ƒç´ è·ç¦»ç±»å‹? é‚£ä¸åº”è¯¥å« distance_type ä¹ˆ? å¥½å¥‡æ€ªçš„å‘½åâ€¦</p>
</li>
<li><p>type_traits</p>
<p>   åº”è¯¥æ˜¯ä¸€äº›ç±»å‹ç‰¹æ€§ç›¸å…³çš„ä¸œè¥¿.</p>
</li>
<li><p>vector_reference, closure_type, const_closure_type</p>
<p>   <img src="https://imgur.com/7zJA0Nk.png" alt=""></p>
<p>   è¿™è²Œä¼¼æ˜¯ä¸€ä¸ªå°è£…äº†è‡ªèº«å†…éƒ¨å®¹å™¨ç±»å‹çš„ç±».</p>
</li>
<li><p>storage_category</p>
<p>   <img src="https://imgur.com/HN2Wujx.png" alt=""></p>
<p>   è¿™å¥½åƒæ˜¯ä¸€ä¸ªä»¥ç±»ç±»å‹ä¸ºè¯†åˆ«çš„æ ‡è¯†, emmâ€¦ ç”¨ enum ä¼šä¸ä¼šå¥½ç‚¹? </p>
</li>
</ul>
<p>æ¥ä¸‹æ¥å°±æ˜¯ä¸€äº›æ™®é€šçš„æˆå‘˜å‡½æ•°, å…¶ä¸­å‡ ä¸ªæ¯”è¾ƒåœ¨æ„çš„: </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">AE</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">BOOST_UBLAS_INLINE</span></span></span><br><span class="line"><span class="class"><span class="title">vector</span> (<span class="title">const</span> <span class="title">vector_expression</span>&lt;AE&gt; &amp;<span class="title">ae</span>):</span></span><br><span class="line">	vector_container&lt;self_type&gt; (),</span><br><span class="line">	data_ (ae ().<span class="built_in">size</span> ()) &#123;</span><br><span class="line">    vector_assign&lt;scalar_assign&gt; (*<span class="keyword">this</span>, ae);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// vector_expression å°±æ˜¯ vector è¡¨è¾¾å¼, å…¶åŒ…å« + - * / å››åˆ™è¿ç®—ç­‰ç­‰</span></span><br><span class="line"><span class="comment">// å¯ä»¥å‚è€ƒ vector_expression.hpp æ–‡ä»¶.</span></span><br><span class="line"><span class="comment">// æˆ‘ä¹Ÿä¸æ˜¯ååˆ†æ¸…æ¥šè¿™æ˜¯å•¥ç©æ„ = = , çœ‹èµ·æ¥æ˜¯å°è£…äº†ä¸€äº›åˆ—è¿ç®—çš„ç±».</span></span><br></pre></td></tr></table></figure>
<p>è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¥‡æ€ªçš„ resize</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span> <span class="params">(size_type <span class="built_in">size</span>, <span class="keyword">bool</span> preserve = <span class="literal">true</span>)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (preserve)</span><br><span class="line">		data ().resize (<span class="built_in">size</span>, <span class="keyword">typename</span> A::value_type ());</span><br><span class="line">	<span class="keyword">else</span></span><br><span class="line">		data ().resize (<span class="built_in">size</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// preserve å†³å®šäº†æ•°æ®æ˜¯å¦ä¿ç•™, ä¸ä¿ç•™çš„è¯ä¼šæˆªæ–­. </span></span><br><span class="line"><span class="comment">// å¾ˆå¤šå‡½æ•°éƒ½åªæœ‰2, 3è¡Œ, vector å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒ…è£…, åº•å±‚æ•°æ®çš„æ§åˆ¶åœ¨å…¶ container å†….</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgur.com/lil0XBq.png" alt=""></p>
<p>æ¯”è¾ƒå¥½å¥‡ data å“ªé‡Œæ¥çš„, vector åªæœ‰ data_ è¿™ä¸€ä¸ªæˆå‘˜. ç»“æœçœ‹åˆ° = =</p>
<p>data æ˜¯ public çš„, è¿™é‡ŒåŠ  data() æ„Ÿè§‰æœ‰ç‚¹å¤šä½™. æˆ–è€…è¯´, å­˜åœ¨å®ƒè¯´çš„ â€œvery specific caseâ€ ?</p>
<p>åœ¨å…¶ä»–åœ°æ–¹ä¹Ÿæœ‰çœ‹åˆ°è°ƒç”¨çš„æ˜¯ data(), è€Œå¹¶é data_ . æˆ–è®¸æ˜¯ä¸ºäº†åŠŸèƒ½æ€§? </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">std</span>::<span class="built_in">fill</span> (data ().<span class="built_in">begin</span> (), data ().<span class="built_in">end</span> (), value_type<span class="comment">/*zero*/</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ƒè°ƒç”¨çš„æ˜¯ std çš„ fill å‡½æ•°, å…¶è‡ªèº«ä¹Ÿå®ç°äº†ä¸€ä¸ª std çš„ fill, ä¸è¿‡æ˜¯ä¸€ä¸ªæ¯”è¾ƒæ™®é€šçš„ fill</span></span><br><span class="line"><span class="comment">// memset æ˜¯å¦ä¼šæ›´å¥½?</span></span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">C</span>&gt;          // <span class="title">Container</span> <span class="title">assignment</span> <span class="title">without</span> <span class="title">temporary</span></span></span><br><span class="line"><span class="class"><span class="title">BOOST_UBLAS_INLINE</span></span></span><br><span class="line"><span class="class"><span class="title">vector</span> &amp;<span class="title">operator</span> = (<span class="title">const</span> <span class="title">vector_container</span>&lt;C&gt; &amp;<span class="title">v</span>) &#123;</span></span><br><span class="line">    resize (v ().<span class="built_in">size</span> (), <span class="literal">false</span>);</span><br><span class="line">    assign (v);</span><br><span class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">AE</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">BOOST_UBLAS_INLINE</span></span></span><br><span class="line"><span class="class"><span class="title">vector</span> &amp;<span class="title">operator</span> = (<span class="title">const</span> <span class="title">vector_expression</span>&lt;AE&gt; &amp;<span class="title">ae</span>) &#123;</span></span><br><span class="line">    <span class="function">self_type <span class="title">temporary</span> <span class="params">(ae)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> assign_temporary (temporary);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿™æ˜¯ä¸ªèµ‹å€¼æ“ä½œç¬¦é‡è½½, ä½†æ˜¯, é—®é¢˜æ˜¯</span></span><br><span class="line"><span class="comment">// æ˜¯å¦å¯ä»¥è§„é¿éƒ¨åˆ† resize æ“ä½œ? æ¯”å¦‚ v é•¿åº¦ä¸º 10, é‚£ä¹ˆè‡³å¤š 10 ä¸ªå…ƒç´ ä¸éœ€è¦ resize</span></span><br><span class="line"><span class="comment">// äº¤ç»™åç»­çš„ assign å°±å¥½äº†</span></span><br><span class="line"><span class="comment">// è¿˜è¦æ³¨æ„çš„æ˜¯, expression çš„èµ‹å€¼æœ‰ä¸´æ—¶å€¼, ä½† container æ²¡æœ‰, è™½ç„¶è¿™å¾ˆæ­£å¸¸.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">AE</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">BOOST_UBLAS_INLINE</span></span></span><br><span class="line"><span class="class"><span class="title">vector</span> &amp;<span class="title">assign</span> (<span class="title">const</span> <span class="title">vector_expression</span>&lt;AE&gt; &amp;<span class="title">ae</span>) &#123;</span></span><br><span class="line">	vector_assign&lt;scalar_assign&gt; (*<span class="keyword">this</span>, ae);</span><br><span class="line">	<span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... å•Šå•Šå•Š ç»•æ¥ç»•å», è¦åäº† = =</span></span><br><span class="line"><span class="comment">// ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªæ”¶è·å°±æ˜¯, ä¹‹å‰ä¸ºä»€ä¹ˆç”¨ç±»ç±»å‹å½“ tag, æ˜æ˜åªæ˜¯ä¸€ä¸ªç©ºæ•°æ®ç»“æ„</span></span><br></pre></td></tr></table></figure>
<p><img src="https://imgur.com/QLzGeyR.png" alt=""></p>
<p>è¯·çœ‹è¿™é‡Œ! å®ƒä½¿ç”¨äº†è¿™ä¸ªç±»ç±»å‹æ¥é‡è½½æ¨¡æ¿. </p>
<p>ä¸è¿‡â€¦ æˆ‘è®°å¾—æœ‰ç”¨å€¼æ¥æŒ‡å®šçš„æ–¹å¼ = =. </p>
<p>æˆ‘çªç„¶å‘ç°ä¸€ä¸ªå¾ˆä¸¥è‚ƒçš„é—®é¢˜, ä¸Šè¿°çš„éƒ¨åˆ†å‡½æ•°ä¸­, è¿”å›å€¼ç›´æ¥æ˜¯ vector, è€Œå¹¶é vector&lt;T, A&gt; â€¦ </p>
<p>è€Œæˆ‘è¯•äº†ä¸€ä¸‹, å‘ç°æ˜¯å¯ä»¥ç¼–è¯‘é€šè¿‡çš„ = =, è€Œ google ä¸Šå‡ ä¹ç¤ºä¾‹éƒ½å‘Šè¯‰æˆ‘è¦åŠ  <T>, æˆ‘æ˜¯ä¸æ˜¯è¯¥å†çœ‹ä¸€ä¸‹æ¨¡æ¿?</p>
<h2 id="iterator"><a href="#iterator" class="headerlink" title="iterator"></a>iterator</h2><p>boost å°† vector çš„ iterator å®ç°ä¸ºå†…éƒ¨ç±»çš„å½¢å¼.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Use the storage array iterator</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">typename</span> A::const_iterator const_subiterator_type;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">typename</span> A::iterator subiterator_type;</span><br></pre></td></tr></table></figure>
<p>å®ƒä½¿ç”¨çš„æ˜¯åº•å±‚å®¹å™¨çš„ iterator, å®ƒå’Œ vector ç±»ä¼¼, ä¹Ÿæ˜¯ä¸€ä¸ªåŒ…è£…ç±». çœ‹æ¥ä¸€åˆ‡çš„æ ¸å¿ƒåœ¨åº•å±‚å®¹å™¨ä¸­</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/// Serialize a vector into and archive as defined in Boost</span></span><br><span class="line"><span class="comment">/// \param ar Archive object. Can be a flat file, an XML file or any other stream</span></span><br><span class="line"><span class="comment">/// \param file_version Optional file version (not yet used)</span></span><br><span class="line">     <span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">Archive</span>&gt;</span></span><br><span class="line"><span class="class">     <span class="title">void</span> <span class="title">serialize</span>(<span class="title">Archive</span> &amp; <span class="title">ar</span>, <span class="title">const</span> <span class="title">unsigned</span> <span class="title">int</span> /* <span class="title">file_version</span> */)&#123;</span></span><br><span class="line">         ar &amp; serialization::make_nvp(<span class="string">"data"</span>,data_);</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>

<p>å“¦å“¦å“¦, ä¸æ„§æ˜¯ boost, å¾ˆæ–¹ä¾¿å˜›.</p>
<h2 id="unbounded-array"><a href="#unbounded-array" class="headerlink" title="unbounded_array"></a>unbounded_array</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Storage types</span></span><br><span class="line"><span class="keyword">template</span>&lt;<span class="class"><span class="keyword">class</span> <span class="title">T</span>, <span class="title">class</span> <span class="title">ALLOC</span> = <span class="title">std</span>:</span>:allocator&lt;T&gt; &gt;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">unbounded_array</span>;</span></span><br></pre></td></tr></table></figure>
<p>(ãƒï½€Ğ”)ãƒ ä½ â€¦ </p>
<p>(é¡ºä¾¿, åœ¨è¿™æ®µæœŸé—´æˆ‘æŠ˜è…¾äº†ä¸€ä¸‹ IDE, Clion, xcode, visual studio. æœ€åè¿˜æ˜¯ vs å¥½. å¯¹äºè¿™ç§æºç çº§åˆ«çš„ç¬¦å·è§£æ, å…¶ä»– IDE å¥½åƒéƒ½ä¸æ€ä¹ˆèªæ˜. ä½†æ˜¯å¾ˆå¯æƒœ vs mac çš„æ”¯æŒå¹¶ä¸å¥½. è€Œä¸”æ²¡æœ‰ vs æ’ä»¶)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">const</span> T *const_pointer;</span><br><span class="line"><span class="keyword">typedef</span> T *pointer;</span><br><span class="line"><span class="keyword">typedef</span> const_pointer const_iterator;</span><br><span class="line"><span class="keyword">typedef</span> pointer iterator</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¿­ä»£å™¨åªæ˜¯ä¸€ç§æ¦‚å¿µ, ä¸€ç§æœºåˆ¶, å…¶å†…éƒ¨è¿˜æ˜¯æŒ‡é’ˆ.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">ALLOC alloc_;</span><br><span class="line">size_type size_;</span><br><span class="line">pointer data_</span><br></pre></td></tr></table></figure>
<p>data_ åº”è¯¥å°±æ˜¯æ•°æ®å­˜å‚¨æ‰€åœ¨.</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">swap</span> <span class="params">(unbounded_array &amp;a)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (<span class="keyword">this</span> != &amp;a) &#123;</span><br><span class="line">	<span class="built_in">std</span>::swap (size_, a.size_);</span><br><span class="line">	<span class="built_in">std</span>::swap (data_, a.data_);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥, swap æ˜¯è½»é‡çº§çš„, åªæœ‰å†…éƒ¨å…ƒç´ äº¤æ¢.</p>
<p>è€å¤«çªç„¶å‘ç°ä¸€ä»¶å¾ˆè¦å‘½çš„äº‹æƒ…â€¦</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line"><span class="function">reference <span class="title">insert_element</span> <span class="params">(size_type i, const_reference t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> (data () [i] = t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">BOOST_UBLAS_INLINE</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">erase_element</span> <span class="params">(size_type i)</span> </span>&#123;</span><br><span class="line">	data () [i] = value_type<span class="comment">/*zero*/</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">reference <span class="keyword">operator</span> [] (size_type i) &#123;</span><br><span class="line">    BOOST_UBLAS_CHECK (i &lt; size_, bad_index ());</span><br><span class="line">    <span class="keyword">return</span> data_ [i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ˜¯ vector çš„æ’å…¥å’Œåˆ é™¤å…ƒç´ , ä»¥åŠæ’å…¥å…ƒç´ å†…éƒ¨ [] çš„é‡è½½â€¦ è¿™â€¦ </p>
<p>boost çš„ vector å°±æ˜¯æ•°ç»„â€¦ è¿˜æ˜¯ä¸ä¼šè‡ªåŠ¨å˜é•¿çš„é‚£ç§â€¦ </p>
<p>æ˜¯çš„, å†ä¸‰å¯¹æ¯”æ–‡æ¡£å’Œæºç , æ’å…¥åªæœ‰ insert_element ä¸€å¤„. è€Œæ’å…¥æ—¶ä¼šå…ˆè¿›è¡Œç•Œé™åˆ¤å®š, å¦‚æœè¶Šç•Œ, åˆ™ç›´æ¥æŠ¥é”™â€¦ </p>
<p>æƒ³ä¸åˆ°ä½ æ˜¯è¿™æ ·çš„ boost. æˆ‘çœ‹é”™ä½ äº†! </p>
<p>å•Š, ä¸çŸ¥ä¸è§‰è¿™ä¸ªæ–‡æ¡£å·²ç»è¦åˆæ¬¡ç»“å°¾äº†å‘¢ :) è™½ç„¶åç»­åº”è¯¥æœ‰å¾ˆå¤šè¡¥å……å†…å®¹, æ¯”å¦‚æ ‡å‡†çš„ vector æ˜¯å¦‚ä½•åšçš„. åº•å±‚å…¶ä»–å®¹å™¨çš„ç‰¹æ€§â€¦ </p>
<p>ç°åœ¨è¿˜å‰©çš„æ˜¯: å†…å­˜æ˜¯æ€ä¹ˆåˆ†é…çš„. å…¶å®, æ¯”æ„æ–™ä¹‹ä¸­çš„è¿˜è¦ç®€å•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">_NODISCARD _DECLSPEC_ALLOCATOR _<span class="function">Ty* <span class="title">allocate</span><span class="params">(_CRT_GUARDOVERFLOW <span class="keyword">const</span> <span class="keyword">size_t</span> _Count)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">static_cast</span>&lt;_Ty*&gt;(_Allocate&lt;_New_alignof&lt;_Ty&gt;&gt;(_Get_size_of_n&lt;<span class="keyword">sizeof</span>(_Ty)&gt;(_Count)));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è°ƒç”¨äº† _Allocate </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">template</span> &lt;<span class="keyword">size_t</span> _Align, <span class="class"><span class="keyword">class</span> _<span class="title">Traits</span> = _<span class="title">Default_allocate_traits</span>,</span></span><br><span class="line"><span class="class">    <span class="title">enable_if_t</span>&lt;(!_HAS_ALIGNED_NEW || _Align &lt;= __STDCPP_DEFAULT_NEW_ALIGNMENT__), int&gt; = 0&gt;</span></span><br><span class="line"><span class="class">_<span class="title">DECLSPEC_ALLOCATOR</span> <span class="title">void</span>* _<span class="title">Allocate</span>(<span class="title">const</span> <span class="title">size_t</span> _<span class="title">Bytes</span>) &#123;</span></span><br><span class="line">    <span class="comment">// allocate _Bytes when !_HAS_ALIGNED_NEW || _Align &lt;= __STDCPP_DEFAULT_NEW_ALIGNMENT__</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(_M_IX86) || defined(_M_X64)</span></span><br><span class="line">    <span class="keyword">if</span> (_Bytes &gt;= _Big_allocation_threshold) &#123; <span class="comment">// boost the alignment of big allocations to help autovectorization</span></span><br><span class="line">        <span class="keyword">return</span> _Allocate_manually_vector_aligned&lt;_Traits&gt;(_Bytes);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// defined(_M_IX86) || defined(_M_X64)</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_Bytes != <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> _Traits::_Allocate(_Bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¦ä¹ˆæ‰§è¡Œä¼˜åŒ–ç‰ˆæœ¬çš„åˆ†é…, è¦ä¹ˆç›´æ¥åˆ†é…, æˆ‘ä»¬çœ‹çœ‹ç›´æ¥åˆ†é…çš„å°±å¥½</span></span><br><span class="line"><span class="comment">// åœ¨ _Default_allocate_traits ä¸‹: </span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">Default_allocate_traits</span> &#123;</span></span><br><span class="line">    _DECLSPEC_ALLOCATOR <span class="keyword">static</span> <span class="keyword">void</span>* _Allocate(<span class="keyword">const</span> <span class="keyword">size_t</span> _Bytes) &#123;</span><br><span class="line">        <span class="keyword">return</span> ::<span class="keyword">operator</span> <span class="keyword">new</span>(_Bytes);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __cpp_aligned_new</span></span><br><span class="line">    _DECLSPEC_ALLOCATOR <span class="keyword">static</span> <span class="keyword">void</span>* _Allocate_aligned(<span class="keyword">const</span> <span class="keyword">size_t</span> _Bytes, <span class="keyword">const</span> <span class="keyword">size_t</span> _Align) &#123;</span><br><span class="line">        <span class="keyword">return</span> ::<span class="keyword">operator</span> <span class="keyword">new</span> (_Bytes, <span class="keyword">align_val_t</span>&#123;_Align&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span> <span class="comment">// __cpp_aligned_new</span></span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> defined(_M_IX86) || defined(_M_X64)</span></span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> _Big_allocation_threshold = <span class="number">4096</span>;</span><br><span class="line"><span class="keyword">constexpr</span> <span class="keyword">size_t</span> _Big_allocation_alignment = <span class="number">32</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„æ–™ä¹‹å¤–çš„ç®€å•(å½“ç„¶, å†çœ‹ new åº•éƒ¨å°±ä¸é‚£ä¹ˆç®€å•äº†)</span></span><br></pre></td></tr></table></figure>]]></content>
  </entry>
  <entry>
    <title>other/TopLevelDirectoriesMeansInLinux</title>
    <url>/2020/03/31/other/TopLevelDirectoriesMeansInLinux/</url>
    <content><![CDATA[<h1 id="Top-Level-Directories-Means-In-Linux"><a href="#Top-Level-Directories-Means-In-Linux" class="headerlink" title="Top Level Directories Means In Linux"></a>Top Level Directories Means In Linux</h1><p>It looks like I havenâ€™t written some notes about Linux top-level directories. so do it now!</p>
<p>æˆ‘å¥½åƒè¿˜æ²¡å†™è¿‡å…³äº Linux é¡¶å±‚æ–‡ä»¶å«ä¹‰çš„ç¬”è®°, é‚£å°±ç°åœ¨å†™å§!</p>
<a id="more"></a>



<p><a href="https://www.granneman.com/tech/linux/thelinuxenvironment/topleveldirectories" target="_blank" rel="noopener">FROM</a></p>
<p><code>/</code>: The top level directory in your system. Itâ€™s called the root directory, because itâ€™s the root of the system: all the rest of the directory structure emanates from it like branches from the root of a tree. Donâ€™t get confused by the /root directory, by the way; thatâ€™s a different â€˜rootâ€™.</p>
<p>æ ¹èŠ‚ç‚¹, å« root ç›®å½•çš„æ—¶å€™, æœ‰ä¸¤ç§æ ¹æ®ä¸Šä¸‹æ–‡ä¸åŒè€Œå«ä¹‰ä¸åŒçš„é€‰é¡¹: æ ¹ç›®å½•(/), root ç”¨æˆ·æ ¹ç›®å½•(/root)</p>
<p><code>/bin</code>: Contains binaries for your system. The /bin directory is, by default, in your PATH, meaning that any executable file in this directory can be executed just by entering the file name at the command line.</p>
<p>äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ç›®å½•. é€šå¸¸ä¼šåœ¨ PATH ç¯å¢ƒå˜é‡ä¸­, æ‰§è¡Œçš„æ—¶å€™åªéœ€æä¾›å¯æ‰§è¡Œæ–‡ä»¶å.</p>
<p>(PS: æ‰€ä»¥æœ‰ç§ç›´æ¥æ‰§è¡Œå½“å‰ç›®å½•è€Œä¸å¸¦ ./ å‰ç¼€çš„æ–¹æ³•æ˜¯åœ¨ PATH ä¸­åŠ  . )</p>
<p>(æˆ‘çŒœçš„, å®æµ‹å¯è¡Œ!  <code>export PATH=$PATH:.</code>)</p>
<p><code>/boot</code>: Contains files necessary to boot your system, including the kernel.</p>
<p>åŒ…å«å¯åŠ¨ç³»ç»Ÿå¿…é¡»çš„æ–‡ä»¶, åŒ…æ‹¬å†…æ ¸.</p>
<p><code>/dev</code>: An abstracted directory which contains all your system devices: hard drives, CD-ROMs, sound cards, and much, much more. When devices are mounted, it occurs here.</p>
<p>è™šæ‹Ÿæ–‡ä»¶ç›®å½•, æ‰€æœ‰å¯æŒ‚è½½è®¾å¤‡éƒ½åœ¨è¿™é‡Œ.</p>
<p><code>/etc</code>: Contains most of the system and application configuration files your Linux machine uses. Back this directory up regularly.</p>
<p>åº”ç”¨å’Œç³»ç»Ÿçš„é…ç½®æ–‡ä»¶. å¾ˆé‡è¦, æ‰€ä»¥è¯·å‘¨æœŸæ€§ä¿å­˜å®ƒ.</p>
<p>(PS: ä¸ºä»€ä¹ˆå« etc å‘¢? etc æ˜¯ç­‰ç­‰çš„æ„æ€. æˆ‘è®°å¾—ä¹‹å‰æŸ¥è¿‡, æœ€åå¾—åˆ°çš„ç­”æ¡ˆæ˜¯, å†å²åŸå› â€¦  (â•¯â–”çš¿â–”)â•¯ )</p>
<p><code>/etc/skel</code>: â€œskeletonâ€ files used to create user accounts.</p>
<p>åˆ›å»ºç”¨æˆ·æ‰€éœ€çš„æ–‡ä»¶?</p>
<p>( PS: çœ‹äº†çœ‹, åŒ…æ‹¬ä¸‰ä¸ªæ–‡ä»¶ <code>.profile</code> <code>.bashrc</code> <code>.bash_logout</code> )</p>
<p><code>/home</code>: Contains the home directory for each system user.</p>
<p>åŒ…å«ç³»ç»Ÿç”¨æˆ·çš„ home ç›®å½•. </p>
<p>(PS: ä¸åŒ…å« root)</p>
<p><code>/lib</code>: System modules, software libraries, &amp; information databases, shared by various applications &amp; the system itself.</p>
<p>ç³»ç»Ÿæ¨¡å—, è½¯ä»¶/ä¿¡æ¯åº“. </p>
<p><code>/opt</code>: Optional software that you installed.</p>
<p>å¯é€‰è½¯ä»¶å®‰è£…ç›®å½•.</p>
<p><code>/proc</code>: Another abstracted directory which is created when the system boots. Contains information about the processes on your system.</p>
<p>ç³»ç»Ÿè¿è¡Œåˆ›å»ºçš„è™šæ‹Ÿç›®å½•. åŒ…å«è¿›ç¨‹ä¿¡æ¯.</p>
<p><code>/root</code>: The home directory of the root user.</p>
<p>root çš„ home.</p>
<p><code>/sbin</code>: Contains additional system binaries that are only available to root. Mostly admin tools.</p>
<p>admin å·¥å…·. åªå¯¹ root å¼€æ”¾.</p>
<p><code>/tmp</code>: The temporary directory. Any user can place stuff in here, but be forewarned: your system periodically cleans out this directory, and anything you leave in here will be deleted.</p>
<p>ä¸´æ—¶æ–‡ä»¶ç›®å½•</p>
<p><code>/usr</code>: Contains subdirectories that will be used system-wide by all users, including binaries, libraries, man files, and other things.</p>
<p>åŒ…å«æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨çš„å­ç›®å½•, åŒ…æ‹¬äºŒè¿›åˆ¶, åº“, man æ–‡ä»¶, ä»¥åŠå…¶ä»–.</p>
<p><code>/usr/doc</code>: Program documentation.</p>
<p>ç¨‹åºæ–‡æ¡£</p>
<p><code>/usr/info</code>: Program documentation.</p>
<p>ç¨‹åºæ–‡æ¡£</p>
<p><code>/usr/lib</code>: Program libraries (shareable system program modules).</p>
<p>ç¨‹åºåº“</p>
<p><code>/usr/man</code>: Manual pages.</p>
<p>man æ‰‹å†Œ</p>
<p><code>/var</code>: Contains variable data that changes in size as the system runs. For instance, log files, mail directories, databases, and printing spools.</p>
<p>éšç³»ç»Ÿè¿è¡Œè€Œæ”¹å˜çš„å„ç§æ•°æ®. åŒ…æ‹¬, æ—¥å¿—æ–‡ä»¶, é‚®ä»¶ç›®å½•, æ•°æ®åº“.</p>
<p>2020å¹´3æœˆ31æ—¥</p>
<p>å¥½åƒè¿˜æœ‰äº›é—æ¼, ä¸å®Œå…¨çš„, è¡¥ä¸€ä¸‹</p>
<p><a href="https://www.howtogeek.com/117435/htg-explains-the-linux-directory-structure-explained/" target="_blank" rel="noopener">FROM</a></p>
<p><code>/lost+found</code> â€“ Recovered Files</p>
<p>Each Linux file system has a lost+found directory. If the file system crashes, a file system check will be performed at next boot. Any corrupted files found will be placed in the lost+found directory, so you can attempt to recover as much data as possible.</p>
<p>æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿéƒ½åŒ…å«ä¸€ä¸ª lost+found ç›®å½•. å¦‚æœæ–‡ä»¶ç³»ç»Ÿå´©æºƒ, ä¸‹æ¬¡é‡å¯æ—¶ä¼šæ£€æŸ¥è¿™ä¸ªæ–‡ä»¶. ä»»ä½•è¢«å‘ç°çš„æŸåæ–‡ä»¶éƒ½ä¼šæ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹.</p>
<p>(PS: éƒ¨åˆ†ä¸ä¼š, æ¯”å¦‚ tmpfs å’Œ udev)</p>
<p><code>/mnt</code> â€“ Temporary Mount Points</p>
<p>Historically speaking, the /mnt directory is where system administrators mounted temporary file systems while using them. For example, if youâ€™re mounting a Windows partition to perform some file recovery operations, you might mount it at /mnt/windows. However, you can mount other file systems anywhere on the system.</p>
<p>å†å²ä¸Šæ¥è¯´, /mnt ç›®å½•åŒ…å«ç³»ç»Ÿç®¡ç†å‘˜ä½¿ç”¨æ—¶æŒ‚è½½çš„ä¸´æ—¶æ–‡ä»¶ç³»ç»Ÿ. æ¯”å¦‚, å¦‚æœä½ æŒ‚è½½ä¸€ä¸ª windows åˆ†åŒºæ‰§è¡Œä¸€äº›æ–‡ä»¶æ¢å¤æ“ä½œ, ä½ åº”è¯¥æŒ‚è½½åœ¨ /mnt/windows ä¸Š. ç„¶è€Œ, ä½ å¯ä»¥åœ¨ç³»ç»Ÿä»»ä½•åœ°æ–¹æŒ‚è½½æ–‡ä»¶.</p>
<p><code>/opt</code> â€“ Optional Packages</p>
<p>The /opt directory contains subdirectories for optional software packages. Itâ€™s commonly used by proprietary software that doesnâ€™t obey the standard file system hierarchy â€“ for example, a proprietary program might dump its files in /opt/application when you install it.</p>
<p>åŒ…å«å¯é€‰è½¯ä»¶åŒ…. è¿™é€šå¸¸ç”¨äºä¸éµå¾ªæ ‡å‡†æ–‡ä»¶ç³»ç»Ÿå±‚æ¬¡çš„ä¸“æœ‰è½¯ä»¶. æ¯”å¦‚, å°†ä¼šåœ¨å®‰è£…æ—¶ä¸‹è½½å…¶æ–‡ä»¶åˆ° /opt/application çš„ä¸“æœ‰ç¨‹åº. </p>
<p><code>/run</code> â€“ Application State Files</p>
<p>The /run directory is fairly new, and gives applications a standard place to store transient files they require like sockets and process IDs. These files canâ€™t be stored in /tmp because files in /tmp may be deleted.</p>
<p>ä¸€ä¸ªç¨‹åºå­˜å‚¨å…¶ä¸´æ—¶æ–‡ä»¶çš„åœ°æ–¹, è¿™äº›æ–‡ä»¶ä¸èƒ½å­˜å‚¨åˆ° /tmp, å› ä¸ºé‡Œé¢çš„æ–‡ä»¶ä¼šè¢«åˆ é™¤.</p>
<p><code>/srv</code> â€“ Service Data</p>
<p>The /srv directory contains â€œdata for services provided by the system.â€ If you were using the Apache HTTP server to serve a website, youâ€™d likely store your websiteâ€™s files in a directory inside the /srv directory.</p>
<p>ç³»ç»ŸæœåŠ¡æ–‡ä»¶æ•°æ®ç›®å½•. å¦‚æœä½¿ç”¨äº† Apache HTTP æœåŠ¡, é‚£ä¹ˆä½ åº”è¯¥æŠŠæ–‡ä»¶å­˜å‚¨åœ¨è¿™é‡Œ.</p>
<p>(PS: Apache é»˜è®¤ç›®å½•æ˜¯ â€˜/var/www/htmlâ€™ , æ€ä¹ˆæ›´æ”¹? è¿˜è®°å¾— /etc çš„ç”¨å¤„ä¹ˆ?)</p>
<p><code>/usr</code> â€“ User Binaries &amp; Read-Only Data</p>
<p>The /usr directory contains applications and files used by users, as opposed to applications and files used by the system. For example, non-essential applications are located inside the /usr/bin directory instead of the /bin directory and non-essential system administration binaries are located in the /usr/sbin directory instead of the /sbin directory. Libraries for each are located inside the /usr/lib directory. The /usr directory also contains other directories â€“ for example, architecture-independent files like graphics are located in /usr/share.</p>
<p>åŒ…å«ç”¨æˆ·ä½¿ç”¨çš„åº”ç”¨å’Œæ–‡ä»¶, è€Œä¸æ˜¯ç³»ç»Ÿæ‰€ä½¿ç”¨çš„åº”ç”¨å’Œæ–‡ä»¶. </p>
<p>The /usr/local directory is where locally compiled applications install to by default â€“ this prevents them from mucking up the rest of the system.</p>
<p><code>/var</code> â€“ Variable Data Files</p>
<p>The /var directory is the writable counterpart to the /usr directory, which must be read-only in normal operation. Log files and everything else that would normally be written to /usr during normal operation are written to the /var directory. For example, youâ€™ll find log files in /var/log.</p>
<p>ä¸ /usr ç›¸æ¯”, æ˜¯ä¸€ä¸ªå¯å†™å…¥çš„ç›®å½•. æ—¥å¿—åŠå…¶ä»–é€šå¸¸ä¼šå†™å…¥ /usr çš„æ•°æ®éƒ½ä¼šå†™å…¥åˆ° /var ç›®å½•. </p>
]]></content>
  </entry>
  <entry>
    <title>other/funnyThings</title>
    <url>/2020/03/31/other/funnyThings/</url>
    <content><![CDATA[<p>èŠä¸€ä¸‹å¤§æ¦‚åŠå¹´å‰çš„ä¸€æ¬¡è¯¯æ“ä½œå¯¼è‡´çš„æ•´ä¸ªæœåŠ¡å™¨æ•°æ®ä¸¢å¤±çš„é—®é¢˜. å•çº¯åˆ†äº«ä¸€ä¸‹, å°±å½“çœ‹æˆ.<br>(ä¹‹æ‰€ä»¥ç°åœ¨æ‰è¯´, æ˜¯æ€•è¢«é€®ä¸ªç°è¡Œâ€¦ é‚£å°±å°´å°¬äº†â€¦)  </p>
<a id="more"></a>

<p>å¼€å§‹æ­£é¢˜:<br>é‚£æ˜¯ä¸€ä¸ªé˜³å…‰æ˜åªšçš„ä¸‹åˆ, å¿™å®Œæ‰‹ä¸Šçš„ä¸œè¥¿, åˆšäº«å—ç€æ¸…é—²æ—¶å…‰çš„ LZ çªç„¶æ¥åˆ°äº†ä¸€ä¸ªåˆä½œæ–¹è¿è¥å‘æ¥çš„éœ€æ±‚.   </p>
<pre><code>äº²ğŸ˜™ è¿™è¾¹çœ‹æœåŠ¡å™¨ xxx æµæ°´å·²ç»æ¯”è¾ƒå°‘äº†å‘¢, ä¸ºäº†èŠ‚çº¦æˆæœ¬, å°†äº xxx å¯¹æœåŠ¡å™¨è¿›è¡Œé™é…. å¸Œæœ›é…åˆä¸€ä¸‹ ğŸ¤</code></pre><p>å“¦å“¦, åŸæ¥æ˜¯æ‰£13ç”²æ–¹åˆæƒ³èŠ‚çº¦æˆæœ¬ <img src="https://imgur.com/JGzIDMA.png" alt=""></p>
<p>å½³äºå£å·´, æŠŠè¿™å°æœåŠ¡å™¨çš„æœéƒ½å…³äº†, åˆ·ä¸€ä¸‹å¤–ç½‘æœåŠ¡å™¨çŠ¶æ€, ç­‰å¾…ä»–ä»¬æ“ä½œ.  </p>
<pre><code>å¥½çš„, æœåŠ¡å™¨å·²ç»å…³é—­äº†, éº»çƒ¦é™é…ä¹‹åå‘ŠçŸ¥ä¸€ä¸‹ ğŸ¤</code></pre><p>.</p>
<pre><code>æœåŠ¡å™¨æ€ä¹ˆè¿›ä¸å»å‘¢? @æˆ‘</code></pre><p>ç„¶åé—®é¢˜æ¥äº†, åˆä½œæ–¹æ“ä½œé‡å¯ä¹‹åæœåŠ¡å™¨è¿›ä¸å»â€¦ <img src="https://imgur.com/taxmpv7.png" alt="">  </p>
<pre><code>æˆ‘çœ‹çœ‹</code></pre><p>å°äº‹å°äº‹, å¾…è€å¤«ç™»å½•çœ‹çœ‹ <img src="https://imgur.com/u4nEsKg.png" alt="">    </p>
<p>ç„¶åæˆ‘ ssh ç™»å½•å‘ç°, åˆ†åŒºæ²¡äº†â€¦!!!  Î£(ã£Â°Ğ” Â°;)ã£ <img src="https://imgur.com/iFBtw0B.png" alt="">    </p>
<p>ä»”ç»†çœ‹çœ‹, æ²¡é”™, è€å¤«çš„ â€˜/dev/vdb1â€™ , æŒ‚è½½åœ¨ â€˜/dataâ€™ (æ‰€æœ‰æ•°æ®çš„ä¸»ç›®å½•) çš„åˆ†åŒºæ²¡äº†!!! <img src="https://imgur.com/lg1l2Vz.png" alt="">  </p>
<p>emmâ€¦ æ…Œä¸ªp, åæ­£ä¸å…³æˆ‘äº‹, åæ‰‹å°±æŠŠé—®é¢˜ä¸¢ç»™äº†å¯¹é¢ <img src="https://imgur.com/d6j3QXi.png" alt="">   </p>
<p>æœ¬æ¥äº‹æƒ…å¯èƒ½åˆ°æ­¤ä¸ºæ­¢, ä¸æˆ‘å·²æ— å…³, æ‰¾ä¸æ‰¾å›æ¥é”…éƒ½ä¸æ˜¯æˆ‘çš„. ä½†æ˜¯äº‹æƒ…å‡ºç°äº†è½¬æœºâ€¦ <img src="https://imgur.com/cqQAFFW.png" alt=""></p>
<p>å› ä¸ºå·²ç»å¤„ç†äº†ä¸€æ®µæ—¶é—´äº†, æˆ‘äº²åˆ‡åœ°é—®å€™äº†ä¸€ä¸‹åˆä½œæ–¹çš„è¿ç»´å°å“¥: </p>
<pre><code>æ‚¨å¥½, è¯·é—®é—®é¢˜è¿›å±•æ€ä¹ˆæ ·äº†? ğŸ˜Š</code></pre><p>å¯èƒ½å› ä¸ºäº‹æƒ…çš„ç¡®æ¯”è¾ƒå¤§, åˆšå¥½åˆºæ¿€åˆ°ä»–äº†, ä»–å›å¤:</p>
<pre><code>æ€¥ä»€ä¹ˆ? è¿™ä¸æ­£åœ¨çœ‹ä¹ˆ? </code></pre><p>ä¸­é€”åˆè¯´äº†å‡ å¥è¯¸å¦‚ â€œæˆ‘è¿™è¾¹æ²¡é—®é¢˜, ä½ ç¡®å®šä½ é‚£è¾¹æ²¡åšä»€ä¹ˆæ“ä½œ?â€ ä¹‹ç±»æƒ³ç”©é”…çš„è¯. æ€»ä¹‹æˆ‘ä¹Ÿè¢«åˆºæ¿€åˆ°äº†</p>
<p>è¡Œ! è€å¤«å°±æ‰¾è¯æ®!!! <img src="https://imgur.com/KS9TZk2.png" alt=""> </p>
<p>(ç„¶è€Œäº‹å®è¯æ˜å°±ä¸è¯¥å¤šäº‹â€¦) <img src="https://imgur.com/NEwh4DL.png" alt=""> </p>
<p>ä» history æ‰¾èµ·, df -h æˆªå›¾, vim /etc/fstab  â€¦<br>æœ¬å½“æˆ‘å·²ç»å¯è¶³åŠ›æ°”å‘æŒ¥æˆ‘åœ¨ç¥–å®‰å¤šå¹´å­¦æ¥çš„æŠ€æœ¯è¦æ€¼äººçš„æ—¶å€™  <img src="https://imgur.com/4yUa4zW.png" alt="">  <img src="https://imgur.com/cY7ux06.png" alt=""> </p>
<p>çªç„¶å‘ç°äº†æˆ‘çš„ä¸€ä¸ªè¿·ä¹‹æ“ä½œâ€¦ <img src="https://imgur.com/iFBtw0B.png" alt="">  </p>
<pre><code>fdisk /dev/vdb
mkfs.ext3 /dev/vdb
...
mount /dev/vdb1 /data</code></pre><p>è¿™ä¸€åˆ», è€å¤«ä¼¼ä¹æ˜ç™½äº†ä»€ä¹ˆâ€¦<br>ç®€å•æ¥è¯´, æˆ‘åˆ†åŒºäº† /dev/vdb1. ä½†æ˜¯å´åœ¨æ ¼å¼åŒ–çš„æ—¶å€™æ ¼å¼åŒ–äº† /dev/vdb !!! <img src="https://imgur.com/lg1l2Vz.png" alt=""> 1 æ²¡äº†!!!</p>
<p>æˆ‘æŠ“æˆ‘è‡ªå·±, è¿™ç§æ“ä½œæ²¡æƒ³åˆ°å‡ºç°åœ¨è‡ªå·±èº«ä¸Šäº† <img src="https://imgur.com/FKcBB4Y.png" alt="">  </p>
<p>æ€ä¹ˆåŠ, å®Œäº†, å¤§æ¸…å®Œäº†. æ€ä¹ˆåŠ, éš¾é“ç°åœ¨å°±è¦ç»†è½¯è·‘äº†ä¹ˆ <img src="https://imgur.com/r3QpOw9.png" alt="">   </p>
<p>æœ¬æ¥æƒ³è‡ªå·±æ“¦å±è‚¡, çœ‹æœ‰æ²¡æœ‰åŠæ³•å°†æ•°æ®æ¢å¤çš„<br>ä½†æ˜¯æˆ‘çœ‹åˆ°äº†ä¸€æ¡è®©æˆ‘æ‰“æ¶ˆæƒ³æ³•çš„æŒ‡ä»¤ <img src="https://imgur.com/FhTyJMk.png" alt="">   </p>
<p>(æŒ‡ä»¤åº”è¯¥æ˜¯å¯¹é¢è¿ç»´å°è¯•ä¿®å¤è€Œæ‰§è¡Œçš„, å…·ä½“æ˜¯å•¥å·²ç»å¿˜äº†, ä¸è¿‡çœ‹äº† man æ‰‹å†Œ, å¤§æ¦‚æ„æ€æ˜¯é‡æ–°æ‰«æä¿®å¤ç£ç›˜, æˆ‘åœ¨æˆ‘çš„æµ‹è¯•æœºä¸Šè¯•äº†è¯•, emmâ€¦ æ˜¯çš„, å¾ˆå¹²å‡€)  <img src="https://imgur.com/tRtuVf4.png" alt=""></p>
<p>å½³äºå£å·´, çœ‹æ¥é“å®šè¦å›å»å–ç…è›‹é¥¼äº†â€¦  </p>
<p>çŠ¹è±«å†ä¸‰, æƒ³äº†æƒ³å¯¹é¢è¿ç»´å°å“¥, æƒ³äº†æƒ³è‡ªå·±, æƒ³äº†æƒ³è¿˜æœªè¡¨ç™½çš„ç¾æœ¯å¦¹å­.<br>æˆ‘è¿˜æ˜¯æ¯…ç„¶åœ°èµ°å‘äº†è€å¤§â€¦ <img src="https://imgur.com/n671WzG.png" alt=""></p>
<p>// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“  </p>
<p>åç»­:<br>è€å¤§ä¸æ„§æ˜¯è€æ±Ÿæ¹–! å«æˆ‘ä¸è¦å£°å¼  <img src="https://imgur.com/MRQpKkV.png" alt=""><br>æˆ‘çš„æœ€åä¸€ç‚¹è‰¯å¿ƒä¹Ÿç»™ä»–ä»¬ç•™ä¸‹äº†ç½ªè¯, æ²¡æœ‰åˆ  history.</p>
<p>æœ€å, äº‹æƒ…è¿˜æ˜¯æ²¡è¢«å‘ç°, äº‹æƒ…ä¸äº†äº†ä¹‹ (è¿ç»´å°å“¥æ€ä¹ˆæ ·æˆ‘å°±ä¸çŸ¥é“äº†, æ¯•ç«Ÿé‚£æ˜¯æ•´å°æœåŠ¡å™¨çš„æ•°æ®, ç©å®¶å¯èƒ½å·²ç»ç‚¸é”…äº†â€¦)<br><img src="https://imgur.com/yVT26JL.png" alt="">  </p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/PermutationInString</title>
    <url>/2020/03/27/leetcode/PermutationInString/</url>
    <content><![CDATA[<h1 id="Permutation-in-String"><a href="#Permutation-in-String" class="headerlink" title="Permutation in String"></a>Permutation in String</h1><p><img src="https://imgur.com/b1Y77Az.png" alt=""></p>
<p>æ˜¯å¦å­˜åœ¨ç­‰ä»·å­ä¸²</p>
<a id="more"></a>



<h2 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">checkInclusion</span><span class="params">(<span class="built_in">string</span> s1, <span class="built_in">string</span> s2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s2.<span class="built_in">size</span>() &lt; s1.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; mp;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;v : s1) ++mp[v];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, b = <span class="number">0</span>; i &lt; s2.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!mp.count(s2[i])) &#123;</span><br><span class="line">                <span class="keyword">while</span> (b &lt; i &amp;&amp; mp.count(s2[b]) != <span class="number">0</span>)</span><br><span class="line">                    ++mp[s2[b++]];</span><br><span class="line">                b = i + <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (--mp[s2[i]] &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">while</span> (mp[s2[i]] &lt; <span class="number">0</span>)</span><br><span class="line">                    ++mp[s2[b++]];</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (i - b == s1.<span class="built_in">size</span>() - <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (s2.<span class="built_in">size</span>() - b &lt; s1.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨çš„æ˜¯æ»‘åŠ¨çª—å£æ¥åš. å…¶ä¸­ map å­˜æ”¾å…ƒç´ . ä¸è¿‡å¯ä»¥ä¸ç”¨é«˜çº§æ•°æ®ç»“æ„. å› ä¸ºå°å†™è‹±æ–‡å­—æ¯æ€»å…±ä¹Ÿå°± 26 ä¸ª, å…¶ä¸‹æ ‡åšç´¢å¼•. è¿˜å¯ä»¥çœå»ä¸€ä¸ª int. æœ‰ä¸€äº›ä¼˜åŒ–çš„ç‚¹, å¯ä»¥é€šè¿‡æœ€ä¼˜ç®—æ³•æ¥å€Ÿé‰´. </p>
<h2 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">match</span><span class="params">(<span class="keyword">int</span> map1[], <span class="keyword">int</span> map2[])</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">26</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (map1[i] != map2[i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">checkInclusion</span><span class="params">(<span class="built_in">string</span> str, <span class="built_in">string</span> <span class="built_in">text</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(str.length() &gt; <span class="built_in">text</span>.length())</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">int</span> *textMap = (<span class="keyword">int</span>*)<span class="built_in">calloc</span>(<span class="number">26</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="keyword">int</span> *strMap = (<span class="keyword">int</span> *)<span class="built_in">calloc</span>(<span class="number">26</span>, <span class="keyword">sizeof</span>(<span class="keyword">int</span>));</span><br><span class="line">        <span class="comment">// creating the maps with the relevant chars</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; str.length(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            textMap[<span class="built_in">text</span>[i] - <span class="string">'a'</span>]++;</span><br><span class="line">            strMap[str[i] - <span class="string">'a'</span>]++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// sliding window</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">text</span>.length() - str.length(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(match(strMap, textMap))</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            textMap[<span class="built_in">text</span>[i + str.length()] - <span class="string">'a'</span>]++;</span><br><span class="line">            textMap[<span class="built_in">text</span>[i] - <span class="string">'a'</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> match(strMap, textMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå…³é”®çš„ç‚¹æ˜¯æˆ‘ä¸å¿…ä¸€å¼€å§‹å°±å°†æ‰€æœ‰çš„ s2 è·å–. è¿™æ˜¯æˆ‘æ²¡æƒ³åˆ°çš„. (å…¶å®è¿™ä¹Ÿä¸éš¾æƒ³åˆ°, ä¸ºä»€ä¹ˆå‘¢ = =)</p>
<p>ä»–ä¹Ÿæ˜¯æ»‘åŠ¨çª—å£. è¿™æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«å¥½è¯´çš„. è¿™é‡Œé¡ºä¾¿è¯´ä¸€ä¸‹ calloc. è¿™æ˜¯ä¸€ä¸ªé™„å¸¦åˆå§‹åŒ–çš„ malloc. </p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/SubtreeOfAnotherTree</title>
    <url>/2020/03/27/leetcode/SubtreeOfAnotherTree/</url>
    <content><![CDATA[<h1 id="Subtree-of-Another-Tree"><a href="#Subtree-of-Another-Tree" class="headerlink" title="Subtree of Another Tree"></a>Subtree of Another Tree</h1><p><img src="https://imgur.com/UJvmRho.png" alt=""></p>
<p>åˆ¤æ–­æ˜¯å¦å­˜åœ¨å­æ ‘</p>
<a id="more"></a>



<h2 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isSubtree</span><span class="params">(TreeNode* s, TreeNode* t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!t) <span class="keyword">return</span> !s;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> findRoot(s, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">findRoot</span><span class="params">(TreeNode *s, TreeNode *t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!s) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">if</span> (s-&gt;val == t-&gt;val &amp;&amp; isMatch(s, t)) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> findRoot(s-&gt;left, t) || findRoot(s-&gt;right, t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isMatch</span><span class="params">(TreeNode *s, TreeNode *t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!t) <span class="keyword">return</span> !s;</span><br><span class="line">        <span class="keyword">if</span> (!s) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (s-&gt;val != t-&gt;val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> isMatch(s-&gt;left, t-&gt;left) &amp;&amp; isMatch(s-&gt;right, t-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç®€å•è§£é‡Šçš„è¯, å°±æ˜¯ â€œå½’å½’â€ ç®—æ³• ğŸ˜‚. é€’å½’å¥—é€’å½’, å°½ç®¡æˆ‘ååˆ†ä¸æƒ…æ„¿. ä½†æ˜¯å› ä¸ºè¿™ä¸æ˜¯ä¸ª bst çš„ç¼˜æ•…. åªæœ‰åœ¨é€’å½’ä¸­å»åˆ¤æ–­(è¿™ä¸ªåˆ¤æ–­ä¹Ÿéœ€è¦é€’å½’)æ‰æ¯”è¾ƒé«˜æ•ˆ, ä¸ç„¶å¦‚ä½•åˆ¤æ–­â€æ˜¯å¦å­˜åœ¨å…¶ä»–èŠ‚ç‚¹çš„å€¼å’Œè¿™ä¸ªèŠ‚ç‚¹ç›¸ç­‰, ä¹Ÿèƒ½è¿›è¡Œåˆ¤æ–­â€å°±ä¼šæˆä¸ºä¸€ä¸ªæ¯”è¾ƒè´¹åŠ›çš„é—®é¢˜. å†™å‡º â€œå½’å½’â€ å°±åƒğŸ®è¢«æŒ¤å‡ºäº†æœ€åä¸€æ»´ä¸€æ ·ä¸æƒ…æ„¿ğŸ˜­.</p>
<h2 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">eq</span><span class="params">(TreeNode* s, TreeNode* t)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!s &amp;&amp; !t) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (!s || !t) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> s-&gt;val == t-&gt;val &amp;&amp; eq(s-&gt;left, t-&gt;left) </span><br><span class="line">            &amp;&amp; eq(s-&gt;right, t-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isSubtree</span><span class="params">(TreeNode* s, TreeNode* t)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> s &amp;&amp; (eq(s, t) || isSubtree(s-&gt;left, t) || isSubtree(s-&gt;right, t));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcT5uw13DUFeKPYfuH6JCGMIm7c1CJ5BDdQtApGTGhFgQbCr0IyY" alt=""></p>
<p>å“ˆå“ˆå“ˆ, è€å“¥ä½ ä¹Ÿæ˜¯ â€œå½’å½’â€ å•Š.</p>
<p>å’³å’³, ä¸è¿‡æ¯”æˆ‘å°‘äº†ä¸€ä¸ªå‡½æ•°, ä»”ç»†çœ‹çœ‹. </p>
<pre><code>if (!t) return !s;
if (!s) return false;
// ---------------------
if (!s &amp;&amp; !t) return true;
if (!s || !t) return false;</code></pre><p>å°±è¿™ä¸¤ä¸ªè¡¨è¾¾å¼çš„å¤„ç†è€Œè¨€, è€å¤«è§‰å¾—è‡ªå·±è¦èƒœä¸€ç­¹! ç¬¬ä¸€ä¸ªè¡¨è¾¾å¼å°±æ˜¯å¦‚æœ t ä¸ºå‡, é‚£ä¹ˆ s ä¸º true åˆ™ false, åä¹‹äº¦å¯. </p>
<p>è€Œç¬¬äºŒä¸ªè¡¨è¾¾å¼å¯ä»¥åŸºäºç¬¬ä¸€ä¸ªè¡¨è¾¾å¼, è¿™æ—¶å€™ t å·²ç»ä¸å¯èƒ½ä¸º false äº†. å¦‚æœ s ä¸ºçœŸ, ç›´æ¥è¿”å› false å°±å¥½. </p>
]]></content>
  </entry>
  <entry>
    <title>other/newAnddelete</title>
    <url>/2020/03/27/other/newAnddelete/</url>
    <content><![CDATA[<h1 id="new-And-delete"><a href="#new-And-delete" class="headerlink" title="new And delete"></a>new And delete</h1><p>When I was a trainee at the training institution. I was shocked when my teacher shows me the secret blow â€˜newâ€™ and â€˜deleteâ€™. I still remember that day even I canâ€™t fully understand it. Itâ€™s time to resolve it by myself!</p>
<p>è‡³ä»Šæˆ‘è¿˜è®°å¾—åœ¨åŸ¹è®­çš„æ—¶å€™, è®²å¸ˆç»™æˆ‘æ¼”ç¤ºäº† new å’Œ delete çš„å†…éƒ¨å®ç°æ—¶æˆ‘çš„éœ‡æƒŠ. è™½ç„¶å½“æ—¶æ²¡æœ‰å®Œå…¨ç†è§£. æ˜¯æ—¶å€™è‡ªå·±çœ‹çœ‹äº†.</p>
<a id="more"></a>



<h2 id="new-class"><a href="#new-class" class="headerlink" title="new class"></a>new class</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">public:</span><br><span class="line">    int i &#x3D; 0;</span><br><span class="line">    char c &#x3D; 0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    A *pa &#x3D; new A;</span><br><span class="line">    pa-&gt;i &#x3D; 10;</span><br><span class="line">    printf(&quot;%d\n&quot;, pa-&gt;i);</span><br><span class="line">    delete pa;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; -------------------------------</span><br><span class="line">main:</span><br><span class="line">.LFB4945:</span><br><span class="line">        .loc 1 11 0</span><br><span class="line">        .cfi_startproc</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cafi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset 6, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register 6</span><br><span class="line">        pushq   %rbx</span><br><span class="line">        subq    $24, %rsp</span><br><span class="line">        .cfi_offset 3, -24</span><br><span class="line">        .loc 1 12 0</span><br><span class="line">        movl    $8, %edi</span><br><span class="line">        call    _Znwm@PLT</span><br><span class="line">        movq    %rax, %rbx</span><br><span class="line">        movq    %rbx, %rdi</span><br><span class="line">        call    _ZN1AC1Ev</span><br><span class="line">        movq    %rbx, -24(%rbp)</span><br><span class="line">        .loc 1 13 0</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        movl    $10, (%rax)</span><br><span class="line">        .loc 1 14 0</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        movl    (%rax), %eax</span><br><span class="line">        movl    %eax, %esi</span><br><span class="line">        leaq    .LC0(%rip), %rdi</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        call    printf@PLT</span><br><span class="line">        .loc 1 15 0</span><br><span class="line">        movq    -24(%rbp), %rax</span><br><span class="line">        movl    $8, %esi	&#x2F;&#x2F; ç¬¬äºŒä¸ªå‚æ•°æ˜¯å¤§å°</span><br><span class="line">        movq    %rax, %rdi	&#x2F;&#x2F; ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ this</span><br><span class="line">        call    _ZdlPvm@PLT</span><br><span class="line">        .loc 1 16 0</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        addq    $24, %rsp</span><br><span class="line">        popq    %rbx</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa 7, 8</span><br><span class="line">        ret</span><br><span class="line">        .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>æ²¡æœ‰ä»€ä¹ˆå¥½è¯´çš„, åˆ†é…ç©ºé—´, è°ƒç”¨æ„é€ . ç„¶åææ„.</p>
<h2 id="new-an-array-of-classes"><a href="#new-an-array-of-classes" class="headerlink" title="new an array of classes"></a>new an array of classes</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A &#123;</span><br><span class="line">public:</span><br><span class="line">    int i &#x3D; 0;</span><br><span class="line">    char c &#x3D; 0;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    A *pa &#x3D; new A[2];</span><br><span class="line">    pa-&gt;i &#x3D; 10;</span><br><span class="line">    printf(&quot;%d\n&quot;, pa-&gt;i);</span><br><span class="line">    delete[] pa;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; -------------------------------</span><br><span class="line">main:</span><br><span class="line">.LFB4945:</span><br><span class="line">        .loc 1 11 0</span><br><span class="line">        .cfi_startproc</span><br><span class="line">        pushq   %rbp</span><br><span class="line">        .cfi_def_cfa_offset 16</span><br><span class="line">        .cfi_offset 6, -16</span><br><span class="line">        movq    %rsp, %rbp</span><br><span class="line">        .cfi_def_cfa_register 6</span><br><span class="line">        pushq   %r13</span><br><span class="line">        pushq   %r12</span><br><span class="line">        pushq   %rbx</span><br><span class="line">        subq    $24, %rsp</span><br><span class="line">        .cfi_offset 13, -24</span><br><span class="line">        .cfi_offset 12, -32</span><br><span class="line">        .cfi_offset 3, -40</span><br><span class="line">        .loc 1 12 0</span><br><span class="line">        movl    $16, %edi</span><br><span class="line">        call    _Znam@PLT</span><br><span class="line">        movq    %rax, %r13</span><br><span class="line">        movq    %r13, %rax</span><br><span class="line">        movl    $1, %ebx</span><br><span class="line">        movq    %rax, %r12</span><br><span class="line">.L4:</span><br><span class="line">        .loc 1 12 0 is_stmt 0 discriminator 3</span><br><span class="line">        testq   %rbx, %rbx	&#x2F;&#x2F; æ¨å‡ºå¾ªç¯çš„æ¡ä»¶~</span><br><span class="line">        js      .L3</span><br><span class="line">        .loc 1 12 0 discriminator 2</span><br><span class="line">        movq    %r12, %rdi</span><br><span class="line">        call    _ZN1AC1Ev</span><br><span class="line">        addq    $8, %r12</span><br><span class="line">        subq    $1, %rbx</span><br><span class="line">        jmp     .L4	&#x2F;&#x2F; å¾ªç¯~</span><br><span class="line">.L3:</span><br><span class="line">        .loc 1 12 0</span><br><span class="line">        movq    %r13, -40(%rbp)</span><br><span class="line">        .loc 1 13 0 is_stmt 1</span><br><span class="line">        movq    -40(%rbp), %rax</span><br><span class="line">        movl    $10, (%rax)</span><br><span class="line">        .loc 1 14 0</span><br><span class="line">        movq    -40(%rbp), %rax</span><br><span class="line">        addq    $8, %rax</span><br><span class="line">        movl    $20, (%rax)</span><br><span class="line">                .loc 1 15 0</span><br><span class="line">        movq    -40(%rbp), %rax</span><br><span class="line">        movl    (%rax), %eax</span><br><span class="line">        movl    %eax, %esi</span><br><span class="line">        leaq    .LC0(%rip), %rdi</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        call    printf@PLT</span><br><span class="line">        .loc 1 16 0</span><br><span class="line">        movq    -40(%rbp), %rax</span><br><span class="line">        addq    $8, %rax</span><br><span class="line">        movl    (%rax), %eax</span><br><span class="line">        movl    %eax, %esi</span><br><span class="line">        leaq    .LC0(%rip), %rdi</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        call    printf@PLT</span><br><span class="line">        .loc 1 17 0</span><br><span class="line">        cmpq    $0, -40(%rbp)</span><br><span class="line">        je      .L5</span><br><span class="line">        .loc 1 17 0 is_stmt 0 discriminator 1</span><br><span class="line">        movq    -40(%rbp), %rax</span><br><span class="line">        movq    %rax, %rdi</span><br><span class="line">        call    _ZdaPv@PLT	&#x2F;&#x2F; åˆ é™¤æ•°ç»„åªæœ‰ this?</span><br><span class="line">.L5:</span><br><span class="line">        .loc 1 18 0 is_stmt 1</span><br><span class="line">        movl    $0, %eax</span><br><span class="line">        addq    $24, %rsp</span><br><span class="line">        popq    %rbx</span><br><span class="line">        popq    %r12</span><br><span class="line">        popq    %r13</span><br><span class="line">        popq    %rbp</span><br><span class="line">        .cfi_def_cfa 7, 8</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«æƒŠè‰³çš„, å¾—çœ‹çœ‹ _ZdaPv</p>
<h2 id="ZdaPv"><a href="#ZdaPv" class="headerlink" title="_ZdaPv"></a>_ZdaPv</h2><p><img src="https://imgur.com/nZAfmgn.png" alt=""></p>
<p><img src="https://imgur.com/kom6PWG.png" alt=""></p>
<p>â€¦</p>
<p>è·Ÿåäº†â€¦ ğŸ¤® </p>
<p>ä¸çŸ¥é“æœ‰å¤šå°‘å±‚ jnmp, å¤šå°‘ä¸ªå¾ªç¯â€¦ æˆ–è®¸ä¸æ˜¯ç°åœ¨ğŸ¤£â€¦ </p>
<p>ä¸è¿‡, è¿˜å¥½å˜›â€¦ è‡³å°‘çŸ¥é“äº†å¦‚ä½•æ“ä½œçš„â€¦ è™½ç„¶ä¸çŸ¥é“ç»†èŠ‚.</p>
<p>ä¸è¿‡æ ¹æ®æ¨æ–­, åˆ†é…çš„åªæœ‰ 16 å­—èŠ‚, é‚£ä¹ˆæ„æ€æ˜¯åº”è¯¥æ²¡æœ‰é¢å¤–çš„ç©ºé—´ç”¨äºä¿å­˜æ•°ç»„å¤§å°(è™½ç„¶æœ‰å¯èƒ½åœ¨å‡½æ•°å†…éƒ¨, ä½†æ„Ÿè§‰å¯èƒ½æ€§ä¸å¤§) </p>
<p>emmâ€¦ æœç„¶æˆ‘è¿˜æ˜¯ä¸å®‰åˆ†çš„äººå‘¢â€¦  </p>
<p>æˆ‘æœç„¶è¿˜æ˜¯å–œæ¬¢åšè¿™ä¸€ç±»çš„äº‹æƒ….</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/SubarraySumEqualsk</title>
    <url>/2020/03/24/leetcode/SubarraySumEqualsk/</url>
    <content><![CDATA[<h1 id="Subarray-Sum-Equals-k"><a href="#Subarray-Sum-Equals-k" class="headerlink" title="Subarray Sum Equals k"></a>Subarray Sum Equals k</h1><p><img src="https://imgur.com/QchplcW.png" alt=""></p>
<p>è¿ç»­å’Œæ¬¡æ•°</p>
<a id="more"></a>



<h2 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h2><p>é—®é¢˜åœ¨äºæ•°å­—æ˜¯æœ‰ç¬¦å·çš„. é‚£ä¹ˆå¦‚æœç”¨å•çº¯çš„é¦–ä½å‰è¿›çš„æ–¹å¼çš„è¯, å°±æ— æ³•å¾—çŸ¥ä½•æ—¶åº”è¯¥é¦–å‰è¿›, è€Œä½•æ—¶å°¾å‰è¿›. </p>
<p>æ¯”å¦‚æ•°å­—: [1, 2, -4], æ±‚å’Œ -1. å½“ä½ åœ¨ 1 çœ‹åˆ° 2 æ—¶, å¯èƒ½è§‰å¾—ä¹‹åçš„æ•°å­—éƒ½æ˜¯å¢åŠ çš„ ç„¶åå°±ä¸ç»§ç»­äº†. </p>
<p>(PS: è¿™é‡Œçªç„¶çœ‹åˆ°ä¸€ä¸ªäººç”Ÿå“²å­¦, ä½ çŸ¥é“ä¸‹ä¸€æ¬¡æ˜¯å¤±è´¥è¿˜æ˜¯æˆåŠŸ, ä½†æ˜¯ä¸çŸ¥é“è¿™ä¹‹ååˆæ˜¯ä»€ä¹ˆ, å¤§å¤šæ•°éƒ½åªçœ‹åˆ°ç›´æ¥çš„ç»“æœ, è€Œå¾ˆå°‘çœ‹åˆ°ç»“æœä¹‹åçš„ä¸œè¥¿. è¿™æ˜¯æˆ‘æ²¡æ”¾å¼ƒè¿™é“é¢˜çš„åŸå›  :), æœ¬æ¥æ²¡ä»€ä¹ˆå¥½çš„ç‚¹å­, æŒ‰ç…§æˆ‘çš„åšæ³•, ä¼šç•™åˆ°ä»¥ååšçš„, æˆ–è®¸è§£å†³è¿‘åœ¨å’«å°ºäº†å‘¢?)</p>
<p>æ‰€ä»¥é‡‡ç”¨äº†æœ€ç®€å•çš„æ–¹æ³•: </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">subarraySum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.<span class="built_in">size</span>(); ++i)</span><br><span class="line">            nums[i] += nums[i - <span class="number">1</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, sub = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; nums.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (nums[j] - sub == k) </span><br><span class="line">                    ++ret;</span><br><span class="line">            &#125;</span><br><span class="line">            sub = nums[i];</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è‚‰çœ¼å¯è§çš„å¹³æ–¹çº§/2. è™½ç„¶é€šè¿‡äº†, ä½†æ•ˆç‡æä½</p>
<h2 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">subarraySum</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; h;</span><br><span class="line">        h[<span class="number">0</span>]++;</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            sum += nums[i];</span><br><span class="line">            <span class="keyword">if</span> ( h.count(sum - k) )</span><br><span class="line">                count += h[sum-k];</span><br><span class="line">            ++h[sum];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ‰€ä»¥è¯´æ€è·¯å•Š = = â€¦ </p>
<p>å¾ˆç®€å•çš„, æ ¸å¿ƒæ˜¯ sum - k, å…¶å«ä¹‰æ˜¯ç¬¦åˆçš„å·²èµ°è·ç¦», æ¯”å¦‚å½“å‰ sum æ˜¯ 10, è€Œ k ä¸º 2. é‚£ä¹ˆæ‰€æœ‰ä¹‹å‰ sum ä¸º 8 çš„ç‚¹, , å…¶è·ç¦»è‡³å½“å‰ç‚¹çš„å’Œéƒ½å¯ä»¥æ»¡è¶³æ¡ä»¶. è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ 0 ä¸€å¼€å§‹åˆå§‹åŒ–ä¸º 1 çš„åŸå› . å› ä¸ºé‚£ç­‰åŒäºèµ·ç‚¹.</p>
]]></content>
  </entry>
  <entry>
    <title>read/OptimizationAndIndexes</title>
    <url>/2020/03/23/read/OptimizationAndIndexes/</url>
    <content><![CDATA[<h1 id="Optimization-and-Indexes"><a href="#Optimization-and-Indexes" class="headerlink" title="Optimization and Indexes"></a>Optimization and Indexes</h1><p>Indexes are used to find rows with specific column values quickly. Without an index, MySQL must<br>begin with the first row and then read through the entire table to find the relevant rows. The larger the<br>table, the more this costs. If the table has an index for the columns in question, MySQL can quickly<br>determine the position to seek to in the middle of the data file without having to look at all the data. This<br>is much faster than reading every row sequentially.</p>
<p>index ç”¨äºåŠ é€ŸæŸ¥è¯¢. </p>
<p>(PS: å°±æœ€ç®€å•æ¥è¯´, ç´¢å¼•ç›¸å½“äºä¸€ä¸ªäººçš„ç‰¹å¾. æŸ¥è¯¢æ•°æ®æ—¶ä¸ä¸€å®šéœ€è¦å®Œå…¨åŒ¹é…, ä¹Ÿä¸ä¸€å®šä¸€å¼€å§‹å°±éœ€è¦å®Œå…¨åŒ¹é…æœç´¢, è¿™æ—¶å€™ä½¿ç”¨ç´¢å¼•å°±ç›¸å½“äºæ‰¾äººæ—¶ä½¿ç”¨å¹´é¾„, æ€§åˆ«ç­‰ç‰¹å¾æ¥å¯»æ‰¾ä¸€æ ·, æ˜¯ä¸€ä¸ªå¾ˆç®€å•ä¹Ÿå¾ˆé‡è¦çš„æ¦‚å¿µ. å¦‚ä½•å¯»æ‰¾å¹¶è§„å®š index æ˜¯æå…¶é‡è¦çš„ä¸€ç¯)</p>
<a id="more"></a>



<p>Most MySQL indexes (PRIMARY KEY, UNIQUE, INDEX, and FULLTEXT) are stored in B-trees.<br>Exceptions: Indexes on spatial data types use R-trees; MEMORY tables also support hash indexes;<br>InnoDB uses inverted lists for FULLTEXT indexes.</p>
<p>å¤§å¤šæ•° MySQL ç´¢å¼•ç±»å‹ä¸º B-trees. é™¤äº†æŸäº›ç‰¹æ®Šæ¡ˆä¾‹: ç‰¹æ®Šæ•°æ®ç±»å‹ä½¿ç”¨ R-trees. å†…å­˜è¡¨æ”¯æŒ hash ç´¢å¼•. InnoDB å¯¹å…¨æ–‡ç´¢å¼•ä½¿ç”¨å€’æ’åºè¡¨. </p>
<p>In general, indexes are used as described in the following discussion. Characteristics specific to hash<br>indexes (as used in MEMORY tables) are described in Section 8.3.9, â€œComparison of B-Tree and Hash<br>Indexesâ€.<br>MySQL uses indexes for these operations:<br>â€¢ To find the rows matching a WHERE clause quickly.</p>
<ul>
<li>åŠ é€ŸæŸ¥è¯¢</li>
</ul>
<p>â€¢ To eliminate rows from consideration. If there is a choice between multiple indexes, MySQL normally<br>uses the index that finds the smallest number of rows (the most selective index).<br>â€¢ If the table has a multiple-column index, any leftmost prefix of the index can be used by the<br>optimizer to look up rows. For example, if you have a three-column index on (col1, col2,<br>col3), you have indexed search capabilities on (col1), (col1, col2), and (col1, col2,<br>col3).</p>
<p>â€¢ To retrieve rows from other tables when performing joins. MySQL can use indexes on columns<br>more efficiently if they are declared as the same type and size. In this context, VARCHAR and CHAR<br>are considered the same if they are declared as the same size. For example, VARCHAR(10) and<br>CHAR(10) are the same size, but VARCHAR(10) and CHAR(15) are not.<br>For comparisons between nonbinary string columns, both columns should use the same character<br>set. For example, comparing a utf8 column with a latin1 column precludes use of an index.<br>Comparison of dissimilar columns (comparing a string column to a temporal or numeric column, for<br>example) may prevent use of indexes if values cannot be compared directly without conversion. For<br>a given value such as 1 in the numeric column, it might compare equal to any number of values in<br>the string column such as â€˜1â€™, â€˜ 1â€™, â€˜00001â€™, or â€˜01.e1â€™. This rules out use of any indexes for<br>the string column.</p>
<p>åŒæ ·é•¿åº¦å’Œç±»å‹çš„ç´¢å¼•åœ¨å¤šè¡¨æŸ¥è¯¢æ—¶å¯ä»¥æé«˜æ•ˆç‡. ç±»å‹ä¸ä¸€è‡´, é•¿åº¦ä¸ä¸€è‡´, å­—ç¬¦é›†ä¸ä¸€è‡´ ç­‰éƒ½ä¼šé€ æˆæ— æ³•ä½¿ç”¨ç´¢å¼•çš„æƒ…å†µ. </p>
<p>â€¢ To find the MIN() or MAX() value for a specific indexed column key_col. This is optimized by a<br>preprocessor that checks whether you are using WHERE key_part_N = constant on all key<br>parts that occur before key_col in the index. In this case, MySQL does a single key lookup for each<br>MIN() or MAX() expression and replaces it with a constant. If all expressions are replaced with<br>constants, the query returns at once. For example:<br>SELECT MIN(key_part2),MAX(key_part2)<br>FROM tbl_name WHERE key_part1=10;<br>â€¢ To sort or group a table if the sorting or grouping is done on a leftmost prefix of a usable index (for<br>example, ORDER BY key_part1, key_part2). If all key parts are followed by DESC, the key<br>is read in reverse order. (Or, if the index is a descending index, the key is read in forward order.)</p>
<ul>
<li>åŠ é€Ÿ ORDER BY</li>
</ul>
<p>â€¢ In some cases, a query can be optimized to retrieve values without consulting the data rows. (An<br>index that provides all the necessary results for a query is called a covering index.) If a query uses<br>from a table only columns that are included in some index, the selected values can be retrieved from<br>the index tree for greater speed:<br>SELECT key_part3 FROM tbl_name<br>WHERE key_part1=1<br>Indexes are less important for queries on small tables, or big tables where report queries process most<br>or all of the rows. When a query needs to access most of the rows, reading sequentially is faster than<br>working through an index. Sequential reads minimize disk seeks, even if not all the rows are needed for<br>the query. See Section 8.2.1.23, â€œAvoiding Full Table Scansâ€ for details.</p>
<p>ç´¢å¼•å­˜åœ¨ä¸¤ç§ä¸é€‚ç”¨çš„æƒ…å†µ : ä¸€ç§æ˜¯å¯¹äºæ•°æ®å°‘çš„è¡¨æŸ¥è¯¢. å¦å¤–ä¸€ç§æ˜¯éœ€è¦è®¿é—®å¤§éƒ¨åˆ†è¡¨æ•°æ®çš„æŸ¥è¯¢, è¿™ç§æƒ…å†µä¸‹çš„é¡ºåºè¯»å–è¦æ¯”ç´¢å¼•å¿«, å³ä½¿å¤§éƒ¨åˆ†æ•°æ®éƒ½ä¸éœ€è¦. </p>
<h3 id="Primary-Key-Optimization"><a href="#Primary-Key-Optimization" class="headerlink" title="Primary Key Optimization"></a>Primary Key Optimization</h3><p>The primary key for a table represents the column or set of columns that you use in your most vital<br>queries. It has an associated index, for fast query performance. Query performance benefits from<br>the NOT NULL optimization, because it cannot include any NULL values. With the InnoDB storage<br>engine, the table data is physically organized to do ultra-fast lookups and sorts based on the primary<br>key column or columns.</p>
<p>è¡¨çš„ä¸»é”®æ˜¯æŸ¥è¯¢ä¸­ä½¿ç”¨çš„åˆ—. ä¸»é”®æœ‰ç›¸å…³çš„ç´¢å¼•, ç”¨äºåŠ é€ŸæŸ¥è¯¢. </p>
<p>If your table is big and important, but does not have an obvious column or set of columns to use as a<br>primary key, you might create a separate column with auto-increment values to use as the primary key.<br>These unique IDs can serve as pointers to corresponding rows in other tables when you join tables<br>using foreign keys.</p>
<p>å¦‚æœæ²¡æœ‰æ˜æ˜¾çš„åˆ—ä½œä¸ºä¸»é”®, å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå¢åˆ—ä½œä¸ºä¸»é”®. å”¯ä¸€ ID å¯ä½œä¸ºå¤–é”®.</p>
<h3 id="Multiple-Column-Indexes"><a href="#Multiple-Column-Indexes" class="headerlink" title="Multiple-Column Indexes"></a>Multiple-Column Indexes</h3><p>å¤šåˆ—ç´¢å¼•æ˜¯ç”±å¤šä¸ªåˆ—ç»„ä»çš„ç´¢å¼•(= = åºŸè¯)â€¦ å…¶ä½¿ç”¨æ–¹å¼å¿…é¡»ä»å·¦åˆ°å³, æ¯”å¦‚ç´¢å¼• (i1, i2, i3), åˆ™ä½¿ç”¨ (i1), (i1, i2), (i1, i2, i3) æŸ¥è¯¢æ—¶å¯ä½¿ç”¨ç´¢å¼•, å…¶ä½™æƒ…å†µå‡ä¸å¯ä½¿ç”¨ç´¢å¼• (ä¸é¡ºåºæ— å…³, ä¸å­˜åœ¨æœ‰å…³).</p>
<h3 id="Hash-Index-Characteristics"><a href="#Hash-Index-Characteristics" class="headerlink" title="Hash Index Characteristics"></a>Hash Index Characteristics</h3><p>Hash indexes have somewhat different characteristics from those just discussed:<br>â€¢ They are used only for equality comparisons that use the = or &lt;=&gt; operators (but are very fast). They<br>are not used for comparison operators such as &lt; that find a range of values. Systems that rely on<br>this type of single-value lookup are known as â€œkey-value storesâ€; to use MySQL for such applications,<br>use hash indexes wherever possible.</p>
<p>åªèƒ½ç”¨äºç­‰å¼/ä¸ç­‰å¼. (PS: æ„æ–™ä¹‹ä¸­, hash å¹¶æ²¡æœ‰ä»»ä½•æ¯”è¾ƒ)</p>
<p>â€¢ The optimizer cannot use a hash index to speed up ORDER BY operations. (This type of index cannot<br>be used to search for the next entry in order.)</p>
<p>ä¸èƒ½ç”¨äº ORDER BY ä¼˜åŒ– (PS: åŒç†)</p>
<p>â€¢ MySQL cannot determine approximately how many rows there are between two values (this is used<br>by the range optimizer to decide which index to use). This may affect some queries if you change a<br>MyISAM or InnoDB table to a hash-indexed MEMORY table.</p>
<p>ä¸èƒ½å¾—çŸ¥ä¸¤å€¼ä¹‹é—´å­˜åœ¨å¤šå°‘è¡Œ/ </p>
<p>â€¢ Only whole keys can be used to search for a row. (With a B-tree index, any leftmost prefix of the key<br>can be used to find rows.)</p>
<p>åªæ”¯æŒå…¨å€¼åŒ¹é…. </p>
<p>(PS: è¿™äº›é™åˆ¶å’Œç‰¹æ€§çš„æ ¹æºå°±æ˜¯ hash è‡ªèº«çš„ç‰¹æ€§)</p>
<h3 id="Use-of-Index-Extensions"><a href="#Use-of-Index-Extensions" class="headerlink" title="Use of Index Extensions"></a>Use of Index Extensions</h3><p>InnoDB automatically extends each secondary index by appending the primary key columns to it.</p>
<pre><code>Consider this table definition:
CREATE TABLE t1 (
i1 INT NOT NULL DEFAULT 0,
i2 INT NOT NULL DEFAULT 0,
d DATE DEFAULT NULL,
PRIMARY KEY (i1, i2),
INDEX k_d (d)
) ENGINE = InnoDB;</code></pre><p>This table defines the primary key on columns (i1, i2). It also defines a secondary index k_d on<br>column (d), but internally InnoDB extends this index and treats it as columns (d, i1, i2).<br>The optimizer takes into account the primary key columns of the extended secondary index when<br>determining how and whether to use that index. This can result in more efficient query execution plans<br>and better performance.<br>The optimizer can use extended secondary indexes for ref, range, and index_merge index access,<br>for Loose Index Scan access, for join and sorting optimization, and for MIN()/MAX() optimization.<br>The following example shows how execution plans are affected by whether the optimizer uses<br>extended secondary indexes. Suppose that t1 is populated with these rows:</p>
<p>MySQL è‡ªåŠ¨æ‰©å±•æ¬¡çº§ç´¢å¼•. </p>
<h3 id="Optimizer-Use-of-Generated-Column-Indexes"><a href="#Optimizer-Use-of-Generated-Column-Indexes" class="headerlink" title="Optimizer Use of Generated Column Indexes"></a>Optimizer Use of Generated Column Indexes</h3><p>MySQL supports indexes on generated columns. For example:</p>
<pre><code>CREATE TABLE t1 (f1 INT, gc INT AS (f1 + 1) STORED, INDEX (gc));</code></pre><p>The generated column, gc, is defined as the expression f1 + 1. The column is also indexed and the<br>optimizer can take that index into account during execution plan construction. In the following query,<br>the WHERE clause refers to gc and the optimizer considers whether the index on that column yields a<br>more efficient plan:</p>
<pre><code>SELECT * FROM t1 WHERE gc &gt; 9;</code></pre><p>The optimizer can use indexes on generated columns to generate execution plans, even in the<br>absence of direct references in queries to those columns by name. This occurs if the WHERE, ORDER<br>BY, or GROUP BY clause refers to an expression that matches the definition of some indexed generated<br>column. The following query does not refer directly to gc but does use an expression that matches the<br>definition of gc:</p>
<pre><code>SELECT * FROM t1 WHERE f1 + 1 &gt; 9;</code></pre><p>The optimizer recognizes that the expression f1 + 1 matches the definition of gc and that gc<br>is indexed, so it considers that index during execution plan construction. You can see this using<br>EXPLAIN:</p>
<pre><code>mysql&gt; EXPLAIN SELECT * FROM t1 WHERE f1 + 1 &gt; 9\G
*************************** 1. row ***************************
id: 1
select_type: SIMPLE
table: t1
partitions: NULL
type: range
possible_keys: gc
key: gc
key_len: 5
ref: NULL
rows: 1
filtered: 100.00
Extra: Using index condition</code></pre><p>generated column æŒ‡çš„æ˜¯ä¸€ä¸ªåŒ…å«å…¶ä»–å­—æ®µçš„è¡¨è¾¾å¼. </p>
<h3 id="Descending-Indexes"><a href="#Descending-Indexes" class="headerlink" title="Descending Indexes"></a>Descending Indexes</h3><p>MySQL supports descending indexes: DESC in an index definition is no longer ignored but causes<br>storage of key values in descending order. Previously, indexes could be scanned in reverse order but<br>at a performance penalty. A descending index can be scanned in forward order, which is more efficient.<br>Descending indexes also make it possible for the optimizer to use multiple-column indexes when the<br>most efficient scan order mixes ascending order for some columns and descending order for others.<br>Consider the following table definition, which contains two columns and four two-column index<br>definitions for the various combinations of ascending and descending indexes on the columns:</p>
<pre><code>CREATE TABLE t (
c1 INT, c2 INT,
INDEX idx1 (c1 ASC, c2 ASC),
INDEX idx2 (c1 ASC, c2 DESC),
INDEX idx3 (c1 DESC, c2 ASC),
INDEX idx4 (c1 DESC, c2 DESC)
);</code></pre><p>The table definition results in four distinct indexes. The optimizer can perform a forward index scan for<br>each of the ORDER BY clauses and need not use a filesort operation:</p>
<pre><code>ORDER BY c1 ASC, c2 ASC -- optimizer can use idx1
ORDER BY c1 DESC, c2 DESC -- optimizer can use idx4
ORDER BY c1 ASC, c2 DESC -- optimizer can use idx2
ORDER BY c1 DESC, c2 ASC -- optimizer can use idx3</code></pre><p>å¯ä»¥æŒ‡å®šç´¢å¼•åˆ—çš„é¡ºåº, ä»¥ç”¨äº ORDER BY ä¼˜åŒ–.</p>
<h3 id="Indexed-Lookups-from-TIMESTAMP-Columns"><a href="#Indexed-Lookups-from-TIMESTAMP-Columns" class="headerlink" title="Indexed Lookups from TIMESTAMP Columns"></a>Indexed Lookups from TIMESTAMP Columns</h3><p>Temporal values are stored in TIMESTAMP columns as UTC values, and values inserted into and<br>retrieved from TIMESTAMP columns are converted between the session time zone and UTC. (This is<br>the same type of conversion performed by the CONVERT_TZ() function. If the session time zone is<br>UTC, there is effectively no time zone conversion.)</p>
<p>åœ¨ TIMESTAMP ä¸­çš„å€¼ä»¥ UTC è§„èŒƒå­˜å‚¨. è¯»å–å’Œå†™å…¥åœ¨ä¼šè¯æ—¶åŒºå’Œ UTC ä¹‹é—´è½¬æ¢. (æ•ˆæœå’Œä½¿ç”¨ CONVERT_TZ å‡½æ•°ä¸€æ ·. å¦‚æœæ—¶åŒºå·²ç»æ˜¯ UTC äº†, é‚£ä¹ˆä¸éœ€è¦è½¬æ¢)</p>
<p>Due to conventions for local time zone changes such as Daylight Saving Time (DST), conversions<br>between UTC and non-UTC time zones are not one-to-one in both directions. UTC values that are<br>distinct may not be distinct in another time zone. The following example shows distinct UTC values that<br>become identical in a non-UTC time zone:</p>
<pre><code>mysql&gt; CREATE TABLE tstable (ts TIMESTAMP);
mysql&gt; SET time_zone = &apos;UTC&apos;; -- insert UTC values
mysql&gt; INSERT INTO tstable VALUES
(&apos;2018-10-28 00:30:00&apos;),
(&apos;2018-10-28 01:30:00&apos;);
mysql&gt; SELECT ts FROM tstable;
+---------------------+
| ts |
+---------------------+
| 2018-10-28 00:30:00 |
| 2018-10-28 01:30:00 |
+---------------------+
mysql&gt; SET time_zone = &apos;MET&apos;; -- retrieve non-UTC values
mysql&gt; SELECT ts FROM tstable;
+---------------------+
| ts |
+---------------------+
| 2018-10-28 02:30:00 |
| 2018-10-28 02:30:00 |
+---------------------+</code></pre><h1 id="Other"><a href="#Other" class="headerlink" title="Other"></a>Other</h1><h2 id="why-b-trees"><a href="#why-b-trees" class="headerlink" title="why b-trees ?"></a>why b-trees ?</h2><p>å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆæ˜¯ b æ ‘, åˆ°åº•ä¼˜åŠ¿åœ¨å“ªé‡Œ? <a href="https://stackoverflow.com/questions/6211118/b-trees-vs-binary-trees" target="_blank" rel="noopener">answer</a></p>
<p>Algorithmic complexity is the same, since O(logb n) = O(c log n) = O(log n) but the constant factors, which are hidden in big-O notation, could vary noticeably, depending on implementation and hardware.</p>
<p>ç®—æ³•çš„å¤æ‚åº¦æ˜¯ä¸€æ ·çš„.</p>
<p>B-trees were designed for platter hard disks, which have a large access time (moving the head into position) after which an entire physical sector is read. Making the B-tree nodes as large as the sector minimizes the number of access times and maximizes the useful data out of each read operation.</p>
<p>B-trees ä¸ºç¡¬ç›˜è€Œè®¾è®¡, å°†å…¶èŠ‚ç‚¹è®¾ç½®ä¸ºæœ€å°æ‰‡åŒºå¤§å°å¯ä»¥å‡å°‘è®¿é—®æ—¶é—´, æœ€å¤§åŒ–åˆ©ç”¨æ¯ä¸ªè¯»å–å‡ºçš„æ•°æ®.</p>
<p>But if you are working out of memory you have a negligible access time, therefore a better comparison is to count the number of single words accessed by your algorithm.</p>
<p>å¦‚æœç”¨å®Œäº†å†…å­˜, å°†ä¼šæœ‰è½»å¾®çš„æ¶ˆè€—. ä¸€ä¸ªå¯¹æ¯”ç‚¹æ˜¯è®¡ç®—ç®—æ³•è®¿é—®çš„å•ä¸ªå­—ç¬¦æ•°.</p>
<p>For example, letâ€™s plan a data structure to store 220 keys of 1 word each, for a total of 4MiB of raw data on a 32bit machine.</p>
<p>A binary search tree will have 220 nodes, each holding one key and two pointers (3 words). Depth will be log2(220) = 20. The average search will have to read the key and one of the pointers from each node in its path, from the root all the way down = <strong>40 words</strong>.</p>
<p>A B-tree made for hard disks will have 4kB nodes. Each node could be stored internally as a sorted array of key and pointer couples, between 256 and 512 of them. What is the average search going to look like? Considering an average 3/4 fill, each node will contain 384 entries, and its internal binary search will have to visit on average log2(384) = 5.95 keys. The average depth will be log384(220) = 2.33, so our search will have to read on average 2.33 times 5.95 keys, or about <strong>14 words</strong>.</p>
<p>(PS: è¿™é‡Œå› ä¸ºæ ¼å¼çš„é—®é¢˜, 220 çš„å«ä¹‰æ˜¯ 2çš„ 20æ¬¡æ–¹. è¿™é‡Œæƒ³è¡¨è¾¾çš„æ˜¯: å¦‚æœæ˜¯ bst å­˜å‚¨, æ¯ä¸ªèŠ‚ç‚¹å¯èƒ½åˆ†å¸ƒåœ¨ä¸åŒçš„æ‰‡åŒºä¸Š, ä¸€æ¬¡ç£ç›˜è®¿é—®å¾—åˆ°çš„æœ‰ç”¨ä¿¡æ¯æœ€åçš„æƒ…å†µæ˜¯åªèƒ½ä½¿ç”¨ä¸€æ¬¡, è€Œ B-trees å°†å…¶å°½å¯èƒ½æœ€å¤§åŒ–, ä¸º s(æ‰‡åŒºå¤§å°) / n(å•ä¸ªèŠ‚ç‚¹å¤§å°) æ¬¡, æ‰€ä»¥è™½ç„¶æœç´¢çš„æ•ˆç‡æ˜¯åŸºæœ¬ä¸€è‡´çš„, ä½†æ˜¯å…¶æ¯æ¬¡ I/O æ‰€å¾—çš„æœ‰æ•ˆç‡æ˜¯å®Œå…¨ä¸åŒçš„. è¿™æ˜¯ B-trees å¹¿æ³›åº”ç”¨äºæ•°æ®åº“çš„æ ¹æºæ‰€åœ¨.)</p>
<p>In the case of a low-fanout (branching factor) B-tree, with each node holding between 16 and 32 keys, the average fill will be 24 keys, the average depth log24(220) = 4.36, the binary search in each node will make log2(24) = 4.58 comparisons, and the overall average search will have to read about <strong>20 words</strong>.</p>
<p>Keep in mind that the last two data structures achieve a better result than binary trees because they <strong>optimize read operations</strong> over modifications. To insert a key into one of these B-trees you would have to rewrite on average an entire 384-word or 24-word node, if not more than one, while in the binary-tree case a write operation would still only need to touch up to 40 words.</p>
<p>(PS: è¿™é‡Œè¯´çš„æ˜¯å…³äºæ•°æ®æ’å…¥, B-trees å¯èƒ½å­˜åœ¨æœ€åæƒ…å†µ, è™½ç„¶å­˜åœ¨çš„æœ€å¥½æƒ…å†µä¼˜äº bst)</p>
<h2 id="R-trees"><a href="#R-trees" class="headerlink" title="R-trees"></a><a href="https://en.wikipedia.org/wiki/R-tree" target="_blank" rel="noopener">R-trees</a></h2><p>R-trees æ˜¯ä¸“ç”¨äºç©ºé—´å­˜å‚¨çš„æ•°æ®ç»“æ„. å…¶ç»“æ„å’Œ B-trees ç±»ä¼¼, ä¸“ç”¨äºå­˜å‚¨ç©ºé—´ä¿¡æ¯, å­èŠ‚ç‚¹å’Œçˆ¶èŠ‚ç‚¹çš„å…³ç³»ä¸ºç›¸äº¤. çˆ¶èŠ‚ç‚¹åŒ…å«å­èŠ‚ç‚¹(ä½†ä¸ä¸€å®šå®Œå…¨)</p>
<p><strong>R-trees</strong> are tree data structures used for spatial access methods, i.e., for indexing multi-dimensional information such as geographical coordinates, rectangles or polygons.</p>
<p>R-trees æ˜¯ç”¨äºç´¢å¼•å¤šç»´ä¿¡æ¯, å¦‚åœ°ç†åæ ‡, çŸ©é˜µ, æˆ–å¤šè¾¹å½¢çš„æ•°æ®ç»“æ„.</p>
<p>(PS: æˆ‘è¿™é‡Œå†æ¬¡æ·±æ€, ä»€ä¹ˆæ˜¯æ•°æ®ç»“æ„? æ•°æ®çš„ç»„ç»‡æ–¹å¼. æ•°æ®çš„ç»„ç»‡æ–¹å¼ç”±å…¶è®¿é—®æ–¹å¼åŠå­˜å‚¨æ–¹å¼å†³å®š. ä¸åŒçš„æ•°æ®ç»“æ„å°±æ˜¯ä¸ºäº†ä¸åŒçš„ç›®çš„è€Œç”Ÿçš„. ä¾‹å¦‚ B-trees å®ƒé’ˆå¯¹è®¿é—®åšäº†ä¼˜åŒ–. å°½å¯èƒ½å‡å°‘å…¶ I/O, ä»¥æé«˜æ•ˆç‡. å˜é‡çš„å‰å, çƒ­ç‚¹. éƒ½æ˜¯å¾ˆé‡è¦çš„ç‚¹. å†è€ƒè™‘ä¸€ä¸‹ B+tree, ä»–çš„ä¼˜ç‚¹æ˜¯å¶å­èŠ‚ç‚¹åŒ…å«æ‰€æœ‰æ•°æ®, å½“è¿›è¡Œå…¨è¡¨è®¿é—®æ—¶, å°±æ˜¯ä¸€ä¸ªçº¿æ€§çš„æ—¶é—´, åŒæ—¶, å¯ä»¥ä½¿ç”¨äºŒåˆ†. å¯èƒ½æ˜¯å¤„äºè¿™æ ·çš„ç›®çš„, æ‰æœ‰äº†ä¼˜åŒ–ç‰ˆæœ¬çš„ B+trees. è€Œ R-trees , ç”¨äºå¤šç»´ä¿¡æ¯. å…¶çˆ¶å­èŠ‚ç‚¹çš„å…³ç³»å˜æˆäº†ç±»ä¼¼åŒ…å«/è¢«åŒ…å«çš„å…³ç³». å¯ä»¥å¤„ç†ä¸€äº›ä¾‹å¦‚ xx ç¦» xx å¤šè¿œ. xx é™„è¿‘æœ‰å“ªäº›å»ºç­‘â€¦ å¹¿æ³›æ¥è¯´, æ˜¯ â€œç»„ç»‡â€. èº«è¾¹çš„äº‹ç‰©éƒ½æœ‰ç»„ç»‡, å…¬å¸çš„ç®¡ç†çº§. çœå¸‚åŒºçš„åˆ’åˆ†. ç”µè„‘çš„æ„æˆâ€¦ )</p>
]]></content>
  </entry>
  <entry>
    <title>other/aboutUseServiceToControlMysqld</title>
    <url>/2020/03/12/other/aboutUseServiceToControlMysqld/</url>
    <content><![CDATA[<h1 id="aboutUseServiceToControlMysqld"><a href="#aboutUseServiceToControlMysqld" class="headerlink" title="aboutUseServiceToControlMysqld"></a>aboutUseServiceToControlMysqld</h1><p>é€šå¸¸æ˜¯é€šè¿‡ service è¿™ä¸ªæŒ‡ä»¤æ¥æ§åˆ¶ mysql çš„. ä½œä¸ºä¸€æ¡æœ‰æ¢¦æƒ³çš„å’¸é±¼. åªä½¿ç”¨ service è€Œä¸ç”¨ mysql åŸå§‹æŒ‡ä»¤, è¿™æ€ä¹ˆèƒ½è¡Œ<del>(ï¿£â–½ï¿£)</del>*. æ‰€ä»¥å°±è¯•äº†è¯• (ä½œæ­») ä½¿ç”¨ mysql åŸç”Ÿçš„æŒ‡ä»¤æ¥æ§åˆ¶. è¯•äº†è¯•å‘ç°, å…¶å®è¿˜æ˜¯æœ‰ä¸€äº›å‘çš„.</p>
<p>No zuo no die.</p>
<a id="more"></a>



<h2 id="mysqld"><a href="#mysqld" class="headerlink" title="mysqld"></a>mysqld</h2><p>æ ¹æ® mysql å®˜æ–¹æ–‡æ¡£ 4-3 èŠ‚å¼€å¤´çš„: </p>
<pre><code>This section describes mysqld, the MySQL server, and several programs that are used to start the server.</code></pre><p>å¯çŸ¥ mysqld å°±æ˜¯ mysql çš„æœåŠ¡ç«¯. </p>
<h3 id="mysqld-safe"><a href="#mysqld-safe" class="headerlink" title="mysqld_safe"></a>mysqld_safe</h3><p>mysqld_safe is the recommended way to start a mysqld server on Unix. mysqld_safe adds some<br>safety features such as restarting the server when an error occurs and logging runtime information to<br>an error log</p>
<p>ä¸€ä¸­é™„å¸¦ä¸€äº›åŠŸèƒ½çš„ mysqld</p>
<h3 id="mysql-server"><a href="#mysql-server" class="headerlink" title="mysql.server"></a>mysql.server</h3><p>MySQL distributions on Unix and Unix-like system include a script named mysql.server, which starts<br>the MySQL server using mysqld_safe. It can be used on systems such as Linux and Solaris that use<br>System V-style run directories to start and stop system services. It is also used by the macOS Startup<br>Item for MySQL.</p>
<p>ä¸€ä¸ªä½¿ç”¨ mysqld çš„è„šæœ¬.</p>
<h2 id="Zuo"><a href="#Zuo" class="headerlink" title="Zuo"></a>Zuo</h2><p>ä¸€å¼€å§‹æˆ‘æ˜¯æƒ³ service å…³é—­ä¹‹åç›´æ¥ mysqld çš„, ç»“æœ mysqld å¹¶ä¸å»ºè®®ä½¿ç”¨ root å¯åŠ¨:</p>
<pre><code>2020-03-11T09:19:32.477114Z 0 [ERROR] [MY-010123] [Server] Fatal error: Please read &quot;Security&quot; section of the manual to find out how to run mysqld as root!
2020-03-11T09:19:32.477401Z 0 [ERROR] [MY-010119] [Server] Aborting</code></pre><p>google äº†ä¸€ä¸‹, éœ€è¦æŒ‡å®š<code>--user=root</code>, ä½†æ˜¯ä¸èƒ½æ­£å¸¸è¿è¡Œ, ä¸ºä»€ä¹ˆå‘¢? æŸ¥äº†ä¸€ä¸‹ log </p>
<pre><code>Could not create unix socket lock file /var/run/mysqld/mysqld.sock.lock.</code></pre><p>äºæ˜¯åˆ google äº†ä¸€ä¸‹, ç®€å•çš„æ–¹æ¡ˆæ˜¯åˆ›å»º /var/run/mysqld/ è¿™ä¸ªæ–‡ä»¶å¤¹. è¿™ä¸ªæ–‡ä»¶å¤¹çš„ç”¨å¤„æ˜¯:</p>
<pre><code>This directory was once intended for system information data describing the system since it was booted. These functions have been moved to /run; this directory exists to ensure compatibility with systems and software using an older version of this specification.</code></pre><p>å¥½åƒæœ‰ç‚¹ä¸å¦™â€¦ ä¸ºä»€ä¹ˆéœ€è¦æˆ‘æ¥åˆ›å»º? è¿™æ—¶å€™æˆ‘æœ‰ç‚¹æ˜ç™½ä¸ºä»€ä¹ˆç­”æ¡ˆå¤§å¤šéƒ½æ˜¯ä½¿ç”¨ service å¯åŠ¨äº†.</p>
<p>ç»“æœæ˜¯æ­£å¸¸è¿è¡Œäº†. ä½†æ˜¯è¡¨ç°å¾ˆå¥‡æ€ª, é¦–å…ˆæ˜¯è¿›ç¨‹æ— ååº”. å¥½åƒä¸€ç›´åœ¨ç­‰å¾…è¾“å…¥. ä½†æ˜¯ç”¨å…¶ä»–çš„ ssh ä¸Šå»è¯• mysql çš„åŠŸèƒ½æ˜¯æ­£å¸¸çš„. å¹¶ä¸”æŠŠå½“å‰ ssh å…³äº†ä¹Ÿæ˜¯æ­£å¸¸çš„.</p>
<p>è¿™æ—¶å€™æˆ‘å‡†å¤‡è¯•è¯•å…³é—­äº†, æŸ¥äº†ä¸€ä¸‹, æ¯”è¾ƒæ¨èçš„æ–¹æ¡ˆæ˜¯ <code>mysqladmin -u root -p shutdown</code> , ä½¿ç”¨äº†ä¹‹åè¾“å…¥ mysql root å¯†ç å°±å¥½äº†. å…³é—­ä¹Ÿæ¯”è¾ƒæ­£å¸¸. ä½†æ˜¯å½“æˆ‘å†ä½¿ç”¨ service å¯åŠ¨æ—¶å€™, é—®é¢˜å‡ºç°äº†.</p>
<pre><code>â— mysql.service - MySQL Community Server
   Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled)
   Active: failed (Result: exit-code) since Wed 2020-03-11 16:42:24 CST; 17min ago
     Docs: man:mysqld(8)
           http://dev.mysql.com/doc/refman/en/using-systemd.html
  Process: 8961 ExecStart=/usr/sbin/mysqld (code=exited, status=1/FAILURE)
  Process: 8926 ExecStartPre=/usr/share/mysql-8.0/mysql-systemd-start pre (code=exited, status=0/SUCCESS)
 Main PID: 8961 (code=exited, status=1/FAILURE)
   Status: &quot;Server startup in progress&quot;
    Error: 13 (Permission denied)
      CPU: 343ms

Mar 11 16:42:24 VM-0-13-debian systemd[1]: Starting MySQL Community Server...
Mar 11 16:42:24 VM-0-13-debian systemd[1]: mysql.service: Main process exited, code=exited, status=1/FAILURE
Mar 11 16:42:24 VM-0-13-debian systemd[1]: Failed to start MySQL Community Server.
Mar 11 16:42:24 VM-0-13-debian systemd[1]: mysql.service: Unit entered failed state.
Mar 11 16:42:24 VM-0-13-debian systemd[1]: mysql.service: Failed with result &apos;exit-code&apos;.</code></pre><p>çœ‹äº†çœ‹ log æ–‡ä»¶, æ²¡ä»€ä¹ˆå¤´ç»ª, google äº†ä¸€ä¸‹æ²¡æœ‰ä»»ä½•æˆæœ</p>
<pre><code>mysqld: File &apos;./binlog.index&apos; not found (OS errno 13 - Permission denied)</code></pre><p>çœ‹åˆ° permission denied çš„æ—¶å€™, çªç„¶æƒ³äº†æƒ³, å» /var/lib/mysql ä¸‹å»çœ‹çœ‹, åŸæ¥ç»è¿‡ä¹‹å‰çš„ root ç™»å½•. å…¶ä¸­ä¸€äº›æ–‡ä»¶æ‰€æœ‰è€…å·²ç»è¢«æ”¹æˆ root äº† (æˆ‘ä¸å®Œå…¨ç¡®å®šæ˜¯è¿™ä¸ªåŸå› , ä½†æ˜¯å¥½åƒåªæœ‰è¿™ä¸ªåŸå› äº†) å chown æ›´æ”¹æ‰€æœ‰è€…åå˜æ­£å¸¸äº†.</p>
<p>è¿™æ—¶å€™æˆ‘åˆæƒ³äº†æƒ³. service æ˜¯å¦‚ä½•å¯åŠ¨çš„å‘¢? å®ƒæ˜¯ç”¨ mysql è¿™ä¸ªç”¨æˆ·å¯åŠ¨çš„ä¹ˆ? æˆ‘æƒ³å°è¯•åˆ‡æ¢ç¨‹ mysql æ¥è¯•è¯•, ä½†æ˜¯ su åæ— æ”¹å˜, whoami ä¾æ—§æ˜¯ root , æˆ‘è¿˜ä»¥ä¸ºé•¿ä¹…ä¸åˆ‡å…¶ä»–ç”¨æˆ·, ç”¨é”™äº†æŒ‡ä»¤, ä½†æ˜¯å¥½åƒå¹¶ä¸æ˜¯è¿™æ ·. æˆ‘æƒ³äº†æƒ³. å»çœ‹çœ‹ /etc/password, ç„¶åå‘ç°äº†è¿™ä¸€è¡Œ</p>
<pre><code>mysql:x:107:112:MySQL Server,,,:/var/lib/mysql:/bin/false</code></pre><p>å“¦. æ€ªä¸å¾—, mysql ç”¨æˆ·å¥½åƒè¢«åšäº†é™åˆ¶, æ‰€ä»¥æˆ‘æ”¹æˆ /bin/bash ä¹‹åè¾¾åˆ°äº†é¢„æœŸçš„æ•ˆæœ. </p>
<p>ä½†æ˜¯ mysqld çš„æ‰§è¡Œå¹¶ä¸å¦‚äººæ„.</p>
<pre><code>13 2020-03-11T09:22:14.311301Z 0 [ERROR] [MY-010273] [Server] Could not create unix socket lock file /var/run/mysqld/mysqld.sock.lock.  12 2020-03-11T09:22:14.311311Z 0 [ERROR] [MY-010268] [Server] Unable to setup unix socket lock file.</code></pre><p>:( å®ƒåˆè¦æˆ‘åˆ›å»ºæ–‡ä»¶. é‚£ç®—äº†å§. å¦‚æœæ¯å¯åŠ¨æ¬¡æˆ‘éƒ½éœ€è¦åˆ›å»ºä¸€æ¬¡çš„è¯, é‚£æœªå…ä¹Ÿå¤ªä½æ•ˆäº†â€¦</p>
<p>(PS: å…¶å®ä¸­é€”çš„æ—¶å€™æˆ‘æ²¡æ³¨æ„æˆ‘ç™»å½•çš„ç”¨æˆ·, å› ä¸ºæ˜¯å¤šçª—å£, æˆ‘ä¸å°å¿ƒæŠŠå†…ç½‘çš„ä¸»æœºçš„ mysql ç»™å…³äº†! ï¼ˆï¼›Â´Ğ´ï½€ï¼‰ã‚è°¢å¤©è°¢åœ°, è¿˜å¥½æ˜¯å†…ç½‘. æˆ‘å…³é—­çš„æ—¶å€™æ˜¯ç›´æ¥æŸ¥è¿›ç¨‹ kill çš„, å¯¼è‡´ mysql.sock æ–‡ä»¶ä¾æ—§åœ¨, è¿˜å‡ºäº†ç‚¹å°é—®é¢˜. ä½†æ˜¯é—®é¢˜åˆæ¥äº†! æˆ‘ç”¨ mysql å±…ç„¶èƒ½ç™»å½•, è¿˜èƒ½æ­£å¸¸ SQL !!! w(ï¾ŸĞ”ï¾Ÿ)w.ä»€ä¹ˆé¬¼â€¦ è¿™æˆ–è®¸å’Œä¹‹å‰ mysqld çš„è¡Œä¸ºæœ‰å…³ç³»)</p>
]]></content>
  </entry>
  <entry>
    <title>other/aboutProcess</title>
    <url>/2020/03/11/other/aboutProcess/</url>
    <content><![CDATA[<h1 id="aboutProcess"><a href="#aboutProcess" class="headerlink" title="aboutProcess"></a>aboutProcess</h1><p>è®°å½•ä¸€ä¸‹å…³äºè¿›ç¨‹çš„ä¸€äº›ä¿¡æ¯</p>
<p>take note something about process</p>
<a id="more"></a>



<h2 id="definition"><a href="#definition" class="headerlink" title="definition"></a>definition</h2><p>è¿›ç¨‹æ˜¯è¿è¡Œä¸­çš„ç¨‹åº, ä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºå¯ä»¥ç®€å•çœ‹ä½œä¸€ä¸ªç»“æ„ä½“, å…¶åŒ…å«è¿è¡Œç¨‹åºæ‰€éœ€çš„å‡ ä¸ªæ®µ. ä»¥åŠä¸€äº›å¯é€‰çš„ dbeug ä¿¡æ¯, å’Œå…¶ä»–å¦‚é“¾æ¥ä¿¡æ¯ â€¦</p>
<h2 id="structure-wiki"><a href="#structure-wiki" class="headerlink" title="structure wiki"></a>structure <a href="https://en.wikipedia.org/wiki/Executable_and_Linkable_Format" target="_blank" rel="noopener">wiki</a></h2><h3 id="File-layout"><a href="#File-layout" class="headerlink" title="File layout"></a>File layout</h3><p><a href="https://upload.wikimedia.org/wikipedia/commons/e/e4/ELF_Executable_and_Linkable_Format_diagram_by_Ange_Albertini.png" target="_blank" rel="noopener">picture</a></p>
<p>Each ELF file is made up of one ELF header, followed by file data. The data can include:</p>
<ul>
<li><p>Program header table, describing zero or more <a href="https://en.wikipedia.org/wiki/Memory_segmentation" target="_blank" rel="noopener">memory segments</a> </p>
<p>ç¨‹åºå¤´è¡¨, é›¶æˆ–å¤šä¸ªå†…å­˜æ®µ</p>
</li>
<li><p>Section header table, describing zero or more sections</p>
<p>æ®µå¤´è¡¨, é›¶ä¸ªæˆ–å¤šä¸ªæ®µ</p>
</li>
<li><p>Data referred to by entries in the program header table or section header table</p>
<p>é€šè¿‡åœ¨ç¨‹åºå¤´è¡¨å’Œæ®µå¤´è¡¨çš„å…¥å£å¼•ç”¨çš„æ•°æ®</p>
</li>
</ul>
<h3 id="File-header"><a href="#File-header" class="headerlink" title="File header"></a>File header</h3><p>The ELF header defines whether to use <a href="https://en.wikipedia.org/wiki/32-bit" target="_blank" rel="noopener">32-</a> or <a href="https://en.wikipedia.org/wiki/64-bit_computing" target="_blank" rel="noopener">64-bit</a> addresses. The header contains three fields that are affected by this setting and offset other fields that follow them. The ELF header is 52 or 64 bytes long for 32-bit and 64-bit binaries respectively.</p>
<p>ELF ( excutable linkable format ) å¤´å®šä¹‰äº†æ˜¯ 32 ä½è¿˜æ˜¯ 64 ä½å¯»å€. åˆ†åˆ«ä½ 52 å­—èŠ‚ å’Œ 64 å­—èŠ‚å¤§å°.</p>
<p>(æ•°æ®ç»“æ„è¡¨å®åœ¨æ˜¯å¤ªå¤§äº†ğŸ˜¨, è¿™é‡Œä¸æ–¹ä¾¿å±•ç¤º, æœ‰éœ€è¦è¯·å» wiki. )</p>
<pre><code>Section Headers:
[Nr] Name              Type             Address           Offset
       Size              EntSize          Flags  Link  Info  Align
[ 0]                   NULL             0000000000000000  00000000
   0000000000000000  0000000000000000           0     0     0</code></pre><p>å…¶ä¸­æˆ‘è¿˜å‘ç°äº† align, å…¶æ•°å€¼ 1, 4, 8, 16 ä¸ç­‰, æˆ‘è¿™æ˜¯ 64 ä½çš„æ‰§è¡Œç¨‹åº. æ•°æ®æ®µæ˜¯ 8, ä»£ç æ®µä¸º 16.</p>
<p>(PS: å…³äºå…¶æ•°æ®ç»“æ„, å¯ä»¥é€šè¿‡ readelf è¿™ä¸ªæŒ‡ä»¤æ¥æŸ¥çœ‹, æˆ‘è¿˜æ˜¯å¤ªå°çœ‹æ®µçš„æ•°é‡äº†, æœ‰ 35 ä¸ª, å…¶ä¸­åŒ…å«é‡è¦çš„ .text .rodata .data .bss .debug_info .debug_info. å…¶ä¸­æˆ‘å°è¯•ä½¿ç”¨ obkcopy åˆ é™¤ debug ä¿¡æ¯, å‘ç°åŸå…ˆçš„æ®µæ•°é‡å˜å°‘äº†, 35 -&gt; 30. ä¹Ÿå°±æ˜¯æ•°, å¦‚æœç”±éœ€è¦çš„è¯, å¯ä»¥ç»§ç»­å¢åŠ æ®µçš„æ•°é‡, è¿™å¯èƒ½ç”±ä¸€ä¸ªç±»ä¼¼ TCP/IP header lenth çš„ä¸œè¥¿æ¥æŒ‡å®š.</p>
<h3 id="Program-header"><a href="#Program-header" class="headerlink" title="Program header"></a>Program header</h3><p>The program header table tells the system how to create a process image. It is found at file offset <code>e_phoff</code>, and consists of <code>e_phnum</code> entries, each with size <code>e_phentsize</code>. The layout is slightly different in <a href="https://en.wikipedia.org/wiki/32-bit" target="_blank" rel="noopener">32-bit</a> ELF vs <a href="https://en.wikipedia.org/wiki/64-bit" target="_blank" rel="noopener">64-bit</a> ELF, because the <code>p_flags</code> are in a different structure location for alignment reasons. Each entry is structured as:</p>
<p>ç¨‹åºå¤´è¡¨å‘Šè¯‰ç³»ç»Ÿå¦‚ä½•åˆ›å»ºç¨‹åºæ˜ åƒ.</p>
<p>(æ•°æ®ç»“æ„è¡¨å®åœ¨æ˜¯å¤ªå¤§äº†ğŸ˜¨, è¿™é‡Œä¸æ–¹ä¾¿å±•ç¤º, æœ‰éœ€è¦è¯·å» wiki. )</p>
<pre><code>Program Headers:
Type           Offset             VirtAddr           PhysAddr
               FileSiz            MemSiz              Flags  Align</code></pre><p>å…¶ä¸­çš„ flags å­—æ®µå’Œæ–‡ä»¶ä¸€æ ·ä¹Ÿæ˜¯æœ‰ä¸‰ä¸ª: RWX, æˆ‘çªç„¶æœ‰äº†å¤§èƒ†çš„æƒ³æ³•ğŸ˜.</p>
<p>è¿™é‡Œä¹Ÿæœ‰ align å­—æ®µ, ä¸€äº›å­—æ®µéƒ½å’Œæˆ‘ä¹‹å‰å­¦è¿‡çš„ä¸œè¥¿æœ‰æŒ‚é’©, æ¯”å¦‚ è™šæ‹Ÿåœ°å€å†…å­˜å¤§å°(æˆ‘å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆ Size æ²¡å†™å…¨)</p>
<p>è¿˜æœ‰ä¸€äº›å…³äºåŠ¨æ€é“¾æ¥, æ˜ å°„ å’Œä¸€äº›æˆ‘ä¹Ÿä¸çŸ¥é“çš„ä¿¡æ¯. readelf åŠ elf ç»“æ„æ˜¯å€¼å¾—å­¦ä¹ çš„çŸ¥è¯†.</p>
<h2 id="command"><a href="#command" class="headerlink" title="command"></a>command</h2><h3 id="get-stat"><a href="#get-stat" class="headerlink" title="get stat"></a>get stat</h3><p>the pimary command in linux to get process status is â€˜psâ€™.  </p>
<p>ps æœ‰ä¸¤ç§æ ¼å¼, ä¸€ç§æ˜¯æ ‡å‡†çš„, ä½¿ç”¨çš„æŒ‡ä»¤éƒ½éœ€è¦å¸¦ dash. ä¸€ç§æ˜¯ BSD è¯­æ³•. ä¸å¸¦ dash. ä½†æ˜¯å…¼å®¹. æ‰€ä»¥ä½ å¸¦ dash ä¹Ÿä¸ä¼šå‡ºé”™, ä¸è¿‡ä¼šç»™ä½ ä¸ªè­¦å‘Š.</p>
<p>(PS: ä¸ªäººæ¯”è¾ƒæ¨èçš„æŒ‡ä»¤æ˜¯ ps -elyjf, å…¶ä¸­ e æ„ä¸ºæ‰€æœ‰è¿›ç¨‹, ly ç»å¸¸è”ç”¨å¯ä»¥çœ‹åˆ°æ›´å¤šçš„ä¿¡æ¯, æ¯”å¦‚ RSS PRI. j æ„ä¸º jobs, å¯ä»¥çœ‹åˆ°ç»„ ID å’Œ session ID æ–¹ä¾¿ kill. f å¥½åƒå¯ä»¥æ˜¾ç¤ºæ›´å¤šçš„ä¸œè¥¿, æ–‡æ¡£çš„è§£é‡Šæ˜¯ Do full-format, è¡¨ç°ä¸Šæœ€é‡è¦çš„æ˜¯ä¼šå°†å‘½ä»¤è¡Œå®Œå…¨å±•å¼€.)</p>
<pre><code>This version of ps accepts several kinds of options:
1   UNIX options, which may be grouped and must be preceded by a dash.
2   BSD options, which may be grouped and must not be used with a dash.
3   GNU long options, which are preceded by two dashes.</code></pre><h4 id="fileds"><a href="#fileds" class="headerlink" title="fileds"></a>fileds</h4><p>å…¶ä¸­æˆ‘ç»å¸¸çœ‹åˆ°ä»¥ä¸‹å­—æ®µ:</p>
<ul>
<li><p>S </p>
<p>status, çŠ¶æ€, é€šå¸¸ä¸º R(running or runable) å’Œ S(interruptible sleep). åœ¨è¿™æ–¹é¢æ ‡å‡†ä¸å¦‚ BSD å¥½, BSD è¿˜ä¼šæ˜¾ç¤ºå…¶ä»–çš„çŠ¶æ€.</p>
</li>
<li><p>UID        </p>
<p>ç”¨æˆ· ID. é€šå¸¸æ˜¯å­—ç¬¦ä¸², å¦‚ root</p>
</li>
<li><p>PID  </p>
<p>process ID. å¾ˆå¸¸ç”¨çš„ç”¨äºè¾¨åˆ«è¿›ç¨‹çš„ ID</p>
</li>
<li><p>PPID  </p>
<p>parent process ID. çˆ¶è¿›ç¨‹è¿›ç¨‹ ID.</p>
</li>
<li><p>PGID   </p>
<p>process group ID. ç”¨æˆ·ç»„ ID.</p>
</li>
<li><p>SID  </p>
<p>session ID, ä¼šè¯ ID.</p>
</li>
<li><p>C </p>
<p>CPU åˆ©ç”¨ç‡, å¾ˆå¤šéƒ½æ˜¯ 0. æ–‡æ¡£ä¸­çš„æè¿°æ˜¯: cpu utilization of the process in â€œ##.#â€ format.  Currently, it is the CPU time used divided by the time the process has been running  (cputime/realtime ratio), expressed as a percentage.  It will not add up to 100% unless you are lucky.  (alias pcpu). (å“ˆå“ˆ, æ„æ€æ˜¯ CPU è¶…è¿‡ 100% æ•ˆç‡å°±å¾ˆå€¼ä¹ˆ? æˆ‘è§‚å¯Ÿè¿™ä¸ªå€¼éƒ½éå¸¸ä½, ä½†æ˜¯å†…å­˜ä½¿ç”¨ç‡å±…é«˜ä¸ä¸‹, æœç„¶ I/O æ‰æ˜¯æœåŠ¡å™¨çš„ç“¶é¢ˆæ‰€åœ¨)</p>
</li>
<li><p>PRI  </p>
<p>priority ä¼˜å…ˆçº§, è¿™ä¸ªå€¼åº”è¯¥æ˜¯è¶Šå°è¶Šå¥½, é€šå¸¸çš„è¿›ç¨‹éƒ½æ˜¯ 80. renice å¯ä»¥èµ‹äºˆæ–°çš„ nice è°ƒæ•´, å¯è°ƒæ•´èŒƒå›´æ˜¯ 19 ~ -20. </p>
</li>
<li><p>NI   </p>
<p>è¿™ä¸ª å’Œ PRI å¯¹åº”. æ˜¯è°ƒæ•´çš„ä¼˜å…ˆçº§, æ¯”å¦‚ PRI ä¸º 60, NI ä¸º -20. æ„å‘³åŸå§‹è¿›ç¨‹ PRI ä¸º 80, ç»è°ƒæ•´ -20 = 60.</p>
</li>
<li><p>RSS    </p>
<p>resident set size. æ„å‘³æœ‰å¤šå°‘å†…å­˜è¢«åˆ†é…ç»™äº†è¿™ä¸ªè¿›ç¨‹. (å¾ˆé‡è¦çš„æŒ‡ä»¤)</p>
</li>
<li><p>SZ </p>
<p>è¿›ç¨‹æ ¸å¿ƒæ˜ åƒå¤§å°. size in physical pages of the core image of the process.  This includes text, data, and stack space.  Device mappings are currently excluded; this is subject to change.  See vsz and rss.</p>
</li>
<li><p>WCHAN  </p>
<p>address of the kernel function where the process is sleeping (use wchan if you want the kernel function name).  Running tasks will display a dash (â€˜-â€˜) in this column.</p>
<p>æ­£åœ¨ç­‰å¾…çš„å†…æ ¸äº‹ä»¶, å¯ä»¥æŸ¥çœ‹ /boot/System.map (æœ‰7wå¤šä¸ªâ€¦)</p>
</li>
<li><p>STIME </p>
<p>start time, è¿›ç¨‹å¼€å§‹äº‹ä»¶</p>
</li>
<li><p>TTY          </p>
<p>ä¼ª tty è®¾å¤‡æ–‡ä»¶</p>
</li>
<li><p>TIME </p>
<p>ç´¯è®¡ CPU æ—¶é—´.</p>
</li>
<li><p>CMD</p>
<p>æ‰§è¡Œç¨‹åºæ—¶æ‰€ç”¨çš„æŒ‡ä»¤. é€šè¿‡ -f é€‰é¡¹å¯ä»¥æŸ¥çœ‹å®Œæ•´çš„.</p>
</li>
</ul>
<p>è¿˜æœ‰å…¶ä»–çš„ ps æŒ‡ä»¤, ä¾‹å¦‚ pgrep.</p>
<h3 id="kill"><a href="#kill" class="headerlink" title="kill"></a>kill</h3><p>kill ç”¨æ¥ç»™è¿›ç¨‹å‘é€ä¿¡å·, å…¶é»˜è®¤è¡Œä¸ºä¸º SIG_TERM. ç»ˆæ­¢è¿›ç¨‹, æˆ‘è§‰å¾—è¿™å¯èƒ½å°±æ˜¯ä¸ºä»€ä¹ˆå« kill çš„åŸå› .</p>
<p>å…¶æŒ‡ä»¤æœ¬èº«æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«çš„, å…³é”®æ˜¯æŒ‡ä»¤çš„ç§ç±»:</p>
<pre><code> 1) SIGHUP         2) SIGINT         3) SIGQUIT         4) SIGILL         5) SIGTRAP
 6) SIGABRT         7) SIGBUS         8) SIGFPE         9) SIGKILL        10) SIGUSR1
11) SIGSEGV        12) SIGUSR2        13) SIGPIPE        14) SIGALRM        15) SIGTERM
16) SIGSTKFLT    17) SIGCHLD        18) SIGCONT        19) SIGSTOP        20) SIGTSTP
21) SIGTTIN        22) SIGTTOU        23) SIGURG        24) SIGXCPU        25) SIGXFSZ
26) SIGVTALRM    27) SIGPROF        28) SIGWINCH    29) SIGIO        30) SIGPWR
31) SIGSYS        34) SIGRTMIN    35) SIGRTMIN+1    36) SIGRTMIN+2    37) SIGRTMIN+3
38) SIGRTMIN+4    39) SIGRTMIN+5    40) SIGRTMIN+6    41) SIGRTMIN+7    42) SIGRTMIN+8
43) SIGRTMIN+9    44) SIGRTMIN+10    45) SIGRTMIN+11    46) SIGRTMIN+12    47) SIGRTMIN+13
48) SIGRTMIN+14    49) SIGRTMIN+15    50) SIGRTMAX-14    51) SIGRTMAX-13    52) SIGRTMAX-12
53) SIGRTMAX-11    54) SIGRTMAX-10    55) SIGRTMAX-9    56) SIGRTMAX-8    57) SIGRTMAX-7
58) SIGRTMAX-6    59) SIGRTMAX-5    60) SIGRTMAX-4    61) SIGRTMAX-3    62) SIGRTMAX-2
63) SIGRTMAX-1    64) SIGRTMAX</code></pre><p>å…³äºå…¶æè¿°, å¯ä»¥ <a href="https://www.bogotobogo.com/Linux/linux_process_and_signals.php#signals" target="_blank" rel="noopener">å‚è€ƒ</a> .</p>
<h2 id="about-proc"><a href="#about-proc" class="headerlink" title="about /proc"></a>about /proc</h2><p>/proc æ˜¯ä¸€ä¸ªè™šæ‹ŸæŒ‚è½½ç›®å½•, é‡Œé¢åŒ…æ‹¬äº†ä¸€äº›ç³»ç»Ÿä¿¡æ¯, ä»¥åŠä»¥ PID ä¸ºåçš„è¿›ç¨‹ä¿¡æ¯. </p>
<p>æˆ‘è®°å¾—æˆ‘ä¹‹å‰çœ‹è¿‡, è¿™é‡Œå°±ä¸åšç¬”è®°äº†, è¯¦ç»† <a href="https://www.tecmint.com/exploring-proc-file-system-in-linux/" target="_blank" rel="noopener">å‚è€ƒ</a></p>
]]></content>
  </entry>
  <entry>
    <title>other/somethingAboutBackspace</title>
    <url>/2020/03/10/other/somethingAboutBackspace/</url>
    <content><![CDATA[<h1 id="å…³äº-backspace-æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†"><a href="#å…³äº-backspace-æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†" class="headerlink" title="å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†"></a>å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†</h1><p>åœ¨ä½¿ç”¨ hexo deploy è¾“å…¥ç”¨æˆ·å/å¯†ç , æˆ–å…¶ä»–ç‰¹æ®Šéœ€è¦è¾“å…¥å¯†ç çš„åœºåˆ, backspace æ€»æ˜¯è¢«å½“ä½œå¯†ç çš„ä¸€éƒ¨åˆ†.</p>
<p>è¿™å¯ä»¥ç†è§£, å› ä¸ºè¿™ä¸ªæœ¬èº«å°±æ˜¯ä¸€ç§æŒ‰é”®, åªä¸è¿‡å¤§å¤šæ•°æ—¶å€™è¢«èµ‹äºˆäº†åˆ é™¤å­—ç¬¦çš„åŠŸèƒ½.</p>
<p>å¤„äºå¥½å¥‡, æœç´¢äº†ä¸€ä¸‹ç›¸å…³èµ„æ–™</p>
<p>Backspace is traded as part of password when I use â€˜hexoâ€™ and other spacial situation that I need to enter password.</p>
<p>I can understand this because â€˜backspaceâ€™ is also a normal key that traded as a function in some special situation .</p>
<a id="more"></a>



<h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><p>from <a href="https://unix.stackexchange.com/questions/50493/clear-erase-a-mistyped-invisible-password-on-a-shell-terminal-in-linux" target="_blank" rel="noopener">stackExchange</a></p>
<p>Characters like Ctrl+L are handled by the <strong>application</strong>. In the case of entering input into the shell, like <code>bash</code>, it clears the screen. Some applications, like <code>emacs</code>, use it to redraw the screen and/or recenter the cursor.</p>
<p>C+L éƒ½è¢«åº”ç”¨æ‰€ç®¡ç†. åœ¨è¾“å…¥æ—¶, æ¯”å¦‚ bash. å°†ä¼šæ¸…å±. </p>
<p>Characters like Ctrl+U at a password prompt are handled by the <a href="http://en.wikipedia.org/wiki/Line_discipline" target="_blank" rel="noopener"><strong>TTY line discipline</strong></a>. Theyâ€™ll work any time the input terminal is in the â€œcanonicalâ€ line-editing mode, which is what mode your programs are in while youâ€™re entering a password. In this mode, itâ€™s the Linux kernel itself that is interpreting these characters. You can see what functions are assigned to which keys in the output of <code>stty -a</code>:</p>
<p>C+Uè¢«å½“ä½œå¯†ç æç¤º, ç”± TTY line discipline ç®¡ç†. å½“è¾“å…¥å¯†ç , è¿›å…¥è¡Œç¼–è¾‘æ¨¡å¼æ—¶, å°±ä¼šè¢«å…¶ç®¡ç†. linux å†…æ ¸è§£é‡Šè¿™äº›å­—ç¬¦, å¯ä»¥é€šè¿‡ <code>stty -a</code> æŒ‡ä»¤æŸ¥çœ‹ä¸€äº›ç‰¹æ®Šçš„é”®è¢«èµ‹äºˆçš„åŠŸèƒ½.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">speed 38400 baud; rows 45; columns 128; line &#x3D; 0;</span><br><span class="line">intr &#x3D; ^C; quit &#x3D; ^\; erase &#x3D; ^?; kill &#x3D; ^U; eof &#x3D; ^D; eol &#x3D; &lt;undef&gt;; eol2 &#x3D; &lt;undef&gt;; swtch &#x3D; &lt;undef&gt;; start &#x3D; ^Q; stop &#x3D; ^S;</span><br><span class="line">susp &#x3D; ^Z; rprnt &#x3D; ^R; werase &#x3D; ^W; lnext &#x3D; ^V; flush &#x3D; ^O; min &#x3D; 1; time &#x3D; 0;</span><br><span class="line">-parenb -parodd cs8 -hupcl -cstopb cread -clocal -crtscts</span><br><span class="line">-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8</span><br><span class="line">opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0</span><br><span class="line">isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke</span><br></pre></td></tr></table></figure>

<p>Here, you can see that Ctrl+U is tied to <code>kill</code>, which (according to the <a href="http://linux.die.net/man/1/stty" target="_blank" rel="noopener">stty man page</a>) will â€œerase the current lineâ€. You could also use <code>stty</code> to change this mapping:</p>
<p>é€šè¿‡ stty çš„ man æ‰‹å†Œå¯ä»¥æŸ¥çœ‹è¿™äº›æŒ‡ä»¤çš„æ„ä¹‰(çœ‹åˆ°é‡Œé¢çš„C+Säº†å§, æœ‰æ—¶å€™ windows ä¹ æƒ¯æ€§ä¿å­˜å¸¦åˆ° linux çš„ä¸‹åœºå°±æ˜¯ â€˜æ­»æœºâ€™ ğŸ“´)  (æˆ‘ç†è§£ stty ä¸­çš„ s å¯èƒ½æ˜¯ soft çš„æ„æ€)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">stty kill ^E   # make ctrl-e erase the line</span><br></pre></td></tr></table></figure>

<p><a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">This page</a> has a lot of great information about the TTY layer if youâ€™re interested.</p>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="å…³äº-line-discipline"><a href="#å…³äº-line-discipline" class="headerlink" title="å…³äº line discipline"></a>å…³äº line discipline</h3><p>from <a href="">wiki</a></p>
<p>A <strong>line discipline</strong> (<strong>LDISC</strong>) is a layer in the <a href="https://en.wikipedia.org/wiki/Computer_terminal" target="_blank" rel="noopener">terminal</a> subsystem in some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-1" target="_blank" rel="noopener">[1]</a> The terminal subsystem consists of three layers: the upper layer to provide the <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">character device</a> interface, the lower hardware driver to communicate with the hardware or <a href="https://en.wikipedia.org/wiki/Pseudo_terminal" target="_blank" rel="noopener">pseudo terminal</a>, and the middle line discipline to implement behavior common to terminal devices.</p>
<p>LDISC æ—¶ä¸€ä¸ªç±» UNIX ç³»ç»Ÿç»ˆç«¯çš„å­ç³»ç»Ÿä¸­çš„ä¸€å±‚. å…¶å®Œæ•´ä¸ºä¸‰å±‚, é¡¶å±‚æä¾›ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ç•Œé¢. ä¸‹å±‚ç¡¬ä»¶é©±åŠ¨ä¸ç¡¬ä»¶/ä¼ªç»ˆç«¯äº¤äº’. ä¸­å±‚ â€˜line disciplineâ€™ å®ç°å¸¸è§çš„è¡Œä¸ºç»™ç»ˆç«¯è®¾å¤‡(æˆ‘ç†è§£è¿™ä¸ªè¡Œä¸ºå¯èƒ½æ˜¯æ™®é€šå­—ç¬¦çš„å›æ˜¾ä»¥åŠç‰¹æ®Šå­—ç¬¦çš„è§£é‡Š)</p>
<p>The line discipline glues the low level device driver code with the high level generic interface routines (such as read(2), write(2) and <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a>(2)), and is responsible for implementing the semantics associated with the device.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-2" target="_blank" rel="noopener">[2]</a> The policy is separated from the device driver so that the same serial hardware driver can be used by devices that require different data handling.</p>
<p>â€˜line disciplineâ€™ å°†åº•å±‚é©±åŠ¨è®¾å¤‡ä»£ç å’Œé«˜å±‚æ³›å‹ç•Œé¢ç†è§£ç²˜åˆåœ¨ä¸€èµ·. å…¶å®ç°äº†ä¸è®¾å¤‡ç›¸å…³çš„è¯­ä¹‰. ä¸åŒçš„è®¾å¤‡é©±åŠ¨æœ‰ä¸åŒçš„ç­–ç•¥. ä»¥ç”¨äºåŒæ ·çš„ç¡¬ä»¶é©±åŠ¨èƒ½è¢«éœ€è¦ä¸åŒæ•°æ®ç®¡ç†çš„è®¾å¤‡æ‰€ä½¿ç”¨.</p>
<p>For example, the standard line discipline processes the data it receives from the hardware driver and from applications writing to the device according to the requirements of a terminal on a <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> system. On input, it handles special characters such as the interrupt character (typically <a href="https://en.wikipedia.org/wiki/Control-C" target="_blank" rel="noopener">Control-C</a>) and the erase and kill characters (typically <a href="https://en.wikipedia.org/wiki/Backspace" target="_blank" rel="noopener">backspace</a> or <a href="https://en.wikipedia.org/wiki/Delete_key" target="_blank" rel="noopener">delete</a>, and Control-U, respectively) and, on output, it replaces all the <a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> characters with a <a href="https://en.wikipedia.org/wiki/Carriage_return" target="_blank" rel="noopener">CR</a>/<a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> sequence.</p>
<p>æ¯”å¦‚: æ ‡å‡† â€˜line disciplineâ€™ ç¨‹åºå¤„ç†æ¥è‡ªç¡¬ä»¶é©±åŠ¨å’Œå¼•ç”¨çš„æ•°æ®. æ ¹æ®ç³»ç»Ÿç»ˆç«¯çš„éœ€æ±‚å†™å…¥åˆ°è®¾å¤‡. åœ¨è¾“å…¥ä¸­, å…¶ç®¡ç†å¦‚ä¸­æ–­å­—ç¬¦çš„ç‰¹æ®Šå­—ç¬¦, å®ç°å“åº”åŠŸèƒ½. åœ¨è¾“å…¥ä¸­, å°†æ¢è¡Œç¬¦è¡¨ç°ä¸ºæ¢è¡Œ.</p>
<p>Some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems use <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">STREAMS</a> to implement line disciplines.</p>
<p>(è¿™é‡Œæåˆ°äº†æµ, å…³äº <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">wiki</a> ä¸­å¯¹äº æµçš„è§£é‡Š: a stream is a chain of <a href="https://en.wikipedia.org/wiki/Coroutine" target="_blank" rel="noopener">coroutines</a> that <a href="https://en.wikipedia.org/wiki/Message_passing" target="_blank" rel="noopener">pass messages</a> between a program and a device driver (or between a pair of programs). æµæ˜¯ä¸¤è€…é—´ä¼ é€’ä¿¡æ¯çš„ååŒé“¾.)</p>
<h3 id="å…³äº-character-device"><a href="#å…³äº-character-device" class="headerlink" title="å…³äº character device"></a>å…³äº character device</h3><p>from <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">wiki</a></p>
<p>In <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> <a href="https://en.wikipedia.org/wiki/Operating_systems" target="_blank" rel="noopener">operating systems</a>, a <strong>device file</strong> or <strong>special file</strong> is an <a href="https://en.wikipedia.org/wiki/Interface_(computer_science)" target="_blank" rel="noopener">interface</a> to a <a href="https://en.wikipedia.org/wiki/Device_driver" target="_blank" rel="noopener">device driver</a> that appears in a <a href="https://en.wikipedia.org/wiki/File_system" target="_blank" rel="noopener">file system</a> as if it were an ordinary <a href="https://en.wikipedia.org/wiki/Computer_file" target="_blank" rel="noopener">file</a>. </p>
<p>è®¾å¤‡æ–‡ä»¶åˆç§°ç‰¹æ®Šæ–‡ä»¶, æ˜¯ä¸€ä¸ªè®¾å¤‡é©±åŠ¨çš„æ¥å£, ä»–èƒ½è¢«å½“ä½œä¸€ä¸ªæ™®é€šæ–‡ä»¶ä¸€æ ·æ‰§è¡Œ.</p>
<h4 id="Character-devices"><a href="#Character-devices" class="headerlink" title="Character devices"></a>Character devices</h4><p><em>Character special files</em> or <em>character devices</em> provide unbuffered, direct access to the hardware device. They do not necessarily allow programs to read or write single characters at a time; that is up to the device in question. The character device for a hard disk, for example, will normally require that all reads and writes are aligned to block boundaries and most certainly will not allow reading a single byte.</p>
<p>å­—ç¬¦ç‰¹æ®Šæ–‡ä»¶/å­—ç¬¦è®¾å¤‡æä¾›äº†æ— ç¼“å†², ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡. ç¡¬ç›˜ä¸Šçš„å­—ç¬¦è®¾å¤‡, é€šå¸¸éœ€è¦æ‰€æœ‰çš„è¯»å–å’Œå†™å…¥å¯¹å…¶å—è¾¹ç•Œ. ä¸å…è®¸è¯»å–å•ä¸ªå­—èŠ‚.</p>
<p>Character devices are sometimes known as <em>raw devices</em> to avoid the confusion surrounding the fact that a character device for a piece of block-based hardware will typically require programs to read and write aligned blocks.</p>
<h4 id="Block-devices"><a href="#Block-devices" class="headerlink" title="Block devices"></a>Block devices</h4><p><em>Block special files</em> or <em>block devices</em> provide buffered access to hardware devices, and provide some abstraction from their specifics.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-5" target="_blank" rel="noopener">[5]</a> Unlike character devices, block devices will always allow the programmer to read or write a block of any size (including single characters/bytes) and any alignment. The downside is that because block devices are buffered, the programmer does not know how long it will take before written data is passed from the kernelâ€™s buffers to the actual device, or indeed in what order two separate writes will arrive at the physical device. Additionally, if the same hardware exposes both character and block devices, there is a risk of data corruption due to clients using the character device being unaware of changes made in the buffers of the block device.</p>
<p>å—ç‰¹æ®Šæ–‡ä»¶/å—è®¾å¤‡æä¾›äº†å¸¦ç¼“å†²çš„ç¡¬ä»¶è®¾å¤‡è®¿é—®. åŒæ—¶è¿˜æä¾›äº†ä¸€äº›æŠ½è±¡. ä¸å­—ç¬¦è®¾å¤‡ä¸åŒçš„æ˜¯, å—è®¾å¤‡æ€»æ˜¯å…è®¸ç¨‹åºè¯»å–/å†™å…¥ä»»æ„å¤§å°ä»»æ„å¯¹å…¶çš„å— ( è¿™ä¸å‘ğŸ‘¨ğŸâ€¦ è¿™ä¸æ˜¯åº”è¯¥æ˜¯ä¸Šé¢é‚£ç§çš„å®šä¹‰ä¹ˆ, æ‰€ä»¥è¯´, å†å²é”™è¯¯å•Šâ€¦ ). å› ä¸ºå—è®¾å¤‡æ˜¯å¸¦ç¼“å†²çš„, ä¸çŸ¥ä½•æ—¶æ•°æ®ä¼šè¢«å†™å…¥. ä¹Ÿä¸çŸ¥å¤šä¸ªä¸åŒçš„å†™å…¥è€…è°å…ˆå†™å…¥. </p>
<p>Most systems create both block and character devices to represent hardware like hard disks. FreeBSD and Linux notably do not; the former has removed support for block devices,<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-6" target="_blank" rel="noopener">[6]</a> while the latter creates only block devices. In Linux, to get a character device for a disk one must use the â€œrawâ€ driver, though one can get the same effect as opening a character device by opening the block device with the Linux-specific <code>O_DIRECT</code> flag.</p>
<p>linux ä¸­å¯ä»¥é€šè¿‡æ‰“å¼€å—è®¾å¤‡æ—¶æŒ‡å®š O_DIRECT æ ‡è¯†æ¥æ¨¡æ‹Ÿå­—ç¬¦è®¾å¤‡.</p>
<h4 id="Pseudo-devices"><a href="#Pseudo-devices" class="headerlink" title="Pseudo-devices"></a>Pseudo-devices</h4><p>Device nodes on Unix-like systems do not necessarily have to correspond to <a href="https://en.wikipedia.org/wiki/Physical_device" target="_blank" rel="noopener">physical devices</a>. Nodes that lack this correspondence form the group of <em>pseudo-devices</em>. They provide various functions handled by the operating system. Some of the most commonly used (character-based) pseudo-devices include:</p>
<p>ç±» Unix ç³»ç»Ÿçš„è®¾å¤‡èŠ‚ç‚¹ä¸å¿…ç¬¦åˆç‰©ç†è®¾å¤‡, ç¼ºå¤±è¿™æ ·æ¡ä»¶çš„è®¾å¤‡ç»„æˆäº†ä¼ªè®¾å¤‡. å®ƒä»¬æä¾›äº†ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„å„ç§åŠŸèƒ½. </p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/null" target="_blank" rel="noopener">/dev/null</a> â€“ accepts and discards all input written to it; provides an <a href="https://en.wikipedia.org/wiki/End-of-file" target="_blank" rel="noopener">end-of-file</a> indication when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/zero" target="_blank" rel="noopener">/dev/zero</a> â€“ accepts and discards all input written to it; produces a continuous stream of <a href="https://en.wikipedia.org/wiki/Null_character" target="_blank" rel="noopener">null characters</a> (zero-value bytes) as output when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/full" target="_blank" rel="noopener">/dev/full</a> â€“ produces a continuous stream of null characters (zero-value bytes) as output when read from, and generates an <a href="https://en.wikipedia.org/wiki/Errno.h" target="_blank" rel="noopener">ENOSPC</a> (â€œdisk fullâ€) error when attempting to write to it.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/random" target="_blank" rel="noopener">/dev/random</a> â€“ produces bytes generated by the kernelâ€™s <a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator" target="_blank" rel="noopener">cryptographically secure pseudorandom number generator</a>. Its exact behavior varies by implementation, and sometimes variants such as /dev/urandom or /dev/arandom are also provided.</li>
</ul>
<p>Additionally, BSD-specific pseudo-devices with an <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a> interface may also include:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/pf" target="_blank" rel="noopener">/dev/pf</a> â€“ allows userland processes to control <a href="https://en.wikipedia.org/wiki/PF_(firewall)" target="_blank" rel="noopener">PF</a> through an ioctl interface.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/bio" target="_blank" rel="noopener">/dev/bio</a> â€“ provides ioctl access to devices otherwise not found as /dev nodes, used by <a href="https://en.wikipedia.org/wiki/Bioctl" target="_blank" rel="noopener">bioctl</a> to implement <a href="https://en.wikipedia.org/wiki/RAID" target="_blank" rel="noopener">RAID</a> management in <a href="https://en.wikipedia.org/wiki/OpenBSD" target="_blank" rel="noopener">OpenBSD</a> and <a href="https://en.wikipedia.org/wiki/NetBSD" target="_blank" rel="noopener">NetBSD</a>.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/sysmon" target="_blank" rel="noopener">/dev/sysmon</a> â€“ used by NetBSDâ€™s <a href="https://en.wikipedia.org/wiki/Envsys" target="_blank" rel="noopener">sysmon_envsys</a> framework for <a href="https://en.wikipedia.org/wiki/System_monitor" target="_blank" rel="noopener">hardware monitoring</a>, accessed in the userland through <a href="https://en.wikipedia.org/wiki/Proplib(3)" target="_blank" rel="noopener">proplib(3)</a> by the envstat utility.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-envstat-7" target="_blank" rel="noopener">[7]</a></li>
</ul>
<p>(PS: å½“æˆ‘çœ‹åˆ° /dev/full çš„æ—¶å€™, çªç„¶æœ‰äº† ( â€µâ–½â€²)ÏˆğŸ˜ˆ æƒ³æ³•, /dev/null æ˜¯ç©ºæ–‡ä»¶, ç»å¸¸ç”¨äºæ¸…ç©ºæ–‡ä»¶, æ¯”å¦‚ â€œcat /dev/null &gt; fileâ€. é‚£ä¹ˆ full å‘¢? é‚£å½“ç„¶æ˜¯æ¥å¡«å……æ–‡ä»¶çš„å§? æ¬¸ æ˜¯ä¸æ˜¯èƒ½å’ŒæŸä¸ªä¸œè¥¿è”ç³»åœ¨ä¸€èµ·? æ˜¯çš„, åˆ åº“ğŸ˜±â€¦ å¦‚æœæˆ‘æŠŠä¸œè¥¿åˆ äº†ä¹‹å, å†ä½¿ç”¨è¿™ä¸ªä¸œè¥¿æ¥å¡«å……æ— ç”¨æ•°æ®, é‚£ä¹ˆæ˜¯å¦æ„å‘³ç€å¦‚æœæˆ‘æŠŠç£ç›˜å¼„æ»¡, è‡³å°‘é€šè¿‡ç£ç›˜è‡ªèº«æ¢å¤æ•°æ®çš„æ–¹æ³•æ— æ³•ä½¿ç”¨äº†å‘¢? </p>
<p>å¯¹æ­¤æˆ‘è¿›è¡Œäº†å°æµ‹è¯•(å½“ç„¶åœ¨æˆ‘çš„ä¸»æœºä¸Šâ€¦), å®ƒé¦–å…ˆä¼¼ä¹å—æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶, å¯ä»¥é€šè¿‡ â€˜getconf FILESIZEBITSâ€™ è·å¾—. è·å¾—çš„å•ä½å› è¯¥æ˜¯ä»¥ GB è®¡ç®—çš„. æˆ‘ä½¿ç”¨çš„ä¸»æœºæ˜¯ 64GB, å‡è®¾ç£ç›˜æ˜¯ 1TB, é‚£ä¹ˆè‡³å°‘éœ€è¦ 20 ä¸ªå¹¶å‘çš„æŒ‡ä»¤æ‰èƒ½å¡«æ»¡, ä¼¼ä¹ä¸å¤ªéš¾ğŸ˜Š. å¥½äº†, å°±å…ˆç ”ç©¶åˆ°è¿™é‡Œ)</p>
<h3 id="å…³äº-TTY"><a href="#å…³äº-TTY" class="headerlink" title="å…³äº TTY"></a>å…³äº TTY</h3><p>from <a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">document</a> </p>
<h4 id="The-use-cases"><a href="#The-use-cases" class="headerlink" title="The use cases"></a>The use cases</h4><p><img src="http://www.linusakesson.net/programming/tty/case1.png" alt="Diagram"></p>
<p>A user types at a terminal (a physical teletype). This terminal is connected through a pair of wires to a <em>UART</em> (Universal Asynchronous Receiver and Transmitter) on the computer. The operating system contains a <em>UART driver</em> which manages the physical transmission of bytes, including parity checks and flow control. In a naive system, the UART driver would then deliver the incoming bytes directly to some application process. But such an approach would lack the following essential features:</p>
<p>ç”¨æˆ·åœ¨ç»ˆç«¯(ä¸€ä¸ªç‰©ç†ç”µä¼ æ‰“å­—æœº)è¾“å…¥. ç»ˆç«¯å’Œ UART(é€šç”¨å¼‚æ­¥æ¥æ”¶ä¼ é€’)é©±åŠ¨(ç®¡ç†ç‰©ç†å­—èŠ‚ä¼ è¾“, åŒ…æ‹¬ parity æ£€æµ‹å’Œæµæ§åˆ¶) ç”±ä¸€å¯¹ç”µçº¿è¿æ¥. åœ¨åŸå§‹çš„ç³»ç»Ÿä¸­, UART ä¼šç›´æ¥å°†è¾“å…¥è¾“å…¥é€’é€åˆ°åº”ç”¨ç¨‹åºä¸­. è¿™ä¼šç¼ºå¤±ä¸€äº›é‡è¦çš„ç‰¹æ€§.</p>
<p><strong>Line editing.</strong> Most users make mistakes while typing, so a backspace key is often useful. This could of course be implemented by the applications themselves, but in accordance with the UNIX design philosophy, applications should be kept as simple as possible. So as a convenience, the operating system provides an editing buffer and some rudimentary editing commands (backspace, erase word, clear line, reprint), which are enabled by default inside the <em>line discipline</em>. Advanced applications may disable these features by putting the line discipline in <em>raw</em> mode instead of the default <em>cooked</em> (or <em>canonical</em>) mode. Most interactive applications (editors, mail user agents, shells, all programs relying on <code>curses</code> or <code>readline</code>) run in raw mode, and handle all the line editing commands themselves. The line discipline also contains options for character echoing and automatic conversion between carriage returns and linefeeds. Think of it as a primitive kernel-level <code>sed(1)</code>, if you like.</p>
<p>è¾“å…¥æ•°æ®é”™è¯¯æ—¶, ç»å¸¸éœ€è¦ä½¿ç”¨ backspace é”®. è¿™å½“ç„¶å¯ä»¥ç”±åº”ç”¨è‡ªèº«å®ç°. ä½†æ˜¯æ ¹æ® UNIX è®¾è®¡çš„ç†å¿µ, åº”ç”¨åº”è¯¥å°½å¯èƒ½ç®€æ´. æ‰€ä»¥ä¸ºäº†ç®€ä¾¿èµ·è§, æ“ä½œç³»ç»Ÿæä¾›äº†ç¼–è¾‘ç¼“å†²å’Œä¸€äº›åŸºæœ¬çš„ç¼–è¾‘å‘½ä»¤(backspace, ease word, clear line, reprint) åœ¨ line discipline ä¸­é»˜è®¤å¯ç”¨. å…¶ä»–é«˜çº§åº”ç”¨å¯èƒ½é€šè¿‡å°†å…¶ç½®äºåŸå§‹æ¨¡å¼å–æ¶ˆè¿™äº›ç‰¹æ€§. å¤§å¤šäº¤äº’åº”ç”¨(ç¼–è¾‘å™¨, ç”¨æˆ·é‚®ä»¶ä»£ç†, shell, æ‰€æœ‰ä¾èµ–äº curses/ readline çš„åº”ç”¨ç¨‹åº) è¿è¡ŒäºåŸå§‹æ¨¡å¼. è‡ªè¡Œç®¡ç†è¡Œç¼–è¾‘å‘½ä»¤. line discipline è¿˜åŒ…å«å­—ç¬¦å›æ˜¾å’Œè‡ªåŠ¨è½¬æ¢å›è½¦å’Œæ¢è¡Œ. </p>
<p><strong>Session management.</strong> The user probably wants to run several programs simultaneously, and interact with them one at a time. If a program goes into an endless loop, the user may want to kill it or suspend it. Programs that are started in the background should be able to execute until they try to write to the terminal, at which point they should be suspended. Likewise, user input should be directed to the foreground program only. The operating system implements these features in the <em>TTY driver</em> (<code>drivers/char/tty_io.c</code>).</p>
<p>ç”¨æˆ·å½“ç„¶å¸Œæœ›åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºå¹¶å¯ä»¥ä¸å…¶äº¤äº’. å¦‚æœç¨‹åºé™·å…¥æ­»å¾ªç¯. ç”¨æˆ·å¸Œæœ›èƒ½æš‚åœ/å…³é—­å®ƒ. ç¨‹åºåœ¨è¿›å…¥åå°ååº”å½“ä¾æ—§èƒ½è¿è¡Œ, ç›´åˆ°å®ƒå°è¯•å‘ç»ˆç«¯å†™å…¥. ç”¨æˆ·è¾“å…¥åº”å½“ä»…ç›´æ¥å‘é€ç»™å‰ç«¯ç¨‹åº. æ“ä½œç³»ç»Ÿå°†è¿™äº›ç‰¹æ€§å®ç°åœ¨äº† TTY é©±åŠ¨ä¸­.</p>
<p>An operating system process is â€œaliveâ€ (has an <em>execution context</em>), which means that it can perform actions. The TTY driver is not alive; in object oriented terminology, the TTY driver is a passive object. It has some data fields and some methods, but the only way it can actually do something is when one of its methods gets called from the context of a process or a kernel interrupt handler. The line discipline is likewise a passive entity.</p>
<p>ä¸€ä¸ªç¨‹åºæ˜¯â€™æ´»è·ƒçš„â€™ æ„å‘³ç€å®ƒèƒ½æ‰§è¡Œæ“ä½œ. TTY é©±åŠ¨å¹¶ä¸æ˜¯, å®ƒæ˜¯è¢«åŠ¨å¯¹è±¡. å®ƒæ‹¥æœ‰ä¸€äº›æ•°æ®å­—æ®µå’Œæ–¹æ³•. ä»…å½“å…¶æ–¹æ³•è¢«è¿›ç¨‹/å†…æ ¸ä¸­å¤„ç†ç¨‹åºçš„ä¸Šä¸‹æ–‡è°ƒç”¨çš„æ—¶å€™æ‰èƒ½åšäº‹. (å°±åƒä¸€ä¸ªåº“ä¸€æ ·)</p>
<p>Together, a particular triplet of UART driver, line discipline instance and TTY driver may be referred to as a <em>TTY device</em>, or sometimes just TTY. A user process can affect the behaviour of any TTY device by manipulating the corresponding device file under <code>/dev</code>. Write permissions to the device file are required, so when a user logs in on a particular TTY, that user must become the owner of the device file. This is traditionally done by the <code>login(1)</code> program, which runs with root privileges.</p>
<p>åˆåœ¨ä¸€èµ·, ä¸€ä¸ªç‰¹å®šçš„ä¸‰é‡: UART é©±åŠ¨, line discipline å®ä¾‹, å’Œ TTY é©±åŠ¨. ç»Ÿç§°ä¸º TTY é©±åŠ¨. æˆ–è€…æœ‰æ—¶ç›´æ¥ç§°ä¸º TTY. ç”¨æˆ·è¿›ç¨‹å¯ä»¥é€šè¿‡å¯¹ /dev ä¸‹çš„è®¾å¤‡æ–‡ä»¶çš„ç®¡ç†æ¥æ”¹å˜ä»»æ„ TTY è®¾å¤‡çš„è¡Œä¸º. è¿™éœ€è¦å¯¹äºè®¾å¤‡æ–‡ä»¶çš„å†™æƒé™, æ‰€ä»¥å½“ç”¨æˆ·ç™»å½•ç‰¹å®šçš„ TTY æ—¶, ç”¨æˆ·å¿…é¡»ç§°ä¸ºè¿™ä¸ªè®¾å¤‡æ–‡ä»¶çš„æ‰€æœ‰è€…. è¿™é€šå¸¸ç”±è¿è¡Œæ—¶å¸¦æœ‰ root æƒé™ login ç¨‹åºæ¥å®ç°.</p>
<p>The physical line in the previous diagram could of course be a long-distance phone line:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case2.png" alt="Diagram"></p>
<p>This does not change much, except that the system now has to handle a modem hangup situation as well.</p>
<p>Letâ€™s move on to a typical desktop system. This is how the Linux console works:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case3.png" alt="Diagram"></p>
<p>The TTY driver and line discipline behave just like in the previous examples, but there is no UART or physical terminal involved anymore. Instead, a video terminal (a complex state machine including a <em>frame buffer</em> of characters and graphical character attributes) is emulated in software, and rendered to a VGA display.</p>
<p>å½“æ•°æ®è¾“å…¥æ—¶, ä¼šé€šè¿‡ä¸€ç³»åˆ—çš„äº¤æ¢æœ€ç»ˆç”± TTY å‘ç»™è¿›ç¨‹, è€Œå½“æ•°æ®è¾“å‡ºæ—¶, ä¼šåŸè·¯ (ä½†ä» terminal emulator å¼€å§‹åˆ†å¼€) å‘é€ç»™è¾“å‡ºè®¾å¤‡ (æ˜¾ç¤ºå±â€¦)</p>
<p>The console subsystem is somewhat rigid. Things get more flexible (and abstract) if we move the terminal emulation into userland. This is how <code>xterm(1)</code> and its clones work:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case4.png" alt="Diagram"></p>
<p>To facilitate moving the terminal emulation into userland, while still keeping the TTY subsystem (session management and line discipline) intact, the <em>pseudo terminal</em> or <em>pty</em> was invented. And as you may have guessed, things get even more complicated when you start running pseudo terminals inside pseudo terminals, Ã  la <code>screen(1)</code> or <code>ssh(1)</code>.</p>
<p>è¿™é‡Œæœ‰ä¸»ä» TTY, ä¼ªç»ˆç«¯. è¿™é‡Œä½œè€…æåˆ°äº† ssh. æˆ‘æŸ¥äº†ä¸€ä¸‹ PTY ç›¸å…³çš„ä¸œè¥¿, å‘ç°äº† å…³äº ssh â€˜-tâ€™ å’Œ â€˜-Tâ€™ é€‰é¡¹çš„è¯´æ˜. å°±æœ‰äº† <a href="https://security.stackexchange.com/questions/107933/what-exactly-does-ssh-t-userdomain-verify-do" target="_blank" rel="noopener">stackExchange</a> å’Œ <a href="https://stackoverflow.com/questions/42505339/why-use-t-with-ssh" target="_blank" rel="noopener">stackOverflow</a> çš„è§£é‡Š. </p>
<p>-T: è¿™ä¸ªé€‰é¡¹ä¸ç”Ÿäº§ PTY, ç»ˆç«¯è¿è¡Œäºæœ¬åœ°, è¿™æˆ–è®¸å°±æ˜¯ PTY(pseudo) ä¸ºä»€ä¹ˆå« PTY çš„åŸå› . github çš„ ssh ä¹Ÿæ˜¯å¸¦ -T é€‰é¡¹çš„, å› ä¸ºå¦‚æœä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ª tty çš„è¯â€¦ </p>
<p>Now letâ€™s take a step back and see how all of this fits into the process model.</p>
<h4 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h4><p>A Linux process can be in one of the following states:</p>
<p><img src="http://www.linusakesson.net/programming/tty/linuxprocess.png" alt="Process states"></p>
<table>
<thead>
<tr>
<th>R</th>
<th>Running or runnable (on run queue)</th>
</tr>
</thead>
<tbody><tr>
<td>D</td>
<td>Uninterruptible sleep (waiting for some event)</td>
</tr>
<tr>
<td>S</td>
<td>Interruptible sleep (waiting for some event or signal)</td>
</tr>
<tr>
<td>T</td>
<td>Stopped, either by a job control signal or because it is being traced by a debugger.</td>
</tr>
<tr>
<td>Z</td>
<td>Zombie process, terminated but not yet reaped by its parent.</td>
</tr>
</tbody></table>
<p>(PS: çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™, æˆ‘æœ‰ç‚¹é—å¿˜ ps çš„ç»†èŠ‚äº†, å»çœ‹äº†çœ‹ ps çš„è¯´æ˜. ç„¶åæ˜ç™½äº†ä¹‹å‰æœ‰æ¬¡é¢è¯•çš„äº‹æƒ…äº†. å½“æ—¶æˆ‘è¿˜å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆä¼šæœ‰äººåœ¨æˆ‘å›ç­”äº†æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„å‘½ä»¤è¡Œåå†é—®æˆ‘ä¸€æ¬¡. æˆ‘å½“æ—¶ç­”çš„æ—¶ ps -axu (-aux?) éƒ½æ˜¯ä¸å¯¹çš„. è€Œåè€…æ›´æ˜¯å¤§é”™ç‰¹é”™. æˆ‘æœ€åˆéœ€è¦è¿™æ¡æŒ‡ä»¤æ—¶, ä»…ä»…åªæ˜¯åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹(è¯¯å¯¼æˆ‘, å¯æ¶å•Šâ€¦) ç„¶åå°±å…¨ä¿¡äº†, ä¹‹åå°±åªæ˜¯ç„äº†ä¸€çœ¼ man æ‰‹å†Œ. å¹¶æœªè¿‡å¤šåœ¨æ„. è¿™æ€åº¦éå¸¸æœ‰é—®é¢˜, åŒ…æ‹¬ä¹‹å‰çš„ä¸€ä¸ª C++ ç©ºå¯¹è±¡, æˆ‘ç»™å®ƒèµ‹å€¼æ—¶ä¾æ—§ä¼šå‡ºé”™, æˆ‘è¿˜å¥½å¥‡ä¸ºä»€ä¹ˆ, å› ä¸ºæˆ‘æ ¹æœ¬æ²¡ä»”ç»†æƒ³è¿‡ææ„çš„é—®é¢˜. ä½œä¸ºä¸€ä¸ªæŠ€æœ¯äººå‘˜, æˆ‘æ„Ÿè§‰å¾ˆç¾æ„§. åŒ…æ‹¬è¿™æ¬¡çš„ç¬”è®°, å¦‚æœä¸æ˜¯å¤„äºå¥½å¥‡, ä¹Ÿä¸ä¼šç‰µæ‰¯å‡ºè¿™ä¹ˆå¤šä¸œè¥¿æ¥, å­¦ä¹ æ˜¯ä¸€ä¸ªè¶Šå­¦è¶Šå°‘çš„è¿‡ç¨‹. æˆ‘åº”å½“æ—¶åˆ»è¿™æ ·è­¦é†’è‡ªå·±.)</p>
<p>By running <code>ps l</code>, you can see which processes are running, and which are sleeping. If a process is sleeping, the <code>WCHAN</code> column (â€œwait channelâ€, the name of the wait queue) will tell you what kernel event the process is waiting for.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$ ps l</span><br><span class="line">F   UID   PID  PPID PRI  NI    VSZ   RSS WCHAN  STAT TTY        TIME COMMAND</span><br><span class="line">0   500  5942  5928  15   0  12916  1460 wait   Ss   pts&#x2F;14     0:00 -&#x2F;bin&#x2F;bash</span><br><span class="line">0   500 12235  5942  15   0  21004  3572 wait   S+   pts&#x2F;14     0:01 vim index.php</span><br><span class="line">0   500 12580 12235  15   0   8080  1440 wait   S+   pts&#x2F;14     0:00 &#x2F;bin&#x2F;bash -c (ps l) &gt;&#x2F;tmp&#x2F;v727757&#x2F;1 2&gt;&amp;1</span><br><span class="line">0   500 12581 12580  15   0   4412   824 -      R+   pts&#x2F;14     0:00 ps l</span><br></pre></td></tr></table></figure>

<p>The â€œ<code>wait</code>â€œ wait queue corresponds to the <code>wait(2)</code> syscall, so these processes will be moved to the running state whenever thereâ€™s a state change in one of their child processes. There are two sleeping states: Interruptible sleep and uninterruptible sleep. Interruptible sleep (the most common case) means that while the process is part of a wait queue, it may actually also be moved to the running state when a signal is sent to it. If you look inside the kernel source code, you will find that any kernel code which is waiting for an event must check if a signal is pending after schedule() returns, and abort the syscall in that case.</p>
<p>æœ‰å¯ä¸­æ–­å’Œä¸å¯ä¸­æ–­ç¡çœ . ä¸­æ–­ç¡çœ æ„å‘³ç€å¦‚æœè¿›ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­, é‚£ä¹ˆå…¶å¯ä»¥åœ¨ä¿¡å·å‘é€ç»™å®ƒæ—¶æ›´æ–°ä¸ºè¿è¡Œæ€. ä»»ä½•ç­‰å¾…äº‹ä»¶çš„å†…æ ¸ä»£ç éƒ½å¿…é¡»åœ¨è°ƒåº¦è¿”å›åæ£€æŸ¥ä¿¡å·æŒ‚èµ·.</p>
<p>In the <code>ps</code> listing above, the <code>STAT</code> column displays the current state of each process. The same column may also contain one or more attributes, or flags:</p>
<table>
<thead>
<tr>
<th>s</th>
<th>This process is a session leader.</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>This process is part of a foreground process group.</td>
</tr>
</tbody></table>
<p>These attributes are used for job control.</p>
<h3 id="Jobs-and-sessions"><a href="#Jobs-and-sessions" class="headerlink" title="Jobs and sessions"></a>Jobs and sessions</h3><p>Job control is what happens when you press <code>^Z</code> to suspend a program, or when you start a program in the background using <code>&amp;</code>. A job is the same as a process group. Internal shell commands like <code>jobs</code>, <code>fg</code> and <code>bg</code> can be used to manipulate the existing jobs within a <em>session</em>. Each session is managed by a <em>session leader</em>, the shell, which is cooperating tightly with the kernel using a complex protocol of signals and system calls.</p>
<p>The following example illustrates the relationship between processes, jobs and sessions:</p>
<p>å·¥ä½œç®¡ç†åœ¨æŒ‰ä¸‹ C+Z æŒ‚èµ·ç¨‹åºæˆ–ä½¿ç”¨ &amp; ä½¿ç¨‹åºåå°æ‰§è¡Œæ—¶å‘ç”Ÿ. ä¸€ä¸ªå·¥ä½œå°±æ˜¯ä¸€ä¸ªç»è¿›ç¨‹ç»„. linux æä¾›äº† jobs, fg, bg åœ¨ä¼šè¯ä¸­ç®¡ç†ç°æœ‰å·¥ä½œ. æ¯ä¸ªç»˜ç”»éƒ½ç”±ä¸€ä¸ªä¼šè¯ leader ç®¡ç†. shell , å’Œå†…æ ¸ç»ç”±å¤æ‚çš„ä¿¡å·å’Œç³»ç»Ÿè°ƒç”¨åè®®å¯†åˆ‡åˆä½œ. </p>
<p>(PS: å…³äº <a href="https://en.wikipedia.org/wiki/Process_group" target="_blank" rel="noopener">process group</a> , ç®€å•æ¥è¯´å°±æ˜¯ä¸€ç»„è¿›ç¨‹, è€Œä¼šè¯æ˜¯ä¸€ç»„è¿›ç¨‹ç»„)</p>
<h4 id="The-following-shell-interactionsâ€¦"><a href="#The-following-shell-interactionsâ€¦" class="headerlink" title="The following shell interactionsâ€¦"></a>The following shell interactionsâ€¦</h4><p><img src="http://www.linusakesson.net/programming/tty/exampleterm.png" alt="Screenshot"></p>
<h4 id="â€¦correspond-to-these-processesâ€¦"><a href="#â€¦correspond-to-these-processesâ€¦" class="headerlink" title="â€¦correspond to these processesâ€¦"></a>â€¦correspond to these processesâ€¦</h4><p><img src="http://www.linusakesson.net/programming/tty/examplediagram.png" alt="Table"></p>
<h4 id="â€¦and-these-kernel-structures"><a href="#â€¦and-these-kernel-structures" class="headerlink" title="â€¦and these kernel structures."></a>â€¦and these kernel structures.</h4><ul>
<li><p>TTY Driver (/dev/pts/0).</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Size: 45x13</span><br><span class="line">  Controlling process group: (101)</span><br><span class="line">Foreground process group: (103)</span><br><span class="line">  UART configuration (ignored, since this is an xterm):</span><br><span class="line">    Baud rate, parity, word length and much more.</span><br><span class="line">  Line discipline configuration:</span><br><span class="line">    cooked&#x2F;raw mode, linefeed correction,</span><br><span class="line">    meaning of interrupt characters etc.</span><br><span class="line">  Line discipline state:</span><br><span class="line">    edit buffer (currently empty),</span><br><span class="line">    cursor position within buffer etc.</span><br></pre></td></tr></table></figure>
</li>
<li><p>pipe0</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Readable end (connected to PID 104 as file descriptor 0)</span><br><span class="line">Writable end (connected to PID 103 as file descriptor 1)</span><br><span class="line">Buffer</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The basic idea is that every pipeline is a job, because every process in a pipeline should be manipulated (stopped, resumed, killed) simultaneously. Thatâ€™s why <code>kill(2)</code> allows you to send signals to entire process groups. By default, <code>fork(2)</code> places a newly created child process in the same process group as its parent, so that e.g. a <code>^C</code> from the keyboard will affect both parent and child. But the shell, as part of its session leader duties, creates a new process group every time it launches a pipeline.</p>
<p>åŸºç¡€çš„æƒ³æ³•æ˜¯æ¯ä¸ªç®¡é“éƒ½æ˜¯ä¸€ä¸ªå·¥ä½œ. å› ä¸ºæ¯ä¸ªç®¡é“ä¸­çš„è¿›ç¨‹éƒ½éœ€è¦è¢«åŒæ—¶ç®¡ç†. é»˜è®¤åœ¨ä½¿ç”¨ fork æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°å­ç¨‹åºåˆ°åŒæ ·çš„è¿›ç¨‹ç»„ä¸­, å°±å’Œå®ƒçš„çˆ¶è¿›ç¨‹ä¸€æ ·. æ‰€ä»¥ C+C ä¼šå½±å“çˆ¶å­è¿›ç¨‹, ä½†æ˜¯ shell ä½œä¸ºä¼šè¯ leader, å½“åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡é“çš„æ—¶å€™, å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„.</p>
<p>The TTY driver keeps track of the foreground process group id, but only in a passive way. The session leader has to update this information explicitly when necessary. Similarly, the TTY driver keeps track of the size of the connected terminal, but this information has to be updated explicitly, by the terminal emulator or even by the user.</p>
<p>TTY è¢«åŠ¨æŒç»­è·Ÿè¸ªå‰å°ç¨‹åºç»„ id. ä¼šè¯ leader å¿…é¡»åœ¨å¿…è¦æ—¶æ›´æ–°è¿™äº›ä¿¡æ¯(è°ƒç”¨?). åŒæ ·çš„, TTY é©±åŠ¨æŒç»­è·Ÿè¸ªå·²è¿æ¥ç»ˆç«¯å¤§å°.</p>
<p>As you can see in the diagram above, several processes have <code>/dev/pts/0</code> attached to their standard input. But only the foreground job (the <code>ls | sort</code> pipeline) will receive input from the TTY. Likewise, only the foreground job will be allowed to write to the TTY device (in the default configuration). If the cat process were to attempt to write to the TTY, the kernel would suspend it using a signal.</p>
<p>(æˆ‘ä¹Ÿæ²¡æƒ³åˆ°å› ä¸ºä¸€ä¸ªå¥½å¥‡èƒ½ç‰µæ‰¯è¿™äº›ä¸œè¥¿å‡ºæ¥â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/NextGreaterElementII</title>
    <url>/2020/03/06/leetcode/NextGreaterElementII/</url>
    <content><![CDATA[<h2 id="Next-Greater-Element-II"><a href="#Next-Greater-Element-II" class="headerlink" title="Next Greater Element II"></a>Next Greater Element II</h2><p><img src="https://imgur.com/wvepI5B.png" alt=""></p>
<p>æ•°ç»„æ‰¾æœ€å¤§å€¼</p>
<a id="more"></a>



<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nextGreaterElements(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        nums.reserve(nums.<span class="built_in">size</span>() * <span class="number">2</span>);</span><br><span class="line">        back_insert_iterator&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; bi (nums);</span><br><span class="line">        copy(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), bi);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stk;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (cnt &lt; nums.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">while</span> (!stk.empty() &amp;&amp; nums[stk.top()] &lt; nums[cnt]) &#123;</span><br><span class="line">                nums[stk.top()] = nums[cnt];</span><br><span class="line">                stk.pop();</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cnt &lt; nums.<span class="built_in">size</span>() / <span class="number">2</span>)</span><br><span class="line">                stk.push(cnt);</span><br><span class="line">            cnt++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (!stk.empty()) &#123;</span><br><span class="line">            nums[stk.top()] = <span class="number">-1</span>;</span><br><span class="line">            stk.pop();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        nums.resize(nums.<span class="built_in">size</span>() / <span class="number">2</span>);</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç”¨ä¸¤ä¸ªæ‹¼æ¥çš„æ•°ç»„æ¥è§£å†³å¾ªç¯çš„é—®é¢˜, ä¸‹ä¸€ä¸ªæœ€å¤§æ•°å­—åˆ†ä¸ºä¸¤ç§æƒ…å†µ</p>
<ol>
<li>ä¸‹ä¸€ä¸ªæ•°å­—æ¯”ç°åœ¨çš„æ•°å­—å¤§, é‚£ä¹ˆå°±å¯ä»¥ç›´æ¥æ›¿æ¢å½“å‰æ•°å­—, å¹¶ä¸”åœ¨æ ˆä¸­ç»§ç»­è¿™ä¸ªè¿‡ç¨‹</li>
<li>ä¸‹ä¸€ä¸ªæ•°å­—å°äºç­‰äºå½“å‰æ•°å­—, å…¥æ ˆ, ç»§ç»­ä¸‹æ¬¡å¾ªç¯</li>
</ol>
<p>å½“éå†åˆ°æœ€åæ—¶, æœ‰ä¸‹ä¸€ä¸ªæœ€å¤§æ•°å­—çš„æ•°å­—å·²ç»è¢«å¡«å……äº†, æ ˆä¸­å‰©ä½™çš„æ•°å­—å³æœªæ‰¾åˆ°ä¸‹ä¸€ä¸ªæœ€å¤§æ•°å­—çš„æ•°å­—</p>
<p>è¿™ä¸ªç®—æ³•éœ€è¦ä¸€å€é¢å¤–çš„ç©ºé—´, ä»¥åŠä¸€ä¸ªæ ˆ. é¢å¤–ç©ºé—´ä¸»è¦æ˜¯å› ä¸ºæ•°å­—ä¼šæ”¹å˜, ä½†æ˜¯è¢«æ”¹å˜çš„æ•°å­—å¯èƒ½æ˜¯å…¶ä»–æ•°å­—æ‰€éœ€è¦çš„æ•°å­—. æš‚æ—¶æ²¡æœ‰æƒ³åˆ°å…¶ä»–çš„æ–¹æ³•. è€Œæ ˆæ˜¯ç”¨ä½œè®°å½•, åœ¨æç«¯æƒ…å†µä¸‹ { 3, 2, 1â€¦} å®ƒç­‰åŒäºä¸€å€çš„é¢å¤–ç©ºé—´.</p>
<p>æ—¶é—´ä¸Š, æ˜¯ä¸€ä¸ª O(n) çš„ç®—æ³•. (å¹³å‡æƒ…å†µæ¯” n å¤§ä¸€äº›)</p>
<p><img src="https://imgur.com/pqr2rn6.png" alt=""></p>
<p>åŠ ä¸Š â€˜fast IOâ€™ çš„è¯è¿˜ç®—ä¸ªä¸é”™çš„ç»“æœ, æˆ‘éå¸¸å¥½å¥‡æœ‰æ²¡æœ‰ä¸ç”¨é¢å¤–ç©ºé—´çš„ç®—æ³•.</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; nextGreaterElements(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; next_greater(n);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>) <span class="keyword">return</span> next_greater;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> maxi=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++) maxi = nums[i] &gt; nums[maxi]? i:maxi;</span><br><span class="line"></span><br><span class="line">        next_greater[maxi] = - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">int</span> p;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=(maxi<span class="number">-1</span>+n)%n; i!=maxi; i=(i<span class="number">-1</span>+n)%n)&#123;</span><br><span class="line">            p = (i+<span class="number">1</span>)%n;</span><br><span class="line">            <span class="keyword">while</span>(p != <span class="number">-1</span> &amp;&amp; nums[i] &gt;= nums[p]) p = next_greater[p];</span><br><span class="line">            next_greater[i] = p;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;n; i++)&#123;</span><br><span class="line">            p = next_greater[i];</span><br><span class="line">            next_greater[i] = p == <span class="number">-1</span>? p: nums[next_greater[i]];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> next_greater;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>emmmâ€¦ æˆ‘æ€ä¹ˆæ„Ÿè§‰è¿™ä¸ªç®—æ³•å¾ˆé‚‹é¢â€¦ </p>
<p>ä»ä¸€å¼€å§‹çš„ä¸€æ¬¡å®Œæ•´å¾ªç¯æ‰¾æœ€å¤§å€¼, ä½†æ˜¯å¾ªç¯ä¸­ä¸åšå…¶ä»–äº‹æƒ…(å…¶å®æ˜¯å¯ä»¥æƒ³åŠæ³•åšä¸€äº›èƒ½æé«˜æ•ˆç‡äº‹æƒ…çš„, ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯åªç”¨æ¥æ‰¾æœ€å¤§å€¼, å¤ªæµªè´¹äº†) . å¾ªç¯é—®é¢˜å®ƒç”¨å–ä½™æ¥é¿å…, è¿™æ˜¯æ„æ–™ä¹‹ä¸­çš„. ä¹Ÿç”¨äº†é¢å¤–ä¸€å€çš„ç©ºé—´, å¾ªç¯æœ‰ä¸‰ä¸ª, ä¸¤æ¬¡è‚‰çœ¼å¯è§å®Œæ•´çš„å¾ªç¯. æ„Ÿè§‰å¹¶æ²¡æœ‰å…¶ä»–æœ€ä¼˜ç®—æ³•ä¸€æ ·, ç»™äººçœ¼å‰ä¸€äº®çš„æ„Ÿè§‰ = =.</p>
<p>The first cycle of this algorithm just find the max without anything can help efficiency. It used the same extra space and two complete cycles. It doesnâ€™t feel as good as the other best algorithms.</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/FindtheDuplicateNumber</title>
    <url>/2020/02/29/leetcode/FindtheDuplicateNumber/</url>
    <content><![CDATA[<h2 id="Find-the-Duplicate-Number"><a href="#Find-the-Duplicate-Number" class="headerlink" title="Find the Duplicate Number"></a>Find the Duplicate Number</h2><p><img src="https://imgur.com/TuxxCiA.png" alt=""></p>
<a id="more"></a>



<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>æˆ‘çš„åšæ³•åå‘äºæ•°å­¦, æˆ‘æ˜¯è¿™æ ·æ€è€ƒçš„: n ä¸ªæ•°çš„è¯, åŸæœ¬çš„æ€»å’Œ Sn æ˜¯å¯ä»¥ç›´æ¥æ±‚å‡ºæ¥çš„. è¿™ä¸ªåŸæœ¬çš„æ€»å’Œå’Œå®é™…æ€»å’Œ(Sn1)çš„å·®è·å°±æ˜¯é‡å¤æ•°ç»„æ‰€é€ æˆçš„å½±å“(Sn2), æˆ‘ä¹Ÿå¯ä»¥é€šè¿‡ O(n) æ¥ç®—å‡ºæœ‰å¤šå°‘ä¸ªæ•°å­—ä¸å­˜åœ¨, åä¸º cnt. å› ä¸ºé‡å¤æ•°å­—åªä¼šæœ‰ä¸€ä¸ª, å…¶é—´çš„å·® (Sn1 + Sn2 - Sn) / cnt çš„ç»“æœå°±æ˜¯é‡å¤çš„æ•°å­—. æ¯”å¦‚:</p>
<pre><code>6 7
1 3 3 | 2 + 1 = 3
6 7
2 2 3 | 1 + 1 = 2

10 8
1 2 2 3 | 4 - 2 = 2
10 9
2 2 2 3 | 9 + 1 + 4 - 10 / 2 = 2</code></pre><p>å‡è®¾æ•°å­—[1, 3, 3] å…¶ Sn = 6, Sn1 = 7, Sn2 = 2, åˆ™ç”±ä¹‹å‰çš„å…¬å¼å¯å¾—: (7 + 2 - 6) / 1 = 3.</p>
<p>å…¶ä½™æ¡ˆä¾‹ä¾æ—§å¦‚æ­¤. ä»£ç å¦‚ä¸‹ : </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            sum += nums[i - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">find</span>(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>(), i) == nums.<span class="built_in">end</span>()) &#123;</span><br><span class="line">                ++cnt;</span><br><span class="line">                sum += i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)((sum - (<span class="number">1</span> + nums.<span class="built_in">size</span>()) * nums.<span class="built_in">size</span>() / <span class="number">2</span>) / cnt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgur.com/LWP332a.png" alt=""></p>
<p>è¿™æ˜¯ä¸ª O(n) å¤æ‚åº¦çš„ç®—æ³•, ä½†æ˜¯å…¶ä¸­é‚£ä¸ª find å¾ˆè€—æ—¶, åº”è¯¥æ˜¯ç®—æ³•çš„æ ¸å¿ƒç“¶é¢ˆ. </p>
<p>å¹¶ä¸” <code>nums.size()) * nums.size() / 2</code> è¦æ³¨æ„ä¸€ä¸‹, è¿™é‡Œæˆ‘å‡è®¾æ˜¯ä»å·¦å¾€å³çš„, ä½†æ˜¯å¦‚æœè®¡ç®—æœºä¸è¿™ä¹ˆåš, å¯èƒ½ä¼šæœ‰é—®é¢˜.</p>
<h2 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">findDuplicate</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">size</span>() &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> slow&#123; nums[<span class="number">0</span>] &#125;;</span><br><span class="line">        <span class="keyword">int</span> fast&#123; nums[nums[<span class="number">0</span>]] &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (slow != fast) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[nums[fast]];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fast = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (fast != slow) &#123;</span><br><span class="line">            slow = nums[slow];</span><br><span class="line">            fast = nums[fast];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> fast;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™å’Œä¹‹å‰æˆ‘åšè¿‡çš„ä¸€é“é“¾è¡¨é¢˜çš„è§£æ³•ååˆ†ç›¸ä¼¼, æ€è·¯æ˜¯è¿™æ ·çš„: ä¸€ä¸ªäººèµ°å¾—å¿«, å¦ä¸€ä¸ªäººèµ°å¾—æ…¢. å¿«çš„äººçš„è·ç¦»ä¸€ç›´æ˜¯æ…¢çš„äººçš„ä¸¤å€, æ‰€ä»¥ä¸€å¼€å§‹ slow æ˜¯ nums[0], è€Œå¹¶é 0. å› ä¸º 0 å’Œ 1 çš„å·®è·å’Œ 1 å’Œ 2 çš„å·®è·è™½ç„¶éƒ½åªæœ‰1, ä½†å‰è€…å¹¶æ²¡æœ‰å€æ•°å…³ç³». è€Œå½“èµ°äº† n æ­¥æ—¶(fast èµ°äº† 2næ­¥) ä¸¤äººç¢°æ’. æ­¤æ—¶ fast å†é‡æ–°å¼€å§‹, ä»¥åŒæ ·çš„é€Ÿåº¦å¼€å§‹è¡Œèµ°, é‚£ä¹ˆ n æ­¥å, ä¸€å®šä¼šç›¸é‡(æˆ‘ä¸å¤ªç¡®å®šæ˜¯å¦ä¸€å®šæ˜¯ n æ­¥, ä½†æœ€å¤š n æ­¥). æ­¤æ—¶ slow å’Œ fast çš„ä½ç½®è‚¯å®šæ˜¯ä¸åŒçš„ (while çš„æ¡ä»¶ä¿è¯äº†å…¶ä¸åŒ) æ‰€ä»¥æœ€åçš„å€¼å°±æ˜¯é‡å¤çš„æ•°å­—. ä¹‹æ‰€ä»¥éœ€è¦ä¸¤æ¬¡, æ˜¯å› ä¸ºç¬¬ä¸€æ¬¡çš„ç»“æœå¯èƒ½ä¼šå‡ºç°å¶ç„¶çš„æƒ…å†µ, æ¯”å¦‚éƒ½æŒ‡å‘åŒä¸€ä¸ªæ•°å­—. </p>
<p>ç¬¬ä¸€æ¬¡çš„å¾ªç¯ç»“æŸ, æ„å‘³ç€æœ‰ä¸¤ä¸ªä¸‹æ ‡æŒ‡å‘çš„æ•°å€¼æ˜¯ç›¸åŒçš„(å¶ç„¶æƒ…å†µä¼šæŒ‡å‘åŒä¸€ä¸ªä¸‹æ ‡). ä¹Ÿå°±æ˜¯è¯´, åœ¨ç¬¬ä¸€æ¬¡ç»“æŸæ—¶, ç­”æ¡ˆå°±å·²ç»æœ‰å¯èƒ½å¾—åˆ°äº†</p>
<p><img src="https://imgur.com/NuDtTwh.png" alt=""></p>
<p>å°†æ ‡æ³¨çš„ä»£ç å¢åŠ å, ä¹Ÿå¯ä»¥å¾—åˆ°ç­”æ¡ˆ. </p>
<p>è€Œç¬¬äºŒæ¬¡å¾ªç¯æ˜¯ä¸ºäº†è§„é¿å¶ç„¶æƒ…å†µ, æ¯”å¦‚ [3,1,3,4,2] åˆ°ç¬¬ä¸€æ¬¡å¾ªç¯ç»“æŸ slow æ˜¯ 4, fast æ˜¯ 3. åˆšå¥½, å…¶å®ä»–ä»¬æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªæ•°å­—, é’ˆå¯¹è¿™ç§æƒ…å†µ, å°±æœ‰äº†ç¬¬äºŒæ¬¡å¾ªç¯. è€Œä¹‹æ‰€ä»¥ç¬¬äºŒæ¬¡å¾ªç¯ä» 0 å¼€å§‹, æ˜¯å› ä¸ºè¿™é‡Œéœ€è¦çš„æ˜¯æ­¥æ•°ä¸€è‡´. ä¸€å®šä¼šå¾—åˆ°ç­”æ¡ˆä¹ˆ? å†ä»”ç»†æƒ³æƒ³è¿™ä¸ªä¾‹å­, å…¶å¾ªç¯å‘¨æœŸä¸º: 3, 4, 2, 3, 4, 2â€¦ å½“ç„¶, ç¬¬äºŒæ¬¡æ˜¯ä»¥ 2 å¼€å§‹çš„, æ‰€ä»¥æ˜¯ 2, 3, 4â€¦</p>
<p>emmâ€¦ [æŒ å¤´â€¦] </p>
<p>è¿™ä¸ªç®—æ³•æœ‰ä¸¤ä¸ªå‰ææ¡ä»¶:</p>
<ol>
<li>æ•°ç»„ä¸­çš„æ•°å­—éƒ½èƒ½å½“ä½œä¸‹æ ‡, ä¹Ÿå°±æ˜¯ä¸è¶…è¿‡æ•°ç»„é•¿åº¦</li>
<li>é‡å¤çš„æ•°å­—åªèƒ½æœ‰ä¸€ä¸ª, ä¸ç„¶å¯èƒ½ä¼šé€ æˆæ­»å¾ªç¯</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>read/Arithmetic</title>
    <url>/2020/02/26/read/Arithmetic/</url>
    <content><![CDATA[<h2 id="Arithmetic"><a href="#Arithmetic" class="headerlink" title="Arithmetic"></a>Arithmetic</h2><p>ä¹‹å‰å°±å¬è¯´è®¡ç®—æœºåªä¼šåšåŠ æ³•è¿ç®—, å…¶ä½™è¿ç®—éƒ½æ˜¯é€šè¿‡æ¼”åŒ–è€Œæ¥çš„, è¿™æ¬¡åœ¨çœ‹ <computer organization and design the hardwareSoftware interface> çš„æ—¶å€™, å®ƒå•ç‹¬æ‹¿å‡ºäº†ä¸€èŠ‚è®²è¿™ä¸ªä¸œè¥¿, æ‰€ä»¥å°±åšä¸ªç¬”è®° :)</p>
<p>Computer can do add arithmetic only, other arithmetics are based on it.</p>
<a id="more"></a>



<h2 id="add"><a href="#add" class="headerlink" title="add"></a>add</h2><p>åŠ æ³•è¦æ³¨æ„ä¸€ä¸‹æº¢å‡º, å¯ä»¥å‚è€ƒä¸€ä¸‹æˆ‘ä¹‹å‰çš„ç¬”è®°</p>
<p>the key point of add arithmetic is overflow, about <a href="https://yucangs.github.io/2020/01/10/other/overFlowAndCarry/" target="_blank" rel="noopener">overflow</a></p>
<h2 id="Sub"><a href="#Sub" class="headerlink" title="Sub"></a>Sub</h2><p>å‡æ³•å°±æ˜¯åŠ ä¸Šè´Ÿæ•°, è€Œè´Ÿæ•°çš„è®¡ç®—æ–¹å¼ä¹‹å‰æœ‰åš<a href="https://yucangs.github.io/2020/01/10/other/encode/" target="_blank" rel="noopener">ç¬”è®°</a></p>
<h2 id="mul"><a href="#mul" class="headerlink" title="mul"></a>mul</h2><p><img src="https://imgur.com/wYT63l2.png" alt=""></p>
<p>In this example, we restricted the decimal digits to 0 and 1. With only two<br>choices, each step of the multiplication is simple:</p>
<p>å°†åè¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶, æ ¹æ®æ¯ä¸€ä½æ•°å­—æ‰§è¡Œä¸åŒçš„é€‰æ‹©: </p>
<ol>
<li>Just place a copy of the multiplicand (1 ? multiplicand) in the proper place<br>if the multiplier digit is a 1, or</li>
<li>Place 0 (0 ? multiplicand) in the proper place if the digit is 0.<br>Although the decimal example above happens to use only 0 and 1, multiplication<br>of binary numbers must always use 0 and 1, and thus always off ers only these two<br>choices.</li>
</ol>
<p>1 å³æ‹·è´, 0 ä»€ä¹ˆä¹Ÿä¸åš</p>
<p><img src="https://imgur.com/jYot1g7.png" alt=""></p>
<p><img src="https://imgur.com/JLBNTK0.png" alt=""></p>
<p>ç¬¬äºŒå¼ å›¾å°±ç®€æ˜å¤šäº†, ç®€è¿°äº†ä¹˜æ³•è¿ç®—çš„åŸç†.</p>
<h2 id="Div"><a href="#Div" class="headerlink" title="Div"></a>Div</h2><p><img src="https://imgur.com/EIhJokd.png" alt=""></p>
<p><img src="https://imgur.com/3RiHAfk.png" alt=""></p>
<p>å°±å’Œæ™®é€šçš„é™¤æ³•è¿ç®—æ­¥éª¤æ˜¯ä¸€æ ·çš„</p>
]]></content>
  </entry>
  <entry>
    <title>read/InterVirtualizationTechnology</title>
    <url>/2020/02/12/read/InterVirtualizationTechnology/</url>
    <content><![CDATA[<h2 id="InterVirtualizationTechnology"><a href="#InterVirtualizationTechnology" class="headerlink" title="InterVirtualizationTechnology"></a>InterVirtualizationTechnology</h2><p>é•¿ä¹…ä»¥æ¥ä¸€ç›´å¯¹è™šæ‹ŸåŒ–ä¸€çŸ¥åŠè§£ï¼Œä»€ä¹ˆæ˜¯è™šæ‹ŸåŒ–ï¼Œä¸ºä»€ä¹ˆè¦è™šæ‹ŸåŒ–ï¼Œè™šæ‹ŸåŒ–çš„ä¼˜åŠ£ï¼Œè™šæ‹ŸåŒ–çš„åŸç†æ˜¯ä»€ä¹ˆâ€¦â€¦ è¿™ç¯‡ç¬”è®°æ”¶é›†è‡ªç½‘ä¸Šçš„ä¿¡æ¯ï¼Œç„¶åå½’çº³ä¸€ä¸‹ã€‚ç†è§£å…¶ä¸­æŸäº›åŸå› ã€‚</p>
<p>from ï¼š<a href="https://www.hardwaresecrets.com/everything-you-need-to-know-about-the-intel-virtualization-technology/" target="_blank" rel="noopener">Everything you need to know about the Intel virtuallization technology</a></p>
<a id="more"></a>

<p>Several Intel CPUs come with the Intel Virtualization Technology (VT). Formerly known as Vanderpool, this technology enables a CPU to act as if you have several independent computers, in order to enable several operating systems to run at the same time on the same machine. In this tutorial we will explain everything you need to know about this technology.</p>
<p>éƒ¨åˆ† CPU å…·æœ‰è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚è¿™ç§æŠ€æœ¯ä½¿ CPU è¿è¡Œèµ·æ¥å¥½åƒæ˜¯æœ‰å¤šä¸ªç‹¬ç«‹çš„ç”µè„‘ä¸€æ ·ï¼Œè®©å¤šä¸ªæ“ä½œç³»ç»Ÿåœ¨åŒä¸€æ—¶é—´ã€åŒä¸€æœºå™¨ä¸Šè¿è¡Œã€‚</p>
<p>Intelâ€™s virtualization technology is available in two versions: VT-x, for x86 processors; and VT-i, for Itanium (i.e., IA-64) processors. In this tutorial we will be covering the details of the VT-x technology.</p>
<p>Inter è™šæ‹ŸåŒ–æŠ€æœ¯åº”ç”¨äºä¸¤ä¸ªç‰ˆæœ¬ï¼šVT-xï¼ˆx86å¤„ç†å™¨ï¼‰ï¼ŒVT-iï¼ˆIA-64å¤„ç†å™¨ï¼‰</p>
<p>Virtualization technology is nothing new. There is some software on the market that enables virtualization; probably <a href="https://www.vmware.com/" target="_blank" rel="noopener">VMware</a> is the most famous one. (<a href="https://en.wikipedia.org/wiki/Comparison_of_platform_virtual_machines" target="_blank" rel="noopener">Click here for a complete list of virtualization software available on the market</a>.) With this technique, you can â€œpartitionâ€ a single computer to act as if it were several independent computers, allowing the system to run several operating systems at the same time. These operating systems can even be different (e.g., you can run Windows in one virtual machine and Linux in another).</p>
<p>å·²æœ‰ä¸€äº›è½¯ä»¶ä½¿ç”¨äº†è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå…¶ä¸­ VMware æ˜¯æœ€å‡ºåçš„ä¹‹ä¸€ã€‚ä½¿ç”¨è¿™ä¸ªæŠ€æœ¯å¯ä»¥åœ¨å•ä¸ªç”µè„‘ä¸Šè¿è¡Œå¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œå°±åƒå¤šä¸ªç”µè„‘ä¸€æ ·ã€‚è¿™äº›æ“ä½œç³»ç»Ÿå¯ä»¥å½¼æ­¤ä¸å…¼å®¹ã€‚</p>
<p>Multi-core technology allows a single processor to have more than one physical processor inside. For example, a computer with one dual-core processor acts as if it were a computer with two CPUs installed, working under a mode called symmetrical multiprocessing (SMP). Even though multi-core CPUs have more than one processor inside, they cannot be used independently. The operating system is run by the first CPU core, and the additional cores the CPU may have must be used by the same operating system. So, based on any explanation, there is no difference between a single-core CPU and a multi-core one.</p>
<p>å¤šæ ¸æŠ€æœ¯ä½¿å•ä¸ªå¤„ç†å™¨å¯ä»¥æ‹¥æœ‰å¤šä¸ªç‰©ç†å¤„ç†å™¨ã€‚ä¸€ä¸ªåŒæ ¸çš„å¤„ç†å™¨å¯ä»¥åƒä¸€ä¸ªåŒ CPU çš„ç”µè„‘ä¸€æ ·ï¼Œè¿è¡Œäºä¸€ä¸ªå«åš<a href="https://www.wisegeek.com/what-is-symmetric-multiprocessing.htm" target="_blank" rel="noopener">å¯¹ç§°å¤šå¤„ç†å™¨</a>çš„æ¨¡å¼ã€‚å³ä½¿å¤šæ ¸å¤„ç†å™¨æ‹¥æœ‰å¤šä¸ªå¤„ç†å•å…ƒï¼Œä½†ä¸èƒ½ç‹¬ç«‹ä½¿ç”¨ã€‚å•æ ¸ CPU å’Œå¤šæ ¸ CPU å¹¶æ— å¤ªå¤§åŒºåˆ«ã€‚</p>
<p>Hyper-Threading technology simulates an additional processor per CPU core. For example, a dual-core CPU with Hyper-Threading technology is seen by the operating system as if it were a quad-core CPU. These additional processors cannot run separate operating systems, so for the operating system the Hyper-Threading technology has the same effect as the multi-core technology.</p>
<p>è¶…çº¿ç¨‹æŠ€æœ¯å°†æ¯ä¸ª CPU æ ¸å¿ƒæ¨¡æ‹Ÿä¸€ä¸ªé¢å¤–çš„å¤„ç†å•å…ƒã€‚ä¸€ä¸ªåŒæ ¸çš„ CPU åœ¨è¶…çº¿ç¨‹æŠ€æœ¯ä¸‹ï¼Œåœ¨æ“ä½œç³»ç»Ÿçš„è§†è§’çœ‹èµ·æ¥å°±åƒä¸€ä¸ªå››æ ¸çš„å¤„ç†å™¨ã€‚è¿™äº›é¢å¤–çš„å¤„ç†å™¨ä¸èƒ½è¿è¡Œä¸åŒçš„æ“ä½œç³»ç»Ÿã€‚å¯¹æ“ä½œç³»ç»Ÿè€Œè¨€ï¼Œè¶…çº¿ç¨‹æŠ€æœ¯å¸¦æ¥çš„å¥½å¤„å’Œå¤šæ ¸æŠ€æœ¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>The diagrams below may help you understand the differences between those technologies.</p>
<p><a href="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214556/263_011.gif" target="_blank" rel="noopener"><img src="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214556/263_011.gif" alt="Multitasking"></a><strong>Figure 1:</strong> Multitasking</p>
<p><a href="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214554/263_021.gif" target="_blank" rel="noopener"><img src="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214554/263_021.gif" alt="Multi-core or Hyper-Threading"></a><strong>Figure 2:</strong> Multi-core or Hyper-Threading</p>
<p><a href="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214544/263_031.gif" target="_blank" rel="noopener"><img src="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214544/263_031.gif" alt="Virtualization"></a><strong>Figure 3:</strong> Virtualization</p>
<p>ï¼ˆå¯ä»¥çœ‹å‡ºï¼Œè™šæ‹ŸåŒ–æŠ€æœ¯ä¸ºæ¯ä¸ª OS æä¾›äº†è™šæ‹Ÿçš„ CPUï¼‰</p>
<p>If you pay close attention, Virtualization Technology uses the same idea as the Virtual 8086 (V86) mode, which has been available since the 386 processor. With the V86 mode you can create several virtual 8086 machines to run DOS-based programs at the same time, each one â€œthinkingâ€ that it is running in a completely independent computer. With VT you can create several â€œcompleteâ€ virtual machines to run full operating systems simultaneously.</p>
<p>If there is software such as VMware that enables virtualization, why implement Virtualization Technology inside the CPU? The advantage is that CPUs with Virtualization Technology have some new instructions to control virtualization. With them, controlling software (called VMM, Virtual Machine Monitor) can be simpler, thus improving performance compared to software-based solutions. When the CPU has support to Virtualization Technology, the virtualization is said to be hardware-based or hardware-assisted.</p>
<p>å¦‚æœå·²ç»æœ‰äº†ç±»ä¼¼ VMware çš„è½¯ä½“æ”¯æŒè™šæ‹ŸåŒ–ï¼Œä¸ºä»€ä¹ˆè¦åœ¨ CPU ä¸­å®ç°è™šæ‹ŸåŒ–æŠ€æœ¯å‘¢ï¼Ÿå› ä¸ºè™šæ‹ŸåŒ–æŠ€æœ¯ä½¿ç”¨äº†ç‰¹æ®Šçš„ CPU æŒ‡ä»¤ï¼Œè¿™äº›æŒ‡ä»¤å¸¦æ¥äº†é¢å¤–çš„ç›Šå¤„ã€‚ï¼ˆåœ¨ <a href="https://en.wikipedia.org/wiki/X86_instruction_listings" target="_blank" rel="noopener">x86 instruction sets</a> ä¸­ï¼Œå¸¦æœ‰ VM å¼€å¤´çš„æŒ‡ä»¤åº”è¯¥å°±æ˜¯è™šæ‹ŸåŒ–æŒ‡ä»¤ï¼‰</p>
<p>Processors with Virtualization Technology have an extra instruction set called Virtual Machine Extensions or VMX. VMX brings 10 new virtualization-specific instructions to the CPU: VMPTRLD, VMPTRST, VMCLEAR, VMREAD, VMWRITE, VMCALL, VMLAUNCH, VMRESUME, VMXOFF, and VMXON.</p>
<p>There are two modes to run under virtualization: VMX root operation and VMX non-root operation. Usually, only the virtualization controlling software, called Virtual Machine Monitor (VMM), runs under root operation, while operating systems running on top of the virtual machines run under non-root operation. Software running on top of virtual machines is also called â€œguest software.â€</p>
<p>æœ‰ä¸¤ç§è™šæ‹Ÿæ¨¡å¼åœ¨è™šæ‹ŸåŒ–ä¸­è¿è¡Œï¼šVMX root å’Œ VMX non-root æ“ä½œã€‚é€šå¸¸åªæœ‰è™šæ‹ŸåŒ–æ§åˆ¶è½¯ä»¶(VMM)æ‰è¿è¡Œäº root æ“ä½œä¸‹ï¼Œæ“ä½œç³»ç»Ÿè¿è¡Œäºè™šæ‹Ÿæœºçš„é¡¶å±‚ï¼Œå¤„äº non-root æ“ä½œã€‚è¿è¡Œäºè™šæ‹Ÿæœºé¡¶å±‚çš„è½¯ä»¶åˆç§°â€œè®¿å®¢è½¯ä»¶â€</p>
<p>To enter virtualization mode, the software should execute the VMXON instruction and then call the VMM software. The VMM software can enter each virtual machine using the VMLAUNCH instruction, and exit it by using the VMRESUME instruction. If the VMM wants to shutdown and exit the virtualization mode, it executes the VMXOFF instruction.</p>
<p>è½¯ä»¶é€šè¿‡æ‰§è¡Œ VMXON æŒ‡ä»¤å¹¶è°ƒç”¨ VMM è½¯ä»¶è¿›å…¥è™šæ‹Ÿæ¨¡å¼ã€‚VMM å¯ä»¥ä½¿ç”¨ VMLAUNCH æŒ‡ä»¤è¿›å…¥æ¯ä¸ªè™šæ‹Ÿæœºï¼Œå¹¶é€šè¿‡ä½¿ç”¨ VMRESUME æŒ‡ä»¤é€€å‡ºã€‚ï¼ˆä¸ºä»€ä¹ˆæ˜¯ resume ï¼Ÿï¼‰é€šè¿‡ä½¿ç”¨ VMXOFF æŒ‡ä»¤å…³é—­å¹¶æ¨å‡ºè™šæ‹Ÿæ¨¡å¼ã€‚</p>
<p><a href="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214536/263_041.gif" target="_blank" rel="noopener"><img src="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214536/263_041.gif" alt="Operation of the Virtualization Technology"></a><strong>Figure 4:</strong> Operation of the Virtualization Technology</p>
<p>Each guest shown in Figure 4 can be a different operating system, running its own programs (even several programs at the same time as we have shown in Figure 3).</p>
<p>æ¯ä¸ªâ€œè®¿å®¢â€å¯ä»¥æ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œè¿è¡Œè‡ªå·±çš„ç¨‹åºã€‚</p>
<p>More recent processors have an extension called EPT (Extended Page Tables), which allows each guest to have its own page table to keep track of memory addresses. Without this extension, the VMM has to exit the virtual machine to perform address translations. This exiting-and-returning task reduces performance. Therefore, the EPT increases virtualization performance.</p>
<p>å¤„ç†å™¨æœ‰é¢å¤–çš„ EPT (æ‰©å±•é¡µè¡¨)åŠŸèƒ½ï¼Œå¯ä»¥ä½¿â€œè®¿å®¢â€æ‹¥æœ‰è‡ªå·±çš„é¡µè¡¨ï¼Œä»¥ç”¨äºè¿½è¸ªå†…å­˜åœ°å€ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªé¢å¤–æ‰©å±•ï¼ŒVMM å¿…é¡»é€€å‡ºè™šæ‹Ÿæœºæ‰§è¡Œåœ°å€è½¬æ¢ï¼Œè¿™ä¼šå½±å“æ€§èƒ½/</p>
<p>Even though the Intel Virtualization Technology was released in 2005, not all current processors from Intel support this technology. The easiest way to verify if your CPU supports this technology is to run the <a href="https://downloadcenter.intel.com/Detail_Desc.aspx?DwnldID=7838" target="_blank" rel="noopener">Intel Processor Identification Utility</a>. After you download and install this program, run it and go to the â€œCPU Technologiesâ€ tab. There you will see, besides â€œIntel (R) Virtualization Technology,â€ whether your CPU supports it or not. Also, you can see whether your CPU supports the Extended Page Tables (EPT), besides â€œIntel VT-x with Extended Page Tables.â€ See Figure 5.</p>
<p><a href="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214518/263_051.gif" target="_blank" rel="noopener"><img src="https://s3.amazonaws.com/hs-wordpress/wp-content/uploads/2017/12/12214518/263_051.gif" alt="Detecting support for the Intel Virtualization Technology"></a><strong>Figure 5:</strong> Detecting support for the Intel Virtualization Technology</p>
<p>æœ€åå†è¡¥å……ä¸€ä¸‹ Intel å®˜æ–¹è™šæ‹ŸåŒ–æŠ€æœ¯æ–‡æ¡£ <a href="https://www.intel.com/content/www/us/en/virtualization/virtualization-technology/intel-virtualization-technology.html" target="_blank" rel="noopener">InterVitrualizationTechnololy</a></p>
<p>Virtualization abstracts hardware that allows multiple workloads to share a common set of resources. On shared virtualized hardware, a variety of workloads can co-locate while maintaining full isolation from each other, freely migrate across infrastructures, and scale as needed.o</p>
<p>è™šæ‹ŸåŒ–æŠ½è±¡ç¡¬ä»¶ï¼Œä½¿å¤šä¸ªå·¥ä½œç«™å…±äº«åŒä¸€ä»½èµ„æºã€‚åœ¨å…±äº«è™šæ‹Ÿç¡¬ä»¶ä¸Šï¼Œå¤šä¸ªå·¥ä½œç«™å¯ä»¥åœ¨ä¿è¯å…¶å®Œå…¨éš”ç¦»çš„æƒ…å†µä¸‹åä½œï¼Œè‡ªç”±åœ°åœ¨æ¶æ„ä¸­è¿ç§»èµ„æºï¼ŒæŒ‰å…¶æ‰€éœ€è‡ªé€‚åº”ã€‚</p>
<p>Businesses tend to gain significant capital and operational efficiencies through virtualization because it leads to improved server utilization and consolidation, dynamic resource allocation and management, workload isolation, security, and automation. Virtualization makes on-demand self-provisioning of services and software-defined orchestration of resources possible, scaling anywhere in a hybrid cloud on-premise or off-premise per specific business needs.</p>
<p>ä¼ä¸šæœŸæœ›é€šè¿‡è™šæ‹ŸåŒ–å‡å°‘æ”¯å‡ºï¼Œæé«˜æ•ˆç‡ã€‚</p>
<p>IntelÂ® Virtualization Technology (IntelÂ® VT) represents a growing portfolio of technologies and features that make virtualization practical by eliminating performance overheads and improving security. IntelÂ® Virtualization Technology (IntelÂ® VT) provides hardware assist to the virtualization software, reducing its size, cost, and complexity. Special attention is also given to reduce the virtualization overheads occurring in cache, I/O, and memory. Over the last decade or so, a significant number of hypervisor vendors, solution developers, and users have been enabled with IntelÂ® Virtualization Technology<br>(IntelÂ® VT), which is now serving a broad range of customers in the consumer, enterprise, cloud, communication, technical computing, and many more sectors.</p>
<p>IntelÂ® Virtualization Technology (IntelÂ® VT) portfolio currently includes (but not limited to):</p>
<p><strong>CPU virtualization</strong> features enable faithful abstraction of the full prowess of IntelÂ® CPU to a virtual machine (VM). All software in the VM can run without any performance or compatibility hit, as if it was running natively on a dedicated CPU. Live migration from one IntelÂ® CPU generation to another, as well as nested virtualization, is possible.</p>
<p>CPU è™šæ‹ŸåŒ–ï¼šä¸º VM æä¾›äº† CPU çš„æŠ½è±¡ã€‚æ‰€æœ‰ VM è¿è¡Œçš„è½¯ä»¶ä¸ä¼šå¸¦æ¥æ€§èƒ½æˆ–å…¼å®¹æ€§çš„ç¼ºå¤±ã€‚å°±åƒä½¿ç”¨ä¸“æœ‰çš„ CPU ä¸€æ ·ã€‚</p>
<p><strong>Memory virtualization</strong> features allow abstraction isolation and monitoring of memory on a per virtual machine (VM) basis. These features may also make live migration of VMs possible, add to fault tolerance, and enhance security. Example features include direct memory access (DMA) remapping and <a href="https://software.intel.com/en-us/articles/best-practices-for-paravirtualization-enhancements-from-intel-virtualization-technology-ept-and-vt-d" target="_blank" rel="noopener">extended page tables</a> (EPT), including their extensions: accessed and dirty bits, and fast switching of EPT contexts.</p>
<p>å†…å­˜ è™šæ‹ŸåŒ–ï¼šæä¾›åŸºäºæ¯ä¸ªè™šæ‹Ÿæœºçš„æŠ½è±¡éš”ç¦»å’Œå†…å­˜ç›‘è§†ã€‚è¿™äº›ç‰¹æ€§å¯èƒ½ä½¿ VMs çš„å®æ—¶è¿ç§»å¯å®ç°ã€‚å¢åŠ å®¹é”™åŠ›å’Œå®‰å…¨æ€§ã€‚æ¯”å¦‚ç›´æ¥å†…å­˜è®¿é—®(DMA)ï¼Œé‡æ˜ å°„å’Œæ‰©å±•é¡µè¡¨(EPT)ï¼ŒåŒ…æ‹¬ä»–ä»¬çš„æ‰©å±•ï¼šè®¿é—®å’Œè„ä½ï¼Œå¿«é€Ÿåˆ‡æ¢ EPT ä¸Šä¸‹æ–‡ã€‚</p>
<p>I/O virtualization** features facilitate offloading of multi-core packet processing to network adapters as well as direct assignment of virtual machines to virtual functions, including disk I/O. Examples include IntelÂ® Virtualization Technology for Directed I/O (VT-d), Virtual Machine Device Queues (VMDQ), <a href="https://cdrdv2.intel.com/v1/dl/getcontent/321211" target="_blank" rel="noopener">Single Root I/O Virtualization</a> (SR-IOV, a PCI-SIG standard), and <a href="https://www.intel.com/content/www/us/en/io/data-direct-i-o-technology.html" target="_blank" rel="noopener">IntelÂ® Data Direct I/O Technology (IntelÂ® DDIO) enhancements</a>.</p>
<p><strong>IntelÂ® Graphics Virtualization Technology</strong> (<a href="https://01.org/blogs/skjain/2014/intelÂ®-graphics-virtualization-update" target="_blank" rel="noopener">IntelÂ® GVT</a>) allows VMs to have full and/or shared assignment of the graphics processing units (GPU) as well as the video transcode accelerator engines integrated in Intel <a href="http://ark.intel.com/products/65732/Intel-Xeon-Processor-E3-1230V2-8M-Cache-3_30-GHz" target="_blank" rel="noopener">system-on-chip products</a>. It enables usages such as workstation remoting, desktop-as-a-service, media streaming, and online gaming.</p>
<p>IntelÂ® Graphics Virtualization Technology</p>
<p><strong>Virtualization of Security and Network functions</strong> enables transformation of traditional network and security workloads into compute. Virtual functions can be deployed on standard high volume servers anywhere in the data center, network nodes, or cloud, and smartly co-located with business workloads. Examples of technologies making it happen include <a href="https://www.intel.com/content/www/us/en/architecture-and-technology/intel-quick-assist-technology-overview.html" target="_blank" rel="noopener">IntelÂ® QuickAssist Technology (IntelÂ® QAT) </a>and the <a href="https://www.intel.com/content/www/us/en/communications/data-plane-development-kit.html" target="_blank" rel="noopener">Data Plane Development Kit (DPDK)</a>.</p>
<p>å…¶ä»–æœ‰å…³ Intel VT çš„ä¿¡æ¯ï¼š</p>
<p><a href="https://www.youtube.com/watch?v=XItj08D5KPk" target="_blank" rel="noopener">video</a></p>
<p><a href="https://itpeernetwork.intel.com/a-peek-into-extended-page-tables/#gs.waxaq1" target="_blank" rel="noopener">EPT</a></p>
]]></content>
  </entry>
  <entry>
    <title>other/auto+const+pointer</title>
    <url>/2020/02/10/other/auto+const+pointer/</url>
    <content><![CDATA[<h2 id="auto-const-pointer"><a href="#auto-const-pointer" class="headerlink" title="auto+const+pointer"></a>auto+const+pointer</h2><p>åœ¨é¡¹ç›®ä¸­é‡åˆ°äº†éœ€è¦ä½¿ç”¨autoçš„åœºæ™¯ï¼Œé‚£æ˜¯ä¸€ä¸ªå¤æ‚ç±»å‹çš„æŒ‡é’ˆã€‚ä½¿ç”¨æ—¶å‡ºäº†ä¸€äº›ç–‘é—®ï¼Œæ‰€ä»¥æœ‰äº†è¿™ç¯‡ç¬”è®°ã€‚</p>
<p>Iâ€™ve got a problem when I need to use the â€˜autoâ€™ keyword in a project. Thisâ€™s why I wrote this note.</p>
<a id="more"></a>

<p>å‚è€ƒä»¥ä¸‹ä»£ç ï¼š</p>
<p>think flowing codes</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> *p = &amp;i;</span><br><span class="line"><span class="keyword">auto</span> p2 = p;</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘æƒ³è¦ p2 å®‰å…¨ä¸€äº›ï¼Œæˆ‘ä¸æƒ³æ”¹å˜ i çš„å€¼ï¼Œé‚£ä¹ˆæˆ–è®¸å¯ä»¥è¿™æ ·åšï¼š</p>
<p>if I want p2 to be safer and donâ€™t want to change the value of â€˜iâ€™, maybe I can do this:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> p2 = p; <span class="comment">// or const auto p2 = p; ?</span></span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ consnt åœ¨ auto ä½ç½®ä¸å½±å“å…¶è¯­ä¹‰ï¼Œp2 ä¾æ—§å¯ä»¥æ”¹å˜ i çš„å€¼ã€‚ï¼ˆpsï¼šåŒ const ä¼šæŠ¥é”™ï¼‰</p>
<p>The position of â€˜constâ€™ at â€˜autoâ€™ doesnâ€™t affect anything. The value of â€˜iâ€™ still can be changed by â€˜p2â€™. (PS: double-const will get an error)</p>
<p>æˆ‘æƒ³è¦çš„æ˜¯ä¸€ä¸ªåŒ const çš„æŒ‡é’ˆï¼Œå¦‚ä½•å®ç°å‘¢ï¼Ÿ</p>
<p>I want a double-const pointer, how can get it?</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span>* <span class="keyword">const</span> p2 = p;</span><br></pre></td></tr></table></figure>

<p>Emmm, å¥½åƒå¹¶ä¸æ˜¯å¾ˆæœ‰æ„ä¹‰å†™è¿™ç¯‡ç¬”è®°</p>
<p>it seems doesnâ€™t make sense to write this noteâ€¦</p>
]]></content>
  </entry>
  <entry>
    <title>read/ICMPTheInternetControlMessageProtocol</title>
    <url>/2020/01/18/read/ICMPTheInternetControlMessageProtocol/</url>
    <content><![CDATA[<h3 id="5-6-ICMP-The-Internet-Control-Message-Protocol"><a href="#5-6-ICMP-The-Internet-Control-Message-Protocol" class="headerlink" title="5.6 ICMP: The Internet Control Message Protocol"></a>5.6 ICMP: The Internet Control Message Protocol</h3><p>The Internet Control Message Protocol (ICMP), specified in [RFC 792], is used by<br>hosts and routers to communicate network-layer information to each other. The most<br>typical use of ICMP is for error reporting. For example, when running an HTTP<br>session, you may have encountered an error message such as â€œDestination network<br>unreachable.â€ This message had its origins in ICMP. At some point, an IP router was<br>unable to find a path to the host specified in your HTTP request. That router created<br>and sent an ICMP message to your host indicating the error.</p>
<p>ICMP ç”¨äºä¸»æœºå’Œè·¯ç”±å½¼æ­¤é€šè®¯, ä¼ é€’ç½‘ç»œå±‚ä¿¡æ¯. æœ€å…¸å‹çš„ç”¨æ³•æ˜¯é”™è¯¯æŠ¥å‘Š. </p>
<a id="more"></a>

<p>ICMP is often considered part of IP, but architecturally it lies just above IP, as<br>ICMP messages are carried inside IP datagrams. That is, ICMP messages are carried<br>as IP payload, just as TCP or UDP segments are carried as IP payload. Similarly,<br>when a host receives an IP datagram with ICMP specified as the upper-layer protocol<br>(an upper-layer protocol number of 1), it demultiplexes the datagramâ€™s contents to<br>ICMP, just as it would demultiplex a datagramâ€™s content to TCP or UDP.</p>
<p>ICMP é€šå¸¸è¢«è®¤ä¸ºæ˜¯ IP çš„ä¸€éƒ¨åˆ†. ä½†æ˜¯ç»“æ„ä¸Šå®ƒå¤„äº IP çš„ä¸Šå±‚. ICMP ä¿¡æ¯ä½äº IP æ•°æ®åŒ…ä¸­. ICMP ä¿¡æ¯ä½œä¸º IP çš„è´Ÿè½½, å°±åƒ TCP/UDP æ®µä¸€æ ·. å½“ä¸»æœºæ¥æ”¶åˆ°é™„å¸¦ ICMP, å¹¶æŒ‡å®šä¸ºä¸Šå±‚åè®®çš„ IP æ•°æ®æŠ¥æ—¶. è§£å¤ç”¨æ•°æ®æŠ¥çš„å†…å®¹ç»™ ICMP. å°±åƒè§£å¤ç”¨æ•°æ®æŠ¥å†…å®¹ç»™ TCP/UDP ä¸€æ ·.</p>
<p>ICMP messages have a type and a code field, and contain the header and the first<br>8 bytes of the IP datagram that caused the ICMP message to be generated in the first<br>place (so that the sender can determine the datagram that caused the error). Selected<br>ICMP message types are shown in Figure 5.19. Note that ICMP messages are used<br>not only for signaling error conditions.</p>
<p>ICMP æ¶ˆæ¯æœ‰ä¸€ä¸ªç±»å‹å’Œä»£ç å­—æ®µ (åé¢è¿™æ®µæˆ‘è¯»ä¸é€šâ€¦). ICMP ä¸ä»…ä»…ç”¨äºé”™è¯¯æ¶ˆæ¯ä¼ é€’.</p>
<p>The well-known ping program sends an ICMP type 8 code 0 message to the<br>specified host. The destination host, seeing the echo request, sends back a type 0<br>code 0 ICMP echo reply. Most TCP/IP implementations support the ping server<br>directly in the operating system; that is, the server is not a process. Chapter 11 of<br>[Stevens 1990] provides the source code for the ping client program. Note that the<br>client program needs to be able to instruct the operating system to generate an ICMP<br>message of type 8 code 0.</p>
<p>ping ç¨‹åºå°±æ˜¯ç”± ICMP å®ç°çš„. ping ä¼šå‘é€ä¸€ä¸ªç±»å‹ä¸º 8, ä»£ç ä¸º 0 çš„æ¶ˆæ¯ç»™æŒ‡å®šä¸»æœº, å½“æŒ‡å®šä¸»æœºçœ‹åˆ°è¿™ä¸ªå›æ˜¾æ¶ˆæ¯æ—¶, è¿”å›ä¸€ä¸ªç±»å‹ 0, ä»£ç  0 çš„æ¶ˆæ¯. è¿™é€šå¸¸å®ç°äºæ“ä½œç³»ç»Ÿ. è¿™æ„å‘³è¿™è¿™ä¸ªæœåŠ¡å¹¶ä¸æ˜¯ä¸€ä¸ªè¿‡ç¨‹.</p>
<p>Another interesting ICMP message is the source quench message. This message<br>is seldom used in practice. Its original purpose was to perform congestion controlâ€”to<br>allow a congested router to send an ICMP source quench message to a host to force<br>that host to reduce its transmission rate. We have seen in Chapter 3 that TCP has its<br>own congestion-control mechanism that operates at the transport layer, without the<br>use of network-layer feedback such as the ICMP source quench message.</p>
<p>å¦ä¸€ä¸ªæ¶ˆæ¯æ˜¯ source quench (æˆ‘ä¸çŸ¥é“è¯¥æ€ä¹ˆä¸­æ–‡ç§°å‘¼å®ƒ :( â€¦ ) æ¶ˆæ¯, å®ƒç”¨äºæ‹¥å¡æ§åˆ¶. ä½†æ˜¯ TCP å·²ç»æœ‰è‡ªå·±çš„æ‹¥å¡æ§åˆ¶æ–¹æ³•äº†, ç”¨ä¸ç€å®ƒ, æ‰€ä»¥å¾ˆå°‘è¢«ä½¿ç”¨.</p>
<p>In Chapter 1 we introduced the Traceroute program, which allows us to trace a<br>route from a host to any other host in the world. Interestingly, Traceroute is imple-<br>mented with ICMP messages. To determine the names and addresses of the routers<br>between source and destination, Traceroute in the source sends a series of ordinary IP<br>datagrams to the destination. Each of these datagrams carries a UDP segment with an<br>unlikely UDP port number. The first of these datagrams has a TTL of 1, the second of 2,<br>the third of 3, and so on. The source also starts timers for each of the datagrams. When<br>the nth datagram arrives at the nth router, the nth router observes that the TTL of the<br>datagram has just expired. According to the rules of the IP protocol, the router discards<br>the datagram and sends an ICMP warning message to the source (type 11 code 0). This<br>warning message includes the name of the router and its IP address. When this ICMP<br>message arrives back at the source, the source obtains the round-trip time from the<br>timer and the name and IP address of the nth router from the ICMP message.</p>
<p>ç¬¬ä¸€ç« ä¸­æˆ‘ä»¬æå‡ºäº† Traceroute ç¨‹åº. Traceroute ä¹Ÿæ˜¯åŸºäº ICMP å®ç°çš„. Traceroute å‘é€ä¸€ç³»åˆ—åŸå§‹ IP æ•°æ®æŠ¥åˆ°ç›®çš„åœ°. æ¯ä¸ªæ•°æ®æŠ¥æºå¸¦ä¸€ä¸ªä¸å¯èƒ½çš„ UDP ç«¯å£çš„ UDP æ®µ (???). ç¬¬ä¸€ä¸ªæ•°æ®æŠ¥çš„ TTL è®¾ç½®ä¸º 1, ç¬¬äºŒä¸ªä¸º 2, ä¾æ¬¡å¾ªç¯. æºä¸»æœºåŒæ—¶å¼€å¯å®šæ—¶å™¨, å½“æ•°æ®æŠ¥åˆ°è¾¾ç¬¬ n ä¸ªè·¯ç”±æ—¶, TTL è¿‡æœŸ, è·¯ç”±ä¸¢å¼ƒè¯¥æ•°æ®æŠ¥, è¿”å›ä¸€ä¸ª ICMP è­¦å‘Šä¿¡æ¯ (ç±»å‹ 11, ä»£ç  0). è¿™ä¸ªè­¦å‘Šä¿¡æ¯åŒ…å«è·¯ç”±ååŠå…¶ IP åœ°å€. Traceroute ç”±æ­¤å®ç°.</p>
<p>How does a Traceroute source know when to stop sending UDP segments?<br>Recall that the source increments the TTL field for each datagram it sends. Thus, one<br>of the datagrams will eventually make it all the way to the destination host. Because<br>this datagram contains a UDP segment with an unlikely port number, the destination<br>host sends a port unreachable ICMP message (type 3 code 3) back to the source.</p>
<p>Traceroute ä½•æ—¶åœæ­¢å‘é€ UDP æ®µå‘¢? å› ä¸º TTL ä¸æ–­å¢åŠ , æœ€ç»ˆä¼šåˆ°è¾¾ç›®çš„åœ°, ä½†æ˜¯å› ä¸ºå‘é€çš„ UDP æ•°æ®æŠ¥çš„ç›®çš„ç«¯å£æ˜¯ä¸€ä¸ªä¸å¯èƒ½çš„ç«¯å£, æ‰€ä»¥ç›®çš„ä¸»æœºè¿”å›ä¸€ä¸ª ICMP ç«¯å£ä¸å¯è¾¾æ¶ˆæ¯ (ç±»å‹ 3, ä»£ç  3).</p>
<p>When the source host receives this particular ICMP message, it knows it does not<br>need to send additional probe packets. (The standard Traceroute program actually<br>sends sets of three packets with the same TTL; thus the Traceroute output provides<br>three results for each TTL.)</p>
<p>å½“æºä¸»æœºæ”¶åˆ°è¿™ä¸ªç‰¹æ®Šçš„ ICMP æ¶ˆæ¯å, å°±çŸ¥æ™“å·²åˆ°è¾¾ç›®çš„åœ°.</p>
<p>(æˆ‘ google äº†ä¸€ä¸‹, å½“ä¸­é€”è·¯ç”±å˜åŒ–ä¼šå‘ç”Ÿä»€ä¹ˆ, å¾—åˆ°çš„ç­”æ¡ˆæ˜¯: ä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿ, Traceroute å¹¶ä¸ä¿è¯è¿™ä¸ªâ€¦ )</p>
<p>In this manner, the source host learns the number and the identities of routers<br>that lie between it and the destination host and the round-trip time between the two<br>hosts. Note that the Traceroute client program must be able to instruct the operating<br>system to generate UDP datagrams with specific TTL values and must also be able to<br>be notified by its operating system when ICMP messages arrive. Now that you under-<br>stand how Traceroute works, you may want to go back and play with it some more.</p>
<p>A new version of ICMP has been defined for IPv6 in RFC 4443. In addition to<br>reorganizing the existing ICMP type and code definitions, ICMPv6 also added new<br>types and codes required by the new IPv6 functionality. These include the â€œPacket<br>Too Bigâ€ type and an â€œunrecognized IPv6 optionsâ€ error code.</p>
<p>ä¸º IPv6 å®šä¹‰äº†æ–°çš„ ICMP è§„èŒƒ. åŒ…æ‹¬ â€œåŒ…å¤ªå¤§äº†â€, â€œæœªè¯†åˆ« IPv6â€.</p>
]]></content>
  </entry>
  <entry>
    <title>read/routingAlgorithms</title>
    <url>/2020/01/16/read/routingAlgorithms/</url>
    <content><![CDATA[<h2 id="routing-algorithms"><a href="#routing-algorithms" class="headerlink" title="routing algorithms"></a>routing algorithms</h2><p>â€‹    â€¢ A centralized routing algorithm computes the least-cost path between a source<br>and destination using complete, global knowledge about the network. That is, the<br>algorithm takes the connectivity between all nodes and all link costs as inputs.<br>This then requires that the algorithm somehow obtain this information before<br>actually performing the calculation. The calculation itself can be run at one site<br>(e.g., a logically centralized controller as in Figure 5.2) or could be replicated in<br>the routing component of each and every router (e.g., as in Figure 5.1). The key<br>distinguishing feature here, however, is that the algorithm has complete informa-<br>tion about connectivity and link costs. Algorithms with global state information<br>are often referred to as link-state (LS) algorithms, since the algorithm must<br>be aware of the cost of each link in the network. Weâ€™ll study LS algorithms in<br>Section 5.2.1.</p>
<p>â€‹    é›†ä¸­å¼çš„è·¯ç”±ç®—æ³•è®¡ç®—ä»èµ·ç‚¹åˆ°ç»ˆç‚¹çš„æœ€å°‘æˆæœ¬æ—¶, çŸ¥æ™“æ•´ä¸ªç½‘ç»œçš„æˆæœ¬æƒ…å†µ. æ„æ€æ˜¯, è¿™ä¸ªç®—æ³•éœ€è¦æ‰€æœ‰ç›¸è¿èŠ‚ç‚¹çš„æˆæœ¬ä½œä¸ºè¾“å…¥. è¿™éœ€è¦åœ¨å®é™…æ‰§è¡Œè®¡ç®—å‰, åœ¨æŸå¤„è·å–è¿™äº›ä¿¡æ¯. è¿™ä¸ªè®¡ç®—æœ¬èº«å¯ä»¥åœ¨æŸä¸ªç«™ç‚¹, ä¹Ÿå¯ä»¥åœ¨æ¯ä¸ªè·¯ç”±ä¸­. åŸºäºå…¨å±€çŠ¶æ€ä¿¡æ¯çš„ç®—æ³•ç»å¸¸è¢«æˆä¸º link-state(LS) ç®—æ³•. å› ä¸ºç®—æ³•éœ€è¦æ³¨æ„æ•´ä¸ªç½‘ç»œ, æ¯ä¸ªèŠ‚ç‚¹çš„æˆæœ¬æƒ…å†µ. </p>
<p>â€‹    â€¢ In a decentralized routing algorithm, the calculation of the least-cost path is<br>carried out in an iterative, distributed manner by the routers. No node has com-<br>plete information about the costs of all network links. Instead, each node begins<br>with only the knowledge of the costs of its own directly attached links. Then,<br>through an iterative process of calculation and exchange of information with its<br>neighboring nodes, a node gradually calculates the least-cost path to a destination<br>or set of destinations. The decentralized routing algorithm weâ€™ll study below in<br>Section 5.2.2 is called a distance-vector (DV) algorithm, because each node main-<br>tains a vector of estimates of the costs (distances) to all other nodes in the net-<br>work. Such decentralized algorithms, with interactive message exchange between<br>neighboring routers is perhaps more naturally suited to control planes where the<br>routers interact directly with each other, as in Figure 5.1.</p>
<p>â€‹    åˆ†æ•£å¼çš„è·¯ç”±ç®—æ³•, å…¶è®¡ç®—æœ€å°æˆæœ¬è·¯å¾„çš„è®¡ç®—é€šè¿‡è·¯ç”±ä»¥è¿­ä»£, åˆ†å¸ƒçš„æ–¹å¼è®¡ç®—. æ²¡æœ‰èŠ‚ç‚¹çŸ¥æ™“æ•´ä¸ªç½‘ç»œèŠ‚ç‚¹æˆæœ¬ä¿¡æ¯. æ¯ä¸ªèŠ‚ç‚¹åœ¨ä»…çŸ¥æ™“è‡ªèº«ç›´è¿çš„èŠ‚ç‚¹ä¿¡æ¯çš„çŠ¶æ€ä¸‹å¼€å§‹, ç„¶åé€šè¿‡åˆ—ç‚¹çš„æ–¹å¼è®¡ç®—, å¹¶ä¸é‚»è¿‘èŠ‚ç‚¹äº¤æ¢ç»†ä¿¡æ¯, é€æ­¥è®¡ç®—ä¸€ä¸ª/å¤šä¸ªèŠ‚ç‚¹çš„æœ€å°æˆæœ¬è·¯å¾„. åˆ†æ•£å¼è·¯ç”±ç®—æ³•è¿›ç¨‹è¢«æˆä¸º distance-vector(DV) ç®—æ³•, å› ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç®¡ç†ä¸€ä¸ªä¿å­˜è¿æ¥èŠ‚ç‚¹æˆæœ¬çš„å‘é‡. è¿™æ ·çš„åˆ†æ•£ç®—æ³•, éœ€è¦åœ¨é‚»è¿‘èŠ‚ç‚¹äº¤æ¢ä¿¡æ¯, æˆ–è®¸æ›´åŠ é€‚åˆå’Œå…¶ä»–èŠ‚ç‚¹äº¤äº’çš„è·¯ç”±.</p>
<p>â€‹    A second broad way to classify routing algorithms is according to whether they<br>are static or dynamic. In static routing algorithms, routes change very slowly over<br>time, often as a result of human intervention (for example, a human manually editing<br>a link costs). Dynamic routing algorithms change the routing paths as the network<br>traffic loads or topology change. A dynamic algorithm can be run either periodically<br>or in direct response to topology or link cost changes. While dynamic algorithms<br>are more responsive to network changes, they are also more susceptible to problems<br>such as routing loops and route oscillation.</p>
<p>â€‹    ç¬¬äºŒä¸ªåŒºåˆ†è·¯ç”±ç®—æ³•çš„æ–¹å¼æ˜¯æ ¹æ®å…¶æ˜¯é™æ€/åŠ¨æ€çš„. åœ¨é™æ€è·¯ç”±ç®—æ³•ä¸­, è·¯ç”±å˜åŒ–ååˆ†ç¼“æ…¢, é€šå¸¸æ˜¯ç”±äºäººä¸ºå¹²æ¶‰. åŠ¨æ€è·¯ç”±ç®—æ³•éšç€ç½‘ç»œæµé‡è´Ÿè½½/æ‹“æ‰‘å˜åŒ–æ—¶æ›´æ”¹è·¯ç”±è·¯å¾„. åŠ¨æ€è·¯ç”±ç®—æ³•å¯ä»¥æ˜¯å‘¨æœŸæ€§çš„, ä¹Ÿå¯ä»¥æ˜¯ç›´æ¥ç”±æ‹“æ‰‘å“åº”/é“¾æ¥æˆæœ¬å˜åŒ–æ”¹å˜. å½“åŠ¨æ€è·¯ç”±è¶Šç§¯æå“åº”ç½‘ç»œå˜åŒ–, ä¹Ÿå°±è¶Šå®¹å™¨å‡ºç°é—®é¢˜, æ¯”å¦‚è·¯ç”±å¾ªç¯/è·¯ç”±æŒ¯è¡.</p>
<p>â€‹    A third way to classify routing algorithms is according to whether they are load-<br>sensitive or load-insensitive. In a load-sensitive algorithm, link costs vary dynami-<br>cally to reflect the current level of congestion in the underlying link. If a high cost<br>is associated with a link that is currently congested, a routing algorithm will tend<br>to choose routes around such a congested link. While early ARPAnet routing algo-<br>rithms were load-sensitive [McQuillan 1980], a number of difficulties were encoun-<br>tered [Huitema 1998]. Todayâ€™s Internet routing algorithms (such as RIP, OSPF, and<br>BGP) are load-insensitive, as a linkâ€™s cost does not explicitly reflect its current (or<br>recent past) level of congestion.</p>
<p>â€‹    ç¬¬ä¸‰ç§åŒºåˆ†è·¯ç”±ç®—æ³•çš„æ–¹å¼æ˜¯æ ¹æ®å…¶æ˜¯è´Ÿè½½æ•æ„Ÿçš„/è´Ÿè½½ä¸æ•æ„Ÿçš„. åœ¨è´Ÿè½½æ•æ„Ÿçš„ç®—æ³•ä¸­, è¿æ¥æˆæœ¬å˜åŒ–ååº”äº†å½“å‰åº•å±‚çš„å µå¡çŠ¶æ€. å¦‚æœé“¾æ¥æœ‰é«˜è´Ÿè½½, é‚£ä¹ˆå½“å‰é“¾æ¥å µå¡. è·¯ç”±ç®—æ³•å°†ä¼šé‡æ–°é€‰æ‹©è·¯ç”±ä»¥ç„¶åè¿™ä¸ªå µå¡èŠ‚ç‚¹. æ—©å…ˆ ARPAnetçš„è·¯ç”±ç®—æ³•å°±æ˜¯è´Ÿè½½æ•æ„Ÿçš„, ä»Šå¤© Internet è·¯ç”±ç®—æ³•æ˜¯è´Ÿè½½ä¸æ•æ„Ÿçš„, å½“å‰é“¾æ¥çš„è´Ÿè½½ä¸ååº”åº•å±‚çš„å µå¡æƒ…å†µ.</p>
<h3 id="5-2-1-The-Link-State-LS-Routing-Algorithm"><a href="#5-2-1-The-Link-State-LS-Routing-Algorithm" class="headerlink" title="5.2.1 The Link-State (LS) Routing Algorithm"></a>5.2.1 The Link-State (LS) Routing Algorithm</h3><p>Recall that in a link-state algorithm, the network topology and all link costs are<br>known, that is, available as input to the LS algorithm. In practice this is accom-<br>plished by having each node broadcast link-state packets to all other nodes in<br>the network, with each link-state packet containing the identities and costs of<br>its attached links. In practice (for example, with the Internetâ€™s OSPF routing<br>protocol, discussed in Section 5.3) this is often accomplished by a link-state<br>broadcast algorithm [Perlman 1999]. The result of the nodesâ€™ broadcast is that<br>all nodes have an identical and complete view of the network. Each node can<br>then run the LS algorithm and compute the same set of least-cost paths as every<br>other node.</p>
<p>å›æƒ³ä¸€ä¸‹, åœ¨ LS ç®—æ³•çŸ¥æ™“ç½‘ç»œçš„æ‹“æ‰‘å’Œé“¾æ¥æˆæœ¬. å®é™…ä¸Šæ˜¯ç”±æ¯ä¸ªèŠ‚ç‚¹å¹¿æ’­è‡ªèº«çš„ link-state åŒ…ç»™ç½‘ç»œä¸Šå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹æ¥å®ç°çš„, æ¯ä¸ª link-state åŒ…åŒ…å«äº†èº«ä»½éªŒè¯å’Œå…¶å·²é™„åŠ çš„é“¾æ¥çš„è´Ÿè½½. ç»å¸¸ç”± link-state å¹¿æ’­ç®—æ³•å®ç°. èŠ‚ç‚¹å¹¿æ’­çš„ç»“æœæ˜¯: æ‰€æœ‰èŠ‚ç‚¹éƒ½æœ‰ç»Ÿä¸€, å®Œæˆçš„å…³äºæ•´ä¸ªç½‘ç»œçš„è§†å›¾. æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥è¿è¡Œ LS ç®—æ³•, è®¡ç®—å¾—åˆ°å’Œå…¶ä»–èŠ‚ç‚¹ç›¸åŒçš„æœ€å°è´Ÿè½½è·¯å¾„.</p>
<p>The link-state routing algorithm we present below is known as Dijkstraâ€™s<br>algorithm, named after its inventor. A closely related algorithm is Primâ€™s algo-<br>rithm; see [Cormen 2001] for a general discussion of graph algorithms. Dijkstraâ€™s<br>algorithm computes the least-cost path from one node (the source, which we will<br>refer to as u) to all other nodes in the network. Dijkstraâ€™s algorithm is iterative and<br>has the property that after the kth iteration of the algorithm, the least-cost paths<br>are known to k destination nodes, and among the least-cost paths to all destination<br>nodes, these k paths will have the k smallest costs. Let us define the following<br>notation:</p>
<p>ä¸‹é¢å°†è¦æå‡ºçš„è·¯ç”±ç®—æ³•åä¸º Dijkstra ç®—æ³•. è¿™ä¸ªç®—æ³•ä»ä¸€ä¸ªèŠ‚ç‚¹åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å¼€å§‹, è®¡ç®—æœ€å°è´Ÿè½½è·¯å¾„. Dijkstra ç®—æ³•æ˜¯è¿­ä»£çš„, åœ¨ k æ¬¡è¿­ä»£åä¾æ—§æœ‰è¿™æ ·çš„æ€§è´¨. </p>
<p>â€¢ D(v): cost of the least-cost path from the source node to destination v as of this<br>iteration of the algorithm.</p>
<p>ä»èµ·ç‚¹åˆ°é‡ç‚¹çš„æœ€å°è´Ÿè½½è·¯å¾„è´Ÿè½½.</p>
<p>â€¢ p(v): previous node (neighbor of v) along the current least-cost path from the<br>source to v.</p>
<p>æœ€å°è´Ÿè½½è·¯å¾„çš„ä¸Šä¸€ä¸ªèŠ‚ç‚¹.</p>
<p>â€¢ Nâ€²: subset of nodes; v is in Nâ€² if the least-cost path from the source to v is defini-<br>tively known.</p>
<p>èŠ‚ç‚¹å­é›†</p>
<p>The centralized routing algorithm consists of an initialization step followed by<br>a loop. The number of times the loop is executed is equal to the number of nodes in<br>the network. Upon termination, the algorithm will have calculated the shortest paths<br>from the source node u to every other node in the network.</p>
<p>é›†ä¸­è·¯ç”±ç®—æ³•ç”±ä¸€ä¸ªåˆå§‹åŒ–æ­¥éª¤å’Œä¸€ä¸ªå¾ªç¯ç»„æˆ. å¾ªç¯æ‰§è¡Œæ¬¡æ•°ä¸ç½‘ç»œä¸­çš„èŠ‚ç‚¹æ•°ä¸€è‡´. è¿ç®—ç»“æŸå, ç®—æ³•å°†ä¼šå¾—å‡ºä»æºèŠ‚ç‚¹ u åˆ°ç½‘ç»œä¸­æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å°è´Ÿè½½è·¯å¾„. </p>
<pre><code>Link-State (LS) Algorithm for Source Node u
1 Initialization:
2 Nâ€™ = {u}
3 for all nodes v
4 if v is a neighbor of u
5 then D(v) = c(u,v)
6 else D(v) = âˆ
7
8 Loop
9 find w not in Nâ€™ such that D(w) is a minimum
10 add w to Nâ€™
11 update D(v) for each neighbor v of w and not in Nâ€™:
12 D(v) = min(D(v), D(w)+ c(w,v) )
13 /* new cost to v is either old cost to v or known
14 least path cost to w plus cost from w to v */
15 until Nâ€™= N</code></pre><p><img src="https://imgur.com/aYU2AT9.png" alt=""></p>
<p><img src="https://imgur.com/w1FDgP2.png" alt=""></p>
<p>As an example, letâ€™s consider the network in Figure 5.3 and compute the least-<br>cost paths from u to all possible destinations. A tabular summary of the algorithmâ€™s<br>computation is shown in Table 5.1, where each line in the table gives the values of<br>the algorithmâ€™s variables at the end of the iteration. Letâ€™s consider the few first steps<br>in detail.</p>
<p>å‚è€ƒå›¾ 5.3, æ€è€ƒä»¥ä¸‹ç»†èŠ‚.</p>
<p>â€¢ In the initialization step, the currently known least-cost paths from u to its directly<br>attached neighbors, v, x, and w, are initialized to 2, 1, and 5, respectively. Note in<br>particular that the cost to w is set to 5 (even though we will soon see that a lesser-cost<br>path does indeed exist) since this is the cost of the direct (one hop) link from u to<br>w. The costs to y and z are set to infinity because they are not directly connected<br>to u.</p>
<p>åœ¨åˆå§‹åŒ–æ­¥éª¤, å½“å‰ä» u åˆ°å…¶ç›´è¿èŠ‚ç‚¹ v, x, w åˆå§‹åŒ–ä¸º 2, 1, 5. å› ä¸º y å’Œ z æ²¡æœ‰ç›´è¿èŠ‚ç‚¹, æ‰€ä»¥åˆå§‹åŒ–ä¸ºæ— ç©·å¤§.</p>
<p>â€¢ In the first iteration, we look among those nodes not yet added to the set Nâ€² and<br>find that node with the least cost as of the end of the previous iteration. That node<br>is x, with a cost of 1, and thus x is added to the set Nâ€². Line 12 of the LS algorithm<br>is then performed to update D(v) for all nodes v, yielding the results shown in the<br>second line (Step 1) in Table 5.1. The cost of the path to v is unchanged. The cost<br>of the path to w (which was 5 at the end of the initialization) through node x is<br>found to have a cost of 4. Hence this lower-cost path is selected and wâ€™s predeces-<br>sor along the shortest path from u is set to x. Similarly, the cost to y (through x) is<br>computed to be 2, and the table is updated accordingly.</p>
<p>ç¬¬ä¸€æ¬¡è¿­ä»£, æŸ¥æ‰¾è¿˜æœªæ·»åŠ è¿› Nâ€™ é›†åˆçš„èŠ‚ç‚¹, è·å–ä¸Šä¸€æ¬¡è¿­ä»£å¾—åˆ°çš„æœ€å°è´Ÿè½½èŠ‚ç‚¹. åœ¨æ­¤ä¾‹ä¸­ä¸º x, è´Ÿè½½ 1. éšå x åŠ å…¥ Nâ€™ é›†åˆ. LS ç®—æ³•ç¬¬ 12 è¡Œæ‰§è¡Œæ›´æ–° D(v) è¿ç®—. å¾—åˆ°çš„è¿”å›åœ¨è¡¨ 5.1 çš„ç¬¬äºŒè¡Œ. åˆ°èŠ‚ç‚¹ v çš„è´Ÿè½½å¹¶æœªæ”¹å˜, w è·¯å¾„çš„è´Ÿè½½å˜ä¸ºäº† 4. </p>
<p>â€¢ In the second iteration, nodes v and y are found to have the least-cost paths (2),<br>and we break the tie arbitrarily and add y to the set Nâ€² so that Nâ€² now contains u,<br>x, and y. The cost to the remaining nodes not yet in Nâ€², that is, nodes v, w, and z,<br>are updated via line 12 of the LS algorithm, yielding the results shown in the third<br>row in Table 5.1.</p>
<p>åœ¨ç¬¬äºŒæ¬¡è¿­ä»£ä¸­, v å’Œ y èŠ‚ç‚¹æ‰¾åˆ°äº†æœ€å°è´Ÿè½½è·¯å¾„, å¹¶ä¸”å¢åŠ  y èŠ‚ç‚¹åˆ° Nâ€™ ä¸­. </p>
<p>â€¢ And so on . . .</p>
<p>ä»¥æ­¤ç±»æ¨â€¦</p>
<p>(LS ç®—æ³•éœ€è¦çŸ¥æ™“æ‰€æœ‰èŠ‚ç‚¹ä¿¡æ¯, å…¶ç®—æ³•å¤æ‚åº¦ä¸º O(n * n), å› ä¸ºæ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰å¯èƒ½ä¼šæ”¹å˜å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹, å…¶æœ¬è´¨æ˜¯å°†å·²æœ‰çš„èŠ‚ç‚¹è·ç¦»(æ ¹æ®æ¯”è¾ƒè·å¾—/æœ€åˆçš„æ— ç©·å¤§)å’Œæ–°å¾—åˆ°çš„æ‹¼æ¥è·ç¦»åšæ¯”è¾ƒ, ç»è¿‡ (n * n) æ¬¡å¾ªç¯, å¾—åˆ°çš„è·ç¦»å°±æ˜¯æœ€çŸ­è·ç¦»)</p>
<h3 id="5-2-2-The-Distance-Vector-DV-Routing-Algorithm"><a href="#5-2-2-The-Distance-Vector-DV-Routing-Algorithm" class="headerlink" title="5.2.2 The Distance-Vector (DV) Routing Algorithm"></a>5.2.2 The Distance-Vector (DV) Routing Algorithm</h3><p>Whereas the LS algorithm is an algorithm using global information, the distance-<br>vector (DV) algorithm is iterative, asynchronous, and distributed. It is distributed in<br>that each node receives some information from one or more of its directly attached<br>neighbors, performs a calculation, and then distributes the results of its calculation<br>back to its neighbors. It is iterative in that this process continues on until no more<br>information is exchanged between neighbors. (Interestingly, the algorithm is also<br>self-terminatingâ€”there is no signal that the computation should stop; it just stops.)<br>The algorithm is asynchronous in that it does not require all of the nodes to operate in<br>lockstep with each other. Weâ€™ll see that an asynchronous, iterative, self-terminating,<br>distributed algorithm is much more interesting and fun than a centralized algorithm!<br>Before we present the DV algorithm, it will prove beneficial to discuss an impor-<br>tant relationship that exists among the costs of the least-cost paths. Let d x (y) be the<br>cost of the least-cost path from node x to node y. Then the least costs are related by<br>the celebrated Bellman-Ford equation, namely,</p>
<p>ä¸åŒäº LS ç®—æ³•ä½¿ç”¨å…¨å±€ä¿¡æ¯, distance-vector(DV) ç®—æ³•æ˜¯è¿­ä»£, å¼‚æ­¥, åˆ†å¸ƒçš„. </p>
<p>å…¶åˆ†å¸ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Š, æ¥æ”¶æ¥è‡ªç›´è¿èŠ‚ç‚¹çš„ä¿¡æ¯, è®¡ç®—, ç„¶åè¿”å›å…¶è®¡ç®—ç»“æœ. ç›´è‡³æ²¡æœ‰èŠ‚ç‚¹éœ€è¦äº¤æ¢ä¿¡æ¯. </p>
<p>è¿™ä¸ªç®—æ³•è¿˜æ˜¯å¼‚æ­¥ç®—æ³•, ä¸éœ€è¦æ‰€æœ‰èŠ‚ç‚¹å½¼æ­¤é—´åŒæ­¥è¿ç®—. æˆ‘ä»¬å°†ä¼šè§åˆ°, ä¸€ä¸ªå¼‚æ­¥, è¿­ä»£, è‡ªé”€æ¯, çš„åˆ†å¸ƒç®—æ³•æ¯”é›†ä¸­ç®—æ³•æœ‰è¶£çš„å¤š. </p>
<pre><code>Distance-Vector (DV) Algorithm
At each node, x:
1 Initialization:
2 for all destinations y in N:
3 D x (y)= c(x,y)/* if y is not a neighbor then c(x,y)= âˆ */
4 for each neighbor w
5 D w (y) = ? for all destinations y in N
6 for each neighbor w
7 send distance vector D x = [D x (y): y in N] to w
8
9 loop
10 wait (until I see a link cost change to some neighbor w or
11 until I receive a distance vector from some neighbor w)
12
13 for each y in N:
14 D x (y) = min v {c(x,v) + D v (y)}
15
16 if Dx(y) changed for any destination y
17 send distance vector D x = [D x (y): y in N] to all neighbors
18
19 forever</code></pre><p>In the DV algorithm, a node x updates its distance-vector estimate when it either<br>sees a cost change in one of its directly attached links or receives a distance-vector<br>update from some neighbor. But to update its own forwarding table for a given des-<br>tination y, what node x really needs to know is not the shortest-path distance to y but<br>instead the neighboring node v<em>(y) that is the next-hop router along the shortest path<br>to y. As you might expect, the next-hop router v</em>(y) is the neighbor v that achieves<br>the minimum in Line 14 of the DV algorithm. (If there are multiple neighbors v that<br>achieve the minimum, then v<em>(y) can be any of the minimizing neighbors.) Thus,<br>in Lines 13â€“14, for each destination y, node x also determines v</em>(y) and updates its<br>forwarding table for destination y.</p>
<p>åœ¨ DV ç®—æ³•ä¸­, å½“é‚»è¿‘èŠ‚ç‚¹çš„è´Ÿè½½å‘ç”Ÿå˜åŒ–, æˆ–æ¥æ”¶åˆ°ä¸€ä¸ªæ¥è‡ªé‚»è¿‘èŠ‚ç‚¹çš„ distance-vector æ›´æ–°æ—¶, ä¼šæ›´æ–°è‡ªèº«çš„ distance-vector ä¼°è®¡. ä½†æ˜¯ä¸ºäº†æ›´æ–°è‡ªèº«æŸä¸ªèŠ‚ç‚¹ y çš„è½¬å‘è¡¨, x å®é™…éœ€è¦çŸ¥é“çš„å¹¶ä¸æ˜¯åˆ° y çš„æœ€çŸ­è·¯å¾„, è€Œæ˜¯é‚»è¿‘èŠ‚ç‚¹åˆ° y çš„æœ€çŸ­è·¯å¾„. å¦‚ä½ æ‰€æ–™, é‚»è¿‘èŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„æ¥è‡ª DV ç®—æ³•ç¬¬ 14 è¡Œ. </p>
<p>Recall that the LS algorithm is a centralized algorithm in the sense that it<br>requires each node to first obtain a complete map of the network before running the<br>Dijkstra algorithm. The DV algorithm is decentralized and does not use such global<br>information. Indeed, the only information a node will have is the costs of the links<br>to its directly attached neighbors and information it receives from these neighbors.<br>Each node waits for an update from any neighbor (Lines 10â€“11), calculates its new<br>distance vector when receiving an update (Line 14), and distributes its new distance<br>vector to its neighbors (Lines 16â€“17). DV-like algorithms are used in many routing<br>protocols in practice, including the Internetâ€™s RIP and BGP, ISO IDRP, Novell IPX,<br>and the original ARPAnet.</p>
<p>LS ç®—æ³•æ˜¯é›†ä¸­ç®—æ³•, å…¶éœ€è¦å…ˆè·å–æ‰€æœ‰ç½‘ç»œèŠ‚ç‚¹ä¿¡æ¯. è€Œ DV ç®—æ³•æ˜¯åˆ†å¸ƒçš„, ä¸éœ€è¦. å®é™…ä¸Šéœ€è¦çš„ä»…ä»…æ˜¯é‚»è¿‘èŠ‚ç‚¹çš„ä¿¡æ¯. ç±» DV ç®—æ³•åœ¨ç°å®ä¸­åº”ç”¨å¹¿æ³›, åŒ…æ‹¬ internet çš„ RIP, BGP, IOS IDRP, Novell IPX å·²ç»æœ€åˆçš„ ARPAnet. (ä»¥ä¸Šæˆ‘éƒ½ä¸çŸ¥é“ :( â€¦ )</p>
<p><img src="https://imgur.com/E4wSJ2o.png" alt=""></p>
<p>Figure 5.6 illustrates the operation of the DV algorithm for the simple three-<br>node network shown at the top of the figure. The operation of the algorithm is illus-<br>trated in a synchronous manner, where all nodes simultaneously receive distance<br>vectors from their neighbors, compute their new distance vectors, and inform their<br>neighbors if their distance vectors have changed. After studying this example, you<br>should convince yourself that the algorithm operates correctly in an asynchronous<br>manner as well, with node computations and update generation/reception occurring<br>at any time.</p>
<p>å›¾ 5.6 é˜é‡Šäº† DV ç®—æ³•åœ¨ç®€å•çš„ä¸‰èŠ‚ç‚¹ç½‘ç»œä¸Šçš„çš„æ“ä½œ. ç®—æ³•ä»¥å¼‚æ­¥å½¢å¼ä½“ç°. æ‰€æœ‰èŠ‚ç‚¹åŒæ—¶æ¥æ”¶æ¥è‡ªé‚»è¿‘èŠ‚ç‚¹çš„ distance-vector. è®¡ç®—å…¶æ–° distance vectors, ç„¶ååŒæ—¶å…¶é‚»è¿‘èŠ‚ç‚¹(å¦‚æœæœ‰æ”¹å˜çš„è¯). </p>
<p>The leftmost column of the figure displays three initial routing tables for each<br>of the three nodes. For example, the table in the upper-left corner is node xâ€™s ini-<br>tial routing table. Within a specific routing table, each row is a distance vectorâ€”<br>specifically, each nodeâ€™s routing table includes its own distance vector and that<br>of each of its neighbors. Thus, the first row in node xâ€™s initial routing table is<br>D x = [D x (x), D x (y), D x (z)] = [0, 2, 7]. The second and third rows in this table are<br>the most recently received distance vectors from nodes y and z, respectively. Because<br>at initialization node x has not received anything from node y or z, the entries in<br>the second and third rows are initialized to infinity.</p>
<p>After initialization, each node sends its distance vector to each of its two neigh-<br>bors. This is illustrated in Figure 5.6 by the arrows from the first column of tables<br>to the second column of tables. For example, node x sends its distance vector D x =<br>[0, 2, 7] to both nodes y and z. After receiving the updates, each node recomputes its<br>own distance vector. For example, node x computes<br>The second column therefore displays, for each node, the nodeâ€™s new distance vector<br>along with distance vectors just received from its neighbors. Note, for example, that</p>
<p>åˆå§‹åŒ–å, æ¯ä¸ªèŠ‚ç‚¹å°†è‡ªèº«çš„ distance-vector å‘ç”Ÿç»™å…¶é‚»è¿‘èŠ‚ç‚¹. é€šè¿‡å›¾ 5.6 çš„ç®­å¤´è¡¨ç¤º. </p>
<p>(åº”è¯¥åªä¼šå‘é€å˜åŒ–çš„èŠ‚ç‚¹å§? ä¸ç„¶å¤„ç†èµ·æ¥åº”è¯¥ä¸å¤ªæ–¹ä¾¿)</p>
<p>node xâ€™s estimate for the least cost to node z, D x (z), has changed from 7 to 3. Also<br>note that for node x, neighboring node y achieves the minimum in line 14 of the DV<br>algorithm; thus at this stage of the algorithm, we have at node x that v<em>(y) = y and<br>v</em>(z) = y.<br>After the nodes recompute their distance vectors, they again send their updated<br>distance vectors to their neighbors (if there has been a change). This is illustrated in<br>Figure 5.6 by the arrows from the second column of tables to the third column of<br>tables. Note that only nodes x and z send updates: node yâ€™s distance vector didnâ€™t<br>change so node y doesnâ€™t send an update. After receiving the updates, the nodes then<br>recompute their distance vectors and update their routing tables, which are shown in<br>the third column.</p>
<p>åœ¨èŠ‚ç‚¹é‡è®¡ç®— distance vectors å, å†é‡æ–°å‘é€ä»–ä»¬å·²æ›´æ–°çš„ distance vectors ç»™å…¶é‚»è¿‘èŠ‚ç‚¹</p>
<p>The process of receiving updated distance vectors from neighbors, recomputing<br>routing table entries, and informing neighbors of changed costs of the least-cost path<br>to a destination continues until no update messages are sent. At this point, since no<br>update messages are sent, no further routing table calculations will occur and the<br>algorithm will enter a quiescent state; that is, all nodes will be performing the wait in<br>Lines 10â€“11 of the DV algorithm. The algorithm remains in the quiescent state until<br>a link cost changes, as discussed next.</p>
<p>(DV ç®—æ³•æ˜¯åˆ†å¸ƒçš„, å®ƒåªéœ€è¦çŸ¥é“å…¶é‚»è¿‘èŠ‚ç‚¹ä¿¡æ¯, ä¹Ÿåªéœ€è¦ä¸é‚»è¿‘èŠ‚ç‚¹äº¤äº’)</p>
<h2 id="A-Comparison-of-LS-and-DV-Routing-Algorithms"><a href="#A-Comparison-of-LS-and-DV-Routing-Algorithms" class="headerlink" title="A Comparison of LS and DV Routing Algorithms"></a>A Comparison of LS and DV Routing Algorithms</h2><p>The DV and LS algorithms take complementary approaches toward computing rout-<br>ing. In the DV algorithm, each node talks to only its directly connected neighbors,<br>but it provides its neighbors with least-cost estimates from itself to all the nodes<br>(that it knows about) in the network. The LS algorithm requires global information.<br>Consequently, when implemented in each and every router, e.g., as in Figure 4.2 and<br>5.1, each node would need to communicate with all other nodes (via broadcast), but<br>it tells them only the costs of its directly connected links. Letâ€™s conclude our study<br>of LS and DV algorithms with a quick comparison of some of their attributes. Recall<br>that N is the set of nodes (routers) and E is the set of edges (links).</p>
<p>DV å’Œ LS æ˜¯ä¸¤ä¸ªäº’è¡¥çš„ç®—æ³•. DV åªéœ€è¦å’Œå…¶é‚»è¿‘èŠ‚ç‚¹äº¤äº’. ä½†æ˜¯å…¶éœ€è¦äº¤äº’è‡ªèº«åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹çš„æœ€å°è´Ÿè½½ä¼°è®¡. LS ç®—æ³•éœ€è¦å…¨å±€ä¿¡æ¯, å› æ­¤, åœ¨è·¯ç”±ä¸Šå®ç°æ—¶, æ¯ä¸ªèŠ‚ç‚¹éœ€è¦å’Œå…¶ä»–æ‰€æœ‰èŠ‚ç‚¹äº¤äº’(é€šè¿‡å¹¿æ’­). ä½†æ˜¯åªä¼šå‘é€ç›´è¿èŠ‚ç‚¹çš„ä¿¡æ¯. è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªå¿«é€Ÿçš„å¯¹æ¯”æ¥æ€»ç»“ä¸€ä¸‹ LS å’Œ DV ç®—æ³•(N ä»£è¡¨èŠ‚ç‚¹ç»“åˆ, E ä»£è¡¨è¾¹é›†åˆ) </p>
<p>â€¢ Message complexity. We have seen that LS requires each node to know the cost<br>of each link in the network. This requires O(|N| |E|) messages to be sent. Also,<br>whenever a link cost changes, the new link cost must be sent to all nodes. The DV<br>algorithm requires message exchanges between directly connected neighbors at<br>each iteration. We have seen that the time needed for the algorithm to converge<br>can depend on many factors. When link costs change, the DV algorithm will<br>propagate the results of the changed link cost only if the new link cost results in a<br>changed least-cost path for one of the nodes attached to that link.</p>
<p>ä¿¡æ¯å¤æ‚åº¦: LS éœ€è¦æ¯ä¸ªèŠ‚ç‚¹éƒ½çŸ¥é“ç½‘ç»œä¸­çš„é“¾æ¥è´Ÿè½½. æ— è®ºä½•æ—¶é“¾æ¥è´Ÿè½½å˜åŒ–, éƒ½å¿…é¡»å‘é€ç»™å…¶ä½™èŠ‚ç‚¹. DV ç®—æ³•éœ€è¦é‚»è¿‘èŠ‚ç‚¹é—´çš„ä¿¡æ¯äº¤æ¢. è¿™ä¸ªç®—æ³•æ‰€éœ€æ—¶é—´åŸºäºå¾ˆå¤šå› ç´ . å½“é“¾æ¥è´Ÿè½½å‘ç”Ÿå˜åŒ–, ä¿¡æ¯ä»…åœ¨æœ€å°è´Ÿè½½è·¯å¾„å‘ç”Ÿå˜åŒ–æ—¶æ‰ä¼ æ’­ç»™é‚»è¿‘èŠ‚ç‚¹.</p>
<p>â€¢ Speed of convergence. We have seen that our implementation of LS is an O(|N| 2 )<br>algorithm requiring O(|N| |E|)) messages. The DV algorithm can converge slowly<br>and can have routing loops while the algorithm is converging. DV also suffers<br>from the count-to-infinity problem.</p>
<p>æ”¶æ•›é€Ÿåº¦(???): </p>
<p>â€¢ Robustness. What can happen if a router fails, misbehaves, or is sabotaged?<br>Under LS, a router could broadcast an incorrect cost for one of its attached links<br>(but no others). A node could also corrupt or drop any packets it received as part<br>of an LS broadcast. But an LS node is computing only its own forwarding tables;<br>other nodes are performing similar calculations for themselves. This means route<br>calculations are somewhat separated under LS, providing a degree of robustness.<br>Under DV, a node can advertise incorrect least-cost paths to any or all destina-<br>tions. (Indeed, in 1997, a malfunctioning router in a small ISP provided national<br>backbone routers with erroneous routing information. This caused other routers<br>to flood the malfunctioning router with traffic and caused large portions of the<br>Internet to become disconnected for up to several hours [Neumann 1997].) More<br>generally, we note that, at each iteration, a nodeâ€™s calculation in DV is passed on<br>to its neighbor and then indirectly to its neighborâ€™s neighbor on the next iteration.<br>In this sense, an incorrect node calculation can be diffused through the entire<br>network under DV.</p>
<p>ç¨³å®šæ€§: å½“è·¯ç”±å¤±è´¥, é”™è¯¯è¡Œä¸º, æˆ–è€…è¢«è“„æ„ç ´åæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆ? åœ¨ LS ç®—æ³•ä¸­, è·¯ç”±ä¼šå¹¿æ’­é”™è¯¯çš„è´Ÿè½½ç»™æ¯ä¸ªè¿æ¥çš„è·¯ç”±(ä¸æ˜¯å…¶ä»–æ‰€æœ‰). èŠ‚ç‚¹ä¹Ÿå¯èƒ½ä¸¢å¤±æ¥æ”¶åˆ°çš„å¹¿æ’­. ä½†æ˜¯ LS ç®—æ³•ä»…åœ¨åªæ˜¯è·¯ç”±ä¸Šè®¡ç®—(ä¹Ÿå°±åªå½±å“è‡ªèº«). è¿™æ„ä¸ºç€èŠ‚ç‚¹è®¡ç®—æ˜¯åˆ†ç¦»çš„. å¢å¼ºäº†ä¸€å®šçš„ç¨³å®šæ€§. è€Œåœ¨ DV ç®—æ³•ä¸­, èŠ‚ç‚¹å¯èƒ½ä¼šé€šçŸ¥é”™è¯¯çš„æœ€å°è´Ÿè½½ç»™é‚»è¿‘èŠ‚ç‚¹. å‘¨è€Œå¤å§‹, ä¸€ä¸ªèŠ‚ç‚¹çš„è®¡ç®—ä¼šå½±å“åˆ°å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹.</p>
<p>In the end, neither algorithm is an obvious winner over the other; indeed, both algo-<br>rithms are used in the Internet.</p>
<p>æ‰€ä»¥, ä¸¤ç§ç®—æ³•å„æœ‰å…¶ä¼˜. éƒ½åœ¨ Internet ä¸­æœ‰ä½¿ç”¨åˆ°.</p>
]]></content>
  </entry>
  <entry>
    <title>read/newFeaturesInC++14</title>
    <url>/2020/01/15/read/newFeaturesInC++14/</url>
    <content><![CDATA[<h2 id="new-features-in-c-14"><a href="#new-features-in-c-14" class="headerlink" title="new features in c++14"></a>new features in c++14</h2><p>From : <a href="https://en.wikipedia.org/wiki/C%2B%2B14" target="_blank" rel="noopener">wiki</a></p>
<h2 id="New-language-features-edit"><a href="#New-language-features-edit" class="headerlink" title="New language features[edit]"></a>New language features[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=1" target="_blank" rel="noopener">edit</a>]</h2><p>These are the features added to the core language of C++14.</p>
<h3 id="Function-return-type-deduction-edit"><a href="#Function-return-type-deduction-edit" class="headerlink" title="Function return type deduction[edit]"></a>Function return type deduction[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=2" target="_blank" rel="noopener">edit</a>]</h3><p>C++11 allowed <a href="https://en.wikipedia.org/wiki/Lambda_function_(computer_programming)" target="_blank" rel="noopener">lambda functions</a> to deduce the return type based on the type of the expression given to the return statement. C++14 provides this ability to all functions. It also extends these facilities to lambda functions, allowing return type deduction for functions that are not of the form <code>return expression;</code>.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong1-3" target="_blank" rel="noopener">[3]</a></p>
<p>c++å…è®¸ lambda è¡¨è¾¾å¼æ ¹æ®è¿”å›å€¼è¡¨è¾¾å¼æ¨æµ‹è¿”å›å€¼ç±»å‹, c++14å°†å…¶èŒƒå›´æå‡åˆ°äº†æ‰€æœ‰å‡½æ•°. </p>
<p>(åé¢è¿™å¥æˆ‘ä¸æ˜ç™½å®ƒæ˜¯ä»€ä¹ˆæ„æ€)</p>
<p>In order to induce return type deduction, the function must be declared with <code>auto</code> as the return type, but without the trailing return type specifier in C++11:</p>
<p>ä¸ºäº†å¼•è¿›è¿”å›å€¼æ¨æµ‹, éœ€è¦åœ¨å£°æ˜æ—¶åœ¨è¿”å›å€¼ç±»å‹ä¸Šå¸¦ä¸Š auto å…³é”®å­—. è€Œä¸éœ€è¦å°¾éšè¿”å›å€¼è¯´æ˜ç¬¦.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto DeduceReturnType();   &#x2F;&#x2F; Return type to be determined.</span><br></pre></td></tr></table></figure>

<p>If multiple return expressions are used in the functionâ€™s implementation, then they must all deduce the same type.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-deduce-4" target="_blank" rel="noopener">[4]</a></p>
<p>å¦‚æœå‡½æ•°å®ç°ä¸­å­˜åœ¨å¤šä¸ªè¿”å›å€¼è¡¨è¾¾å¼, å®ƒä»¬å¿…é¡»è¢«èƒ½è¢«æ¨æµ‹ä¸ºä¸€ç§ç±»å‹. </p>
<p>Functions that deduce their return types can be forward declared, but they cannot be used until they have been defined. Their definitions must be available to the translation unit that uses them.</p>
<p>è¿”å›å€¼ç±»å‹æ¨å¯¼å¯ä»¥å‰å‘å£°æ˜. ä½†æ˜¯ç›´åˆ°è¢«å®šä¹‰æ—¶æ‰èƒ½ä½¿ç”¨. å®šä¹‰å¿…é¡»èƒ½è¢«ç¿»è¯‘å•å…ƒä½¿ç”¨.</p>
<p><a href="https://en.wikipedia.org/wiki/Recursion" target="_blank" rel="noopener">Recursion</a> can be used with a function of this type, but the recursive call must happen after at least one return statement in the definition of the function:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-deduce-4" target="_blank" rel="noopener">[4]</a></p>
<p>é€’å½’å‡½æ•°ä¹Ÿå¯ä»¥ä½¿ç”¨è¿”å›å€¼æ¨å¯¼, ä½†æ˜¯å¿…é¡»åœ¨è‡³å°‘ä¸€ä¸ªè¿”å›è¯­å¥ä¹‹åä½¿ç”¨.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto Correct(int i)</span><br><span class="line">&#123;</span><br><span class="line">  if (i &#x3D;&#x3D; 1)</span><br><span class="line">    return i;             &#x2F;&#x2F; return type deduced as int</span><br><span class="line"></span><br><span class="line">  return Correct(i-1)+i;  &#x2F;&#x2F; ok to call it now</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auto Wrong(int i)</span><br><span class="line">&#123;</span><br><span class="line">  if (i !&#x3D; 1)</span><br><span class="line">    return Wrong(i-1)+i;  &#x2F;&#x2F; Too soon to call this. No prior return statement.</span><br><span class="line"></span><br><span class="line">  return i;               &#x2F;&#x2F; return type deduced as int</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Alternate-type-deduction-on-declaration-5"><a href="#Alternate-type-deduction-on-declaration-5" class="headerlink" title="Alternate type deduction on declaration[5]"></a>Alternate type deduction on declaration<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-5" target="_blank" rel="noopener">[5]</a></h3><p>In C++11, two methods of type deduction were added. <code>auto</code> was a way to create a variable of the appropriate type, based on a given expression. <code>decltype</code> was a way to compute the type of a given expression. However, <code>decltype</code> and <code>auto</code> deduce types in different ways. In particular, <code>auto</code> always deduces a non-reference type, as though by using <code>std::decay</code>, while <code>auto&amp;&amp;</code> always deduces a reference type. However, <code>decltype</code> can be prodded into deducing a reference or non-reference type, based on the value category of the expression and the nature of the expression it is deducing:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong1-3" target="_blank" rel="noopener">[3]</a></p>
<p>åœ¨ c++11, å¼•è¿›äº†ä¸¤ç§ç±»å‹æ¨å¯¼. <code>auto</code> å’Œ <code>decltype</code> <code>auto</code> æ€»æ˜¯æ¨å¯¼å‡ºéå¼•ç”¨ç±»å‹, <code>decltype</code> åˆ™æ¨å¯¼å‡ºå®Œæ•´çš„ç±»å‹.  </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int   i;</span><br><span class="line">int&amp;&amp; f();</span><br><span class="line">auto          x3a &#x3D; i;     &#x2F;&#x2F; decltype(x3a) is int</span><br><span class="line">decltype(i)   x3d &#x3D; i;     &#x2F;&#x2F; decltype(x3d) is int</span><br><span class="line">auto          x4a &#x3D; (i);   &#x2F;&#x2F; decltype(x4a) is int</span><br><span class="line">decltype((i)) x4d &#x3D; (i);   &#x2F;&#x2F; decltype(x4d) is int&amp;</span><br><span class="line">auto          x5a &#x3D; f();   &#x2F;&#x2F; decltype(x5a) is int</span><br><span class="line">decltype(f()) x5d &#x3D; f();   &#x2F;&#x2F; decltype(x5d) is int&amp;&amp;</span><br></pre></td></tr></table></figure>

<p>C++14 adds the <code>decltype(auto)</code> syntax. This allows <code>auto</code> declarations to use the <code>decltype</code> rules on the given expression.</p>
<p>c++ å¢åŠ äº† <code>decltype(auto)</code> è¯­æ³•, è¿™ä½¿ <code>auto</code> å£°æ˜å¯ä»¥åœ¨æŒ‡å®šè¡¨è¾¾å¼ä¸Šä½¿ç”¨ <code>decltype</code> è§„åˆ™.</p>
<p>The <code>decltype(auto)</code> syntax can also be used with <a href="https://en.wikipedia.org/wiki/C%2B%2B14#Function_return_type_deduction" target="_blank" rel="noopener">return type deduction</a>, by using <code>decltype(auto)</code> syntax instead of <code>auto</code> for the functionâ€™s return type deduction.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-deduce-4" target="_blank" rel="noopener">[4]</a></p>
<p><code>decltype(auto)</code> è¯­æ³•è¿˜å¯ä»¥åœ¨è¿”å›å€¼ç±»å‹æ¨å¯¼ä¸Šä½¿ç”¨.</p>
<h3 id="Relaxed-constexpr-restrictions-edit"><a href="#Relaxed-constexpr-restrictions-edit" class="headerlink" title="Relaxed constexpr restrictions[edit]"></a>Relaxed constexpr restrictions[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=4" target="_blank" rel="noopener">edit</a>]</h3><p><a href="https://en.wikipedia.org/wiki/C%2B%2B11" target="_blank" rel="noopener">C++11</a> introduced the concept of a constexpr-declared function; a function which could be executed at compile time. Their return values could be consumed by operations that require constant expressions, such as an integer template argument. However, C++11 constexpr functions could only contain a single expression that is returned (as well as <code>static_assert</code>s and a small number of other declarations).</p>
<p>c++å¼•è¿›äº†å¸¸é‡å£°æ˜å‡½æ•°(ä¸€ä¸ªå¯ä»¥åœ¨ç¼–è¯‘æœŸæ‰§è¡Œçš„å‡½æ•°). ä»–ä¹ˆçš„è¿”å›å€¼å¯ä»¥è¢«å¸¸é‡è¡¨è¾¾å¼ä½¿ç”¨. ç„¶è€Œ, c++11 å¸¸é‡è¡¨è¾¾å¼å‡½æ•°åªèƒ½åŒ…å«å•ä¸ªè¿”å›çš„è¡¨è¾¾å¼</p>
<p>C++14 relaxes these restrictions. Constexpr-declared functions may now contain the following:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong1-3" target="_blank" rel="noopener">[3]</a></p>
<p>c++14 å–æ¶ˆäº†è¿™äº›é™åˆ¶, å¸¸é‡è¡¨è¾¾å¼å‡½æ•°å¯ä»¥åŒ…å«ä»¥ä¸‹: </p>
<ul>
<li><p>Any declarations except:</p>
<ul>
<li><p><code>static</code> or <code>thread_local</code> variables.</p>
<p><code>staic</code> æˆ– <code>thread_local</code> å˜é‡.</p>
</li>
<li><p>Variable declarations without initializers.</p>
<p>æ²¡æœ‰åˆå§‹åŒ–çš„å˜é‡å£°æ˜(???)</p>
</li>
</ul>
</li>
<li><p>The conditional branching statements <code>if</code> and <code>switch</code>.</p>
<p>if å’Œ switch æ¡ä»¶è¯­å¥</p>
</li>
<li><p>Any looping statement, including range-based <code>for</code>.</p>
<p>ä»»ä½•å¾ªç¯è¯­å¥, åŒ…æ‹¬åŸºäºå¾ªç¯çš„ for</p>
</li>
<li><p>Expressions which change the value of an object if the lifetime of that object began within the constant expression function. This includes calls to any non-<code>const</code> <code>constexpr</code>-declared non-static member functions.</p>
<p>å¯æ›´æ”¹å¼€å§‹äºå¸¸é‡è¡¨è¾¾å¼å‡½æ•°çš„å¯¹è±¡çš„å€¼. è¿™åŒ…æ‹¬ä»»ä½•å¯¹éå¸¸å±æ€§, å¸¸é‡è¡¨è¾¾å¼å®šä¹‰, éé™æ€æˆå‘˜å‡½æ•°çš„è°ƒç”¨.</p>
</li>
</ul>
<p><code>goto</code> statements are forbidden in C++14 relaxed constexpr-declared functions.</p>
<p>Also, C++11 stated that all non-static member functions that were declared <code>constexpr</code> were also implicitly declared <code>const</code>, with respect to <code>this</code>. That has since been removed; non-static member functions may be non-<code>const</code>.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-6" target="_blank" rel="noopener">[6]</a> However, per the restrictions above, a non-<code>const</code> <code>constexpr</code> member function can only modify a class member if that objectâ€™s lifetime began within the constant expression evaluation.</p>
<p>C++11è§„å®šæ‰€æœ‰éé™æ€, è¢« <code>constexpr</code> å£°æ˜çš„æˆå‘˜å‡½æ•°æ˜¯éšå¼å£°æ˜ä¸º <code>const</code> çš„. è¿™åŒæ ·ä¹Ÿè¢«ç§»é™¤äº†, éé™æ€æˆå‘˜å‡½æ•°å¯ä»¥æ˜¯ <code>non-const</code> çš„. ç„¶è€Œ, æ ¹æ®ä¸Šé¢çš„é™åˆ¶, ä¸€ä¸ª <code>non-const</code> <code>constexpr</code> çš„æˆå‘˜å‡½æ•°åªèƒ½æ›´æ”¹å¯¹è±¡ç”Ÿå‘½å‘¨æœŸéšå¸¸é‡è¡¨è¾¾å¼æ±‚å€¼å¼€å§‹çš„å¯¹è±¡çš„æˆå‘˜(???) </p>
<p>(æˆ‘åœ¨å…¶ä»–æ–‡æ¡£ä¸­å¹¶æœªçœ‹åˆ°å…·ä½“çš„å…³äºæ›´æ”¹å€¼çš„ä»‹ç», æˆ‘ç®€å•ç†è§£çš„è¯, constexpr ç°å·²å¯ä»¥æ”¯æŒå¾ªç¯å’Œåˆ†æ”¯è¯­å¥, å¹¶ä¸”å¯ä»¥åŒ…å« static å’Œ thread_local å˜é‡)</p>
<h3 id="Variable-templates-edit"><a href="#Variable-templates-edit" class="headerlink" title="Variable templates[edit]"></a>Variable templates[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=5" target="_blank" rel="noopener">edit</a>]</h3><p>In prior versions of <a href="https://en.wikipedia.org/wiki/C%2B%2B" target="_blank" rel="noopener">C++</a>, only functions, classes or type aliases could be templated. C++14 now allows the creation of variables that are templated. An example given in the proposal is a variable <code>pi</code> that can be read to get the value of <a href="https://en.wikipedia.org/wiki/Pi" target="_blank" rel="noopener">pi</a> for various types (e.g., <code>3</code> when read as an integral type; the closest value possible with <code>float</code>, <code>double</code> or <code>long double</code> precision when read as <code>float</code>, <code>double</code> or <code>long double</code>, respectively; etc.).</p>
<p>åœ¨ä¹‹å‰ç‰ˆæœ¬çš„ C++ ä¸­, ç±»/ç±»å‹åˆ«åå¯ä»¥æ¨¡æ¿åŒ–, C++14 å…è®¸åˆ›å»ºå˜é‡æ¨¡æ¿. </p>
<p>The usual rules of templates apply to such declarations and definitions, including specialization.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-isocpp-7" target="_blank" rel="noopener">[7]</a><a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-8" target="_blank" rel="noopener">[8]</a></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">template&lt;typename T&gt;</span><br><span class="line">constexpr T pi &#x3D; T(3.141592653589793238462643383);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; Usual specialization rules apply:</span><br><span class="line">template&lt;&gt;</span><br><span class="line">constexpr const char* pi&lt;const char*&gt; &#x3D; &quot;pi&quot;;</span><br></pre></td></tr></table></figure>



<h3 id="Aggregate-member-initialization-edit"><a href="#Aggregate-member-initialization-edit" class="headerlink" title="Aggregate member initialization[edit]"></a>Aggregate member initialization[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=6" target="_blank" rel="noopener">edit</a>]</h3><p><a href="https://en.wikipedia.org/wiki/C%2B%2B11" target="_blank" rel="noopener">C++11</a> added member initializers, expressions to be applied to members at class scope if a constructor did not initialize the member itself. The definition of aggregates was changed to explicitly exclude any class with member initializers; therefore, they are not allowed to use aggregate initialization.</p>
<p>C++14 relaxes this restriction,<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong1-3" target="_blank" rel="noopener">[3]</a> allowing aggregate initialization on such types. If the braced init list does not provide a value for that argument, the member initializer takes care of it.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-9" target="_blank" rel="noopener">[9]</a></p>
<p>(æˆ‘ä¸æ˜ç™½è¯´çš„ä»€ä¹ˆ, æˆå‘˜åˆå§‹åŒ–ä¸æ˜¯ C++11 å°±æœ‰çš„ä¹ˆ?)</p>
<h3 id="Binary-literals-edit"><a href="#Binary-literals-edit" class="headerlink" title="Binary literals[edit]"></a>Binary literals[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=7" target="_blank" rel="noopener">edit</a>]</h3><p>Numeric literals in C++14 can be specified in <a href="https://en.wikipedia.org/wiki/Binary_number" target="_blank" rel="noopener">binary form</a>.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong1-3" target="_blank" rel="noopener">[3]</a> The syntax uses the prefixes <code>0b</code> or <code>0B</code>. The syntax is also used in other languages e.g. <a href="https://en.wikipedia.org/wiki/Java_(programming_language)" target="_blank" rel="noopener">Java</a>, <a href="https://en.wikipedia.org/wiki/C_Sharp_(programming_language)" target="_blank" rel="noopener">C#</a>, <a href="https://en.wikipedia.org/wiki/Swift_(programming_language)" target="_blank" rel="noopener">Swift</a>, <a href="https://en.wikipedia.org/wiki/Go_(programming_language)" target="_blank" rel="noopener">Go</a>, <a href="https://en.wikipedia.org/wiki/Scala_(programming_language)" target="_blank" rel="noopener">Scala</a>, <a href="https://en.wikipedia.org/wiki/Ruby_(programming_language)" target="_blank" rel="noopener">Ruby</a>, <a href="https://en.wikipedia.org/wiki/Python_(programming_language)" target="_blank" rel="noopener">Python</a>, <a href="https://en.wikipedia.org/wiki/OCaml" target="_blank" rel="noopener">OCaml</a>, and as an unofficial extension in some C compilers since at least 2007.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-gccbinaryliteralbugreport-10" target="_blank" rel="noopener">[10]</a></p>
<h3 id="Digit-separators-edit"><a href="#Digit-separators-edit" class="headerlink" title="Digit separators[edit]"></a>Digit separators[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=8" target="_blank" rel="noopener">edit</a>]</h3><p>In C++14, the single-quote character may be used arbitrarily as a <a href="https://en.wikipedia.org/wiki/Integer_literal#Digit_separators" target="_blank" rel="noopener">digit separator</a> in numeric literals, both <a href="https://en.wikipedia.org/wiki/Integer_literal" target="_blank" rel="noopener">integer literals</a> and floating point literals.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-11" target="_blank" rel="noopener">[11]</a> This can make it easier for human readers to parse large numbers through <a href="https://en.wikipedia.org/wiki/Subitizing" target="_blank" rel="noopener">subitizing</a>.</p>
<p>auto integer_literal = 1â€™000â€™000;<br> auto floating_point_literal = 0.000â€™015â€™3;<br> auto binary_literal = 0b0100â€™1100â€™0110;<br> auto silly_example = 1â€™0â€™0â€™000â€™00;</p>
<p>C++14ä¸­, å•å¼•å·ä¸“ç”¨äºæ•´æ•°/æµ®ç‚¹æ•°è¡¨ç¤º, ä½¿äººçœ‹èµ·æ¥å¯ä»¥æ›´åŠ æ¸…æ™°(woo, çœŸæ˜¯ä¸ªäººæ€§åŒ–çš„åŠŸèƒ½)</p>
<h3 id="Generic-lambdas-edit"><a href="#Generic-lambdas-edit" class="headerlink" title="Generic lambdas[edit]"></a>Generic lambdas[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=9" target="_blank" rel="noopener">edit</a>]</h3><p>In C++11, <a href="https://en.wikipedia.org/wiki/Anonymous_function" target="_blank" rel="noopener">lambda function</a> parameters need to be declared with concrete types. C++14 relaxes this requirement, allowing lambda function parameters to be declared with the <code>auto</code> type specifier.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-isocpp-7" target="_blank" rel="noopener">[7]</a></p>
<p>åœ¨ C++11 ä¸­, lambda å‡½æ•°å‚æ•°å£°æ˜å¿…é¡»å…·æœ‰å…·ä½“çš„ç±»å‹, C++14 æ”¾æ¾äº†è¿™ä¸ªè¦æ±‚, å…è®¸ lambda å‡½æ•°å‚æ•°ä½¿ç”¨ auto å…³é”®å­—å£°æ˜, å¦‚ä¸‹: </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto lambda &#x3D; [](auto x, auto y) &#123;return x + y;&#125;;</span><br></pre></td></tr></table></figure>

<p>Concerning <code>auto</code> type deduction, generic lambdas follow the rules of template argument deduction (which are similar, but not identical in all respects[*<a href="https://en.wikipedia.org/wiki/Wikipedia:Please_clarify" target="_blank" rel="noopener">clarification needed</a>*]). The code above is equivalent to this:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-12" target="_blank" rel="noopener">[12]</a></p>
<p>å…³äº auto ç±»å‹æ¨å¯¼, æ³›å‹ lambdas éµå¾ªæ¨¡æ¿å‚æ•°æ¨å¯¼åŸåˆ™. ä¸Šè¿°ä»£ç ç­‰åŒäºä»¥ä¸‹:</p>
<p>(å…¶å®ä¹Ÿè¯å®äº†, ä¸å…¶è¯´æ˜¯åŒ¿åå‡½æ•°, ä¸å¦‚è¯´æ˜¯å¸¦ () é‡è½½çš„åŒ¿åç±»)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">struct</span><br><span class="line">&#123;</span><br><span class="line">  template&lt;typename T, typename U&gt;</span><br><span class="line">    auto operator()(T x, U y) const &#123;return x + y;&#125;</span><br><span class="line">&#125; lambda&#123;&#125;;</span><br></pre></td></tr></table></figure>

<p>Generic lambdas are essentially templated functor lambdas.</p>
<p>æ³›å‹ lambdas æ˜¯æ›´é«˜æ•ˆçš„å‡½æ•°æ¨¡æ¿</p>
<h3 id="Lambda-capture-expressions-edit"><a href="#Lambda-capture-expressions-edit" class="headerlink" title="Lambda capture expressions[edit]"></a>Lambda capture expressions[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=10" target="_blank" rel="noopener">edit</a>]</h3><p>C++11 lambda functions capture variables declared in their outer scope by value-copy or by reference. This means that value members of a lambda cannot be move-only types.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-13" target="_blank" rel="noopener">[13]</a> C++14 allows captured members to be initialized with arbitrary expressions. This allows both capture by value-move and declaring arbitrary members of the lambda, without having a correspondingly named variable in an outer scope.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-isocpp-7" target="_blank" rel="noopener">[7]</a></p>
<p>C++11 åœ¨å…¶æ‰€åœ¨ä½œç”¨åŸŸä¸­æŒ‰å€¼/å¼•ç”¨æ•è·å˜é‡, è¿™æ„å‘³ç€ lambda æˆå‘˜çš„å€¼ä¸èƒ½æ˜¯ move-only ç±»å‹. C++14 å¾ªåºè¢«æ•è·å˜é‡ä»¥ä»»æ„å½¢å¼åˆå§‹åŒ–. è¿™ä½¿æ‰€æœ‰æ•è·å¯ä»¥å€¼/ç§»åŠ¨, ä»¥åŠå£°æ˜ä»»æ„çš„ lambda æˆå‘˜, è€Œä¸éœ€è¦åœ¨å¤–å±‚ä½œç”¨åŸŸä¸­æœ‰å¯¹åº”çš„å·²å‘½åæˆå‘˜.</p>
<p>This is done via the use of an initializer expression:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto lambda &#x3D; [value &#x3D; 1] &#123;return value;&#125;;</span><br></pre></td></tr></table></figure>

<p>The lambda function <code>lambda</code> returns 1, which is what <code>value</code> was initialized with. The declared capture deduces the type from the initializer expression as if by <code>auto</code>.</p>
<p>å£°æ˜æ•è·åƒ auto ä¸€æ ·æ¨å¯¼åˆå§‹åŒ–è¡¨è¾¾å¼.</p>
<p>This can be used to capture by move, via the use of the standard <code>std::move</code> function:</p>
<p>è¿˜å¯ä»¥ç”¨äºæ•è·ç§»åŠ¨è¯­ä¹‰(èµå•Š -v- )</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">std::unique_ptr&lt;int&gt; ptr(new int(10));</span><br><span class="line">auto lambda &#x3D; [value &#x3D; std::move(ptr)] &#123;return *value;&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="The-attribute-deprecated-edit"><a href="#The-attribute-deprecated-edit" class="headerlink" title="The attribute [[deprecated]][edit]"></a>The attribute <code>[[deprecated]]</code>[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=11" target="_blank" rel="noopener">edit</a>]</h3><p>The <code>deprecated</code> attribute allows marking an entity <a href="https://en.wikipedia.org/wiki/Deprecated" target="_blank" rel="noopener">deprecated</a>, which makes it still legal to use but puts users on notice that use is discouraged and may cause a warning message to be printed during compilation. An optional <a href="https://en.wikipedia.org/wiki/String_literal" target="_blank" rel="noopener">string literal</a> can appear as the argument of <code>deprecated</code>, to explain the rationale for deprecation and/or to suggest a replacement.</p>
<p>deprecated å±æ€§å¯ä»¥æ ‡è®°ä¸€ä¸ªæ•´ä½“ä¸ºâ€™åºŸå¼ƒçš„â€™, ç»§ç»­ä½¿ç”¨è¿™ä¸ªæ•´ä½“æ˜¯åˆæ³•çš„, ä½†æ˜¯ç”¨æˆ·ä¼šåœ¨ç¼–è¯‘æ—¶æ”¶åˆ°ä¸€ä¸ªè­¦å‘Š. </p>
<p>deprecated å¯ä»¥å¢åŠ å­—ç¬¦ä¸²æ–‡æœ¬, ç”¨ä½œè­¦ç¤ºè¯­.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[[deprecated]] int f();</span><br><span class="line"></span><br><span class="line">[[deprecated(&quot;g() is thread-unsafe. Use h() instead&quot;)]]</span><br><span class="line">void g( int&amp; x );</span><br><span class="line"></span><br><span class="line">void h( int&amp; x );</span><br><span class="line"></span><br><span class="line">void test()</span><br><span class="line">&#123;</span><br><span class="line">  int a &#x3D; f(); &#x2F;&#x2F; warning: &#39;f&#39; is deprecated</span><br><span class="line">  g(a); &#x2F;&#x2F; warning: &#39;g&#39; is deprecated: g() is thread-unsafe. Use h() instead</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>(åœ¨ gcc (Debian 6.3.0-18+deb9u1) 6.3.0 20170516 ç‰ˆæœ¬ä¸‹, å¯¹äºç±»çš„æ”¯æŒæœ‰æ‰€ä¸è¶³)</p>
<h2 id="New-standard-library-features-edit"><a href="#New-standard-library-features-edit" class="headerlink" title="New standard library features[edit]"></a>New standard library features[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=12" target="_blank" rel="noopener">edit</a>]</h2><h3 id="Shared-mutexes-and-locking-edit"><a href="#Shared-mutexes-and-locking-edit" class="headerlink" title="Shared mutexes and locking[edit]"></a>Shared mutexes and locking[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=13" target="_blank" rel="noopener">edit</a>]</h3><p>C++14 adds a shared timed mutex and a companion shared lock type.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong3-14" target="_blank" rel="noopener">[14]</a><a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-15" target="_blank" rel="noopener">[15]</a></p>
<p>C++14 å¢åŠ äº†å…±äº«äº’æ–¥é”, ä»¥åŠä»–çš„â€™ä¼´ä¾£â€™å…±äº«é”ç±»å‹.</p>
<p>(è¿™é‡Œæœ‰ç‚¹ä¸å¥½è¯´, mutex æœ¬èº«æ˜¯ä¸€æŠŠé”, è€Œ lock ä¹Ÿæ˜¯é”çš„æ„æ€, ä¸è¿‡æ˜¯åŠ é”, lock(mutex), emm, åº”è¯¥æ˜¯è¿™æ„æ€)</p>
<h3 id="Heterogeneous-lookup-in-associative-containers-edit"><a href="#Heterogeneous-lookup-in-associative-containers-edit" class="headerlink" title="Heterogeneous lookup in associative containers[edit]"></a>Heterogeneous lookup in associative containers[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=14" target="_blank" rel="noopener">edit</a>]</h3><p>The <a href="https://en.wikipedia.org/wiki/C%2B%2B_Standard_Library" target="_blank" rel="noopener">C++ Standard Library</a> defines four associative container classes. These classes allow the user to look up a value based on a value of that type. The map containers allow the user to specify a key and a value, where lookup is done by key and returns a value. However, the lookup is always done by the specific key type, whether it is the key as in maps or the value itself as in sets.</p>
<p>C++ æ ‡å‡†åº“å®šä¹‰äº†å››ç§å…³è”çš„å®¹å™¨ç±», è¿™äº›ç±»å‹ä½¿ç”¨æˆ·å¯ä»¥æ£€æŸ¥åŸºäºè¯¥å€¼ç±»å‹çš„å€¼. ç„¶è€Œ, æ£€æŸ¥æ€»æ˜¯éœ€è¦æŒ‡å®šç±»å‹æ¥å®Œæˆ (??? å§æ§½ ä½ æƒ³å¹²å˜›???)</p>
<p>C++14 allows the lookup to be done via an arbitrary type, so long as the comparison operator can compare that type with the actual key type.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong2-16" target="_blank" rel="noopener">[16]</a> This would allow a map from <code>std::string</code> to some value to compare against a <code>const char*</code> or any other type for which an <code>operator&lt;</code>overload is available. It is also useful for indexing composite objects in a <code>std::set</code> by the value of a single member without forcing the user of <code>find</code> to create a dummy object (for example creating an entire <code>struct Person</code> to find a person by name).</p>
<p>C++14 å…è®¸æ£€æŸ¥å¯ä»¥ç»ç”±ä»»æ„ç±»å‹å®Œæˆ, åªè¦å¯¹æ¯”æ“ä½œå¯ä»¥å’Œæ­£ç¡®çš„é”®ç±»å‹å¯¹æ¯”. è¿™ä½¿ map&lt;std::string&gt;å¯ä»¥å’Œ const char* ç±»å‹çš„å€¼æˆ–å…¶ä»–æœ‰æœ‰æ•ˆ &lt; é‡è½½çš„æ“ä½œç¬¦çš„ç±»å‹(ä¸ºä»€ä¹ˆä¸€å®šæ˜¯ <code>&lt;</code> ?  <code>&gt;</code> å®ƒä¸é¦™ä¹ˆ?) </p>
<p>å½“è¦æ£€æŸ¥ä¸€ä¸ªé›†åˆä¸­çš„å¤åˆç±»å‹æ—¶, ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¤åˆç±»å‹ä¹Ÿå¯ä»¥æ£€ç´¢ (æ¯”å¦‚: æ£€ç´¢ struct person, å¯ä»¥ä½¿ç”¨ä»–çš„åå­—, è€Œå¹¶ä¸éœ€è¦åˆ›å»ºä¸€ä¸ª person å¯¹è±¡)</p>
<p>To preserve backwards compatibility, heterogeneous lookup is only allowed when the comparator given to the associative container allows it. The standard library classes <code>std::less&lt;&gt;</code> and <code>std::greater&lt;&gt;</code> are augmented to allow heterogeneous lookup.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-17" target="_blank" rel="noopener">[17]</a></p>
<p>ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§, heterogeneous æ£€æŸ¥åªåœ¨å…³è”çš„å®¹å™¨å…è®¸å¯¹æ¯”å™¨æ—¶æ‰é€‚ç”¨. æ ‡å‡†åº“ std::less&lt;&gt;, std::greater&lt;&gt; è¢« heterogeneous æ£€æŸ¥æ¥çº³ (è¯¶, æˆ‘ä¸çŸ¥é“è¿™è¯¥æ€ä¹ˆå†™â€¦)</p>
<p>(è¿™æ˜¯æˆ‘åœ¨ç½‘ä¸Šæ‰¾åˆ°çš„ä»£ç , å…¶ä¸­ä¸¤ä¸ªåŒ…å« thread::id çš„é‡è½½ç¼ºä¸€ä¸å¯, ä¹Ÿå°±æ˜¯è¯´ç¼–è¯‘å™¨éƒ½ä¼šç”¨åˆ°)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ThreadCmp</span> &#123;</span></span><br><span class="line">  <span class="keyword">using</span> is_transparent = <span class="keyword">void</span>;</span><br><span class="line">  <span class="comment">// Regular overload.</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::thread&amp; a, <span class="keyword">const</span> <span class="built_in">std</span>::thread&amp; b)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.get_id() &lt; b.get_id();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Transparent overloads</span></span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::thread&amp; a, <span class="built_in">std</span>::thread::id b)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.get_id() &lt; b;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">bool</span> <span class="title">operator</span><span class="params">()</span><span class="params">(<span class="built_in">std</span>::thread::id a, <span class="keyword">const</span> <span class="built_in">std</span>::thread&amp; b)</span> <span class="keyword">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a &lt; b.get_id();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//bool operator()(std::thread::id a, std::thread::id b) const &#123;</span></span><br><span class="line">  <span class="comment">//  return a &lt; b;</span></span><br><span class="line">  <span class="comment">//&#125;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">set</span>&lt;<span class="built_in">std</span>::thread, ThreadCmp&gt; threads;</span><br><span class="line">    <span class="comment">// Can't construct an instance of `std::thread` with the same id, just to do the lookup.</span></span><br><span class="line">    <span class="comment">// But we can look up by id instead.</span></span><br><span class="line">    <span class="built_in">std</span>::thread::id id = this_thread::get_id();;</span><br><span class="line">    <span class="keyword">auto</span> it = threads.<span class="built_in">find</span>(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




<h3 id="Standard-user-defined-literals-edit"><a href="#Standard-user-defined-literals-edit" class="headerlink" title="Standard user-defined literals[edit]"></a>Standard user-defined literals[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=15" target="_blank" rel="noopener">edit</a>]</h3><p>C++11 defined the syntax for user-defined literal suffixes, but the standard library did not use any of them. C++14 adds the following standard literals:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong2-16" target="_blank" rel="noopener">[16]</a></p>
<p>C++14 å¢åŠ äº†ä»¥ä¸‹æ ‡å‡†å­—é¢é‡</p>
<ul>
<li><p>â€œsâ€, for creating the various <code>std::basic_string</code> types.</p>
<p>â€œsâ€, åˆ›å»ºå„ç§ <code>std::basic_string</code> ç±»å‹</p>
</li>
<li><p>â€œhâ€, â€œminâ€, â€œsâ€, â€œmsâ€, â€œusâ€, â€œnsâ€, for creating the corresponding <code>std::chrono::duration</code> time intervals.</p>
<p>â€œhâ€, â€œminâ€, â€œsâ€, â€œmsâ€, â€œusâ€, â€œnsâ€, åˆ›å»ºå¯¹åº”çš„ <code>std::chrono::duration</code> æ—¶é—´é—´éš”</p>
</li>
<li><p>â€œifâ€, â€œiâ€, â€œilâ€, for creating the corresponding <code>std::complex</code>, <code>std::complex</code> and <code>std::complex</code> imaginary numbers.</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto str &#x3D; &quot;hello world&quot;s; &#x2F;&#x2F; auto deduces string</span><br><span class="line">auto dur &#x3D; 60s;            &#x2F;&#x2F; auto deduces chrono::seconds</span><br><span class="line">auto z   &#x3D; 1i;             &#x2F;&#x2F; auto deduces complex&lt;double&gt;</span><br></pre></td></tr></table></figure>

<p>The two â€œsâ€ literals do not interact, as the string one only operates on <a href="https://en.wikipedia.org/wiki/String_literal" target="_blank" rel="noopener">string literals</a>, and the one for seconds operates only on numbers.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-18" target="_blank" rel="noopener">[18]</a></p>
<h3 id="Tuple-addressing-via-type-edit"><a href="#Tuple-addressing-via-type-edit" class="headerlink" title="Tuple addressing via type[edit]"></a>Tuple addressing via type[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=16" target="_blank" rel="noopener">edit</a>]</h3><p>The <code>std::tuple</code> type introduced in C++11 allows an aggregate of typed values to be indexed by a compile-time constant integer. C++14 extends this to allow fetching from a tuple by type instead of by index.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong2-16" target="_blank" rel="noopener">[16]</a> If the tuple has more than one element of the type, a compile-time error results:<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-19" target="_blank" rel="noopener">[19]</a></p>
<p>C++14 æ‰©å±•äº† <code>std::tuple</code> , å¯ä»¥é€šè¿‡ç±»å‹æ¥è·å–å…ƒç´ , å¦‚æœ tuple æœ‰å¤šä¸ªç›¸åŒç±»å‹, åˆ™ä¼šå‡ºé”™.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">tuple&lt;string, string, int&gt; t(&quot;foo&quot;, &quot;bar&quot;, 7);</span><br><span class="line">int i &#x3D; get&lt;int&gt;(t);        &#x2F;&#x2F; i &#x3D;&#x3D; 7</span><br><span class="line">int j &#x3D; get&lt;2&gt;(t);          &#x2F;&#x2F; Same as before: j &#x3D;&#x3D; 7</span><br><span class="line">string s &#x3D; get&lt;string&gt;(t);  &#x2F;&#x2F; Compile-time error due to ambiguity</span><br></pre></td></tr></table></figure>



<h3 id="Smaller-library-features-edit"><a href="#Smaller-library-features-edit" class="headerlink" title="Smaller library features[edit]"></a>Smaller library features[<a href="https://en.wikipedia.org/w/index.php?title=C%2B%2B14&action=edit&section=17" target="_blank" rel="noopener">edit</a>]</h3><p><code>std::make_unique</code> can be used like <code>std::make_shared</code> for <code>std::unique_ptr</code> objects.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-isocpp-7" target="_blank" rel="noopener">[7]</a></p>
<p><code>std::integral_constant</code> gained an <code>operator()</code> overload to return the constant value.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-wong2-16" target="_blank" rel="noopener">[16]</a></p>
<p>The class template <code>std::integer_sequence</code> and related alias templates were added for representing compile-time integer sequences, such as the indices of elements in a parameter pack.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-intseqs-20" target="_blank" rel="noopener">[20]</a></p>
<p>The global <code>std::begin</code>/<code>std::end</code> functions were augmented with <code>std::cbegin</code>/<code>std::cend</code> functions, which return constant iterators, and <code>std::rbegin</code>/<code>std::rend</code> and <code>std::crbegin</code>/<code>std::crend</code> which return reverse iterators.</p>
<p>The <code>std::exchange</code> function template assigns a new value to a variable and returns the old value.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-exchange-21" target="_blank" rel="noopener">[21]</a></p>
<p>New overloads of <code>std::equal</code>, <code>std::mismatch</code>, and <code>std::is_permutation</code> take a pair of iterators for the second range, so that the caller does not need to separately check that the two ranges are of the same length.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-robustseqs-22" target="_blank" rel="noopener">[22]</a></p>
<p>The <code>std::is_final</code> type trait detects if a class is marked <code>final</code>.</p>
<p>The <code>std::quoted</code> stream I/O manipulator allows inserting and extracting strings with embedded spaces, by placing delimiters (defaulting to double-quotes) on output and stripping them on input, and escaping any embedded delimiters.<a href="https://en.wikipedia.org/wiki/C%2B%2B14#cite_note-quoted-23" target="_blank" rel="noopener">[23]</a></p>
<h2 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h2><ol>
<li><p>ç±»å‹æ¨å¯¼, type deduce</p>
<p>ä»¥ <code>auto</code> ä¸ºä¸», å¯ä»¥æ¨å¯¼è¿”å›å€¼è€Œä¸éœ€è¿”å›å€¼åç½®è¯­æ³•. åŒæ—¶ <code>decltype</code> å¯ä»¥ç”¨äºæ¨å¯¼ auto çš„åŸç±»å‹</p>
</li>
<li><p>å¸¸é‡è¡¨è¾¾å¼åŠ å¼º <code>constexpr</code></p>
<p><code>constexpr</code> ä¸­å¯ä»¥æœ‰é™æ€å˜é‡, thread_local å˜é‡, å¯ä»¥æœ‰åˆ†æ”¯å’Œå¾ªç¯è¯­å¥</p>
</li>
<li><p>å€¼æ¨¡æ¿ variable template</p>
<p>ä¸ä»…ç±», ç°åœ¨å€¼ä¹Ÿå¯ä»¥æ¨¡æ¿åŒ–</p>
</li>
<li><p>æ•°å­—åˆ†éš”ç¬¦ digit separators</p>
<p>ä½¿æ•°å­—æ›´åŠ æ˜“è¯»</p>
</li>
<li><p>åŠ å¼º lambda</p>
<p>lambda çš„å‚æ•°å¯ä»¥æ˜¯ auto æ¨å¯¼çš„äº†, åŒæ—¶ lambda çš„æ•è·å¢åŠ äº†ç§»åŠ¨è¯­ä¹‰, è¿˜å¯ä»¥ä¸æ˜¯å¤–éƒ¨æˆå‘˜(ä¹Ÿå°±æ˜¯è‡ªå»ºå˜é‡)</p>
</li>
<li><p>å…³é”®å­— [[deprecated]]</p>
<p>ç”¨äºè­¦ç¤ºç”¨æˆ·</p>
</li>
<li><p>æ–°çš„å­—é¢é‡, â€œsâ€, â€œhâ€, â€œminâ€ â€¦ </p>
<p>æ–°çš„å­—é¢é‡, ç”¨äºå¿«æ·åˆ›å»ºå˜é‡, è€Œä¸éœ€æ˜¾å¼è½¬æ¢ç±»å‹</p>
</li>
<li><p>æ–°çš„ tuple å…ƒç´ ç´¢å¼•æ–¹å¼</p>
<p>å¯ä»¥ç”¨ç±»å‹æ¥æ£€ç´¢äº†å‘¢ :)</p>
</li>
</ol>
<p>ä»¥ä¸Šæ˜¯æˆ‘ä» C++14 ä¸­å°è±¡æ¯”è¾ƒæ·±åˆ»çš„æ–°ç‰¹æ€§</p>
<p>these are my impressive new features in c++14 </p>
]]></content>
  </entry>
  <entry>
    <title>other/memoryAndCache</title>
    <url>/2020/01/10/other/memoryAndCache/</url>
    <content><![CDATA[<p>#å†…å±‚å¯¹é½è¡¥é½ä¸åˆ†æ”¯ç›®æ ‡ç¼“å†²å™¨<br>    å‡ºè‡ªã€ŠC++åæ±‡ç¼–æŠ€æœ¯åˆ†æä¸æ­ç§˜ã€‹<br>    æ­¤ä¹¦æˆ‘å¹¶æ²¡æœ‰è¯»å®Œï¼Œæ”¶è·æ˜¯å¯¹äºåº•å±‚æ›´åŠ äº†è§£ï¼Œæœ‰2ä¸ªç‚¹æ›´åŠ æ¸…æ¥šäº†</p>
<h2 id="å†…å­˜å¯¹é½ä¸è¡¥é½ï¼Œä¸ºä»€ä¹ˆæ˜¯4å­—èŠ‚"><a href="#å†…å­˜å¯¹é½ä¸è¡¥é½ï¼Œä¸ºä»€ä¹ˆæ˜¯4å­—èŠ‚" class="headerlink" title="å†…å­˜å¯¹é½ä¸è¡¥é½ï¼Œä¸ºä»€ä¹ˆæ˜¯4å­—èŠ‚"></a>å†…å­˜å¯¹é½ä¸è¡¥é½ï¼Œä¸ºä»€ä¹ˆæ˜¯4å­—èŠ‚</h2><ul>
<li><p>CPUè¿ç®—çš„ç¬¬äºŒæ¢¯é˜Ÿæ˜¯cacheï¼ˆé«˜é€Ÿç¼“å†²åŒºï¼‰ï¼Œå®ƒçš„è®¿é—®é€Ÿåº¦ä»…æ¬¡äºå¯„å­˜å™¨</p>
</li>
<li><p>cacheä¸­æœ‰è™šæ‹Ÿåœ°å€æ˜ å°„ï¼Œå½“è¿ç®—æ—¶ä¼šä»ä¸­æ‹¿åˆ°åœ°å€è¿›è¡Œå¯»å€æ“ä½œ</p>
</li>
<li><p>åŒæ—¶32ä½æœºçš„å¯„å­˜å™¨ä½æ•°ä¸º32ä½ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ•°æ®æ•´å½¢intå’ŒæŒ‡é’ˆçš„å¤§å°ä¹Ÿä¸º4å­—èŠ‚</p>
</li>
<li><p>æ€è€ƒ2ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li><p>ä¸€èˆ¬å¸¸ç”¨çš„æ•°æ®ç±»å‹åŸºæœ¬æ˜¯4å­—èŠ‚ä»¥ä¸Šï¼ˆé™¤å•ä¸ªçš„charå’Œshortï¼‰</p>
</li>
<li><p>cacheçš„å†…å­˜ååˆ†å®è´µï¼Œé‡Œé¢ä¿å­˜çš„åœ°å€æ˜¯å¦æœ‰å¿…è¦ç²¾ç¡®åˆ°1ä½  </p>
<p>å¯¹äºcacheè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå…¶ä¸­ä¿å­˜çš„å†…å­˜åœ°å€ä¼šä¸¢å¼ƒåä¸¤ä½ï¼Œä¸¢å¼ƒä¹‹åï¼Œå¯»å€æ“ä½œåªèƒ½åŸºäº4å­—èŠ‚çš„å€æ•°<br>æ‰€ä»¥å¯¹é½è¡¥é½æ˜¯ä»¥4å­—èŠ‚ä¸ºåŸºç¡€çš„</p>
</li>
</ul>
</li>
</ul>
<h2 id="å¯¹äºå¾ªç¯çš„ä¼˜åŒ–"><a href="#å¯¹äºå¾ªç¯çš„ä¼˜åŒ–" class="headerlink" title="å¯¹äºå¾ªç¯çš„ä¼˜åŒ–"></a>å¯¹äºå¾ªç¯çš„ä¼˜åŒ–</h2><ul>
<li><p>å…ˆè€ƒè™‘æµæ°´çº¿ä¼˜åŒ–ï¼Œå…¶åŸç†å¾ˆç®€å•ï¼š<br>  A B C Då››ä¸ªå·¥äººï¼Œå½“ä¸€ä¸ªä»»åŠ¡æ¥çš„æ—¶å€™ï¼Œé¡ºåºæ˜¯A-&gt;B-&gt;C-&gt;D<br>  å½“Aåšå®Œäº†ï¼Œç»§ç»­æ¥äº†ç¬¬2ä¸ªä»»åŠ¡ï¼Œåœ¨æ­¤æ—¶ï¼ŒBåœ¨åšç¬¬ä¸€ä¸ªä»»åŠ¡çš„ç¬¬äºŒæ­¥ï¼Œå‚è€ƒå¦‚å›¾ï¼š</p>
<ol>
<li><p>A B C D</p>
</li>
<li><p>&emsp;A B C D    </p>
</li>
<li><p>&emsp; &emsp;A B C D</p>
</li>
<li><p>â€¦â€¦  </p>
<p>å…¶æ ¸å¿ƒæ˜¯ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå°±éœ€è¦èŠ±è´¹ä¸€æ•´æ®µå·¥ä½œæ—¶é—´<br>è€Œå¦‚æœæ˜¯å¤šä¸ªä»»åŠ¡ï¼Œä¾‹å¦‚2ä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆå°±æ˜¯5/4çš„æ—¶é—´ï¼Œä»¥æ­¤ç±»æ¨</p>
</li>
</ol>
</li>
<li><p>åˆ†æ”¯ç›®æ ‡ç¼“å†²å™¨ï¼Œè€ƒè™‘ä¸‹é¢çš„å¾ªç¯ï¼š  </p>
<pre><code>/**
*@brief å¤–å±‚å¾ªç¯åš10æ¬¡
*/
for (int i = 0; i &lt; 10; ++i)
{
    /**
    *@brief å†…å±‚åš1000æ¬¡å¾ªç¯ï¼Œç¬¬ä¸€æ¬¡ä¸é¢„æµ‹ï¼Œé¢„æµ‹æˆåŠŸ999æ¬¡ï¼Œç¬¬1001æ¬¡é¢„æµ‹å¤±è´¥
    */
    for (int j = 0; j &lt; 1000; ++j)
    {
        //...
    }
}</code></pre><p>  åˆ†æ”¯ç›®æ ‡ç¼“å†²å™¨è¦ç»“åˆæµæ°´çº¿ä¼˜åŒ–æ¥ç†è§£<br>  å½“ç¬¬ä¸€ä¸ªåˆ†æ”¯å¯åŠ¨æ—¶ï¼Œåˆ†æ”¯ç›®æ ‡ç¼“å†²å™¨ä¸è¿›è¡Œé¢„æµ‹ï¼Œå½“ç¬¬äºŒæ¬¡å¾ªç¯è¿›è¡Œæ—¶ï¼Œè¿›è¡Œé¢„æµ‹ï¼Œé¢„æµ‹æˆåŠŸï¼Œç›´åˆ°å¤±è´¥<br>  åˆ†æ”¯ç›®æ ‡ç¼“å†²å™¨æ˜¯ç»éªŒä¸»ä¹‰ï¼Œé¢„æµ‹è¶Šå¤šï¼Œä¼˜åŒ–æ›´å¥½ï¼Œå¦‚æœå¤šæ¬¡å¤±è´¥ï¼Œåˆ™ä¼šåˆ·æ–°<br>  ï¼ˆintelçš„CPUæ˜¯è¿™æ ·çš„ï¼Œå½“è¿›è¡Œä¸€ä¸ªåˆ†æ”¯æ—¶ï¼Œä¸‹ä¸€ä¸ªåˆ†æ”¯å·²ç»åœ¨è¿›è¡Œé¢„æµ‹äº†ï¼Œå®ƒå¯¹true/falseçš„æƒ…å†µè¿›è¡Œé¢„æµ‹<br>  ï¼Œä¹Ÿå°±æ˜¯åœ¨è¿™æ¬¡åˆ†æ”¯æ‰§è¡Œæ—¶ï¼Œä¸‹ä¸€æ¬¡åˆ†æ”¯å·²ç»å‡†å¤‡å¥½äº†ï¼ˆå…¶ä¸­çš„åŒæ­¥è¿™äº›åˆ™æ˜¯æ›´åº•å±‚çš„çŸ¥è¯†äº†ï¼‰å¦‚æœé¢„æµ‹å¤±è´¥åˆ™ä¼šå›æµï¼Œ<br>  å¦‚æœé¢„æµ‹æˆåŠŸï¼Œå°†ä¼šèŠ‚çœæ—¶é—´ä»¥è¾¾åˆ°æå‡æ€§èƒ½çš„ç›®çš„ï¼‰</p>
<p>  å¦‚æœå¤–å±‚åˆ†æ”¯è¿›è¡Œ10æ¬¡ï¼Œå†…å±‚åˆ†æ”¯è¿›è¡Œ1000æ¬¡ï¼Œé‚£ä¹ˆ1æ¬¡ä¸é¢„æµ‹ï¼Œ999æ¬¡æˆåŠŸï¼Œæœ€åä¸€æ¬¡å¤±è´¥ï¼Œè¿™æ ·çš„æ“ä½œé‡å¤10æ¬¡<br>  åˆ™ 10 x 999 = 9990 æ¬¡<br>  å¦‚æœå¤–å±‚åˆ†æ”¯è¿›è¡Œ1000æ¬¡ï¼Œå†…å±‚åˆ†æ”¯è¿›è¡Œ10æ¬¡ï¼Œé‚£ä¹ˆ1æ¬¡ä¸é¢„æµ‹ï¼Œ9æ¬¡æˆåŠŸï¼Œæœ€åä¸€æ¬¡å¤±è´¥ï¼Œè¿™æ ·çš„æ“ä½œé‡å¤1000æ¬¡<br>  åˆ™ 9 x 1000 = 9000 æ¬¡<br>  åˆ†æ”¯é¢„æµ‹æ˜¯ç»éªŒä¸»ä¹‰ï¼Œé¢„æµ‹è¶Šå¤šï¼Œä¼˜åŒ–ä¹Ÿå°±æ›´å¥½ï¼Œæ‰€ä»¥ï¼š<br>  <strong>å¤šé‡å¾ªç¯ï¼Œå†…å±‚å¾ªç¯æ¬¡æ•°åº”å¤§äºå¤–å±‚å¾ªç¯æ¬¡æ•°</strong><br>  PSï¼šè¿™éœ€è¦ç»“åˆCPUæ¥è€ƒè™‘ï¼Œintelçš„CPUæ˜¯è¿™æ ·çš„ï¼ŒAMDå°±ä¸çŸ¥é“äº†</p>
</li>
</ul>
<p>è‡³äºswitchï¼Œifï¼Œç­‰ç­‰ï¼Œéƒ½æœ‰ä¼˜åŒ–ï¼Œå…·ä½“ä»¥åå†è¡¥ï¼Œåˆ†æ”¯çš„ç»“æ„ç±»ä¼¼äºå‡½æ•°è°ƒç”¨ï¼Œéƒ½ä¼šå‘ç”Ÿè·³è½¬ï¼ˆinlineä¾‹å¤–ï¼‰<br>PSï¼šå¼ºæ¨ç¨‹åºåº”å½“äº†è§£åº•å±‚çŸ¥è¯†ï¼Œç¼–è¯‘å™¨ä¼˜åŒ–å’Œæ±‡ç¼–ï¼Œå¦‚æœäº†è§£äº†åº•å±‚ï¼Œå¾ˆå¤šçŸ¥è¯†ç‚¹éƒ½èƒ½è¿åˆƒè€Œè§£<br>å½“ç„¶ï¼Œå‰ææ˜¯æœ‰é‚£è€å¿ƒï¼Œä¸€ä¸ªç®€å•çš„é™¤æ³•ç¼–è¯‘å™¨éƒ½å¯èƒ½ä¼šä¼˜åŒ–æˆä¸€å †è®¡ç®—æœºå¤„ç†æ¯”è¾ƒç®€å•ï¼Œè€Œäººç†è§£èµ·æ¥å°±å¾ˆå¤´ç–¼çš„ä»£ç <br>é‚£æ¶‰åŠåˆ°æ•°å­¦æ–¹é¢çš„çŸ¥è¯†ï¼Œå¹¶ä¸”ä¸ç®€å•â€¦</p>
]]></content>
  </entry>
  <entry>
    <title>other/encode</title>
    <url>/2020/01/10/other/encode/</url>
    <content><![CDATA[<p>#ä¸ºä»€ä¹ˆæ˜¯-128<del>127?<br>æˆ‘ä»¬å¸¸è¯´charç±»å‹æ•°æ®å 1ä¸ªå­—èŠ‚,èŒƒå›´æ˜¯-128</del>127<br>OK,1å­—èŠ‚å…«ä½,1ä½ä¸ºç¬¦å·ä¸º,7ä½å­˜å‚¨æ•°æ®,ä½†æ˜¯ä¸ºä»€ä¹ˆè´Ÿæ•°è¦æ¯”æ­£æ•°å¤šä¸€ä¸ªå‘¢?</p>
<p>è¿™æ¶‰åŠåˆ°è¡¥ç å’Œåç çš„æ¦‚å¿µ,8ä½èƒ½è¡¨ç¤º2^8+1ç§å˜åŒ–(æˆ‘æ›´åå‘äºç§°å®ƒä¸ºå˜åŒ–,å› ä¸ºè®¡ç®—æœºä¸­çš„äºŒè¿›åˆ¶æ˜¯æˆ‘ä»¬èµ‹äºˆä»–çš„æ„ä¹‰,è¿™é‡Œ+1æŒ‡çš„æ˜¯0)<br>ä¹Ÿå°±æ˜¯0<del>255,256ä¸ªæ•°å­—,æ‰€ä»¥-128</del>127æ˜¯æ­£ç¡®çš„<br>è€ƒè™‘ä¸€ä¸‹0ä¼šå¦‚ä½•è¢«è¡¨ç¤º:</p>
<pre><code>åœ¨ç¬¦å·ä½ä¸ºæ­£çš„æƒ…å†µä¸‹ä¸º 0000 0000  
åœ¨ç¬¦å·ä½ä¸ºè´Ÿçš„æƒ…å†µä¸‹ä¸º 1000 0000  </code></pre><p>åŒæ ·çš„æ•°,ä»–ä»¬è¡¨ç¤ºæ–¹å¼é‡å äº†,è¿™æ˜¾ç„¶ä¸å¥½<br>æ‰€ä»¥CPUé‡‡ç”¨äº†æ­£æ•°å’Œè´Ÿæ•°è¡¨ç¤ºæ–¹å¼ä¸åŒçš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜<br>è´Ÿæ•°çš„è¡¨ç°æ–¹å¼ä¸º è¡¥ç : åç  + 1</p>
<p>##åç <br>å°±å’Œå®ƒçš„åå­—ä¸€æ ·,å®ƒçš„æ„ä¹‰æ˜¯é™¤ç¬¦å·ä½å¤–,å…¶ä»–æ‰€æœ‰ä½å–å<br>ä¾‹å¦‚ 0000 0000 å–åä¸º 0111 1111</p>
<p>##è¡¥ç <br>è¡¥ç å³ä¸ºåç  + 1</p>
<p>æœ‰äº†ä»¥ä¸ŠçŸ¥è¯†,é‚£ä¹ˆå¯ä»¥å¾—çŸ¥ä»¥ä¸‹äºŒè¿›åˆ¶è¡¨ç¤ºå¤šå°‘(å‡è®¾ä¸º1 byte):</p>
<pre><code>1111 1111 åç :1000 0000 è¡¥ç :1000 0001 è¡¨ç¤º -1
1000 0000 åç :1111 1111 è¡¥ç :(è¿™é‡Œä¸å¥½è¡¨ç¤ºo(*ï¿£â–½ï¿£*)ãƒ–) è¡¨ç¤º:-128</code></pre><p>æ‰€ä»¥,ä¸ºä»€ä¹ˆè´Ÿæ•°æ¯”æ­£æ•°å¤šäº†ä¸€ä¸ªå‘¢?<br>å› ä¸ºè®¡ç®—æœºå†…éƒ¨ç»“æ„(è¡¥ç )é€ æˆäº†è´Ÿæ•°æ¯”æ­£æ•°èƒ½å¤šè¡¨è¾¾ä¸€ä¸ª(è¿™ä¸€ä¸ªæ˜¯æ¥è‡ªäº-0è¿™ä¸ªæ¦‚å¿µ,å› ä¸ºæˆ‘ä»¬æ›´åŠ åå‘äº+0è€Œä¸æ˜¯-0,<br>æ‰€ä»¥å°±è®©æ­£æ•°åƒäºäº†,ä¹Ÿä¸ä»…ä»…æ˜¯è¿™æ ·,åœ¨å¾ˆå¤šæˆ‘æ— æ³•ä¸¾ä¾‹ä½†çš„ç¡®å­˜åœ¨çš„æŸäº›â€éªšæ“ä½œâ€é‡Œé¢,è¿™ç§æ–¹å¼ç»™äºˆäº†å¾ˆå¤§çš„æ”¯æŒ)</p>
<p>è¿™é‡Œä¹Ÿæ˜ å°„äº†å¾ˆå¤šæ¦‚å¿µ,æ¯”å¦‚ä¸€ä¸ªæ•°å·²ç»è¡¨ç¤ºæœ€å¤§äº†(æ¯”å¦‚charçš„127)æˆ‘å°†å®ƒ+1 ä¸ºä»€ä¹ˆä»–è¡¨ç¤ºäº†-128?</p>
<pre><code>127äºŒè¿›åˆ¶ 0111 1111
+1ä¹‹å 1000 0000(å¾ˆç†Ÿæ‚‰å§,å°±åœ¨ä¸Šé¢,è¿™è¡¨ç¤ºäº†è´Ÿæœ€å¤§)</code></pre><p>PS:åº•å±‚çš„ä¸œè¥¿å¾ˆæœ‰è¶£,ä¸ç„¶ä¸ºä»€ä¹ˆç¼–è¯‘åŸç†å’Œæ“ä½œç³»ç»Ÿå‡­ä»€ä¹ˆè¢«è®¤ä¸ºæ˜¯ç¨‹åºä¸‰å¤§æµªæ¼«(è¿˜æœ‰ä¸€ä¸ªæ˜¯å›¾å½¢å­¦,<br>emmm ä¸‰å¤§æµªæ¼«æœ‰å¾ˆå¤šäº‰è®®,æœ‰äº›è®¤ä¸ºåº”å½“åŒ…å«æ•°æ®åº“å’Œç®—æ³•,æ–°çš„ä¸‰å¤§æµªæ¼«è¿˜æœ‰äººå·¥æ™ºèƒ½å’Œæœºå™¨è§†è§‰ç­‰ç­‰)</p>
<p>PS:å…³äºç¬¦å·ä½æ‰©å±•</p>
<p>æ€è€ƒä¸‹é¢ä»£ç <br>    (x &lt;&lt; 1) &gt;&gt; 1<br>xå·¦ç§»ä¸€ä½ååˆå³ç§»ä¸€ä½, ä¹ä¸€çœ‹å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å˜, è¿™æ¶‰åŠåˆ°ç¬¦å·ä½çš„æ‰©å±•é—®é¢˜  </p>
<p>å¯¹äºç§»ä½æ“ä½œ, å·¦ç§»éƒ½è¡¥0, è€Œå³ç§»å› ä¸ºåç çš„å…³ç³»:æ­£æ•°ç§»ä½è¡¥0, è€Œè´Ÿæ•°ç§»ä½è¡¥1, æ‰€ä»¥å½“xå·¦ç§»æ”¹å˜äº†ç¬¦å·ä½æ—¶,å†å³ç§»,å®ƒçš„å€¼å°†ä¼šå‘ç”Ÿæ”¹å˜<br>å…·ä½“æ”¹å˜çš„è§„å¾‹æ˜¯ç¬¦å·ä½å‘ç”Ÿæ”¹å˜, è€Œæ•°å€¼ä¸Šçš„ä½“ç°æ¶‰åŠåˆ°è´Ÿæ•°ä¼šè¡¥ç , æ‰€ä»¥æ”¹å˜å‰åå¯èƒ½æ˜¯ä¸¤ä¸ªçœ‹èµ·æ¥å®Œå…¨ä¸åŒä½†å…¶å®æœ‰è§„å¾‹çš„å€¼</p>
]]></content>
  </entry>
  <entry>
    <title>other/overFlowAndCarry</title>
    <url>/2020/01/10/other/overFlowAndCarry/</url>
    <content><![CDATA[<p>##å¯¹äºæº¢å‡ºå’Œè¶Šç•Œçš„ç†è§£(overflow/outside range)</p>
<p>x86æ±‡ç¼–flagå¯„å­˜å™¨æœ‰ä¸¤ä¸ªè¡¨ç¤ºä½, åˆ†åˆ«ä½OF/CF, æº¢å‡ºæ ‡å¿—ä½/è¿›ä½æ ‡å¿—ä½<br>å…¶ä¸­OFåªå¯¹æœ‰ç¬¦å·æ•°æœ‰æ•ˆ, ä¾‹å¦‚:<br>å½“ä¸¤ä¸ª1å­—èŠ‚å¤§å°çš„æ•°å­—ç›¸åŠ æ—¶, A: 0111 1111 (127), B: 0000 0001 (1)<br>A + B = 128, å¯¹åº”äºŒè¿›åˆ¶ä½æ˜¯ 1000 0000, ä½†æ˜¯å¯¹äºæœ‰ç¬¦å·æ•°æ¥è¯´, è¿™æ˜¯è´Ÿæ•°, è®¡ç®—ç»“æœæ˜¯é”™è¯¯çš„<br>è¿™é‡Œé”™è¯¯çš„åŸå› æ˜¯è®¡ç®—ç»“æœ<strong>å ç”¨äº†ä¸€ä¸ªä¸è¯¥å®ƒå æœ‰çš„æœ‰æ•ˆä½</strong><br>ä¸è¯¥å®ƒå æœ‰: å®ƒå æœ‰äº†ç¬¦å·ä½, è¿™ä¸ªä½é”™è¯¯åœ°è¢«è®¡ç®—ç»“æœæ”¹å˜<br>æœ‰æ•ˆ: è¿™ä¸ªç¬¦å·ä½æ˜¯è¢«åˆç†åˆ†é…çš„, å¹¶ä¸æ˜¯æœªå®šä¹‰çš„</p>
<p>CFåªå¯¹æ— ç¬¦å·æ•°æœ‰æ•ˆ, ä¾‹å¦‚:<br>å½“ä¸¤ä¸ª1å­—èŠ‚å¤§å°çš„æ•°å­—ç›¸åŠ æ—¶, A: 1111 1111 (255), B: 0000 0001 (1)<br>A + B = 256, å¯¹åº”äºŒè¿›åˆ¶ä½æ˜¯ 1 0000 0000, 1å­—èŠ‚å¤§å°å­˜ä¸ä¸‹9bit, è®¡ç®—ç»“æœæ— æ³•ä¿å­˜, äº§ç”Ÿé”™è¯¯<br>é”™è¯¯åŸå› æ˜¯: è®¡ç®—ç»“æœ<strong>è¶…å‡ºäº†åˆç†çš„èŒƒå›´, è¿™ä¸ªä½æœªè¢«å®šä¹‰</strong><br>åŒæ ·ä¸è¯¥å®ƒå æœ‰, ä½†æ˜¯åŒæ—¶è¿™æ˜¯ä¸ª<strong>æœªè¢«å®šä¹‰çš„ç©ºé—´</strong>  </p>
<p>é‚£ä¹ˆå°±å¯ä»¥ç®€å•çœ‹å‡º, ä»å¯„å­˜å™¨è§’åº¦, æº¢å‡º/è¶Šç•Œçš„åŒºåˆ†äº†, <strong>é‚£ä¸ªä½æ˜¯å¦æœ‰æ•ˆ</strong><br>(ä½†æ˜¯ä¹Ÿä¸ä¸€å®šâ€¦)</p>
<pre><code>vector&lt;int&gt; veci{1, 2, 3};
vector&lt;int&gt;::iterator it1 = veci.begin();
vector&lt;int&gt;::iterator it2 = veci.begin() + 1; 

veci.erase(it1);
// @note è¿™é‡Œçš„eraseä¼šæŠ¥é”™, å› ä¸ºåœ¨ä¸Šä¸€å¥ä»£ç ä¸­, beginè¿­ä»£å™¨æ‰€æŒ‡å‘çš„æ•°æ®è¢«åˆ é™¤äº†, 
//     åˆ é™¤ä¹‹å, beginè¿­ä»£å™¨ä¹‹åçš„å…ƒç´ é‡æ–°æ’åº(å¾€å‰ç§»), æ­¤æ—¶çš„it2å·²ç»ä¸æŒ‡å‘å®ƒåŸå…ˆå¸Œæœ›æŒ‡å‘çš„ä½ç½®äº†  
//     å¯èƒ½å®ƒæŒ‡å‘äº†æ–°çš„beginè¿­ä»£å™¨ä¹‹åçš„ä½ç½®, ä¹Ÿå¯èƒ½æŒ‡å‘beginäº†, ç›´æ¥çš„ç»“æœæ˜¯: å®ƒå¤±æ•ˆäº†  
veci.erase(it2);</code></pre><p>åœ¨ä¸Šæ®µä»£ç ä¸­, it2å®é™…å¯èƒ½è¿˜æ˜¯æŒ‡å‘ä¸€ä¸ªå…ƒç´ çš„, (å®é™…VS debugä¸­, it2æŒ‡å‘äº†ç¬¬ä¸‰ä¸ªå…ƒç´ , ä¹Ÿå°±æ˜¯3)<br>it2å¹¶æœªå¤±æ•ˆ, å®ƒä¾æ—§æŒ‡å‘ä¸€å—å†…å­˜,(è‡³å°‘åœ¨VS debugä¸­è¿™æ ·) ä½†æ˜¯è¿™æ˜¯å—<strong>ä¸è¯¥å®ƒå æœ‰çš„å†…å­˜</strong><br>æŒ‰ç…§ä¸Šè¿°æˆ‘ä»¬å¯¹æº¢å‡º/è¶Šç•Œçš„å®šä¹‰, è¿™ç§é—®é¢˜å±äºæº¢å‡º  </p>
<p>ä½†æ˜¯å¾ˆå¯æƒœ, æŠ¥é”™ä¿¡æ¯æ˜¯:<br>â€œvector erase iterator outside rangeâ€<br>emmmmmmmmmm, ä¹Ÿå°±æ˜¯è¯´, å®ƒè®¤ä¸ºè¿™æ˜¯è¶Šç•Œâ€¦<br>æ‰€ä»¥æˆ‘çš„ç†è§£å¯èƒ½æ˜¯é”™çš„, ä½†æ˜¯æˆ‘è¿˜æ˜¯è®¤ä¸ºè¿™æ ·å­ç†è§£æ²¡æœ‰ä»€ä¹ˆé—®é¢˜(å¤§æ¦‚â€¦ :) )</p>
<p>æˆ–è®¸è¿™æ ·è¯´æ›´å¥½, æœ‰ç¬¦å·æ•°, åªæœ‰7ä½æ•°å€¼, ä¸¤ä¸ª7ä½æ•°å€¼æ— è®ºå¦‚ä½•è®¡ç®—ä¹Ÿä¸ä¼šè¶…è¿‡8ä½<br>è€Œæ— ç¬¦å·æ•°, 8ä½æ•°å€¼, è®¡ç®—æ˜¯å¯èƒ½è¶…è¿‡8ä½çš„</p>
]]></content>
  </entry>
  <entry>
    <title>other/CreatesoFileinLinux</title>
    <url>/2020/01/10/other/CreatesoFileinLinux/</url>
    <content><![CDATA[<h3 id="Step"><a href="#Step" class="headerlink" title="Step"></a>Step</h3><ol>
<li>ç¼–å†™åŠ¨æ€åº“æºæ–‡ä»¶  </li>
<li>å°†åŠ¨æ€åº“æºæ–‡ä»¶ç¼–è¯‘é“¾æ¥ç”ŸæˆåŠ¨æ€åº“æ–‡ä»¶  </li>
<li>åœ¨æ‰§è¡Œæºæ–‡ä»¶ä¸­æ·»åŠ å¤´æ–‡ä»¶å£°æ˜  </li>
<li>ä½¿ç”¨åŠ¨æ€åº“æ–‡ä»¶  </li>
</ol>
<hr>
<h4 id="Step1"><a href="#Step1" class="headerlink" title="Step1:"></a>Step1:</h4><p>â€¦</p>
<h4 id="Step2"><a href="#Step2" class="headerlink" title="Step2:"></a>Step2:</h4><pre><code>gcc/g++ -fPIC -shared -o [libname].so [sourcefile]</code></pre><p>example:  </p>
<pre><code>gcc -fPIC -shared -o tlib.so tlib.c</code></pre><p>è¿™æ ·å°±ä¼šç”Ÿæˆä¸€ä¸ª<code>tlib.so</code>çš„åŠ¨æ€åº“æ–‡ä»¶<br>å…¶ä¸­<code>-fPIC</code>çš„å«ä¹‰æ˜¯: Position Independent Code (ä½ç½®æ— å…³ä»£ç )</p>
<h4 id="Step3"><a href="#Step3" class="headerlink" title="Step3:"></a>Step3:</h4><p>æ·»åŠ å£°æ˜å¯ä»¥åœ¨å•ç‹¬çš„å¤´æ–‡ä»¶ä¸­æ·»åŠ , ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä½¿ç”¨çš„æºæ–‡ä»¶å†…æ·»åŠ   </p>
<h4 id="Step4"><a href="#Step4" class="headerlink" title="Step4:"></a>Step4:</h4><pre><code>gcc t.c -L. tlib.so  </code></pre><p>ä¼šç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„<code>a.out</code>å¯æ‰§è¡Œæ–‡ä»¶  </p>
<p>æ­¤æ—¶è¿˜æœ‰ä¸€ä¸ªé—®é¢˜å°±æ˜¯ç›´æ¥è¿è¡Œçš„è¯ä¼šæŠ¥é”™:<br>åº”ç”¨ç¨‹åºæ‰¾ä¸åˆ°<code>.so</code>æ–‡ä»¶<br>è§£å†³æ–¹æ³•æœ‰ä¸¤ç§, ä¸€ç§æ˜¯æ”¹ç³»ç»Ÿæ–‡ä»¶, å¦å¤–ä¸€ç§æ˜¯ä¸´æ—¶å‘Šè¯‰shellåŠ¨æ€åº“çš„è·¯å¾„<br>å› ä¸ºè¿™ä¸ªæ˜¯æµ‹è¯•ç”¨ä¾‹, ä»‹ç»ç¬¬äºŒç§  </p>
<pre><code>LD_LIBRARY_PATH=. ./a.out  </code></pre><p>æ‰§è¡Œæ­¤å‘½ä»¤å¯ä»¥è§£å†³æŠ¥é”™é—®é¢˜, å…¶ä¸­<code>LD_LIBRARY_PATH=.</code>çš„å«ä¹‰æ˜¯:<br>å‘Šè¯‰shell, åº“çš„è·¯å¾„åœ¨å½“å‰è·¯å¾„ä¸‹(å¦‚æœåº“æ”¾åœ¨åˆ«çš„è·¯å¾„, å°†<code>.</code>æ›¿æ¢å³å¯)  </p>
<p>ä»¥ä¸Šç»éªŒæ¥è‡ª<a href="https://www.cnblogs.com/jiqingwu/p/linux_dynamic_lib_create.html" target="_blank" rel="noopener">åšå®¢å›­</a>  </p>
<hr>
<p>é¡ºä¾¿: ç¬¬ä¸€æ¬¡å†™äº†<code>makefile</code>, ç”¨ä½œä¸Šè¿°çš„åŠ¨æ€åº“ç®¡ç†  </p>
<blockquote>
<p>make build: ç”ŸæˆåŠ¨æ€åº“, å¯æ‰§è¡Œæ–‡ä»¶<br>make doit: æ‰§è¡Œç¨‹åº(å¦‚æœæ–‡ä»¶å¹¶ä¸å­˜åœ¨, å…ˆç”Ÿæˆæ–‡ä»¶)<br>make clean: æ¸…é™¤ç”Ÿæˆçš„æ–‡ä»¶</p>
</blockquote>
<pre><code> 1 build: tlib.so a.out
 2 
 3 tlib.so: tlib.c
 4           gcc -fPIC -shared -o $@ $&lt;
 5 
 6 a.out: t1.c
 7           gcc $&lt; -L. tlib.so
 8 
 9 doit: build 
10           LD_LIBRARY_PATH=. ./a.out
11 
12 file = tlib.so a.out
13 clean: 
14           rm $(file)</code></pre><p>ä¹¦å†™makedileå’Œæ ¸å¿ƒå°±æ˜¯ææ¸…æ¥šä¾èµ–å…³ç³»<br>å…¶ä¸­<code>build</code>ä¸ºåˆ›å»ºåŠ¨æ€åº“å’Œå¯æ‰§è¡Œæ–‡ä»¶, æ‰€ä»¥ä¾èµ–äº<code>tlib.so</code>å’Œ<code>a.out</code><br>è€Œ<code>tlib.so</code>ä¾èµ–äº<code>tlib.c</code>, <code>a.out</code>ä¾èµ–äº<code>t1.c</code><br>â€¦</p>
<p>æœ‰ä¸€ä»½<a href="https://www.kancloud.cn/kancloud/make-command/45593" target="_blank" rel="noopener">makeæ•™ç¨‹</a></p>
<p>ä¸Šè¿°æ‰€ç”¨åˆ°çš„åŸºç¡€makefileè§„åˆ™å¹¶ä¸éš¾ç†è§£, è¿™é‡Œä¸åšèµ˜è¿°  </p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/234PalindromeLinkedList</title>
    <url>/2020/01/10/leetcode/234PalindromeLinkedList/</url>
    <content><![CDATA[<h2 id="234-Palindrome-Linked-List"><a href="#234-Palindrome-Linked-List" class="headerlink" title="234 Palindrome Linked List"></a>234 Palindrome Linked List</h2><p><img src="https://imgur.com/NFvwG9E.png" alt=""></p>
<p>åˆ¤æ–­é“¾è¡¨æ˜¯å¦æ˜¯å›æ–‡é“¾è¡¨, å¯ä»¥çš„è¯, O(n)æ—¶é—´å¤æ‚åº¦, O(1)ç©ºé—´å¤æ‚åº¦.</p>
<p>Determine whether the given single-linked list is a palindrome linked list.</p>
<p>Flow up: O(n) time and O(1) space.</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>å•é“¾è¡¨, æ—¶é—´O(n), ç©ºé—´O(1), åŒæ—¶æ»¡è¶³æœ‰ç‚¹éš¾å•Š = = â€¦ </p>
<p>Itâ€™s a little difficult to solve this question with both O(n) time and O(1) space.</p>
<p>æˆ‘èƒ½ç›¸å‡ºçš„åŠæ³•ä»…åœ¨çŸ¥é“é“¾è¡¨é•¿åº¦/é“¾è¡¨å°¾èŠ‚ç‚¹çš„æƒ…å†µä¸‹é€‚ç”¨.</p>
<p>I can solve this if I know the length of the linked list</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">int</span> n = <span class="number">0</span>;</span><br><span class="line">            ListNode* <span class="built_in">cursor</span> = head;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">cursor</span>) &#123;</span><br><span class="line">                ++n;</span><br><span class="line">                <span class="built_in">cursor</span> = <span class="built_in">cursor</span>-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">            ListNode *prev = head;</span><br><span class="line">            LisTNode *next = prev-&gt;next;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n / <span class="number">2</span>; ++i) &#123;</span><br><span class="line">                ListNode *tmp = next-&gt;next;</span><br><span class="line">                next-&gt;next = prev;</span><br><span class="line"></span><br><span class="line">                prev = next;</span><br><span class="line">                next = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// // this methond redirect two nodes in one cycle</span></span><br><span class="line">            <span class="comment">// cursor = head;</span></span><br><span class="line">            <span class="comment">// ListNode *prev = nullptr;</span></span><br><span class="line">            <span class="comment">// LisTNode *next = cursor-&gt;next;</span></span><br><span class="line">            <span class="comment">// for (int i = 1; i &lt; n / 2; ++i) &#123;</span></span><br><span class="line">            <span class="comment">//     cursor-&gt;next = prev;</span></span><br><span class="line">            <span class="comment">//     ListNode *tmp = next-&gt;next;</span></span><br><span class="line">            <span class="comment">//     next-&gt;next = cursor;</span></span><br><span class="line">            <span class="comment">//     </span></span><br><span class="line">            <span class="comment">//     prev = next;</span></span><br><span class="line">            <span class="comment">//     cursor = tmp;</span></span><br><span class="line">            <span class="comment">//     next = cursor-&gt;next;</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (n &amp; <span class="number">1</span>)</span><br><span class="line">                next = next-&gt;next;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (next) &#123;</span><br><span class="line">                <span class="keyword">if</span> (next-&gt;val != prev-&gt;val)</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                next = next-&gt;next;</span><br><span class="line">                prev = prev-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>çŸ¥é“äº†èŠ‚ç‚¹é•¿åº¦çš„è¯, ä¸æ–­åå‘èŠ‚ç‚¹, ç›´åˆ°åˆ°è¾¾ä¸­é—´èŠ‚ç‚¹, ç„¶åä»ä¸­é—´èŠ‚ç‚¹å‘ä¸¤ç«¯å¯¹æ¯”å°±å¥½äº†, ä¸¤æ¬¡å¾ªç¯å„éå†ä¸€åŠçš„èŠ‚ç‚¹. æ‰€ä»¥è¿˜ç®— O(1), ç©ºé—´åªéœ€è¦å¿…é¡»çš„ç”¨äºéå†çš„èŠ‚ç‚¹, O(1)ä¹Ÿæ»¡è¶³. ä½†é—®é¢˜å°±æ˜¯è¿™æ˜¯èŠ‚ç‚¹é•¿åº¦çš„æƒ…å†µä¸‹. æ‰€ä»¥å¾ˆå¥½å¥‡ä»€ä¹ˆç®—æ³•å¯ä»¥æ»¡è¶³è¿™ä¸¤ä¸ªéœ€æ±‚. (å…¶å®çœ‹äº†ä¹‹åæ„Ÿè§‰ = = , emmmâ€¦ æ²¡æœ‰å¾ˆæƒŠè‰³)</p>
<p>If know the length of the linked list, reverse nodes until the center of the linked list, then compare elements between the center node. </p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isPalindrome</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!head || !head-&gt;next) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        ListNode* slow = head;</span><br><span class="line">        ListNode* fast = head;</span><br><span class="line">        <span class="keyword">while</span> (fast-&gt;next &amp;&amp; fast-&gt;next-&gt;next) &#123;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">            fast = fast-&gt;next-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        slow-&gt;next = reverseList(slow-&gt;next);</span><br><span class="line">        slow = slow-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (slow) &#123;</span><br><span class="line">            <span class="keyword">if</span> (head-&gt;val != slow-&gt;val) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">            slow = slow-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseList</span><span class="params">(ListNode* head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (head == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* currentHead = head;</span><br><span class="line">        <span class="keyword">while</span> (head-&gt;next) &#123;</span><br><span class="line">            ListNode* p = head-&gt;next;</span><br><span class="line">            head-&gt;next = p-&gt;next;</span><br><span class="line">            p-&gt;next = currentHead;</span><br><span class="line">            currentHead = p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> currentHead;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åŠæ³•å‡ ä¹å’Œæˆ‘ç›¸åŒ, æ ¸å¿ƒå°±æ˜¯é‚£ä¸ªä¸­é—´èŠ‚ç‚¹, ç»“æœæ˜¯ç”¨è¿™ç§æ–¹æ³•æ¥è§£å†³çš„â€¦ æ€ä¹ˆæ²¡æƒ³åˆ°å‘¢ = =, å­¦åˆ°äº†å­¦åˆ°äº†â€¦ </p>
<p>è¿˜æœ‰å°±æ˜¯, æˆ‘åœ¨å¥‡å¶é•¿åº¦ä¸ŠèŠ±äº†äº›å¿ƒæ€, æ‰€ä»¥ä» 1 å¼€å§‹å¾ªç¯, å¹¶ä¸”å¯¹ä¸¤ç§æƒ…å†µåšäº†å¤„ç†. </p>
<p>ä½†æ˜¯è¿™ç§æ–¹æ³•çš„è¯, å› ä¸ºå¹¶ä¸æ˜¯ç”±å†…å‘å¤–, æ‰€ä»¥å¥‡å¶ä¸é‡è¦, ä¹Ÿä¸éœ€è¦é¢å¤–çš„ä»£ç æ¥å¤„ç†äº†. </p>
]]></content>
  </entry>
  <entry>
    <title>other/gdb</title>
    <url>/2020/01/09/other/gdb/</url>
    <content><![CDATA[<h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><p>gdbæ˜¯ä¸€ä¸ª c/c++ debug å·¥å…·</p>
<p>æ²¡æœ‰ä¸€ä¸ªæ•™ç¨‹å’Œæ–‡æ¡£æ¯” gdb å®˜æ–¹æ‰‹å†Œæ›´åŠ è¯¦ç»†å’Œå‡†ç¡®</p>
<p>è¿™ä¸ªæ–‡ä»¶åªæ˜¯ç®€å•åœ°ä»‹ç»å…¶ä¸­ä¸€å°éƒ¨åˆ†é¢‘ç¹ä½¿ç”¨çš„åŠŸèƒ½, å…·ä½“éœ€è¦ç»“åˆ gdb<br>çš„å®˜æ–¹æ–‡æ¡£ä½¿ç”¨</p>
<p>(gdbéå¸¸å¼ºå¤§, å…¶æ–‡æ¡£æœ‰400å¤šé¡µ, å®Œå…¨æ˜¯ä¸€æœ¬å‚è€ƒä¹¦çš„è§„æ ¼)</p>
<p>( åŒæ—¶gdbä¹Ÿåšåˆ°äº†é€æ˜, å¤§å¤šæ•°æ—¶å€™ä½ ä½¿ç”¨å®ƒåªéœ€æŒæ¡æå°‘çš„å‡ æ¡æŒ‡ä»¤(åŸºç¡€åŠŸèƒ½ä¸­çš„æŒ‡ä»¤) )</p>
<h3 id="åŸºç¡€åŠŸèƒ½"><a href="#åŸºç¡€åŠŸèƒ½" class="headerlink" title="åŸºç¡€åŠŸèƒ½"></a>åŸºç¡€åŠŸèƒ½</h3><h4 id="n-next"><a href="#n-next" class="headerlink" title="n : next"></a>n : next</h4><p>ç”¨äºè·³è½¬åˆ°ä¸‹ä¸€æ¡è¯­å¥, åŒæ—¶ä¼šå…ˆæ‰§è¡Œå½“å‰è¯­å¥, å¯é…åˆ number è·³è½¬å¤šè¡Œ</p>
<h4 id="s-step"><a href="#s-step" class="headerlink" title="s : step"></a>s : step</h4><p>è¿›å…¥å‡½æ•°è°ƒç”¨</p>
<h4 id="b-break"><a href="#b-break" class="headerlink" title="b : break"></a>b : break</h4><p>æ–­ç‚¹</p>
<h4 id="c-continue"><a href="#c-continue" class="headerlink" title="c : continue"></a>c : continue</h4><p>ç»§ç»­æ‰§è¡Œ</p>
<h4 id="p-print"><a href="#p-print" class="headerlink" title="p : print"></a>p : print</h4><p>æ‰“å°å˜é‡ä¿¡æ¯, ptype å¯ä»¥æ‰“å°ç±»å‹ä¿¡æ¯(ç”¨äºç±», å®ƒä¼šå°†ç±»çš„æ‰€æœ‰æˆå‘˜éƒ½æ‰“å°å‡ºæ¥)</p>
<h4 id="l-ï¼šlist"><a href="#l-ï¼šlist" class="headerlink" title="l ï¼šlist"></a>l ï¼šlist</h4><p>æŸ¥çœ‹å½“å‰è¡Œé™„è¿‘çš„ä»£ç ä¿¡æ¯, å¯ä»¥æŒ‡å®šè¡Œå·å’Œå‡½æ•°, å¯ä»¥ç”¨äºè·³è½¬åˆ°æŒ‡å®šæ–‡ä»¶</p>
<h4 id="bt-backtrace"><a href="#bt-backtrace" class="headerlink" title="bt : backtrace"></a>bt : backtrace</h4><p>è°ƒç”¨å›æº¯, æŸ¥çœ‹å½“å‰è°ƒç”¨æ ˆ</p>
<h4 id="f-frame"><a href="#f-frame" class="headerlink" title="f : frame"></a>f : frame</h4><p>ä¸ bt çš„ä¿¡æ¯é…åˆ, ä½¿ç”¨ number æŒ‡å®šè·³è½¬åˆ°æŸæ¡å‡½æ•°è°ƒç”¨ä¹‹å‰</p>
<h4 id="info"><a href="#info" class="headerlink" title="info"></a>info</h4><p>è¿™æ¡æŒ‡ä»¤ç”¨äºè§‚å¯ŸgdbæŒ‡ä»¤çš„å½“å‰ä¿¡æ¯  </p>
<p>ä¾‹å¦‚: info breakpoints, info frame, info watchpoints, info recordâ€¦ </p>
<h4 id="u-until"><a href="#u-until" class="headerlink" title="u : until"></a>u : until</h4><p>è·³å‡ºå½“å‰å¾ªç¯, æˆ–è€…é…åˆ number æŒ‡å®šæ‰§è¡Œåˆ°ä½•å¤„</p>
<h4 id="finish"><a href="#finish" class="headerlink" title="finish"></a>finish</h4><p>å®Œæˆå½“å‰å‡½æ•°è°ƒç”¨, è·³è½¬åˆ°å‡½æ•°è°ƒç”¨çš„æœ€åä¸€æ¡è¯­å¥</p>
<h3 id="ä¸­çº§åŠŸèƒ½"><a href="#ä¸­çº§åŠŸèƒ½" class="headerlink" title="ä¸­çº§åŠŸèƒ½"></a>ä¸­çº§åŠŸèƒ½</h3><h4 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h4><p>è§‚å¯Ÿç‚¹, å¯ä»¥ç”¨æ¥è§‚å¯Ÿä¸€ä¸ªå˜é‡æˆ–è€…è¡¨è¾¾å¼çš„å˜åŒ–</p>
<h4 id="checkpoint"><a href="#checkpoint" class="headerlink" title="checkpoint"></a>checkpoint</h4><p>æ£€æŸ¥ç‚¹ç”¨æ¥ä¿å­˜å½“å‰è¿›åº¦, å¯ä»¥åœ¨æ‰§è¡Œè‹¥å¹²è¯­å¥ä¹‹åå›åˆ°å½“å‰æ£€æŸ¥ç‚¹</p>
<h4 id="record"><a href="#record" class="headerlink" title="record"></a>record</h4><p>è®°å½•å‘½ä»¤çš„ä½¿ç”¨ä¿¡æ¯, å®ç”¨ä¹‹å¤„åœ¨äº: ä½¿ç”¨å…¶ä¸­çš„ full æ¨¡å¼, å¯ä»¥å®ç° reverse æ“ä½œ</p>
<p>æ¯”å¦‚ reverse-next, è¿™å°†ä¼šåå‘æ‰§è¡Œåˆ°ä¸Šä¸€ä¸ªè¯­å¥</p>
<h4 id="forward-search-search"><a href="#forward-search-search" class="headerlink" title="forward-search/search"></a>forward-search/search</h4><p>å‰å‘æœç´¢/æœç´¢</p>
<h4 id="inferior"><a href="#inferior" class="headerlink" title="inferior"></a>inferior</h4><p>gdbæ”¯æŒdebugå¤šä¸ªè¿›ç¨‹</p>
<h4 id="thread"><a href="#thread" class="headerlink" title="thread"></a>thread</h4><p>gdbæ”¯æŒdebugå¤šçº¿ç¨‹ç¨‹åº</p>
<h4 id="catch"><a href="#catch" class="headerlink" title="catch"></a>catch</h4><p>æ•è·ä¸€ä¸ªäº‹ä»¶</p>
<h4 id="singal"><a href="#singal" class="headerlink" title="singal"></a>singal</h4><p>æ•è·ä¸€ä¸ªä¿¡å·</p>
<h4 id="win-winheight"><a href="#win-winheight" class="headerlink" title="win  : winheight"></a>win  : winheight</h4><p>è¿›å…¥å¯è§†åŒ–æ¨¡å¼, ç®€å•æ¥è¯´å°±æ˜¯ä»£ç ç•Œé¢æ‹¥æœ‰äº†çª—å£, åŒæ—¶ä¸€ç³»åˆ—ä¿¡æ¯ä¹Ÿä¼šæ˜¾ç¤ºåœ¨ä¸Šé¢</p>
<p>(ä¸è¿‡è¿™ä¸ªæ¨¡å¼å®é™…ä¸Šä¼šå‡ºç°ä¼šæ˜¾ç¤ºé”™è¯¯, æ¯”å¦‚ä¼šæ˜¾ç¤ºåˆ é™¤ç¬¦å·, æ˜¾ç¤ºtabé”®ä¹‹ç±»çš„é—®é¢˜, æˆ‘ä¸çŸ¥é“è¿™ç®—ä¸ç®—bugâ€¦)</p>
<p>(æˆ–è®¸æˆ‘ä½¿ç”¨æ–¹å¼ä¸å¯¹? )</p>
<h4 id="e-edit"><a href="#e-edit" class="headerlink" title="e : edit"></a>e : edit</h4><p>ä½ å¯ä»¥åœ¨ gdb ä¸­ç›´æ¥æ›´æ”¹æºæ–‡ä»¶, ä¸è¿‡è¿™å¥½åƒæœ‰ç‚¹é¸¡è‚‹â€¦</p>
<h4 id="disassemble"><a href="#disassemble" class="headerlink" title="disassemble"></a>disassemble</h4><p>åç¼–è¯‘ä»£ç , æ˜¾ç¤º machine code</p>
<h4 id="diaplay"><a href="#diaplay" class="headerlink" title="diaplay"></a>diaplay</h4><p>è‡ªåŠ¨æ˜¾ç¤ºå˜é‡</p>
<h4 id="set-convenience-variable"><a href="#set-convenience-variable" class="headerlink" title="set (convenience variable)"></a>set (convenience variable)</h4><p>ä½¿ç”¨è¯¥æŒ‡ä»¤å¯ä»¥ä¿å­˜å˜é‡, ä¹‹åä½ å¯ä»¥ç”¨åœ¨ä»»ä½•å‘½ä»¤çš„è¡¨è¾¾å¼é‡Œé¢, è®°å¾—å‰é¢åŠ ç¾å…ƒ($)å‰ç¼€</p>
<pre><code>(gdb) set {int}0x604010 = 4
(gdb) p v[0]
$16 = (__gnu_cxx::__alloc_traits&lt;std::allocator&lt;int&gt; &gt;::value_type &amp;) @0x604010: 4
(gdb) set {int}0x604010 = 5
(gdb) p v[0]
$17 = (__gnu_cxx::__alloc_traits&lt;std::allocator&lt;int&gt; &gt;::value_type &amp;) @0x604010: 5</code></pre><p>å®ƒå¯ä»¥ç”¨äºå¯¹å†…å­˜èµ‹å€¼!!!</p>
<pre><code>(gdb) p $rbx
$18 = 1
(gdb) set $rbx = 200
(gdb) p $rbx
$19 = 200</code></pre><p>ä¹Ÿå¯ä»¥ç”¨äºå¯¹å¯„å­˜å™¨èµ‹å€¼!!!</p>
<h4 id="convenience-function-10-12"><a href="#convenience-function-10-12" class="headerlink" title="convenience function (10.12)"></a>convenience function (10.12)</h4><p>gdbæä¾›äº†ä¸€ç³»åˆ—çš„å‡½æ•°ä»¥ä¾›ä½¿ç”¨, ä¾‹å¦‚:</p>
<pre><code>$_strlen(str)     $_streq(str1, str2)      $_regex(str, regex) </code></pre><p>å‰é¢ä¾æ—§è¦åŠ  â€˜$â€™ ç¬¦å·</p>
<h4 id="register-è¿™ä¸ªæˆ‘è¶…å–œæ¬¢çš„-10-13"><a href="#register-è¿™ä¸ªæˆ‘è¶…å–œæ¬¢çš„-10-13" class="headerlink" title="register (è¿™ä¸ªæˆ‘è¶…å–œæ¬¢çš„) (10.13)"></a>register (è¿™ä¸ªæˆ‘è¶…å–œæ¬¢çš„) (10.13)</h4><p>è¿™ä¸ªæŒ‡ä»¤æ”¯æŒä½ æŸ¥çœ‹å¯„å­˜å™¨çš„å†…å®¹, ä½¿ç”¨æ–¹æ³•æ˜¯</p>
<pre><code>p $register</code></pre><p>(è¿™ä¸ªæˆ–è®¸åº”è¯¥æ”¾åœ¨ p ä¸­, ä¸è¿‡æˆ‘è§‰å¾—è¿™åº”è¯¥æ”¾åœ¨é«˜çº§å†…å®¹ä¸­)</p>
<p>æˆ‘ä¾ç¨€è®°å¾—ä¹‹å‰æˆ‘æ›¾ç»å› ä¸ºæ— æ³•åœ¨è¿è¡Œæ—¶çœ‹å†…å­˜å†…å®¹è€Œè‹¦æ¼  </p>
<p>ç°åœ¨è¿™ä¸ªé—®é¢˜éšç€gdbçš„æ·±å…¥å­¦ä¹ è€Œè§£å†³äº†, ä»¥åæˆ‘åˆ†ææ±‡ç¼–çš„æ—¶å€™, å¯ä»¥æ›´åŠ æ·±å…¥äº†</p>
<p>å¹¶ä¸”æ”¯æŒä½¿ç”¨ set æ¥æ”¹å˜å†…å®¹!!</p>
<h4 id="info-os-args"><a href="#info-os-args" class="headerlink" title="info os [args]"></a>info os [args]</h4><p>æŸ¥çœ‹ç³»ç»Ÿç›¸å…³ä¿¡æ¯, æ¯”å¦‚:</p>
<pre><code>info os files</code></pre><p>å°†ä¼šæŸ¥çœ‹ç³»ç»Ÿä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦çš„ä¿¡æ¯</p>
<h4 id="trace-13"><a href="#trace-13" class="headerlink" title="trace (13)"></a>trace (13)</h4><p>æŒ‰ç…§ gdb å®˜æ–¹æ–‡æ¡£çš„æè¿°, è¿™ä¸ªæŒ‡ä»¤æ˜¯ç”¨æ¥è°ƒè¯•é‚£äº›å¯¹äºå®æ—¶æ€§æœ‰è¦æ±‚çš„ç¨‹åº  </p>
<p>ä½†æ˜¯æˆ‘ä¹Ÿæ²¡èƒ½ç†è§£è¿™ä¸ªæŒ‡ä»¤æ˜¯å¦‚ä½•ä½¿ç”¨çš„, åŒæ—¶æœ‰è¿™ä¹ˆä¸€å¥è¯</p>
<pre><code>The tracepoint facility is currently available only for remote targets
è¿½æº¯ç‚¹å½“å‰åªå¯¹è¿œç¨‹ç›®æ ‡æœ‰æ•ˆ</code></pre><p>è¿™ä¸ªæŒ‡ä»¤çš„å†…å®¹å äº†æ•´ä¸ª 13 ç« èŠ‚, åº”è¯¥ç›¸å½“é‡è¦. æ‰€ä»¥è¿™é‡Œä»…ä»…è®°å½•ä¸€ä¸‹, æˆ–è®¸ä»¥åä¼šç”¨åˆ°</p>
<pre><code>14 Debugging Programs That Use Overlays</code></pre><p>=========</p>
<p>åç»­å†…å®¹(ä» 13 ç« å¾€å)æ˜¯ä¸€äº›é«˜çº§å†…å®¹(ä»¥ç½®äºæˆ‘ä¸å¾—ä¸å°†è¿™æ®µä¸»é¢˜çš„æ ‡é¢˜æ”¹æˆä¸­çº§åŠŸèƒ½â€¦)</p>
<p>æ¯”å¦‚å¤§å‹ç¨‹åº, è¿œç¨‹è°ƒè¯• â€¦ </p>
<p>æš‚ä¸ç ”ç©¶</p>
<h3 id="other"><a href="#other" class="headerlink" title="other"></a>other</h3><p>æºè‡ª<a href="http://www.waider.ie/music/lyrics/gdb.html" target="_blank" rel="noopener">http://www.waider.ie/music/lyrics/gdb.html</a></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">GDB!</span><br><span class="line">based on _Tragedy_ by Barry, Robin <span class="keyword">and</span> Maurice Gibb</span><br><span class="line"></span><br><span class="line">Here<span class="number">'</span>s vi</span><br><span class="line">In a lost <span class="keyword">and</span> lonely part of code</span><br><span class="line">Held in time</span><br><span class="line">In a world of bugs my head explodes</span><br><span class="line">Goin<span class="number">'</span> <span class="built_in">home</span></span><br><span class="line">I just can<span class="number">'</span>t make it all alone</span><br><span class="line">I really should be coding you, coding you</span><br><span class="line"><span class="built_in">running</span> you, <span class="built_in">running</span> you</span><br><span class="line"></span><br><span class="line">CHORUS:</span><br><span class="line">GDB when the program<span class="number">'</span>s wrong <span class="keyword">and</span> the debug<span class="number">'</span>s on</span><br><span class="line">It<span class="number">'</span>s GDB when the system dies <span class="keyword">and</span> you don<span class="number">'</span>t know why</span><br><span class="line">It<span class="number">'</span>s hard to bear</span><br><span class="line">With no one to help you</span><br><span class="line">You're going nowhere</span><br><span class="line">GDB when you <span class="built_in">press</span> control <span class="keyword">and</span> the box just rolls</span><br><span class="line">It<span class="number">'</span>s GDB when the system dies <span class="keyword">and</span> you don<span class="number">'</span>t know why</span><br><span class="line">It<span class="number">'</span>s hard to bear</span><br><span class="line">With no one beside you</span><br><span class="line">You're going nowhere</span><br><span class="line"></span><br><span class="line">Night <span class="keyword">and</span> Day</span><br><span class="line">There<span class="number">'</span>s a burning down inside of me</span><br><span class="line">Burning code</span><br><span class="line">And a kernel that won<span class="number">'</span>t let me be</span><br><span class="line">Down it goes</span><br><span class="line"><span class="keyword">and</span> I just can<span class="number">'</span>t take it all alone</span><br><span class="line">I really should be coding you, coding you</span><br><span class="line">Running you, <span class="built_in">running</span> you</span><br><span class="line"></span><br><span class="line">REPEAT CHORUS</span><br><span class="line"></span><br><span class="line"><span class="function">REPEAT <span class="title">CHORUS</span><span class="params">(fade)</span></span></span><br></pre></td></tr></table></figure>
<p>æºè‡ª<a href="https://www.gnu.org/music/gdb-song.html" target="_blank" rel="noopener">https://www.gnu.org/music/gdb-song.html</a></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">Let<span class="number">'</span>s start at the very beginning, a very good place to start,</span><br><span class="line">When you're learning to sing, its Do, Re, Mi; </span><br><span class="line">When you're learning to code, its G, D, B. </span><br><span class="line">(<span class="built_in">background</span>) G, D, B.</span><br><span class="line"></span><br><span class="line">The first three letters just happen to be, G, D, B.</span><br><span class="line"></span><br><span class="line">(<span class="built_in">background</span>) G, D, B.</span><br><span class="line"></span><br><span class="line">(Chorus)</span><br><span class="line"></span><br><span class="line">G!,</span><br><span class="line">GNU!, it<span class="number">'</span>s Stallman<span class="number">'</span>s hope,</span><br><span class="line">D,</span><br><span class="line">a <span class="keyword">break</span> I <span class="built_in">set</span> myself.</span><br><span class="line">B,</span><br><span class="line">debug that rotten code,</span><br><span class="line">Run,</span><br><span class="line">a far, far way to go.</span><br><span class="line">Print,</span><br><span class="line">to see what you have done,</span><br><span class="line">Set,</span><br><span class="line">a patch that follows <span class="built_in">print</span>.</span><br><span class="line">Quit,</span><br><span class="line"><span class="keyword">and</span> recompile your code - - -</span><br><span class="line">That will bring it back to G,</span><br><span class="line">                              D,</span><br><span class="line">                                 B,</span><br><span class="line">                                    &lt;link&gt;</span><br><span class="line">(Resume from the Chorus)</span><br></pre></td></tr></table></figure>
<p>æ„Ÿè§‰, å—¯, å¾ˆæœ‰æ°”åŠ¿</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/48RotateImage</title>
    <url>/2020/01/09/leetcode/48RotateImage/</url>
    <content><![CDATA[<h1 id="Rotate-Image"><a href="#Rotate-Image" class="headerlink" title="Rotate Image"></a>Rotate Image</h1><p><img src="https://i.imgur.com/7hLPAwu.png" alt="">  </p>
<blockquote>
<p>é¡ºæ—¶é’ˆ90åº¦æ—‹è½¬çŸ©é˜µ<br>è¦æ±‚å°±åœ°æ›´æ”¹(ä¸èƒ½åˆ›å»ºå¦å¤–ä¸€ä¸ªçŸ©é˜µ)</p>
</blockquote>
<h2 id="æˆ‘çš„åšæ³•"><a href="#æˆ‘çš„åšæ³•" class="headerlink" title="æˆ‘çš„åšæ³•"></a>æˆ‘çš„åšæ³•</h2><p>æ€è·¯:  </p>
<blockquote>
<p>ä½¿ç”¨ä¸‹æ ‡æ¥è·å–å…ƒç´ æ›´æ–¹ä¾¿<br>ä»å¤–å±‚åˆ°å†…å±‚, ä¸€å±‚å±‚æ—‹è½¬, æ¯æ¬¡æ—‹è½¬nä¸ª, æ¯å±‚æ—‹è½¬4æ¬¡<br>ä¸å¯é¿å…éœ€è¦ä¿å­˜ä¸€ç»„æ•°å€¼  </p>
</blockquote>
<p>å…·ä½“ä»£ç :  </p>
<pre><code>class Solution {
public:
    void rotate(vector&lt;vector&lt;int&gt;&gt;&amp; matrix) {
        int n = matrix.size();

        for (int i = 0; i &lt; n / 2; ++i){
            // backup first stream
            vector&lt;int&gt; backup ((matrix.begin() + i)-&gt;begin() + i + 1, 
                (matrix.begin() + i)-&gt;end() - i);

                for (int col = i + 1, row = n - i - 2; col &lt; n - i; ++col, --row)
                    matrix[i][col] = matrix[row][i];

                for (int row = i, col = i; row &lt; n - i - 1; ++row, ++col)
                    matrix[row][i] = matrix[n - 1 - i][col];

                for (int col = i, row = n - i - 1; col &lt; n - i - 1; ++col, --row)
                    matrix[n - 1 - i][col] = matrix[row][n - i - 1];

                for (int row = n - 1 - i, t = backup.size() - 1; t &gt;= 0; --row, --t)
                    matrix[row][n - i - 1] = backup[t];
        }
    }
};</code></pre><p>æœ€åç»“æœ:  </p>
<p><img src="https://i.imgur.com/IgjHagZ.png" alt="">  </p>
<h2 id="dalaoçš„åšæ³•"><a href="#dalaoçš„åšæ³•" class="headerlink" title="dalaoçš„åšæ³•"></a>dalaoçš„åšæ³•</h2><pre><code>class Solution {
public:
    void swapLR(vector&lt;vector&lt;int&gt;&gt;&amp; matrix) {
        int n = matrix.size();
        for (int i = 0; i &lt; n; i++) {
            int l = 0;
            int r = n-1;
            while(l&lt;r) {
                int temp = matrix[i][l];
                matrix[i][l++] = matrix[i][r];
                matrix[i][r--] = temp;
            }
        }
    }

    void swapdig(vector&lt;vector&lt;int&gt;&gt;&amp; matrix) {
        int n = matrix.size();
        for (int i = 0; i &lt; n-1; i++) {
            for (int j = 0; j &lt; n-1-i; j++) {
                int temp = matrix[i][j];
                matrix[i][j] = matrix[n-1-j][n-1-i];
                matrix[n-1-j][n-1-i] = temp;
            }
        }
    }

    void rotate(vector&lt;vector&lt;int&gt;&gt;&amp; matrix) {
        swapLR(matrix);
        swapdig(matrix);
    }
};</code></pre><p>é¦–å…ˆåˆ†æ swapLR å‡½æ•°:  </p>
<blockquote>
<p>emmmm, å®ƒå¥½åƒå°†å·¦å³çš„æ•°æ®å¯¹æ¢äº†<br><img src="https://i.imgur.com/6uc80iU.png" alt=""><br>emmm, è¿˜æ˜¯çœ‹ä¸æ‡‚æœ‰ä»€ä¹ˆè§„å¾‹, </p>
</blockquote>
<p><img src="https://i.imgur.com/fjWYKBX.png" alt="">  </p>
<p>6å•Šâ€¦, æ›´æ”¹åçš„è¡Œå°±æ˜¯æœ€ç»ˆç»“æœçš„åˆ—, åªè¦éå†å€’å™ä¸€éå°±å¯ä»¥äº†<br>è¿™ç§æ€è·¯æ˜¯å¦‚ä½•å¾—å‡ºçš„? éœ€è¦å“ªæ–¹é¢çš„çŸ¥è¯†ä¹ˆ?<br>æ€è·¯è¿™ç§ä¸œè¥¿å¥½éš¾å¼¥è¡¥, æˆ‘è‡ªè®¤ä¸ºä¸å‡ºæ„å¤–çš„è¯, æ˜¯æ— æ³•æƒ³åˆ°è¿™ä¸€ç‚¹çš„</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/42TrappingRainWater</title>
    <url>/2020/01/09/leetcode/42TrappingRainWater/</url>
    <content><![CDATA[<h2 id="Trapping-Rain-Water"><a href="#Trapping-Rain-Water" class="headerlink" title="Trapping Rain Water"></a>Trapping Rain Water</h2><p><a href="https://leetcode.com/problems/trapping-rain-water/description/" target="_blank" rel="noopener">åŸåœ°å€</a></p>
<p><img src="https://i.imgur.com/o9Cwc3k.png" alt=""></p>
<p>å¤§è‡´æè¿°: ç»™å‡ºä¸€ä¸ªæ•°ç»„, æŒ‰å¦‚ä¸Šæ‰€è¿°, æ±‚å‡ºè“è‰²æ–¹å—çš„æ•°é‡<br>(å°±åƒä¸€ä¸ªå±±è„‰ä¸€æ ·, çœ‹è¿™æ ·çš„å±±è„‰é™é›¨åèƒ½ç•™ä¸‹å¤šå°‘æ°´)</p>
<h3 id="æˆ‘çš„æ€è·¯"><a href="#æˆ‘çš„æ€è·¯" class="headerlink" title="æˆ‘çš„æ€è·¯:"></a>æˆ‘çš„æ€è·¯:</h3><p>æ’é”™:  </p>
<ol>
<li>å¿…é¡»æœ‰3ä¸ªä»¥ä¸Šçš„å±±è„‰æ‰æœ‰å¯èƒ½æœ‰ç§¯æ°´, æ‰€ä»¥æ•°ç»„é•¿åº¦å¿…å®šå¤§äº3  </li>
<li>å·¦å³ä¸ºå¹³åœ°çš„æ•°ç»„ä¸‹æ ‡æˆªæ–­, ç›´åˆ°æœ‰å±±è„‰ä¸ºæ­¢</li>
</ol>
<p>åšæ³•:  </p>
<ol>
<li>ä»å·¦åˆ°å³ä¾æ¬¡æ‹¿åˆ°ç¬¦åˆæ¡ä»¶çš„æ ¼å­ä¸‹æ ‡(æ¯”å¦‚ç¬¬ä¸€æ¬¡æ˜¯(1, 3) )  </li>
<li>è®¡ç®—æ”¹åŒºåŸŸçš„é›¨æ°´  </li>
<li>é‡å¤ç¬¬ä¸€æ­¥, ç›´åˆ°ç»“æŸ</li>
</ol>
<p>// å…·ä½“ä»£ç åœ¨42_.txtä¸­  </p>
<h3 id="dalaoçš„æ€è·¯"><a href="#dalaoçš„æ€è·¯" class="headerlink" title="dalaoçš„æ€è·¯"></a>dalaoçš„æ€è·¯</h3><p>// å…·ä½“ä»£ç åœ¨42_2.txtä¸­</p>
<p><img src="https://i.imgur.com/ZIGTZ9P.png" alt=""></p>
<p><img src="https://i.imgur.com/psX9onj.png" alt="">  </p>
<p>åˆ†æ:<br>ä¸€ä¸ªæ ¼å­ä¸­èƒ½ä¸èƒ½å­˜æ°´å–å†³äºå·¦å³æ ¼å­çš„é«˜åº¦<br>ç®—æ³•ä»å·¦åˆ°å³ä¸€æ¬¡, ä»æœ‰åˆ°å·¦ä¸€æ¬¡.<br>æ¯æ¬¡å‡è®¾è¯¥æ ¼å­ä»¥å·¦/å³å•æ–¹é¢æœ€å¤§èƒ½æ”¾å¤šå°‘æ°´<br>å°†åŒä¸€æ ¼çš„ä¸¤æ¬¡æ•°æ®æ±‚æœ€å°, è¿™å°±æ˜¯è¯¥ä¸‹æ ‡å®é™…èƒ½å­˜å¤šå°‘æ°´<br>æœ€åå‡å»æœ¬èº«çš„å®ä½“æ ¼å­, ä¹Ÿå°±å¾—åˆ°äº†ç©ºä¸‹çš„æ ¼å­  </p>
<p>ç®—æ³•å¤æ‚åº¦ä¸ºO(n)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/21MergeTwoSortedLists</title>
    <url>/2020/01/09/leetcode/21MergeTwoSortedLists/</url>
    <content><![CDATA[<p><img src="https://i.imgur.com/YPfIfKp.png" alt=""></p>
<p>æ’åºä¸¤ä¸ªé“¾è¡¨  </p>
<p>æ€è·¯:  </p>
<p>æ¯æ¬¡å¯¹æ¯”ä¸¤æ¡é“¾è¡¨çš„å½“å‰èŠ‚ç‚¹,  æŒ‰é€‚å½“é¡ºåºæ’å…¥çš„åŒæ—¶éœ€è¦æ³¨æ„ä¸€ç‚¹</p>
<p>å¦‚æœå°çš„èŠ‚ç‚¹çš„æ¥ä¸‹æ¥çš„å€¼ä¾æ—§å°äºå¤§çš„èŠ‚ç‚¹, é‚£ä¹ˆéœ€è¦ç»§ç»­å¾€ä¸‹éå†, çŸ¥é“é‡åˆ°ä¸€ä¸ªèŠ‚ç‚¹å¤§äºå¤§çš„èŠ‚ç‚¹  </p>
<p>è¿™æ ·çš„è¯ä¸€æ¬¡å¾ªç¯ä¸­å°±å¯ä»¥æ’åºå¤šä¸ªèŠ‚ç‚¹, å¾ªç¯çš„æ¬¡æ•°å°±å¯ä»¥å˜å°‘  </p>
<p>ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!l1 &amp;&amp; l2) <span class="keyword">return</span> l2;</span><br><span class="line">		<span class="keyword">if</span> (!l2 &amp;&amp; l1) <span class="keyword">return</span> l1;</span><br><span class="line"></span><br><span class="line">        ListNode *smaller = l1-&gt;val &gt; l2-&gt;val ?</span><br><span class="line">            l2 : l1;</span><br><span class="line">        ListNode *bigger = l1-&gt;val &gt; l2-&gt;val ?</span><br><span class="line">            l1 : l2;</span><br><span class="line">        ListNode *result = smaller;</span><br><span class="line">        <span class="keyword">while</span> (smaller &amp;&amp; bigger) &#123;</span><br><span class="line">            <span class="keyword">while</span> (smaller-&gt;next &amp;&amp; smaller-&gt;next-&gt;val &lt; bigger-&gt;val)</span><br><span class="line">                smaller = smaller-&gt;next;</span><br><span class="line"></span><br><span class="line">            ListNode *tmps = smaller-&gt;next;</span><br><span class="line">            smaller-&gt;next = bigger;</span><br><span class="line"></span><br><span class="line">            smaller = bigger;</span><br><span class="line">            bigger = tmps;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é‡‡ç”¨äº†ä¸€æ¬¡å¾ªç¯å¯¹æ¯”å¤šä¸ªçš„ç®—æ³•, æ¯æ¬¡å¾ªç¯ä¹‹åä¸å¿…å†è®¡ç®—è°å¤§è°å°, èº«ä»½åƒå¼€å…³ä¸€æ ·ä¼šäº’æ¢</p>
<p>ä½†æ˜¯ä»£ç å¤æ‚åº¦å¢åŠ äº†</p>
<p>ç»“æœ:</p>
<p><img src="https://i.imgur.com/dNx5MC7.png" alt=""></p>
<p>emmmmmâ€¦, é¢„å·®æœ‰ç‚¹å¤§â€¦  </p>
<p>æŒ‰ç†æ¥è¯´æˆ‘è§‰å¾—ç®—æ³•å¾ˆå¥½å•Š, ä¸€æ¬¡å¾ªç¯ä¸­æ’åºäº†å¤šä¸ªèŠ‚ç‚¹  </p>
<p>æ¯æ¬¡å¾ªç¯åè¿˜ä¸éœ€è¦è®¡ç®—è°å¤§è°å°</p>
<p>åˆ†æä¸€ä¸‹4msçš„ç®—æ³•:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        ListNode* pre=<span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode* crt=pre;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">NULL</span> &amp;&amp; l2!=<span class="literal">NULL</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1-&gt;val&lt;l2-&gt;val) &#123;</span><br><span class="line">                crt-&gt;next=l1;</span><br><span class="line">                l1=l1-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                crt-&gt;next=l2;</span><br><span class="line">                l2=l2-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            crt=crt-&gt;next;   </span><br><span class="line">        &#125;</span><br><span class="line">        crt-&gt;next=(l1==<span class="literal">NULL</span>)?l2:l1;</span><br><span class="line">        <span class="keyword">return</span> pre-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>emmmmâ€¦  </p>
<p>ä»–çš„æ€è·¯å¾ˆç®€å•, æ¯æ¬¡å¯¹æ¯”ä¸¤ä¸ªèŠ‚ç‚¹, ç­›é€‰å‡ºä¸€ä¸ªæœ€å°çš„</p>
<p>å°†ç­›é€‰å‡ºèŠ‚ç‚¹çš„é‚£æ¡é“¾æ¥å¾€ä¸‹å¾ªç¯, å¦å¤–ä¸€æ¡ä¸å˜  </p>
<p>ä½†æ˜¯æ—¶é—´æ¯”æˆ‘å°‘äº†å¾ˆå¤š, æˆ‘ä»”ç»†æ€è€ƒäº†çš„ç®—æ³•åå€’æ²¡æœ‰è¿™ç§å•çº¯çš„ç®—æ³•å¥½  </p>
<p>æœ‰ç‚¹å‡ºä¹æ„æ–™å’Œä¸æœæ°”â€¦</p>
<p>@exprience:</p>
<p>æˆ‘ä»¥åæˆ–è®¸éœ€è¦è€ƒè™‘ <strong>ä»¥å¾ªç¯æ¬¡æ•°æ¢å–å‡å°‘å¾ªç¯å¤æ‚åº¦</strong> çš„åšæ³•äº†  </p>
<p>è¿™æ ·çš„è¯æˆ‘çš„æ¯æ¬¡å¾ªç¯å°½é‡ç®€å•, è™½ç„¶æ¬¡æ•°å˜å¤šäº†, ä½†æ˜¯æ€»ä½“çš„æ•ˆç‡å¯èƒ½è¿˜ä¼šæœ‰æå‡, æ¯”å¦‚è¿™æ¬¡ = =</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/R23._Merge_k_Sorted_Lists</title>
    <url>/2020/01/09/leetcode/R23._Merge_k_Sorted_Lists/</url>
    <content><![CDATA[<p><img src="https://i.imgur.com/0yJznlI.png" alt=""></p>
<p>æ’åºå¤šä¸ªé“¾è¡¨</p>
<p>æ€è·¯:</p>
<p>emmmâ€¦ é‡‡å–ä¸Šæ¬¡çš„æƒ³æ³•è¯•è¯•  </p>
<p>ä¸€æ¬¡åªæ’åºä¸€ä¸ª, æ’åºå¤šæ¬¡</p>
<p>ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeKLists</span><span class="params">(<span class="built_in">vector</span>&lt;ListNode*&gt;&amp; lists)</span> </span>&#123;</span><br><span class="line">        ListNode *result = <span class="keyword">new</span> ListNode(<span class="number">0</span>);</span><br><span class="line">        ListNode *backup = result;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> indexmin = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">while</span>(indexmin &lt; lists.<span class="built_in">size</span>() &amp;&amp; !lists[indexmin])</span><br><span class="line">                ++indexmin;</span><br><span class="line"></span><br><span class="line">            ListNode *<span class="built_in">min</span> = <span class="literal">nullptr</span>;</span><br><span class="line">            <span class="keyword">if</span> (indexmin &lt; lists.<span class="built_in">size</span>())</span><br><span class="line">                <span class="built_in">min</span> = lists[indexmin];</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (indexmin &gt; <span class="number">0</span> &amp;&amp; lists[indexmin - <span class="number">1</span>])</span><br><span class="line">                    backup-&gt;next = lists[indexmin];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; lists.<span class="built_in">size</span>(); ++i)</span><br><span class="line">                <span class="keyword">if</span> (lists[i] &amp;&amp; lists[i]-&gt;val &lt; <span class="built_in">min</span>-&gt;val) &#123;</span><br><span class="line">                    <span class="built_in">min</span> = lists[i];</span><br><span class="line">                    indexmin = i;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            backup-&gt;next = <span class="built_in">min</span>;</span><br><span class="line">            backup = backup-&gt;next;</span><br><span class="line">            lists[indexmin] = lists[indexmin]-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸€æ¬¡å¾ªç¯å†…åªæ€è€ƒå¾—åˆ°æœ€å°çš„ä¸€ä¸ª  </p>
<p>ä»£ç çš„å¤æ‚åº¦é™ä½äº†, ç å­—é€Ÿåº¦å’Œdebugé¢‘ç‡ä¹Ÿæ˜æ˜¾å¥½å¤šäº†</p>
<p>ç»“æœ</p>
<p><img src="https://i.imgur.com/86K7tLZ.png" alt=""></p>
<p>emmmmmmâ€¦. , è¿™æ˜¯æˆ‘è‡³ä»Šä¸ºæ­¢åšçš„æœ€å·®çš„ä¸€æ¬¡leetcodeâ€¦  </p>
<p>éš¾çš„, æƒ³ä¸å‡ºå¥½æ–¹æ³•çš„. å³ä½¿æœ‰æƒ³æ³•ä¹Ÿä¸åš. æ‰€ä»¥å¹³å‡æ¥è¯´ä¸€ç›´è¿˜ç®—ä¸­æ¸¸  </p>
<p>ä¸è¿‡å·®ä¸å¤šæ„æ–™ä¹‹ä¸­, æ¯•ç«Ÿ hard è¿˜æ˜¯æ²¡é‚£ä¹ˆå®¹æ˜“çš„(é™¤äº†é‚£æ¬¡ç”¨æ ‡å‡†åº“å·é¸¡, è™½ç„¶è¯´å·å®Œå°±åæ‚”äº†)</p>
<p>é‚£ä¹ˆ, è¦ä¸è¦çœ‹ä¸€ä¸‹dalaoçš„ä»£ç ?  </p>
<p>ç®—äº†å§, è¿™æ¬¡æ²¡æ€ä¹ˆä»”ç»†æ€è€ƒç®—æ³•, åˆšå¥½æƒ³å°è¯•ä¸€ä¸‹é™ä½å¾ªç¯å¤æ‚åº¦</p>
<p>(è™½ç„¶è¯´å°è¯•ç‚¸äº†, ä½†è¿˜ç®—æœ‰æ‰€æ”¶è·. åœ¨æ—¶é—´ç´§è¿«, è¿˜æœ‰å…¶ä»–é€‚å½“å› ç´ çš„æƒ…å†µä¸‹, è¿™ç§åšæ³•å¯ä»¥è¯´æ˜¯æœ€æœ‰æ•ˆç‡çš„)  </p>
<p>æ²¡æ€ä¹ˆæ€è€ƒå°±å»çœ‹åˆ«äººçš„ç­”æ¡ˆ, é‚£æˆ‘è¿˜åšleetcodeå¹²å˜›â€¦  </p>
<p>ä½†æ˜¯å¥½åƒåˆæš‚æ—¶æƒ³ä¸å‡ºä»€ä¹ˆå¥½æ–¹æ³•, ç•™åˆ°ä»¥åæ¥ä¼˜åŒ–å§â€¦</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/F15_3Sum</title>
    <url>/2020/01/09/leetcode/F15_3Sum/</url>
    <content><![CDATA[<p><img src="https://i.imgur.com/LqfHaar.png" alt=""></p>
<p>ç»™ä¸€ä¸ªæ•°ç»„, æ±‚å…¶ä¸­ä¸‰æ•°å’Œä¸ºé›¶çš„æ‰€æœ‰ç»„åˆ, è¦æ±‚ä¸èƒ½é‡å¤  </p>
<p>æ€è·¯:</p>
<p>éå†æ•°ç»„, æ‰¾å‡ºæ‰€æœ‰ä¸‰æ•°é›†åˆ, å†åˆ¤æ–­æ˜¯å¦ä¸ºé›¶, ä¹‹åç”¨ä¸€ä¸ªmapå»é‡</p>
<p>ä»£ç : </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; threeSum(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">size</span>() &lt; <span class="number">3</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="keyword">bool</span>&gt; repetitive;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>() - <span class="number">2</span>; ++i)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = i + <span class="number">1</span>; k &lt; nums.<span class="built_in">size</span>() - <span class="number">1</span>; ++k)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> v = k + <span class="number">1</span>; v &lt; nums.<span class="built_in">size</span>(); ++v) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (nums[i] + nums[k] + nums[v] != <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">int</span> nmax = <span class="built_in">max</span>(nums[i], nums[k]);</span><br><span class="line">                        nmax = <span class="built_in">max</span>(nmax, nums[v]);</span><br><span class="line">                        <span class="keyword">int</span> nmin = <span class="built_in">min</span>(nums[i], nums[k]);</span><br><span class="line">                        nmin = <span class="built_in">min</span>(nmin, nums[v]);</span><br><span class="line"></span><br><span class="line">                        <span class="keyword">if</span> (!repetitive[(nmax &lt;&lt; <span class="number">4</span>) + nmin]) &#123;</span><br><span class="line">                            repetitive[(nmax &lt;&lt; <span class="number">4</span>) + nmin] = <span class="literal">true</span>;</span><br><span class="line">                            result.push_back(&#123; nmin, <span class="number">0</span> - nmin - nmax, nmax &#125;);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šmapå»é‡é‚£é‡Œæœ‰æ¼æ´, â€œç²¾å¿ƒå‡†å¤‡â€çš„æ•°å­—æœ‰å¯èƒ½éª—è¿‡å®ƒ</p>
<p>ç»“æœ:</p>
<p><img src="https://i.imgur.com/kRu2dZG.png" alt=""></p>
<p>è¶…æ—¶äº†, çœ‹åˆ°é‚£å¯†å¯†éº»éº»çš„çº¢å­—, æ„Ÿè§‰æœ‰ç‚¹ä¸å¦™  </p>
<p><img src="https://i.imgur.com/l5lBEhM.png" alt=""></p>
<p>å®æµ‹ç®—æ³•åœ¨æ•°ç»„é•¿åº¦ä¸º200æ—¶å·²ç»æœ‰æ˜æ˜¾çš„åœé¡¿</p>
<p>ç®—æ³•å¤æ‚åº¦å¤§æ¦‚æ˜¯ å·®ä¸å¤šO(n3) çš„æ ·å­, æ‰€ä»¥éšç€é•¿åº¦çš„å¢åŠ , æ—¶é—´å¤æ‚åº¦çš„å¢åŠ æ˜¯å¾ˆææ€–çš„  </p>
<p>200æœ‰æ˜æ˜¾åœé¡¿çš„è¯. 3000å¤§æ¦‚èƒ½ç®—ä¸ªç—›  </p>
<p>é‚£ä¹ˆå¾—ä¼˜åŒ–ç®—æ³•äº†, æ€ä¹ˆä¼˜åŒ–å‘¢? æš‚æ—¶æƒ³ä¸åˆ°â€¦  </p>
<p>ä¼˜åŒ–çš„æƒ³æ³•:  </p>
<p>ç°åœ¨çš„ç®—æ³•åœ¨ç¬¬ä¸€æ¬¡å¾ªç¯çš„æ—¶å€™ä¼šå°†ä¸‹æ ‡[0, 1]å’Œåç»­æ‰€æœ‰çš„ä¸‹æ ‡ç»„åˆ</p>
<p>ç¬¬äºŒæ¬¡å¾ªç¯çš„æ—¶å€™ä¼šå°†ä¸‹æ ‡[1, 2]å’Œåç»­æ‰€æœ‰ä¸‹æ ‡ç»„åˆ  </p>
<p>è¿™é‡Œæ˜æ˜¾æœ‰å¯ä»¥æå‡çš„ç©ºé—´, å› ä¸ºä¸¤æ¬¡é‡Œé¢1é‡å äº†, åŒç†, åç»­çš„ç»„åˆéƒ½æœ‰é‡å   </p>
<p>åœ¨200é•¿åº¦çš„ç®—æ³•ä¸­, å¤§è‡´ä¼šæœ‰ 4000000 æ¬¡å¾ªç¯, è€Œæœ€åçš„ç»“æœåªæœ‰ 6 ä¸ªç»„åˆ</p>
<p>æƒ³è¦ä¼˜åŒ–çš„è¯åº”è¯¥ä»è¿™é‡Œå…¥æ‰‹, å¦‚ä½•åœ¨é€»è¾‘ä¸Šç­›é™¤æ‰ä¸€äº›å¯èƒ½ä½†å’Œåˆä¸ä¸ºé›¶çš„ç»„åˆ</p>
<p>æ€ä¹ˆåˆ é™¤? emmmmâ€¦ æƒ³ä¸åˆ°  </p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/20ValidParentheses</title>
    <url>/2020/01/09/leetcode/20ValidParentheses/</url>
    <content><![CDATA[<p><img src="https://i.imgur.com/tKMKEzc.png" alt=""></p>
<p>åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯éƒ½æŒ‰æ­£ç¡®æ ¼å¼é—­åˆ</p>
<p>æ€è·¯:</p>
<p>å½“ä¸€ä¸ªå­—ç¬¦è¢«çœ‹åˆ°æ—¶, é¢„æ–™ä¸ä¹‹å¯¹åº”çš„å­—ç¬¦, å½“è¯¥å­—ç¬¦ä¸æ˜¯é¢„æ–™çš„å­—ç¬¦, æœ‰ä¸¤ç§å¯èƒ½</p>
<ol>
<li>å¤±è´¥</li>
<li>è¢«åŒ…å«, ä¾‹å¦‚ ({}), å½“çœ‹åˆ° â€˜(â€˜ æ—¶å€™, æˆ‘ä»¬æƒ³è¦çš„æ˜¯ â€˜)â€™. ä½†è¯¥è¯­å¥æ˜¯åˆæ³•çš„</li>
</ol>
<p>å¦‚æœæ˜¯ç¬¬äºŒç§, é‚£ä¹ˆ â€˜(â€˜ è¦è¢«ä¿å­˜èµ·æ¥, è¿™ç§æ•°æ®ç»“æ„éå¸¸é€‚åˆç”¨æ ˆæ¥åš  </p>
<p>ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isValid</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!s.<span class="built_in">size</span>()) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (s.<span class="built_in">size</span>() &lt; <span class="number">2</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">char</span>&gt; lettermap&#123;</span><br><span class="line">            &#123;<span class="string">'('</span>, <span class="string">')'</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'&#123;'</span>, <span class="string">'&#125;'</span>&#125;,</span><br><span class="line">            &#123;<span class="string">'['</span>, <span class="string">']'</span>&#125;,</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; vch&#123; s[<span class="number">0</span>] &#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (lettermap[vch.back()] != s[i]) vch.push_back(s[i]);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                vch.pop_back();</span><br><span class="line">                <span class="keyword">if</span> (vch.<span class="built_in">size</span>()) &#123;&#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (++i &lt; s.<span class="built_in">size</span>())</span><br><span class="line">                    vch.push_back(s[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> !vch.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¯¥ä»£ç å¹¶æœªåœ¨å¾ªç¯ä¸­åˆ¤æ–­æ˜¯å¦åˆæ³•  </p>
<p>å®é™…æƒ…å†µä¸­, å¯èƒ½ä¸€ä¸ªéå¸¸é•¿çš„å­—ç¬¦ä¸²ä¸€å¼€å§‹å°±é”™äº†, æ¯”å¦‚; â€œ){}{}{}{}â€¦â€  </p>
<p>ä½†æ˜¯ä¾æ—§ä¼šå°†æ•´ä¸ªå­—ç¬¦ä¸²å¾ªç¯ä¸€æ¬¡, è¿™æ ·åšæœ‰ä¸‰ç‚¹è€ƒè™‘:  </p>
<ol>
<li>ä»£ç æ›´åŠ ç®€å•, ç®€æ´. æ›´å®¹æ˜“ç†è§£</li>
<li>å¦‚æœä»£ç çš„ç¡®éœ€è¦å¾ˆå¤šåˆ¤æ–­æ‰èƒ½ç¡®å®šç»“æœ, é‚£ä¹ˆå¤šåŠ æ¡ä»¶è¯­å¥åè€Œæ˜¯ä¸€ç§é¢å¤–çš„æ¶ˆè€—<br>å¹¶ä¸”æ˜¯O(n)å¤æ‚åº¦, èŠ‚çœçš„æ•ˆç‡å¹¶ä¸ä¼šæœ‰å¤šå°‘, åŒæ—¶é¢å¤–çš„æ¶ˆè€—å¹¶ä¸ä¸€å®šä¼šæ¯”åŠ æ¡ä»¶è¯­å¥å¤š</li>
<li>æ‡’</li>
</ol>
<p>PS: å¦‚æœèƒ½æƒ³åˆ°ç”¨æ ˆç»“æ„æ¥åšè¿™ä¸ªé¢˜çš„è¯, ä¼šæ–¹ä¾¿å¾ˆå¤š.  å¦‚æœæ²¡æƒ³åˆ°çš„è¯, å¯èƒ½ä¼šè¶Šæƒ³è¶Šéš¾. </p>
]]></content>
  </entry>
  <entry>
    <title>read/UnderstandingGeneratedColumns</title>
    <url>/2020/01/09/read/UnderstandingGeneratedColumns/</url>
    <content><![CDATA[<h1 id="Understanding-Generated-Columns"><a href="#Understanding-Generated-Columns" class="headerlink" title="Understanding Generated Columns"></a>Understanding Generated Columns</h1><h2 id="The-Theory"><a href="#The-Theory" class="headerlink" title="The Theory"></a>The Theory</h2><p>Generated Columns is a feature <a href="https://dev.mysql.com/doc/refman/5.7/en/mysql-nutshell.html#mysql-nutshell-additions" target="_blank" rel="noopener">released</a> on MySQL 5.7. They can be used during <code>CREATE TABLE</code>or <code>ALTER TABLE</code> statements. It is a way of storing data without actually sending it through the <code>INSERT</code> or <code>UPDATE</code> clauses in SQL. The database resolves what the data will be.</p>
<p>ç”Ÿæˆåˆ—æ˜¯åœ¨ MySQL 5.7 ä¹‹åå‘å¸ƒçš„ä¸€ä¸ªç‰¹æ€§, å¯ä»¥åœ¨ CREATE TABLE / ALTER TABLE æœŸé—´ä½¿ç”¨. æ˜¯ä¸€ç§å­˜å‚¨æ•°æ®è€Œä¸é€šè¿‡ INSERT / UPDATE å­å¥çš„æ–¹æ³•. æ•°æ®åº“è§£ææ•°æ®æ˜¯ä»€ä¹ˆ</p>
<p>There are two types of Generated Columns: <strong>Virtual</strong> and <strong>Stored</strong>. They work with:</p>
<ul>
<li>mathematical expressions (<code>product_price</code> * <code>quantity</code>)</li>
<li>built-in functions (<code>RIGHT()</code>, <code>CONCAT()</code>, <code>FROM_UNIXTIME()</code>, <code>JSON_EXTRACT()</code>)</li>
<li>literals (â€œ2â€, â€œnewâ€, 0)</li>
</ul>
<p>æœ‰ä¸¤ç§ç”Ÿæˆåˆ—: virtual å’Œ stored, å®ƒä»¬å·¥ä½œäº: </p>
<ul>
<li>æ•°å­¦è¡¨è¾¾å¼</li>
<li>å†…å»ºå‡½æ•°</li>
<li>å¤åˆå¸¸é‡</li>
</ul>
<p>Besides that, they can be indexed but they <strong>donâ€™t</strong> allow <strong>subqueries</strong> in it.<br>A Generated Column works within the table domain. If you need subqueries on a particular column, you may have to look at <a href="http://dev.mysql.com/doc/refman/5.7/en/view-syntax.html" target="_blank" rel="noopener">Views</a>.</p>
<p>å¦‚ä¸Š, å®ƒä»¬èƒ½å¤Ÿè¢«ç´¢å¼•, ä½†ä¸å…è®¸å­æŸ¥è¯¢. </p>
<p>ç”Ÿæˆåˆ—åœ¨è¡¨åŸŸä¸­å·¥ä½œ, å¦‚æœä½ éœ€è¦åœ¨ç‰¹æ®Šçš„åˆ—ä¸Šå­æŸ¥è¯¢, ä½ éœ€è¦è€ƒè™‘ view </p>
<h2 id="The-basic-example"><a href="#The-basic-example" class="headerlink" title="The basic example"></a>The basic example</h2><p>As an example I am going to use an e-commerce database as based on my past experience of what I have seen and worked. You will probably have at least these tables or something similar:</p>
<ul>
<li><code>users</code> â€“ stores user info</li>
<li><code>products</code> â€“ stores product info like price and description</li>
<li><code>orders</code> â€“ stores the user_id, date of order</li>
<li><code>orders_items</code> â€“ stores product_id, order_id, quantity and price at the time of purchase</li>
</ul>
<p>This is the whole DB: <a href="https://gist.github.com/gabidavila/7abae0b77ff6cff8899c3a57ff32679d" target="_blank" rel="noopener">Gist</a>.</p>
<p>Notice the <code>order_items</code> definition:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`orders_items`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`order_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_id`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`product_price`</span> <span class="built_in">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'0.00'</span>,</span><br><span class="line">  <span class="string">`quantity`</span> <span class="built_in">int</span>(<span class="number">10</span>) <span class="keyword">unsigned</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="number">1</span>,</span><br><span class="line">  <span class="string">`created_at`</span> <span class="built_in">timestamp</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="string">`updated_at`</span> <span class="built_in">varchar</span>(<span class="number">45</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">'CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP'</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8mb4;</span><br></pre></td></tr></table></figure>



<p>The retrieval would bring:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="string">`id`</span>, <span class="string">`order_id`</span>, <span class="string">`product_id`</span>, <span class="string">`product_price`</span>, <span class="string">`quantity`</span></span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`orders_items`</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">order_id</th>
<th align="left">product_id</th>
<th align="left">product_price</th>
<th align="left">quantity</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">369</td>
<td align="left">1304</td>
<td align="left">202.18</td>
<td align="left">7</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">4</td>
<td align="left">1736</td>
<td align="left">250.40</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">270</td>
<td align="left">1404</td>
<td align="left">29.89</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">256</td>
<td align="left">179</td>
<td align="left">190.40</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">107</td>
<td align="left">1911</td>
<td align="left">146.98</td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>One example is to get the total of that order_item row, something like <code>total_item_price</code> that would store the value of <code>product_price</code> * <code>quantity</code> to show how much the summed amount of an item would be. Some databases have the <code>MONEY</code> type to store <code>price</code>, as with MySQL it is recommended to work with <code>DECIMAL</code>.</p>
<p>ä¸Šè¿°ä¾‹å­è·å– order_item æ‰€æœ‰è¡Œ, åº”è¯¥æœ‰ç±»ä¼¼ total_item_price çš„åˆ—å­˜å‚¨ product * quantity, æ˜¾ç¤ºæ€»é¢.</p>
<p>ä¸€äº›æ•°æ®åº“æœ‰ MONEY ç±»å‹å­˜å‚¨ä»·æ ¼, MySQL æ¨èä½¿ç”¨ DECIMAL</p>
<p>People solve this problem in different ways:</p>
<ul>
<li>store the calculated price on a new column to make it easier to retrieve;</li>
<li>create a view;</li>
<li>or they calculate in the application itself, which in this case might cause problems due to how the language handles floats. There are libraries to deal with money values in a lot of languages and frameworks, however, the overhead of converting each row into a money object could be costly depending on the amount of data being transferred.</li>
</ul>
<p>æœ‰å‡ ç§ä¸åŒçš„æ–¹å¼è§£å†³è¿™ä¸ªé—®é¢˜: </p>
<ul>
<li>åœ¨æ–°çš„åˆ—å­˜å‚¨è®¡ç®—å¥½çš„å€¼, ä¾¿äºæ£€ç´¢</li>
<li>åˆ›å»ºè§†å›¾</li>
<li>æˆ–è€…åœ¨åº”ç”¨å±‚è®¡ç®—, ç”±äºä¸åŒè¯­è¨€å¯¹äºæµ®ç‚¹æ•°çš„ç®¡ç†å¯èƒ½é€ æˆé—®é¢˜. å¤§é‡çš„è¯­è¨€å’Œæ¡†æ¶æä¾›äº†åº“å¤„ç†è¿™ä¸ªé—®é¢˜.ç„¶è€Œ, å°†æ¯è¡Œè½¬æ¢ä¸ºå¯¹è±¡çš„æ¶ˆè€—ä¾èµ–äºæœ‰å¤šå°‘æ•°æ®è¢«è°ƒå…¥</li>
</ul>
<p>Another way Iâ€™ve seen is: people calculate in the query the total amount for the orders_items row as <code>product_price</code> * <code>quantity</code>:</p>
<p>è¿˜æœ‰ä¸€ç§æˆ‘è§è¿‡çš„æ–¹æ³• : åœ¨æŸ¥è¯¢ä¸­è®¡ç®—æ€»é¢</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">  <span class="string">`id`</span>, </span><br><span class="line">  <span class="string">`order_id`</span>, </span><br><span class="line">  <span class="string">`product_id`</span>, </span><br><span class="line">  <span class="string">`product_price`</span>, </span><br><span class="line">  <span class="string">`quantity`</span>,</span><br><span class="line">  <span class="string">`product_price`</span> * <span class="string">`quantity`</span> <span class="keyword">AS</span> total_item_price</span><br><span class="line"><span class="keyword">FROM</span> <span class="string">`orders_items`</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">5</span>;</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="left">id</th>
<th align="left">order_id</th>
<th align="left">product_id</th>
<th align="left">product_price</th>
<th align="left">quantity</th>
<th align="left">total_item_price</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">369</td>
<td align="left">1304</td>
<td align="left">202.18</td>
<td align="left">7</td>
<td align="left">1415.26</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">4</td>
<td align="left">1736</td>
<td align="left">250.40</td>
<td align="left">3</td>
<td align="left">751.20</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">270</td>
<td align="left">1404</td>
<td align="left">29.89</td>
<td align="left">5</td>
<td align="left">149.45</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">256</td>
<td align="left">179</td>
<td align="left">190.40</td>
<td align="left">10</td>
<td align="left">1904.00</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">107</td>
<td align="left">1911</td>
<td align="left">146.98</td>
<td align="left">1</td>
<td align="left">146.98</td>
</tr>
</tbody></table>
<h2 id="Virtual-Columns"><a href="#Virtual-Columns" class="headerlink" title="Virtual Columns"></a>Virtual Columns</h2><ul>
<li>They take no disk space, except when using a Virtual Column as in a <a href="https://dev.mysql.com/doc/refman/5.7/en/create-table-secondary-indexes-virtual-columns.html" target="_blank" rel="noopener">Secondary Index</a>.</li>
<li>They are an <code>INPLACE</code> operation: it means the table definition is changed without having to recopy all the data again. <a href="http://dev.mysql.com/doc/refman/5.7/en/innodb-create-index-overview.html" target="_blank" rel="noopener">More info</a>.</li>
<li>The values are calculated on the fly during read operations and <code>BEFORE</code> triggers.</li>
</ul>
<p>Consider using virtual columns for data where changes happens in a significant number of times. The cost of a Virtual Column comes from reading a table constantly and the server has to compute every time what that column value will be.</p>
<ul>
<li>ä¸å ç£ç›˜ç©ºé—´, é™¤éä½¿ç”¨è™šæ‹Ÿåˆ—ä½œä¸ºæ¬¡çº§ç´¢å¼•</li>
<li>æ˜¯ INPLACE æ“ä½œ : è¿™æ„å‘³ç€è¡¨å®šä¹‰æ›´æ”¹ä¸éœ€è¦æ‹·è´æ‰€æœ‰æ•°æ®</li>
<li>å€¼åœ¨è¯»å–æ“ä½œå’Œ BEFORE è§¦å‘ä¹‹é—´åŠ¨æ€è®¡ç®—</li>
</ul>
<h2 id="Stored-Columns"><a href="#Stored-Columns" class="headerlink" title="Stored Columns"></a>Stored Columns</h2><ul>
<li>They do use disk space.</li>
<li>It has the same cost of adding a new column, so it is a <code>COPY</code> operation</li>
<li>Values are updated in every <code>INSERT</code> and <code>UPDATE</code> statement.</li>
</ul>
<p>You should consider using Stored Columns for when the data doesnâ€™t change significantly or at all after creation, like for instance, the example above with the <code>orders_items</code> table. Once a purchase is made, the price of the product is stored, not being changed, neither the quantity. Considering this information we could create <code>total_item_price</code> as a Stored Column.</p>
<ul>
<li>è€—è´¹ç£ç›˜ç©ºé—´</li>
<li>å’Œå¢åŠ è¡Œæœ‰ç›¸ç­‰çš„æ¶ˆè€—, ç­‰ä»·äº COPY æ“ä½œ</li>
<li>å€¼åœ¨æ¯æ¬¡ INSERT å’Œ UPDATE è¯­å¥ä¸­æ›´æ–°</li>
</ul>
<p>ä½ éœ€è¦è€ƒè™‘ä½¿ç”¨å­˜å‚¨åˆ—, ä»¥ä¾¿æ•°æ®æ²¡æœ‰æ˜¾è‘—å˜åŒ–æˆ–åœ¨åˆ›å»ºåæ²¡æœ‰æ˜¾è‘—å˜åŒ–, ä¾‹å¦‚ä¸Šé¢å¸¦æœ‰ order_items çš„è¡¨. å½“è´­ä¹°æ“ä½œå, å­˜å‚¨äº§å“çš„ä»·æ ¼, ä¸ä¼šå†æ›´æ”¹, æ•°é‡ä¹Ÿä¸ä¼š. è€ƒè™‘åˆ°è¿™ä¸ªä¿¡æ¯, æˆ‘ä»¬åº”è¯¥åˆ›å»º total_item_price å­˜å‚¨åˆ—</p>
<h2 id="The-code"><a href="#The-code" class="headerlink" title="The code"></a>The code</h2><h3 id="Creating-a-table"><a href="#Creating-a-table" class="headerlink" title="Creating a table"></a>Creating a table</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;-- Virtual Column&#96; &#96;CREATE&#96; &#96;TABLE&#96; &#96;&#96;orders_items&#96; (&#96;&#96;&#96;id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;AUTO_INCREMENT,&#96;&#96;&#96;order_id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96;&#96;,&#96;&#96;&#96;product_id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96;&#96;,&#96;&#96;&#96;product_price&#96; &#96;&#96;decimal&#96;&#96;(10,2) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;&#39;0.00&#39;&#96;&#96;,&#96;&#96;&#96;quantity&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;1,&#96;&#96;&#96;total_item_price&#96; &#96;&#96;decimal&#96;&#96;(10,2) &#96;&#96;AS&#96; &#96;(&#96;quantity&#96; * &#96;product_price&#96;),&#96;&#96;&#96;created_at&#96; &#96;&#96;timestamp&#96; &#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;CURRENT_TIMESTAMP&#96;&#96;,&#96;&#96;&#96;updated_at&#96; &#96;&#96;varchar&#96;&#96;(45) &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;&#39;CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#39;&#96;&#96;,&#96;&#96;PRIMARY&#96; &#96;KEY&#96; &#96;(&#96;id&#96;)&#96;&#96;) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 &#96;&#96;DEFAULT&#96; &#96;CHARSET&#x3D;utf8mb4;&#96; &#96;-- Stored Column&#96; &#96;CREATE&#96; &#96;TABLE&#96; &#96;&#96;orders_items&#96; (&#96;&#96;&#96;id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;AUTO_INCREMENT,&#96;&#96;&#96;order_id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96;&#96;,&#96;&#96;&#96;product_id&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96;&#96;,&#96;&#96;&#96;product_price&#96; &#96;&#96;decimal&#96;&#96;(10,2) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;&#39;0.00&#39;&#96;&#96;,&#96;&#96;&#96;quantity&#96; &#96;&#96;int&#96;&#96;(10) unsigned &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;1,&#96;&#96;&#96;total_item_price&#96; &#96;&#96;decimal&#96;&#96;(10,2) &#96;&#96;AS&#96; &#96;(&#96;quantity&#96; * &#96;product_price&#96;) STORED,&#96;&#96;&#96;created_at&#96; &#96;&#96;timestamp&#96; &#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;CURRENT_TIMESTAMP&#96;&#96;,&#96;&#96;&#96;updated_at&#96; &#96;&#96;varchar&#96;&#96;(45) &#96;&#96;NOT&#96; &#96;NULL&#96; &#96;DEFAULT&#96; &#96;&#39;CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP&#39;&#96;&#96;,&#96;&#96;PRIMARY&#96; &#96;KEY&#96; &#96;(&#96;id&#96;)&#96;&#96;) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;1 &#96;&#96;DEFAULT&#96; &#96;CHARSET&#x3D;utf8mb4;&#96;</span><br></pre></td></tr></table></figure>

<p>Notice how the definition changes on line 9 and 23: you have another keyword, <code>AS</code>, then an <em>expression</em> and specifically on line 23 you see a <code>STORED</code> keyword. In both lines they are generated columns, if nothing is specified will be a <code>VIRTUAL</code> column.</p>
<p>æ³¨æ„åœ¨ 9 è¡Œ å’Œ 23 è¡Œçš„æ›´æ”¹, æœ‰å¦ä¸€ä¸ªå…³é”®å­—, AS, éšä¹‹è¡¨è¾¾å¼å’Œ STORED å…³é”®å­—. å¦‚æœæ²¡æœ‰æŒ‡å®š, å°†ä¼šæ˜¯ä¸€ä¸ª VIRTUAL åˆ—</p>
<h3 id="Altering-a-table"><a href="#Altering-a-table" class="headerlink" title="Altering a table"></a>Altering a table</h3><p>It uses the same syntax as adding a column, just adding the â€œ<strong>AS</strong> (<em>expression</em>)â€ after the data type:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;-- &#96;full_name&#96; as VIRTUAL COLUMN&#96;&#96;ALTER&#96; &#96;TABLE&#96; &#96;users&#96;&#96;ADD&#96; &#96;COLUMN&#96; &#96;&#96;full_name&#96; &#96;&#96;VARCHAR&#96;&#96;(500)&#96;&#96;AS&#96; &#96;(CONCAT_WS(&#96;&#96;&quot; &quot;&#96;&#96;, &#96;first_name&#96;, &#96;last_name&#96;));&#96; &#96;-- &#96;total_item_price&#96; as STORED COLUMN&#96;&#96;ALTER&#96; &#96;TABLE&#96; &#96;orders_items&#96;&#96;ADD&#96; &#96;COLUMN&#96; &#96;&#96;total_item_price&#96; &#96;&#96;DECIMAL&#96;&#96;(10, 2)&#96;&#96;AS&#96; &#96;(&#96;quantity&#96; * &#96;product_price&#96;) STORED;&#96;</span><br></pre></td></tr></table></figure>

<h2 id="JSON-fields"><a href="#JSON-fields" class="headerlink" title="JSON fields"></a>JSON fields</h2><p>It is also possible to extract data from JSON fields using generated columns. As the functions for JSON are built-in, <code>JSON_EXTRACT</code> and <code>JSON_UNQUOTE</code> as well â€œ<strong>-&gt;</strong>â€ and â€œ<strong>-&gt;&gt;</strong>â€ work as <em>expressions</em>for a generated column:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;-- Stored Columns&#96;&#96;ALTER&#96; &#96;TABLE&#96; &#96;&#96;twitter_users&#96;&#96;&#96;ADD&#96; &#96;COLUMN&#96; &#96;&#96;location&#96; &#96;&#96;VARCHAR&#96;&#96;(255)&#96;&#96;AS&#96; &#96;(response-&gt;&gt;&#96;&#96;&quot;$.location&quot;&#96;&#96;) STORED;&#96;</span><br></pre></td></tr></table></figure>

<h2 id="Final-considerations"><a href="#Final-considerations" class="headerlink" title="Final considerations"></a>Final considerations</h2><p>When the type is <code>STORED</code>, it must be specified after the <em>expression</em> otherwise the default behaviour will be to be <code>VIRTUAL</code>.</p>
<p>Generated columns can have indexes created as the following, no matter if stored, virtual or extracted from a JSON field:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#96;ALTER&#96; &#96;TABLE&#96; &#96;users&#96;&#96;ADD&#96; &#96;INDEX&#96; &#96;&#96;ix_full_name&#96; (&#96;full_name&#96;);&#96;</span><br></pre></td></tr></table></figure>

<p>Which is the <strong>same</strong> syntax for normal columns.</p>
]]></content>
  </entry>
  <entry>
    <title>read/studyNoteOfGo</title>
    <url>/2020/01/09/read/studyNoteOfGo/</url>
    <content><![CDATA[<h2 id="brief"><a href="#brief" class="headerlink" title="brief"></a>brief</h2><h4 id="çŸ­å˜é‡å£°æ˜"><a href="#çŸ­å˜é‡å£°æ˜" class="headerlink" title="çŸ­å˜é‡å£°æ˜"></a>çŸ­å˜é‡å£°æ˜</h4><p>goå¯ä»¥ä½¿ç”¨å½¢å¦‚ := çš„æ–¹å¼å®šä¹‰å˜é‡, è¿™æ ·çš„ç”¨æ³•ä»…å…è®¸åœ¨å‡½æ•°å†…ä½¿ç”¨</p>
<p>( åŒæ—¶, åœ¨ä¸€ä¸ª := çš„ä½¿ç”¨ä¸­å¯ä»¥å®šä¹‰, ä¹Ÿå¯ä»¥èµ‹å€¼, ä¸è¿‡æˆ‘ä¸å»ºè®®ä¹Ÿä¸ä¼šä½¿ç”¨è¿™æ ·æ­§ä¹‰çš„ç”¨æ³•)</p>
<p>(åŒæ ·çš„, := æ”¯æŒå˜é‡çš„ç±»å‹ä¸åŒ, ä¸è¿‡è¿™ä¹Ÿæ˜¯æ¯”è¾ƒæ­§ä¹‰çš„ç”¨æ³•, ä¸æ¨è)</p>
<h4 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h4><p>goçš„æŒ‡é’ˆå¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒ. ä¸ºäº†å®‰å…¨æ€§, å®ƒæŠ›å¼ƒäº†ä¸€äº›çµæ´»æ€§</p>
<p>å®ƒä¸æ”¯æŒæŒ‡é’ˆè¿ç®—, ç›¸å½“äºä¸€ä¸ªå¼•ç”¨ ( æˆ‘ä¸å¼€å¿ƒ :( )</p>
<h3 id="new"><a href="#new" class="headerlink" title="new"></a>new</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">i := <span class="number">0</span></span><br><span class="line">p := &amp;i</span><br><span class="line"></span><br><span class="line">p := <span class="built_in">new</span>(i)</span><br></pre></td></tr></table></figure>

<p>new åœ¨ go ä¸­çš„ä½œç”¨å¾ˆå°, å®ƒçš„ä½œç”¨å°±ç›¸å½“äºå°‘äº†ä¸€ä¸ªåå­—è¢«å ç”¨</p>
<h4 id="å¤šé‡èµ‹å€¼"><a href="#å¤šé‡èµ‹å€¼" class="headerlink" title="å¤šé‡èµ‹å€¼"></a>å¤šé‡èµ‹å€¼</h4><p>go ä¼šå…ˆå¯¹å³è¾¹çš„è¡¨è¾¾å¼ä¸€æ¬¡æ€§æ±‚å€¼</p>
<h4 id="ç”Ÿå‘½å‘¨æœŸ"><a href="#ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="ç”Ÿå‘½å‘¨æœŸ"></a>ç”Ÿå‘½å‘¨æœŸ</h4><p>go é‡‡ç”¨åƒåœ¾å›æ”¶, ä¸‰è‰²æ ‡è®°</p>
<h4 id="slice"><a href="#slice" class="headerlink" title="slice"></a>slice</h4><p>slice ç›¸å½“äº vector, ä½†ä»–å¿…é¡»ä¾èµ–äºå¦ä¸€ä¸ªå®¹å™¨, æ¯”å¦‚æ•°ç»„</p>
<p>å¯ä»¥æŒ‘æˆ˜ slice æŒ‡å‘æ•°ç»„çš„é‚£äº›åŒºé—´, åŒæ—¶å¯ä»¥åŠ¨æ€å¢é•¿</p>
<p>å¢é•¿çš„åŒºé—´ä¸€æ—¦è¶…è¿‡åŸå®¹å™¨çš„å®¹é‡, ä¼šåœ¨ä¸æ›´æ”¹åŸå®¹å™¨çš„æƒ…å†µä¸‹ é‡æ–°åˆ†é…å¹¶æ‹·è´å…ƒç´ </p>
<h3 id="json-xmlâ€¦"><a href="#json-xmlâ€¦" class="headerlink" title="json, xmlâ€¦"></a>json, xmlâ€¦</h3><p>go æä¾›äº†è¿™äº›æ ¼å¼çš„è½¬æ¢æ”¯æŒ</p>
<p>emmmmâ€¦, æ„Ÿè§‰ go ä½¿ç”¨èµ·æ¥å¾ˆæ–¹ä¾¿</p>
<p>å®‰å…¨çš„æŒ‡é’ˆ, æ–¹ä¾¿çš„å˜é‡å‘½å, åƒåœ¾å›æ”¶, å¤šé‡èµ‹å€¼, å¤šè¿”å›å€¼, forè¡ç”Ÿwhile â€¦  </p>
<h3 id="method"><a href="#method" class="headerlink" title="method"></a>method</h3><p>go çš„æ–¹æ³•å£°æ˜å’Œå®šä¹‰ç‹¬ç«‹ä¸å¯¹è±¡æœ¬èº«  </p>
<p>go çš„æ–¹æ³•å°±åƒä¸€ä¸ªæŒ‡å®šäº†ç›®æ ‡çš„å‡½æ•°</p>
<h3 id="å°è£…"><a href="#å°è£…" class="headerlink" title="å°è£…"></a>å°è£…</h3><p>go ä»¥å…¶ä¸èƒ½éšæ„å‘½åä¸ºä»£ä»·(è¿™æ ·çš„ä»£ä»·ä»…ä»…æ˜¯ä¸èƒ½éšæ„é¦–å­—æ¯å¤§å°å†™)æ¢æ¥äº†ç®€æ´çš„å°è£…è§„èŒƒ</p>
<p>é¦–å­—æ¯å¤§å†™çš„, å³ä¸º public æˆå‘˜, è€Œé¦–å­—æ¯å°å†™çš„, å³ä¸º private æˆå‘˜. è¿™ç›¸å½“å®¹æ˜“åˆ¤æ–­</p>
]]></content>
  </entry>
  <entry>
    <title>read/static_filed_in_Cpp</title>
    <url>/2020/01/09/read/static_filed_in_Cpp/</url>
    <content><![CDATA[<p>@brief</p>
<p>when I learning java by <thinking in java>, I see â€œThe order of initialization is statics firstâ€¦â€. soâ€¦ what about c++?</p>
<p>å½“æˆ‘é€šè¿‡ thinking in java å­¦ java æ—¶, æˆ‘æ³¨æ„åˆ°ä¹¦ä¸­çš„ä¸€å¥è¯ â€œThe order of initialization is statics firstâ€. é‚£ä¹ˆ, c++ ä¸­æ˜¯æ€æ ·å¯¹å¾…çš„å‘¢?</p>
<h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><p>think this code:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> i2 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> i;</span><br><span class="line">    A() &#123; <span class="built_in">cout</span> &lt;&lt; <span class="string">"hello"</span> &lt;&lt; <span class="built_in">endl</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> A::i = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; A::i &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    A::i = <span class="number">100</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    A a;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; A::i &lt;&lt; <span class="built_in">endl</span>;           </span><br><span class="line">    <span class="function">thread <span class="title">t1</span><span class="params">(f)</span></span>;</span><br><span class="line">    <span class="function">thread <span class="title">t2</span><span class="params">(f)</span></span>;</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>class A has a static field i, itâ€™s an integer with default value 10.</p>
<p>how did these codes do?</p>
<p>ç±» A æœ‰ä¸€ä¸ªé™æ€å­—æ®µ i, è¿™æ˜¯ä¸€ä¸ªå…·æœ‰é»˜è®¤å€¼ä¸º10çš„æ•´å‹å­—æ®µ</p>
<p>assembly time</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZN1A1iE:</span><br><span class="line">â–¹   .longâ–¹  10</span><br><span class="line">â–¹   .text</span><br><span class="line">â–¹   .globlâ–¹ _Z1fv</span><br><span class="line">â–¹   .typeâ–¹  _Z1fv, @function	</span><br><span class="line">_Z1fv:</span><br><span class="line">.LFB3324:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   subqâ–¹   $16, %rsp</span><br><span class="line">â–¹   leaqâ–¹   -4(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZN1AC1Ev</span><br><span class="line">â–¹   movlâ–¹   _ZN1A1iE(%rip), %eax &#x2F;&#x2F; _ZN1A1iE</span><br><span class="line">â–¹   movlâ–¹   %eax, %esi</span><br><span class="line">â–¹   leaqâ–¹   _ZSt4cout(%rip), %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEi@PLT</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdx</span><br><span class="line">â–¹   movqâ–¹   _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_@GOTPCREL(%rip), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rsi</span><br><span class="line">â–¹   movqâ–¹   %rdx, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEPFRSoS_E@PLT</span><br><span class="line">â–¹   movlâ–¹   $100, _ZN1A1iE(%rip)</span><br><span class="line">â–¹   nop</span><br><span class="line">â–¹   leave                                                                                  </span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br><span class="line">...</span><br><span class="line">main:</span><br><span class="line">.LFB3325:                                                                                 </span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   .cfi_personality 0x9b,DW.ref.__gxx_personality_v0</span><br><span class="line">â–¹   .cfi_lsda 0x1b,.LLSDA3325</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   pushqâ–¹  %rbx</span><br><span class="line">â–¹   subqâ–¹   $40, %rsp</span><br><span class="line">â–¹   .cfi_offset 3, -24</span><br><span class="line">â–¹   leaqâ–¹   -20(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">.LEHB0:</span><br><span class="line">â–¹   callâ–¹   _ZN1AC1Ev</span><br><span class="line">â–¹   movlâ–¹   _ZN1A1iE(%rip), %eax &#x2F;&#x2F; _ZN1A1iE</span><br><span class="line">â–¹   movlâ–¹   %eax, %esi</span><br><span class="line">â–¹   leaqâ–¹   _ZSt4cout(%rip), %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEi@PLT</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdx</span><br><span class="line">â–¹   movqâ–¹   _ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_@GOTPCREL(%rip), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rsi</span><br><span class="line">â–¹   movqâ–¹   %rdx, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEPFRSoS_E@PLT</span><br><span class="line">â–¹   leaqâ–¹   -32(%rbp), %rax</span><br><span class="line">â–¹   leaqâ–¹   _Z1fv(%rip), %rsi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSt6threadC1IRFvvEJEEEOT_DpOT0_</span><br></pre></td></tr></table></figure>

<p>so, static value initialize while process run then copy to register while class construct function executed</p>
<p>æ‰€ä»¥, é™æ€å˜é‡éšç€ç¨‹åºè¿è¡Œè€Œåˆå§‹åŒ–, éšååœ¨ç±»æ„é€ å‡½æ•°å®Œæˆå, å°†å…¶å€¼æ‹·è´åˆ°å¯„å­˜å™¨</p>
<p>this can also be discovered in gdb </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">(gdb) b main</span><br><span class="line">Breakpoint 1 at 0x1908: file t.cpp, line 33.</span><br><span class="line">(gdb) c</span><br><span class="line">The program is not being run.</span><br><span class="line">(gdb) r</span><br><span class="line">Starting program: &#x2F;root&#x2F;cpp&#x2F;a.out </span><br><span class="line">[Thread debugging using libthread_db enabled]</span><br><span class="line">Using host libthread_db library &quot;&#x2F;lib&#x2F;x86_64-linux-gnu&#x2F;libthread_db.so.1&quot;.</span><br><span class="line"></span><br><span class="line">Breakpoint 1, main () at t.cpp:33</span><br><span class="line">33	    A a;</span><br><span class="line">(gdb) p A::i</span><br><span class="line">$2 &#x3D; 10</span><br><span class="line">(gdb) p &amp;A::i</span><br><span class="line">$3 &#x3D; (int *) 0x555555758100 &lt;A::i&gt;</span><br><span class="line">(gdb) p (int)0x555555758100</span><br><span class="line">$4 &#x3D; 1433764096</span><br><span class="line">(gdb) p &#123;int&#125;0x555555758100</span><br><span class="line">$5 &#x3D; 10</span><br></pre></td></tr></table></figure>



<h3 id="how-about-static-const"><a href="#how-about-static-const" class="headerlink" title="how about static const?"></a>how about static const?</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">class A&#123;</span><br><span class="line">public:</span><br><span class="line">    int i2 &#x3D; 1;</span><br><span class="line">    static int const i &#x3D; 11;</span><br><span class="line">    A() &#123; cout &lt;&lt; &quot;hello&quot; &lt;&lt; endl; &#125;</span><br><span class="line">&#125;;</span><br><span class="line">...</span><br><span class="line">_Z1fv:</span><br><span class="line">.LFB3324:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp </span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   subqâ–¹   $16, %rsp</span><br><span class="line">â–¹   leaqâ–¹   -4(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZN1AC1Ev</span><br><span class="line">â–¹   movlâ–¹   $11, %esi        &#x2F;&#x2F; *       </span><br><span class="line">â–¹   leaqâ–¹   _ZSt4cout(%rip), %rdi</span><br><span class="line">...</span><br><span class="line">main:</span><br><span class="line">.LFB3325:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   .cfi_personality 0x9b,DW.ref.__gxx_personality_v0</span><br><span class="line">â–¹   .cfi_lsda 0x1b,.LLSDA3325</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   pushqâ–¹  %rbx</span><br><span class="line">â–¹   subqâ–¹   $40, %rsp</span><br><span class="line">â–¹   .cfi_offset 3, -24</span><br><span class="line">â–¹   leaqâ–¹   -20(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">.LEHB0:</span><br><span class="line">â–¹   callâ–¹   _ZN1AC1Ev</span><br><span class="line">â–¹   movlâ–¹   $11, %esi             &#x2F;&#x2F; *                       </span><br><span class="line">â–¹   leaqâ–¹   _ZSt4cout(%rip), %rdi</span><br></pre></td></tr></table></figure>

<p>if you use static const, there no space to store value, just a compile-time const value</p>
<p>å¦‚æœä½¿ç”¨static const, åˆ™ä¸ä¼šæœ‰ç©ºé—´å­˜å‚¨å€¼, åˆ™æ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å¸¸é‡</p>
]]></content>
  </entry>
  <entry>
    <title>read/SortedIndexBuilds</title>
    <url>/2020/01/09/read/SortedIndexBuilds/</url>
    <content><![CDATA[<h4 id="15-6-2-3-Sorted-Index-Builds"><a href="#15-6-2-3-Sorted-Index-Builds" class="headerlink" title="15.6.2.3 Sorted Index Builds"></a>15.6.2.3 Sorted Index Builds</h4><p>There are three phases to an index build. In the first phase, the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_clustered_index" target="_blank" rel="noopener">clustered index</a> is scanned, and index entries are generated and added to the sort buffer. When the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_sort_buffer" target="_blank" rel="noopener">sort buffer</a> becomes full, entries are sorted and written out to a temporary intermediate file. This process is also known as a â€œrunâ€. In the second phase, with one or more runs written to the temporary intermediate file, a merge sort is performed on all entries in the file. In the third and final phase, the sorted entries are inserted into the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_b_tree" target="_blank" rel="noopener">B-tree</a>.</p>
<p>ç´¢å¼•æ„å»ºæœ‰ä¸‰ä¸ªé˜¶æ®µ, ç¬¬ä¸€é˜¶æ®µ, æ‰«æèšç°‡ç´¢å¼•, ç”Ÿæˆç´¢å¼•æ¡ç›®, æ·»åŠ åˆ°æ’åºç¼“å­˜ä¸­. å½“æ’åºç¼“å­˜è¢«å¡«æ»¡æ—¶, æ¡ç›®æ•°æ®æ’åºå¹¶å­˜å‚¨åˆ°ä¸´æ—¶çš„ä¸­é—´æ–‡ä»¶. è¿™ä¸ªè¿‡ç¨‹ä¹Ÿè¢«æˆä¸º â€˜runâ€™, ç¬¬äºŒé˜¶æ®µ, éšç€ â€˜runsâ€™ å†™å…¥åˆ°ä¸´æ—¶ä¸­é—´æ–‡ä»¶, å¯¹æ‰€æœ‰æ–‡ä»¶ä¸­çš„æ¡ç›®æ•°æ®æ‰§è¡Œåˆå¹¶æ’åº, ç¬¬ä¸‰é˜¶æ®µ, æ’åºå¥½çš„æ¡ç›®æ•°æ®æ’å…¥åˆ° B-tree ä¸­.</p>
<p>Prior to the introduction of sorted index builds, index entries were inserted into the B-tree one record at a time using insert APIs. This method involved opening a B-tree<a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_cursor" target="_blank" rel="noopener">cursor</a> to find the insert position and then inserting entries into a B-tree page using an <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_optimistic" target="_blank" rel="noopener">optimistic</a> insert. If an insert failed due to a page being full, a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_pessimistic" target="_blank" rel="noopener">pessimistic</a> insert would be performed, which involves opening a B-tree cursor and splitting and merging B-tree nodes as necessary to find space for the entry. The drawbacks of this â€œtop-downâ€method of building an index are the cost of searching for an insert position and the constant splitting and merging of B-tree nodes.</p>
<p>åœ¨å¼•è¿›æœ‰åºç´¢å¼•æ„å»ºä¹‹å‰, ä½¿ç”¨æ’å…¥ APIs ä¸€æ¬¡ä¸€æ¡, å°†ç´¢å¼•æ¡ç›®æ’å…¥åˆ° B-tree ä¸­. è¿™ä¸ªæ–¹æ³•åŒ…æ‹¬æ‰“å¼€ B-tree å…‰æ ‡, æŸ¥æ‰¾æ’å…¥ä½ç½®, ç„¶åä½¿ç”¨ optimistic æ’å…¥æ•°æ®åˆ° B-tree é¡µä¸­.</p>
<p>å¦‚æœå› ä¸ºé¡µé¢å·²æ»¡è€Œæ’å…¥å¤±è´¥, æ‰§è¡Œ pessimistic æ’å…¥, åŒ…æ‹¬æ‰“å¼€ B-tree å…‰æ ‡, å¹¶æ ¹æ®éœ€è¦åˆ†è£‚åˆå¹¶ B-tree èŠ‚ç‚¹, ä»¥ä¾¿ä¸ºæ¡ç›®æ‰¾åˆ°ç©ºé—´. </p>
<p>Sorted index builds use a â€œbottom-upâ€ approach to building an index. With this approach, a reference to the right-most leaf page is held at all levels of the B-tree. The right-most leaf page at the necessary B-tree depth is allocated and entries are inserted according to their sorted order. Once a leaf page is full, a node pointer is appended to the parent page and a sibling leaf page is allocated for the next insert. This process continues until all entries are inserted, which may result in inserts up to the root level. When a sibling page is allocated, the reference to the previously pinned leaf page is released, and the newly allocated leaf page becomes the right-most leaf page and new default insert location.</p>
<p>æœ‰åºç´¢å¼•ä½¿ç”¨è‡ªåº•å‘ä¸Šæ–¹æ³•æ„å»ºç´¢å¼•, ä½¿ç”¨è¿™ç§æ–¹æ³•, æ‰€æœ‰ B-tree å±‚çº§éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘æœ€å³å¶å­é¡µçš„å¼•ç”¨. æœ€å³å¶å­é¡µåœ¨å¿…è¦çš„ B-tree æ·±åº¦åˆ†é…, æ¡ç›®æ ¹æ®ä»–ä»¬æœ‰åºé¡ºåºæ’å…¥. å½“å¶å­èŠ‚ç‚¹æ»¡äº†, çˆ¶èŠ‚ç‚¹å¢åŠ ä¸€ä¸ªèŠ‚ç‚¹æŒ‡é’ˆ, ä¸ºä¸‹ä¸€æ¬¡æ’å…¥åˆ†é…ä¸€ä¸ª sibling å¶å­é¡µ. è¿™ä¸ªè¿‡ç¨‹æŒç»­åˆ°æ‰€æœ‰çš„æ¡ç›®æ’å…¥ä¸ºæ­¢, å¯èƒ½å¯¼è‡´æ’å…¥åˆ°æ ¹å±‚çº§.</p>
<p>å½“ sibling é¡µåˆ†é…å, æŒ‡å‘ä¹‹å‰å›ºå®šçš„å¶å­é¡µçš„å¼•ç”¨è¢«é‡Šæ”¾, æ–°åˆ†é…çš„å¶å­é¡µæˆä¸ºæœ€å³å¶å­é¡µå’Œæ–°çš„æ’å…¥ä½ç½®</p>
<p>(PS. å’Œè‡ªå¹³è¡¡äºŒå‰æ ‘ç±»ä¼¼, æ’å…¥èŠ‚ç‚¹åˆ°å°¾ç«¯èŠ‚ç‚¹, ä¸æ–­ä¸Šæº¢åˆ°é€‚å½“çš„ä½ç½®)</p>
<h5 id="Reserving-B-tree-Page-Space-for-Future-Index-Growth"><a href="#Reserving-B-tree-Page-Space-for-Future-Index-Growth" class="headerlink" title="Reserving B-tree Page Space for Future Index Growth"></a>Reserving B-tree Page Space for Future Index Growth</h5><p>To set aside space for future index growth, you can use the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_fill_factor" target="_blank" rel="noopener"><code>innodb_fill_factor</code></a> configuration option to reserve a percentage of B-tree page space. For example, setting <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_fill_factor" target="_blank" rel="noopener"><code>innodb_fill_factor</code></a> to 80 reserves 20 percent of the space in B-tree pages during a sorted index build. This setting applies to both B-tree leaf and non-leaf pages. It does not apply to external pages used for <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a> or <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> entries. The amount of space that is reserved may not be exactly as configured, as the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_fill_factor" target="_blank" rel="noopener"><code>innodb_fill_factor</code></a> value is interpreted as a hint rather than a hard limit.</p>
<p>ä¸ºäº†è®¾ç½®ç©ºé—´ä¸ºä»¥åçš„ç´¢å¼•å¢é•¿åšå‡†å¤‡, å¯ä»¥ä½¿ç”¨ innodb_fill_factor è®¾ç½®å­˜å‚¨ç™¾åˆ†æ¯” B-tree é¡µç©ºé—´, æ¯”å¦‚, è®¾ç½® innodb_fill_factor ä¸º 80, å­˜å‚¨ 20% çš„ç©ºé—´. è¿™ä¸ªè®¾ç½®å¼•ç”¨äºæ‰€æœ‰ B-tree å¶å’Œéå¶é¡µ, ä¸é€‚ç”¨äº TEXT / BLOB æ¡ç›®çš„é¡µ. </p>
<p>å­˜å‚¨çš„é¡µé¢å¤§å°ä¸ä¸€å®šç²¾å‡†, innodb_fill_factor æ˜¯ä¸€ä¸ªæç¤º, è€Œå¹¶ä¸æ˜¯ç¡¬é™åˆ¶</p>
<h5 id="Sorted-Index-Builds-and-Full-Text-Index-Support"><a href="#Sorted-Index-Builds-and-Full-Text-Index-Support" class="headerlink" title="Sorted Index Builds and Full-Text Index Support"></a>Sorted Index Builds and Full-Text Index Support</h5><p>Sorted index builds are supported for <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_fulltext_index" target="_blank" rel="noopener">fulltext indexes</a>. Previously, SQL was used to insert entries into a fulltext index.</p>
<p>æœ‰åºç´¢å¼•æ„å»ºæ”¯æŒ fulltext index.</p>
<h5 id="Sorted-Index-Builds-and-Compressed-Tables"><a href="#Sorted-Index-Builds-and-Compressed-Tables" class="headerlink" title="Sorted Index Builds and Compressed Tables"></a>Sorted Index Builds and Compressed Tables</h5><p>For <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_compression" target="_blank" rel="noopener">compressed tables</a>, the previous index creation method appended entries to both compressed and uncompressed pages. When the modification log (representing free space on the compressed page) became full, the compressed page would be recompressed. If compression failed due to a lack of space, the page would be split. With sorted index builds, entries are only appended to uncompressed pages. When an uncompressed page becomes full, it is compressed. Adaptive padding is used to ensure that compression succeeds in most cases, but if compression fails, the page is split and compression is attempted again. This process continues until compression is successful. For more information about compression of B-Tree pages, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-compression-internals.html" target="_blank" rel="noopener">Section 15.9.1.5, â€œHow Compression Works for InnoDB Tablesâ€</a>.</p>
<p>å¯¹å‹ç¼©è¡¨, ä¹‹å‰åˆ›å»ºç´¢å¼•çš„æ–¹æ³•å°†æ¡ç›®æ·»åŠ åˆ°å‹ç¼©/æœªå‹ç¼©é¡µé¢, å½“æ›´æ”¹æ—¥å¿—é€æ¸å¢å¤š, å‹ç¼©é¡µéœ€è¦é‡å‹ç¼©. å¦‚æœå› ä¸ºç©ºé—´ä¸è¶³è€Œå‹ç¼©å¤±è´¥, ä¹Ÿéœ€è¦è¢«åˆ†å‰², åœ¨æœ‰åºæ„å»ºä¸­, æ¡ç›®ä»…ä»…æ·»åŠ åˆ°æœªå‹ç¼©é¡µ. å½“æœªå‹ç¼©é¡µé€æ¸å¡«æ»¡, å‹ç¼©è¯¥é¡µ.</p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹é€‚åº”çš„å¡«å……ç”¨ä½œç¡®ä¿å‹ç¼©æˆåŠŸ, å¦‚æœå‹ç¼©å¤±è´¥, é¡µè¢«åˆ†éš”, ç„¶åå†æ¬¡å°è¯•å‹ç¼©. è¿™ä¸ªè¿‡ç¨‹ç›´åˆ°å‹ç¼©æˆåŠŸä¸ºæ­¢.</p>
<h5 id="Sorted-Index-Builds-and-Redo-Logging"><a href="#Sorted-Index-Builds-and-Redo-Logging" class="headerlink" title="Sorted Index Builds and Redo Logging"></a>Sorted Index Builds and Redo Logging</h5><p><a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_redo_log" target="_blank" rel="noopener">Redo logging</a> is disabled during a sorted index build. Instead, there is a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_checkpoint" target="_blank" rel="noopener">checkpoint</a> to ensure that the index build can withstand a crash or failure. The checkpoint forces a write of all dirty pages to disk. During a sorted index build, the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_page_cleaner" target="_blank" rel="noopener">page cleaner</a> thread is signaled periodically to flush <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_dirty_page" target="_blank" rel="noopener">dirty pages</a> to ensure that the checkpoint operation can be processed quickly. Normally, the page cleaner thread flushes dirty pages when the number of clean pages falls below a set threshold. For sorted index builds, dirty pages are flushed promptly to reduce checkpoint overhead and to parallelize I/O and CPU activity.</p>
<p>åœ¨æœ‰åºç´¢å¼•æ„å»ºæœŸé—´, redo logging ä¸å¯ç”¨. ä»£æ›¿å…¶çš„æ˜¯ checkpoint, å®ƒç¡®ä¿ç´¢å¼•æ„å»ºç¦å¾—ä½é”™è¯¯å’Œå´©æºƒ. checkpoint å¼ºåˆ¶è„é¡µå†™å›ç¼“å­˜. </p>
<h5 id="Sorted-Index-Builds-and-Optimizer-Statistics"><a href="#Sorted-Index-Builds-and-Optimizer-Statistics" class="headerlink" title="Sorted Index Builds and Optimizer Statistics"></a>Sorted Index Builds and Optimizer Statistics</h5><p>Sorted index builds may result in <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_optimizer" target="_blank" rel="noopener">optimizer</a> statistics that differ from those generated by the previous method of index creation. The difference in statistics, which is not expected to affect workload performance, is due to the different algorithm used to populate the index.</p>
]]></content>
  </entry>
  <entry>
    <title>read/sort2</title>
    <url>/2020/01/09/read/sort2/</url>
    <content><![CDATA[<p>this is a follow-up to <a href="http://49.235.55.145/html_note/sort.html" target="_blank" rel="noopener">sort</a></p>
<p>these sort algorithms based on &lt;Algorithms, 4th&gt;</p>
<h2 id="shell-sort"><a href="#shell-sort" class="headerlink" title="shell sort"></a>shell sort</h2><p>shell sort is a better version sort algorithm based on insert sort.</p>
<p>when a[0] is the biggest number but head of array, for move the number to the end of the array, need swap length(a) elements. </p>
<p>shell sort æ˜¯åŸºäºæ’å…¥æ’åºçš„æ”¹è‰¯ç‰ˆæœ¬</p>
<p>å½“ a[0] æ˜¯æ•´ä¸ªæ•°ç»„æœ€å¤§çš„å…ƒç´ æ—¶, ä¸ºäº†ç§»åŠ¨è¿™ä¸ªå…ƒç´ åˆ°æ•°ç»„çš„å°¾ç«¯, éœ€è¦äº¤æ¢ length(a) æ¬¡å…ƒç´ . </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &lt; v.<span class="built_in">size</span>() / <span class="number">3</span>) h = h * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = h; j &lt; v.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = j; i &gt;= h &amp;&amp; v[i] &lt; v[i - h]; i -= h)</span><br><span class="line">                swap(v[i], v[i - h]);                         </span><br><span class="line">        &#125;</span><br><span class="line">        h /= <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="bottom-up-sort"><a href="#bottom-up-sort" class="headerlink" title="bottom-up sort"></a>bottom-up sort</h2><p>bottom-up sort is a down-top method based on merge sort.</p>
<p>bottom-up sort åŸºäºåˆå¹¶æ’åº, æ˜¯ä¸€ç§ä»åº•è‡³ä¸Šçš„æ–¹æ³•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v, <span class="keyword">int</span> b, <span class="keyword">int</span> m, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v2 = v;</span><br><span class="line">    <span class="keyword">int</span> mid = m++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt;= e; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &gt; mid)</span><br><span class="line">            v[i] = v2[m++];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (m &gt; e)</span><br><span class="line">            v[i] = v2[b++];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (v2[b] &lt; v2[m])</span><br><span class="line">            v[i] = v2[b++];</span><br><span class="line">        <span class="keyword">else</span>Â·</span><br><span class="line">            v[i] = v2[m++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bottomupSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; v.<span class="built_in">size</span>(); i *= <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; v.<span class="built_in">size</span>() - i; j = j + <span class="number">2</span> * i)</span><br><span class="line">			merge(v, j, j + i <span class="number">-1</span>, <span class="built_in">min</span>(<span class="keyword">int</span>(v.<span class="built_in">size</span>() - <span class="number">1</span>, j + <span class="number">2</span> * i - <span class="number">1</span>)));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="a-better-version-of-quick-sort"><a href="#a-better-version-of-quick-sort" class="headerlink" title="a better version of quick sort"></a>a better version of quick sort</h2><p>if an array with some duplicate numbers,  skip these numbers will be more effective</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QS_MIN_LENGTH 7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;                          </span><br><span class="line"></span><br><span class="line">    <span class="comment">// if element too little, insertSort more effective than quickSort</span></span><br><span class="line">    <span class="keyword">if</span> (e - b &lt; QS_MIN_LENGTH)</span><br><span class="line">        insertSort(nums, b, e);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// meduim of three can get more effetive pivot</span></span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[m])</span><br><span class="line">        swap(nums[b], nums[m]);</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[e])</span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    <span class="keyword">if</span> (nums[m] &gt; nums[e])</span><br><span class="line">        swap(nums[m], nums[e]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pivot = nums[m];</span><br><span class="line">    <span class="comment">// skip elements equal pivot</span></span><br><span class="line">    <span class="keyword">int</span> lt = b + <span class="number">1</span>, eq = lt, gt = e - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (eq &lt;= gt) &#123; </span><br><span class="line">        <span class="keyword">if</span> (nums[eq] &lt; pivot)</span><br><span class="line">            swap(nums[lt++], nums[eq++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[eq] &gt; pivot)</span><br><span class="line">            swap(nums[eq], nums[gt--]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            eq++;</span><br><span class="line">    &#125;       </span><br><span class="line"></span><br><span class="line">    quickSort(nums, b, lt - <span class="number">1</span>);</span><br><span class="line">    quickSort(nums, gt + <span class="number">1</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="a-sort-algorithm-without-compare"><a href="#a-sort-algorithm-without-compare" class="headerlink" title="a sort algorithm without compare"></a>a sort algorithm without compare</h3><p>I saw a string sort algorithm without compare in &lt;algorithm 4th&gt;. so take some notes</p>
<p>Iâ€™m to lazy to write this code, please check the bookâ€¦</p>
]]></content>
  </entry>
  <entry>
    <title>read/sort</title>
    <url>/2020/01/09/read/sort/</url>
    <content><![CDATA[<p><a href="https://www.hackerearth.com/zh/practice/algorithms/sorting/bubble-sort/tutorial/" target="_blank" rel="noopener">source link</a></p>
<h2 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h2><h3 id="Bubble-Sort"><a href="#Bubble-Sort" class="headerlink" title="Bubble Sort"></a>Bubble Sort</h3><p>Bubble is the most common algorithm to sort an array. It based on the idea of repeatedly comparing adjacent element and then swapping their  value if exist in the wrong order </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; nums.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[j])</span><br><span class="line">                swap(nums[i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Selection-sort"><a href="#Selection-sort" class="headerlink" title="Selection sort"></a>Selection sort</h3><p>The selection sort is based on finding the minimum or maximum in an unsorted array and putting it to a sorted array</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">min</span> = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; nums.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[<span class="built_in">min</span>] &gt; nums[j])</span><br><span class="line">                <span class="built_in">min</span> = j;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums[i], nums[<span class="built_in">min</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Insertion-sort"><a href="#Insertion-sort" class="headerlink" title="Insertion sort"></a>Insertion sort</h3><p>From left to right, find each elementâ€™s correct position</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = nums[i];</span><br><span class="line">        <span class="keyword">int</span> j = i;</span><br><span class="line">        <span class="keyword">while</span>(j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            nums[j] = nums[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt;= v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            --j;                            </span><br><span class="line">        &#125;</span><br><span class="line">        nums[j] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Merge-sort"><a href="#Merge-sort" class="headerlink" title="Merge sort"></a>Merge sort</h3><p>Merge sort is a divide-and-conquer algorithm based on repeatedly breaking down an array to two sub-array and then merge them</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> q = m + <span class="number">1</span>, p = b;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt;= e; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p &gt; m)</span><br><span class="line">            v.push_back(nums[q++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (q &gt; e)</span><br><span class="line">            v.push_back(nums[p++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[q] &gt; nums[p])</span><br><span class="line">            v.push_back(nums[p++]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            v.push_back(nums[q++]);              </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : v)</span><br><span class="line">        nums[b++] = val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    mergeSort(nums, b, (e + b) / <span class="number">2</span>);</span><br><span class="line">    mergeSort(nums, (e + b) / <span class="number">2</span> + <span class="number">1</span>, e);</span><br><span class="line">    merge(nums, b, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Quick-sort"><a href="#Quick-sort" class="headerlink" title="Quick sort"></a>Quick sort</h3><p>Quick sort is also a divide-and-conquer algorithm. But it reduces the space complexity and removes the use of auxiliary array that is used in merger sort<br>One of the most important factors to influence performance is the pivot.<br>I chose the pivot from the middle, front, and back of the array. Sometimes will improve performance</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partion</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = e;</span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[m])</span><br><span class="line">        swap(nums[b], nums[m]);</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[e])</span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    <span class="keyword">if</span> (nums[m] &gt; nums[e])</span><br><span class="line">        swap(nums[m], nums[e]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> piv = nums[m];</span><br><span class="line">    swap(nums[e--], nums[m]);</span><br><span class="line">    <span class="keyword">while</span> (b &lt; e) &#123;</span><br><span class="line">        <span class="keyword">while</span> (b &lt; e &amp;&amp; nums[b] &lt; piv)</span><br><span class="line">            ++b;</span><br><span class="line">        <span class="keyword">while</span> (b &lt; e &amp;&amp; nums[e] &gt;= piv)</span><br><span class="line">            --e;</span><br><span class="line">        <span class="keyword">if</span> (b &gt;= e) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(nums[p], nums[b]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> p = partion(nums, b, e);</span><br><span class="line">    quickSort(nums, b, p - <span class="number">1</span>);</span><br><span class="line">    quickSort(nums, p + <span class="number">1</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Heap-sort"><a href="#Heap-sort" class="headerlink" title="Heap sort"></a>Heap sort</h3><p>Heap sort uses a structure called heap to sort the array. Heap is a complete binary tree.<br>left sub-tree index = 2 * root index + 1<br>right sub-tree index = 2 * root index + 2</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapify</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> n, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> largest = i;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> r = l + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l &lt; n &amp;&amp; nums[l] &gt; nums[largest])</span><br><span class="line">        largest = l;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (r &lt; n &amp;&amp; nums[r] &gt; nums[largest])</span><br><span class="line">        largest = r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">        swap(nums[i], nums[largest]);</span><br><span class="line">        heapify(nums, n, largest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;                </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.<span class="built_in">size</span>() / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        heapify(nums, nums.<span class="built_in">size</span>(), i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        swap(nums[<span class="number">0</span>], nums[i]);</span><br><span class="line">        heapify(nums, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>read/schedulerAlgorithm</title>
    <url>/2020/01/09/read/schedulerAlgorithm/</url>
    <content><![CDATA[<p>@brief</p>
<p>â€‹    æ—©ä¸Šåœ°é“å……å€¼æ—¶æœ‰ä½å¤§å¦ˆæœ‰ä¸œè¥¿æ‰äº†, å’Œå·¥ä½œäººå‘˜æ²Ÿé€šäº†å‡ åˆ†é’Ÿ, æœ¬æ¥å°±ç¡æ™šäº†, æœ€åå·®ç‚¹å¯¼è‡´ä¸Šç­è¿Ÿåˆ° = =</p>
<p>â€‹    ç„¶åçªç„¶æƒ³åˆ°è¿™å°±æ˜¯å•çº¿ç¨‹å•Šâ€¦ äºæ˜¯å°±æœ‰äº†è¿™ç¯‡å…³äº scheduler algorithm çš„ç¬”è®°</p>
<p>â€‹    <a href="https://www.geeksforgeeks.org/cpu-scheduling-in-operating-systems/" target="_blank" rel="noopener">åŸæ–‡</a></p>
<h3 id="what-is-scheduler"><a href="#what-is-scheduler" class="headerlink" title="what is scheduler"></a>what is scheduler</h3><p><strong>Schedulers</strong> are special system software which handle process scheduling in various ways. Their main task is to select the jobs to be submitted into the system and to decide which process to run. There are <a href="https://www.geeksforgeeks.org/gate-notes-operating-system-scheduler/" target="_blank" rel="noopener">three types of Scheduler</a>:</p>
<p>schedulers æ˜¯ç‰¹æ®Šçš„ç³»ç»Ÿè½¯ä»¶, é€šè¿‡å¤šç§æ–¹å¼æ§åˆ¶è¿›ç¨‹è°ƒåº¦. å®ƒä»¬ä¸»è¦çš„ä»»åŠ¡æ˜¯é€‰æ‹©ä»»åŠ¡å¹¶æäº¤åˆ°ç³»ç»Ÿ, å†³å®šå“ªä¸ªè¿›ç¨‹æ‰§è¡Œ, è¿™é‡Œæœ‰ä¸‰ç§ç±»å‹çš„ scheduler</p>
<ol>
<li><p><strong>Long term (job) scheduler â€“</strong> Due to the smaller size of main memory initially all program are stored in secondary memory. When they are stored or loaded in the main memory they are called process. This is the decision of long term scheduler that how many processes will stay in the ready queue. Hence, in simple words, long term scheduler decides the degree of multi-programming of system.</p>
<p>å› ä¸ºä¸»å­˜ç©ºé—´è¾ƒå°, æœ€åˆ, æ‰€æœ‰çš„ç¨‹åºéƒ½å­˜å‚¨åœ¨æ¬¡çº§å†…å­˜, å½“å®ƒä»¬æ’åºæˆ–åŠ è½½åˆ°ä¸»å­˜æ—¶, ç§°å…¶ä¸ºè¿›ç¨‹. è¿™å–å†³äº long term scheduler , å®ƒå†³å®šæœ‰å¤šå°‘è¿›ç¨‹ä¿ç•™åœ¨ä½ å‡†å¤‡é˜Ÿåˆ—ä¸­, å› æ­¤, ç®€å•æ¥è¯´, long term scheduler å†³å®šäº†ç³»ç»Ÿçš„å¤šç¨‹åºç¨‹åº¦</p>
<p>(PS: è¿™é‡ŒæŒ‡çš„åº”è¯¥æ˜¯å†…å­˜å’Œç¡¬ç›˜, å…³äº secondary memory, å¯ä»¥å‚è€ƒ <a href="https://chortle.ccsu.edu/Java5/Notes/chap01/ch01_7.html" target="_blank" rel="noopener">secondary memory</a>)</p>
</li>
<li><p><strong>Medium term scheduler â€“</strong> Most often, a running process needs I/O operation which doesnâ€™t requires CPU. Hence during the execution of a process when a I/O operation is required then the operating system sends that process from running queue to blocked queue. When a process completes its I/O operation then it should again be shifted to ready queue. ALL these decisions are taken by the medium-term scheduler. Medium-term scheduling is a part of <strong>swapping</strong>.</p>
<p>è¿è¡Œä¸­çš„è¿›ç¨‹ç»å¸¸éœ€è¦ I/O æ“ä½œè€Œå¹¶é CPU. å› æ­¤åœ¨è¿›ç¨‹æ‰§è¡ŒæœŸé—´, å½“éœ€è¦ I/O æ“ä½œæ—¶, æ“ä½œç³»ç»Ÿå°†å½“å‰è¿›ç¨‹ä»è¿è¡Œä¸­é˜Ÿåˆ—å‘é€åˆ°é˜»å¡é˜Ÿåˆ—. å½“è¿›ç¨‹å®Œæˆå®ƒçš„ I/O æ“ä½œæ—¶, åº”è¯¥å†æ¬¡å°†å®ƒç§»å›å‡†å¤‡é˜Ÿåˆ—. æ‰€æœ‰è¿™äº›æ“ä½œéƒ½ç”± medium-term scheduler å†³å®š, medium-term scheduling æ˜¯ swapping çš„ä¸€éƒ¨åˆ†</p>
</li>
<li><p><strong>Short term (CPU) scheduler â€“</strong> When there are lots of processes in main memory initially all are present in the ready queue. Among all of the process, a single process is to be selected for execution. This decision is handled by short term scheduler.Letâ€™s have a look at the figure given below. It may make a more clear view for you.</p>
<p>å½“ç”±å¤§é‡çš„è¿›ç¨‹åœ¨å‡†å¤‡é˜Ÿåˆ—æ—¶, åœ¨æ‰€æœ‰çš„è¿›ç¨‹ä¸­, åªæœ‰ä¸€ä¸ªè¿›ç¨‹è¢«é€‰æ‹©æ‰§è¡Œ. è¿™ç”± short term scheduler å†³å®š. </p>
</li>
</ol>
<p><img src="https://media.geeksforgeeks.org/wp-content/uploads/22_.png" alt=""></p>
<p>(PS: å…³äº CPU burst time, <a href="https://cs.stackexchange.com/questions/50438/how-does-the-os-determine-the-cpu-burst-time-of-a-process" target="_blank" rel="noopener">determine burst time</a>)</p>
<h3 id="difference-scheduling-algorithms"><a href="#difference-scheduling-algorithms" class="headerlink" title="difference scheduling algorithms"></a>difference scheduling algorithms</h3><p><strong><em>First Come First Serve (FCFS):</em></strong> Simplest scheduling algorithm that schedules according to arrival times of processes. First come first serve scheduling algorithm states that the process that requests the CPU first is allocated the CPU first. It is implemented by using the FIFO queue. When a process enters the ready queue, its PCB is linked onto the tail of the queue. When the CPU is free, it is allocated to the process at the head of the queue. The running process is then removed from the queue. FCFS is a non-preemptive scheduling algorithm.</p>
<p>æœ€ç®€å•çš„è°ƒåº¦ç®—æ³•æ ¹æ®æ—¶é—´è¿›ç¨‹çš„æ—¶é—´é¡ºåºè°ƒåº¦. å…ˆåˆ°å…ˆå¾—è°ƒåº¦ç®—æ³•å£°æ˜æœ€å…ˆè¯·æ±‚ CPU çš„è¿›ç¨‹æœ€å…ˆè¢«å¤„ç†. å…¶ä½¿ç”¨ FIFO é˜Ÿåˆ—å®ç°. å½“è¿›ç¨‹è¿›å…¥å‡†å¤‡é˜Ÿåˆ—æ—¶, PCB é“¾æ¥åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨(??? å•¥ä¸œè¥¿???) å½“ CPU ç©ºé—²æ—¶, CPU èµ„æºè¢«åˆ†é…ç»™é˜Ÿåˆ—å¤´éƒ¨çš„è¿›ç¨‹. è¿è¡Œä¸­è¿›ç¨‹ä»é˜Ÿåˆ—ä¸­ç§»é™¤, FCFS æ˜¯ä¸€ä¸ªéæŠ¢å…ˆå¼çš„è°ƒåº¦ç®—æ³•</p>
<p><strong>Note:</strong>First come first serve suffers from <a href="https://www.geeksforgeeks.org/convoy-effect-operating-systems/" target="_blank" rel="noopener">convoy effect</a>.</p>
<p>FCFS å— convoy effect å½±å“</p>
<p><strong><em>Shortest Job First (SJF):</em></strong> Process which have the shortest burst time are scheduled first.If two processes have the same bust time then FCFS is used to break the tie. It is a non-preemptive scheduling algorithm.</p>
<p>æ‹¥æœ‰æœ€çŸ­çªå‘æ—¶é—´çš„è¿›ç¨‹ä¼˜å…ˆè°ƒåº¦. å½“ä¸¤ä¸ªè¿›ç¨‹æ‹¥æœ‰åŒæ ·çš„çªå‘æ—¶é—´æ—¶, FCFS ç”¨äºè§£å†³è¿™ç§æƒ…å†µ. å®ƒåŒæ ·æ˜¯ä¸€ä¸ªéæŠ¢å è°ƒåº¦ç®—æ³•</p>
<p><strong><em>Longest Job First (LJF):</em></strong> It is similar to SJF scheduling algorithm. But, in this scheduling algorithm, we give priority to the process having the longest burst time. This is non-preemptive in nature i.e., when any process starts executing, canâ€™t be interrupted before complete execution.</p>
<p>ç±»ä¼¼ SJF è°ƒåº¦ç®—æ³•, ä½†æ˜¯, åœ¨è¿™ä¸ªè°ƒåº¦ç®—æ³•ä¸­, ç»™äºˆæœ€é•¿çªå‘æ—¶é—´ä¼˜å…ˆæƒé™. è¿™åŒæ ·ä¹Ÿæ˜¯éæŠ¢å å¼çš„. å½“è¿›ç¨‹å¼€å§‹æ‰§è¡Œæ—¶, ä¸èƒ½åœ¨å®Œæˆæ‰§è¡Œå‰è¢«æ‰“æ–­</p>
<p><strong><em>Shortest Remaining Time First (SRTF):</em></strong> It is preemptive mode of SJF algorithm in which jobs are schedule according to shortest remaining time.</p>
<p>æ˜¯ SJF è°ƒåº¦ç®—æ³•çš„æŠ¢å ç‰ˆæœ¬, æ ¹æ®æœ€å°‘å‰©ä½™æ—¶é—´è°ƒåº¦</p>
<p><strong><em>Longest Remaining Time First (LRTF):</em></strong> It is preemptive mode of LJF algorithm in which we give priority to the process having largest burst time remaining.</p>
<p>LJF ç®—æ³•çš„æŠ¢å æ¨¡å¼, ç»™äºˆæœ€å¤§çªå‘æ—¶é—´å‰©ä½™è¿›ç¨‹ä¼˜å…ˆæƒé™</p>
<p><strong><em>Round Robin Scheduling:</em></strong> Each process is assigned a fixed time(Time Quantum/Time Slice) in cyclic way.It is designed especially for the time-sharing system. The ready queue is treated as a circular queue. The CPU scheduler goes around the ready queue, allocating the CPU to each process for a time interval of up to 1-time quantum. To implement Round Robin scheduling, we keep the ready queue as a FIFO queue of processes. New processes are added to the tail of the ready queue. The CPU scheduler picks the first process from the ready queue, sets a timer to interrupt after 1-time quantum, and dispatches the process. One of two things will then happen. The process may have a CPU burst of less than 1-time quantum. In this case, the process itself will release the CPU voluntarily. The scheduler will then proceed to the next process in the ready queue. Otherwise, if the CPU burst of the currently running process is longer than 1-time quantum, the timer will go off and will cause an interrupt to the operating system. A context switch will be executed, and the process will be put at the tail of the ready queue. The CPU scheduler will then select the next process in the ready queue.</p>
<p>æ¯ä¸ªè¿›ç¨‹æ¯ä¸ªå‘¨æœŸè¢«åˆ†é…ä¸€ä¸ªå›ºå®šçš„æ—¶é—´(æ—¶é—´é‡å­/æ—¶é—´ç‰‡), è¿™ç‰¹åˆ«ä¸ºæ—¶é—´å…±äº«ç³»ç»Ÿæ‰€è®¾è®¡. å‡†å¤‡é˜Ÿåˆ—è¢«è§†ä½œä¸€ä¸ªå¾ªç¯çš„é˜Ÿåˆ—. CPU è°ƒåº¦å¾ªç¯å‡†å¤‡é˜Ÿåˆ—. åˆ†é… CPU èµ„æºç»™æ¯ä¸ªè¿›ç¨‹æœ€å¤šä¸€ä¸ªçš„æ—¶é—´é‡. </p>
<p>ä¸ºäº†å®ç° round robin scheduling å°†å‡†å¤‡é˜Ÿåˆ—ä¾æ—§ä¿æŒä¸º FIFO é˜Ÿåˆ—, æ–°çš„è¿›ç¨‹åœ¨é˜Ÿåˆ—çš„å°¾ç«¯åŠ å…¥, CPU ä»é˜Ÿåˆ—çš„å¤´éƒ¨é€‰å–ä¸€ä¸ªè¿›ç¨‹, è®¾ç½®åœ¨ä¸€ä¸ªæ—¶é—´é‡åä¸­æ–­çš„å®šæ—¶å™¨, æ´¾å‘è¿™ä¸ªè¿›ç¨‹. è¿™ä¸ªè¿›ç¨‹çš„ CPU çªå‘å¯èƒ½å°‘äº1ä¸ªæ—¶é—´é‡, åœ¨è¿™ç§æƒ…å†µä¸‹, è¿›ç¨‹ä¼šè‡ªåŠ¨é‡Šæ”¾ CPU èµ„æº, è°ƒåº¦å™¨ç»§ç»­å¤„ç†å‡†å¤‡é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹, å…¶ä»–æƒ…å†µä¸‹, å¦‚æœå½“å‰è¿›ç¨‹ CPU burst è¶…è¿‡1ä¸ªæ—¶é—´ç‰‡, å°†ä¼šè§¦å‘å®šæ—¶å™¨, å‘æ“ä½œç³»ç»Ÿå‘å‡ºä¸€ä¸ªä¸­æ–­. å°†ä¼šæ‰§è¡Œå†…å®¹åˆ‡æ¢, è¿›ç¨‹å°†ä¼šé‡æ–°æ”¾å…¥å‡†å¤‡é˜Ÿåˆ—çš„å°¾ç«¯. CPU è°ƒåº¦å°†ä¼šé€‰æ‹©å‡†å¤‡é˜Ÿåˆ—çš„ä¸‹ä¸€ä¸ªè¿›ç¨‹, ä»¥æ­¤å¾ªç¯.</p>
<p><strong><em>Priority Based scheduling (Non-Preemptive):</em></strong> In this scheduling, processes are scheduled according to their priorities, i.e., highest priority process is scheduled first. If priorities of two processes match, then schedule according to arrival time. Here starvation of process is possible.</p>
<p>åœ¨è¿™ä¸ªè°ƒåº¦ä¸‹, è¿›ç¨‹æ ¹æ®ä»–ä»¬çš„ä¼˜å…ˆçº§è°ƒåº¦, æ¯”å¦‚, é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¼šæœ‰é™è°ƒåº¦. å¦‚æœä¸¤ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§ç›¸ç­‰. åˆ™æ ¹æ®ä»–ä»¬çš„å…ˆåé¡ºåºè°ƒåº¦, æœ‰å¯èƒ½å‡ºç°é¥¥é¥¿çº¿ç¨‹</p>
<p><strong><em>Highest Response Ratio Next (HRRN):</em></strong> In this scheduling, processes with highest response ratio is scheduled. This algorithm avoids starvation.</p>
<pre><code>Response Ratio = (Waiting Time + Burst time) / Burst time</code></pre><p>åœ¨è¿™ç§è°ƒåº¦ä¸‹, æ‹¥æœ‰é«˜å“åº”æ¯”çš„è¿›ç¨‹æœ‰é™è°ƒåº¦, è¿™ä¸ªç®—æ³•é¿å…é¥¥é¥¿</p>
<p><strong><em>Multilevel Queue Scheduling:</em></strong> According to the priority of process, processes are placed in the different queues. Generally high priority process are placed in the top level queue. Only after completion of processes from top level queue, lower level queued processes are scheduled. It can suffer from starvation.</p>
<p>æ ¹æ®è¿›ç¨‹çš„ä¼˜å…ˆçº§, è¿›ç¨‹è¢«æ”¾ç½®åœ¨ä¸åŒçš„é˜Ÿåˆ—. é€šå¸¸, é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹è¢«æ”¾ç½®åœ¨ä¸Šå±‚é˜Ÿåˆ—. åªæœ‰åœ¨å®Œæˆä¸Šå±‚é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹å, ä½å±‚é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹æ‰ä¼šè¢«è°ƒåº¦, å®ƒæœ‰å¯èƒ½æŒ¨é¥¿</p>
<p><strong><em>Multi level Feedback Queue Scheduling:</em></strong> It allows the process to move in between queues. The idea is to separate processes according to the characteristics of their CPU bursts. If a process uses too much CPU time, it is moved to a lower-priority queue.</p>
<p>å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¸­ç§»åŠ¨, è¿™ä¸ªæƒ³æ³•æ ¹æ®å®ƒä»¬çš„ CPU çªå‘ç‰¹æ€§åŒºåˆ†è¿›ç¨‹, å¦‚æœè¿›ç¨‹ä½¿ç”¨è¿‡å¤šçš„ CPU æ—¶é—´, å®ƒå°†ä¼šè¢«ç§»åŠ¨åˆ°ä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—</p>
<p><strong>Some useful facts about Scheduling Algorithms:</strong></p>
<ol>
<li><p>FCFS can cause long waiting times, especially when the first job takes too much CPU time.</p>
<p>FCFS å¯èƒ½å¯¼è‡´é•¿æ—¶é—´ç­‰å¾…, ç‰¹åˆ«æ˜¯å½“ç¬¬ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå¤ªä¹…æ—¶</p>
</li>
<li><p>Both SJF and Shortest Remaining time first algorithms may cause starvation. Consider a situation when the long process is there in the ready queue and shorter processes keep coming.</p>
<p>SJF å’Œ shortest remaining time first ç®—æ³•å¯èƒ½å¯¼è‡´é¥¥é¥¿, è€ƒè™‘å½“é•¿çš„è¿›ç¨‹åœ¨å‡†å¤‡é˜Ÿåˆ—ä¸­, ä½†ä¸€ç›´æœ‰çŸ­è¿›ç¨‹ä¸æ–­åŠ å…¥çš„æƒ…æ™¯</p>
</li>
<li><p>If time quantum for Round Robin scheduling is very large, then it behaves same as FCFS scheduling.</p>
<p>å¦‚æœ round robin è°ƒåº¦çš„æ—¶é—´é‡å¤ªé•¿æ—¶, æƒ…å†µç±»ä¼¼äº FCFS è°ƒåº¦</p>
</li>
<li><p>SJF is optimal in terms of average waiting time for a given set of processes,i.e., average waiting time is minimum with this scheduling, but problems are, how to know/predict the time of next job.</p>
<p>å°±ç»™å®šä¸€ç»„è¿›ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´è€Œè¨€, SJF æ˜¯æœ€ä¼˜çš„, ä½†æ˜¯é—®é¢˜åœ¨äº, å¦‚ä½•é¢„æµ‹ä¸‹ä¸€ä¸ªä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>read/RedisMemoryOptimization</title>
    <url>/2020/01/09/read/RedisMemoryOptimization/</url>
    <content><![CDATA[<p><a href="https://redis.io/topics/memory-optimization" target="_blank" rel="noopener">åŸæ–‡åœ°å€</a></p>
<p>This page is a work in progress. Currently it is just a list of things you should check if you have problems with memory.</p>
<h2 id="Special-encoding-of-small-aggregate-data-types"><a href="#Special-encoding-of-small-aggregate-data-types" class="headerlink" title="Special encoding of small aggregate data types"></a>Special encoding of small aggregate data types</h2><p>Since Redis 2.2 many data types are optimized to use less space up to a certain size. Hashes, Lists, Sets composed of just integers, and Sorted Sets, when smaller than a given number of elements, and up to a maximum element size, are encoded in a very memory efficient way that uses <em>up to 10 times less memory</em> (with 5 time less memory used being the average saving).</p>
<p>ä» Redis 2.2 å¼€å§‹, è®¸å¤šæ•°æ®ç±»å‹ç»è¿‡ä¼˜åŒ–åä½¿ç”¨æ›´å°‘çš„ç©ºé—´. å“ˆå¸Œ, é“¾è¡¨, åªç”±æ•´å‹ç»„æˆçš„é›†åˆ, ä»¥åŠå·²æ’åºé›†åˆ.</p>
<p>å½“å°äºä¸€å®šé‡å…ƒç´ , å¹¶ä¸”å…ƒç´ å¤§å°è¾¾åˆ°æœ€å¤§æ—¶, æ•°æ®ä»¥ä¸€ç§ç›¸å½“é«˜æ•ˆçš„å†…å­˜æ–¹å¼ç¼–ç , åšå¤šå¯èŠ‚çœ 10 å€çš„å†…å­˜ç©ºé—´(å¹³å‡æ˜¯ 5 å€)</p>
<p>This is completely transparent from the point of view of the user and API. Since this is a CPU / memory trade off it is possible to tune the maximum number of elements and maximum element size for special encoded types using the following redis.conf directives.</p>
<p>ä»ç”¨æˆ·å’ŒAPIçš„è§’åº¦ä¸Šæ¥çœ‹, è¿™æ˜¯å®Œå…¨é€æ˜çš„. </p>
<p>å› ä¸ºè¿™æ˜¯ CPU/å†…å­˜ çš„æƒè¡¡, å¯ä»¥ä¸ºä½¿ç”¨ä»¥ä¸‹ redis.conf æŒ‡ä»¤çš„ç‰¹æ®Šç¼–ç ç±»å‹çš„æœ€å¤§å…ƒç´ æ•°é‡å’Œæœ€å¤§å…ƒç´ å¤§å°è¿›è¡Œè°ƒä¼˜</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hash-max-zipmap-entries 512 (hash-max-ziplist-entries for Redis &gt;&#x3D; 2.6)</span><br><span class="line">hash-max-zipmap-value 64  (hash-max-ziplist-value for Redis &gt;&#x3D; 2.6)</span><br><span class="line">list-max-ziplist-entries 512</span><br><span class="line">list-max-ziplist-value 64</span><br><span class="line">zset-max-ziplist-entries 128</span><br><span class="line">zset-max-ziplist-value 64</span><br><span class="line">set-max-intset-entries 512</span><br></pre></td></tr></table></figure>

<p>If a specially encoded value will overflow the configured max size, Redis will automatically convert it into normal encoding. This operation is very fast for small values, but if you change the setting in order to use specially encoded values for much larger aggregate types the suggestion is to run some benchmark and test to check the conversion time.</p>
<p>å¦‚æœç‰¹æ®Šç¼–ç çš„å€¼å°†è¶…è¿‡é…ç½®çš„æœ€å¤§å€¼, Redis å°†è‡ªåŠ¨è½¬æ¢å…¶ä¸ºæ™®é€šç¼–ç . å¯¹äºå°å€¼è½¬æ¢æ“ä½œéå¸¸å¿«, ä½†æ˜¯å¦‚æœæ›´æ”¹è®¾ç½®ä»¥ä¸ºæ›´å¤§çš„èšåˆç±»å‹ä½¿ç”¨ç‰¹æ®Šç¼–ç å€¼, å»ºè®®ä½¿ç”¨åŸºå‡†æµ‹è¯•æµ‹é‡è½¬æ¢æ—¶é—´</p>
<h2 id="Using-32-bit-instances"><a href="#Using-32-bit-instances" class="headerlink" title="Using 32 bit instances"></a>Using 32 bit instances</h2><p>Redis compiled with 32 bit target uses a lot less memory per key, since pointers are small, but such an instance will be limited to 4 GB of maximum memory usage. To compile Redis as 32 bit binary use <em>make 32bit</em>. RDB and AOF files are compatible between 32 bit and 64 bit instances (and between little and big endian of course) so you can switch from 32 to 64 bit, or the contrary, without problems.</p>
<p>ä½¿ç”¨32ä½ç¼–è¯‘çš„redisæ¯ä¸ªé”®å°‘ä½¿ç”¨å¾ˆå¤šç©ºé—´, å› ä¸ºæŒ‡é’ˆå˜å°äº†(8å­—èŠ‚å˜4å­—èŠ‚), ä½†æ˜¯è¿™æ ·æœ€å¤šå°±åªèƒ½ä½¿ç”¨4GBçš„å†…å­˜. </p>
<p>ä½¿ç”¨make 32bitå¯ä»¥å°†redisç¼–è¯‘ä¸º32ä½ç¨‹åº. RDBå’ŒAOFæ–‡ä»¶åœ¨32ä½å’Œ64ä½å®ä¾‹ä¸‹æ˜¯å…¼å®¹çš„(åŒæ ·ä¹Ÿæ˜¯å¤§å°ç«¯å…¼å®¹çš„)æ‰€ä»¥å¯ä»¥ä»32ä½å’Œ64ä½é—´åˆ‡æ¢</p>
<h2 id="Bit-and-byte-level-operations"><a href="#Bit-and-byte-level-operations" class="headerlink" title="Bit and byte level operations"></a>Bit and byte level operations</h2><p>Redis 2.2 introduced new bit and byte level operations: <a href="https://redis.io/commands/getrange" target="_blank" rel="noopener">GETRANGE</a>, <a href="https://redis.io/commands/setrange" target="_blank" rel="noopener">SETRANGE</a>, <a href="https://redis.io/commands/getbit" target="_blank" rel="noopener">GETBIT</a> and <a href="https://redis.io/commands/setbit" target="_blank" rel="noopener">SETBIT</a>. Using these commands you can treat the Redis string type as a random access array. For instance if you have an application where users are identified by a unique progressive integer number, you can use a bitmap in order to save information about the sex of users, setting the bit for females and clearing it for males, or the other way around. With 100 million users this data will take just 12 megabytes of RAM in a Redis instance. You can do the same using <a href="https://redis.io/commands/getrange" target="_blank" rel="noopener">GETRANGE</a> and <a href="https://redis.io/commands/setrange" target="_blank" rel="noopener">SETRANGE</a> in order to store one byte of information for each user. This is just an example but it is actually possible to model a number of problems in very little space with these new primitives.</p>
<p>redis 2.2 å¼•è¿›äº†æ–°çš„æ¯”ç‰¹å’Œä½çº§åˆ«çš„æ“ä½œ: GETRANGE, SETRANGE, GETBIT å’Œ SET BIT. ä½¿ç”¨è¿™äº›å‘½ä»¤, ä½ å¯ä»¥å¯¹å¾…stringç±»å‹åƒä¸€ä¸ªéšæœºè®¿é—®æ•°ç»„ä¸€æ ·(??? éš¾é“ä¸åº”è¯¥æ˜¯ä¹ˆ?) æ¯”å¦‚, å¦‚æœæœ‰è¿™æ ·ä¸€ä¸ªapp, ç”¨æˆ·ä»¥ä¸€ä¸ªå”¯ä¸€çš„æ•´å‹æ•°å­—æ ‡è¯†, ä½ å¯ä»¥ä½¿ç”¨bitmapä¿å­˜ç”¨æˆ·çš„æ€§åˆ«, ç”·çš„ç½®1, å¥³çš„æ¸…0, æˆ–è€…å…¶ä»–æ–¹å¼. 1äº¿ç”¨æˆ·åªéœ€è¦12mçš„å†…å­˜</p>
<p>ä½ å¯ä»¥å¤š GETRANGE å’Œ SETRANGE åšåŒæ ·çš„æ“ä½œ</p>
<h2 id="Use-hashes-when-possible"><a href="#Use-hashes-when-possible" class="headerlink" title="Use hashes when possible"></a>Use hashes when possible</h2><p>Small hashes are encoded in a very small space, so you should try representing your data using hashes every time it is possible. For instance if you have objects representing users in a web application, instead of using different keys for name, surname, email, password, use a single hash with all the required fields.</p>
<p>If you want to know more about this, read the next section.</p>
<h2 id="Using-hashes-to-abstract-a-very-memory-efficient-plain-key-value-store-on-top-of-Redis"><a href="#Using-hashes-to-abstract-a-very-memory-efficient-plain-key-value-store-on-top-of-Redis" class="headerlink" title="Using hashes to abstract a very memory efficient plain key-value store on top of Redis"></a>Using hashes to abstract a very memory efficient plain key-value store on top of Redis</h2><p>I understand the title of this section is a bit scaring, but Iâ€™m going to explain in details what this is about.</p>
<p>Basically it is possible to model a plain key-value store using Redis where values can just be just strings, that is not just more memory efficient than Redis plain keys but also much more memory efficient than memcached.</p>
<p>åœ¨ redis ä¸­å¯ä»¥å®ç°åªä½¿ç”¨å•çº¯stringä½œä¸ºå€¼çš„ key-value, æ¯” redis plain keys å’Œ memcached éƒ½è¦æ›´èŠ‚çœå†…å­˜</p>
<p>Letâ€™s start with some fact: a few keys use a lot more memory than a single key containing a hash with a few fields. How is this possible? We use a trick. In theory in order to guarantee that we perform lookups in constant time (also known as O(1) in big O notation) there is the need to use a data structure with a constant time complexity in the average case, like a hash table.</p>
<p>But many times hashes contain just a few fields. When hashes are small we can instead just encode them in an O(N) data structure, like a linear array with length-prefixed key value pairs. Since we do this only when N is small, the amortized time for HGET and HSET commands is still O(1): the hash will be converted into a real hash table as soon as the number of elements it contains will grow too much (you can configure the limit in redis.conf).</p>
<p>This does not work well just from the point of view of time complexity, but also from the point of view of constant times, since a linear array of key value pairs happens to play very well with the CPU cache (it has a better cache locality than a hash table).</p>
<p>However since hash fields and values are not (always) represented as full featured Redis objects, hash fields canâ€™t have an associated time to live (expire) like a real key, and can only contain a string. But we are okay with this, this was anyway the intention when the hash data type API was designed (we trust simplicity more than features, so nested data structures are not allowed, as expires of single fields are not allowed).</p>
<p>So hashes are memory efficient. This is very useful when using hashes to represent objects or to model other problems when there are group of related fields. But what about if we have a plain key value business?</p>
<p>Imagine we want to use Redis as a cache for many small objects, that can be JSON encoded objects, small HTML fragments, simple key -&gt; boolean values and so forth. Basically anything is a string -&gt; string map with small keys and values.</p>
<p>Now letâ€™s assume the objects we want to cache are numbered, like:</p>
<ul>
<li>object:102393</li>
<li>object:1234</li>
<li>object:5</li>
</ul>
<p>This is what we can do. Every time there is to perform a SET operation to set a new value, we actually split the key into two parts, one used as a key, and used as field name for the hash. For instance the object named â€œobject:1234â€ is actually split into:</p>
<ul>
<li>a Key named object:12</li>
<li>a Field named 34</li>
</ul>
<p>So we use all the characters but the latest two for the key, and the final two characters for the hash field name. To set our key we use the following command:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">HSET object:12 34 somevalue</span><br></pre></td></tr></table></figure>

<p>As you can see every hash will end containing 100 fields, that is an optimal compromise between CPU and memory saved.</p>
<p>There is another very important thing to note, with this schema every hash will have more or less 100 fields regardless of the number of objects we cached. This is since our objects will always end with a number, and not a random string. In some way the final number can be considered as a form of implicit pre-sharding.</p>
<p>What about small numbers? Like object:2? We handle this case using just â€œobject:â€ as a key name, and the whole number as the hash field name. So object:2 and object:10 will both end inside the key â€œobject:â€, but one as field name â€œ2â€ and one as â€œ10â€.</p>
<p>How much memory we save this way?</p>
<p>I used the following Ruby program to test how this works:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">require &#39;rubygems&#39;</span><br><span class="line">require &#39;redis&#39;</span><br><span class="line"></span><br><span class="line">UseOptimization &#x3D; true</span><br><span class="line"></span><br><span class="line">def hash_get_key_field(key)</span><br><span class="line">    s &#x3D; key.split(&quot;:&quot;)</span><br><span class="line">    if s[1].length &gt; 2</span><br><span class="line">        &#123;:key &#x3D;&gt; s[0]+&quot;:&quot;+s[1][0..-3], :field &#x3D;&gt; s[1][-2..-1]&#125;</span><br><span class="line">    else</span><br><span class="line">        &#123;:key &#x3D;&gt; s[0]+&quot;:&quot;, :field &#x3D;&gt; s[1]&#125;</span><br><span class="line">    end</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def hash_set(r,key,value)</span><br><span class="line">    kf &#x3D; hash_get_key_field(key)</span><br><span class="line">    r.hset(kf[:key],kf[:field],value)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">def hash_get(r,key,value)</span><br><span class="line">    kf &#x3D; hash_get_key_field(key)</span><br><span class="line">    r.hget(kf[:key],kf[:field],value)</span><br><span class="line">end</span><br><span class="line"></span><br><span class="line">r &#x3D; Redis.new</span><br><span class="line">(0..100000).each&#123;|id|</span><br><span class="line">    key &#x3D; &quot;object:#&#123;id&#125;&quot;</span><br><span class="line">    if UseOptimization</span><br><span class="line">        hash_set(r,key,&quot;val&quot;)</span><br><span class="line">    else</span><br><span class="line">        r.set(key,&quot;val&quot;)</span><br><span class="line">    end</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This is the result against a 64 bit instance of Redis 2.2:</p>
<ul>
<li>UseOptimization set to true: 1.7 MB of used memory</li>
<li>UseOptimization set to false; 11 MB of used memory</li>
</ul>
<p>This is an order of magnitude, I think this makes Redis more or less the most memory efficient plain key value store out there.</p>
<p><em>WARNING</em>: for this to work, make sure that in your redis.conf you have something like this:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hash-max-zipmap-entries 256</span><br></pre></td></tr></table></figure>

<p>Also remember to set the following field accordingly to the maximum size of your keys and values:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hash-max-zipmap-value 1024</span><br></pre></td></tr></table></figure>

<p>Every time a hash will exceed the number of elements or element size specified it will be converted into a real hash table, and the memory saving will be lost.</p>
<p>You may ask, why donâ€™t you do this implicitly in the normal key space so that I donâ€™t have to care? There are two reasons: one is that we tend to make trade offs explicit, and this is a clear tradeoff between many things: CPU, memory, max element size. The second is that the top level key space must support a lot of interesting things like expires, LRU data, and so forth so it is not practical to do this in a general way.</p>
<p>But the Redis Way is that the user must understand how things work so that he is able to pick the best compromise, and to understand how the system will behave exactly.</p>
<h2 id="Memory-allocation"><a href="#Memory-allocation" class="headerlink" title="Memory allocation"></a>Memory allocation</h2><p>To store user keys, Redis allocates at most as much memory as the <code>maxmemory</code> setting enables (however there are small extra allocations possible).</p>
<p>The exact value can be set in the configuration file or set later via <a href="https://redis.io/commands/config-set" target="_blank" rel="noopener">CONFIG SET</a> (see <a href="http://redis.io/topics/lru-cache" target="_blank" rel="noopener">Using memory as an LRU cache for more info</a>). There are a few things that should be noted about how Redis manages memory:</p>
<ul>
<li>Redis will not always free up (return) memory to the OS when keys are removed. This is not something special about Redis, but it is how most malloc() implementations work. For example if you fill an instance with 5GB worth of data, and then remove the equivalent of 2GB of data, the Resident Set Size (also known as the RSS, which is the number of memory pages consumed by the process) will probably still be around 5GB, even if Redis will claim that the user memory is around 3GB. This happens because the underlying allocator canâ€™t easily release the memory. For example often most of the removed keys were allocated in the same pages as the other keys that still exist.</li>
<li>The previous point means that you need to provision memory based on your <strong>peak memory usage</strong>. If your workload from time to time requires 10GB, even if most of the times 5GB could do, you need to provision for 10GB.</li>
<li>However allocators are smart and are able to reuse free chunks of memory, so after you freed 2GB of your 5GB data set, when you start adding more keys again, youâ€™ll see the RSS (Resident Set Size) to stay steady and donâ€™t grow more, as you add up to 2GB of additional keys. The allocator is basically trying to reuse the 2GB of memory previously (logically) freed.</li>
<li>Because of all this, the fragmentation ratio is not reliable when you had a memory usage that at peak is much larger than the currently used memory. The fragmentation is calculated as the amount of memory currently in use (as the sum of all the allocations performed by Redis) divided by the physical memory actually used (the RSS value). Because the RSS reflects the peak memory, when the (virtually) used memory is low since a lot of keys / values were freed, but the RSS is high, the ratio <code>mem_used / RSS</code> will be very high.</li>
</ul>
<p>If <code>maxmemory</code> is not set Redis will keep allocating memory as it finds fit and thus it can (gradually) eat up all your free memory. Therefore it is generally advisable to configure some limit. You may also want to set <code>maxmemory-policy</code> to <code>noeviction</code> (which is <em>not</em> the default value in some older versions of Redis).</p>
<p>It makes Redis return an out of memory error for write commands if and when it reaches the limit - which in turn may result in errors in the application but will not render the whole machine dead because of memory starvation.</p>
<h2 id="Work-in-progress"><a href="#Work-in-progress" class="headerlink" title="Work in progress"></a>Work in progress</h2><p>Work in progressâ€¦ more tips will be added soon.</p>
]]></content>
  </entry>
  <entry>
    <title>read/MinimunWindowSubstring</title>
    <url>/2020/01/09/read/MinimunWindowSubstring/</url>
    <content><![CDATA[<p>Minimum Window Substring</p>
<p><img src="https://imgur.com/nTiEE6m.png" alt=""></p>
<p>æ‰¾åˆ°å­—ç¬¦ä¸² S ä¸­åŒ…å«å­—ç¬¦ä¸² T æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸²</p>
<h2 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">minWindow</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (t.<span class="built_in">size</span>() &gt; s.<span class="built_in">size</span>()) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> had = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>, e = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">string</span> tmpt = t;</span><br><span class="line">        <span class="built_in">map</span>&lt;<span class="keyword">char</span>, <span class="keyword">int</span>&gt; used;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> indx = tmpt.<span class="built_in">find</span>(s[i]);</span><br><span class="line">            <span class="keyword">if</span> (indx == <span class="built_in">string</span>::npos) &#123;</span><br><span class="line">                ++used[s[i]]; <span class="keyword">continue</span>; </span><br><span class="line">            &#125;</span><br><span class="line">            tmpt.erase(tmpt.<span class="built_in">begin</span>() + indx);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (had++ == <span class="number">0</span>) b = i;</span><br><span class="line">            <span class="keyword">if</span> (tmpt.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">                e = i; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (had != t.<span class="built_in">size</span>()) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> rb = b, re = e;</span><br><span class="line">        <span class="keyword">while</span> (b &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">char</span> need = s[b++];</span><br><span class="line">            <span class="keyword">while</span> (b &lt; s.<span class="built_in">size</span>() &amp;&amp; t.<span class="built_in">find</span>(s[b]) == <span class="built_in">string</span>::npos) b++;</span><br><span class="line">            <span class="keyword">if</span> (b &gt;= s.<span class="built_in">size</span>()) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (used[need] &gt; <span class="number">0</span>) &#123; </span><br><span class="line">                <span class="keyword">if</span> (e - b &lt; re - rb) &#123;</span><br><span class="line">                    rb = b; re = e;</span><br><span class="line">                &#125;</span><br><span class="line">                --used[need]; <span class="keyword">continue</span>; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (++e &lt; s.<span class="built_in">size</span>() &amp;&amp; s[e] != need)</span><br><span class="line">                ++used[s[e]];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (e &gt;= s.<span class="built_in">size</span>()) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (e - b &lt; re - rb) &#123;</span><br><span class="line">                rb = b; re = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> s.substr(rb, re - rb + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»£ç é‡æŒºå¤§çš„â€¦ </p>
<p>ç®€å•æ¥è¯´, æˆ‘çš„æƒ³æ³•æ˜¯é¦–å…ˆæ‰¾åˆ°æœ€å·¦è¾¹åŒ…å«æ‰€æœ‰å­—ç¬¦çš„æœ€å°å­ä¸², ç„¶å slide window , æ…¢æ…¢ç§»åŠ¨åˆ°å­—ç¬¦ S å°¾ç«¯ </p>
<p>è¿™æ ·çš„è¯, å¤æ‚åº¦å°±æ˜¯ O(n)</p>
<h2 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h2><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">minWindow</span><span class="params">(<span class="built_in">string</span> s, <span class="built_in">string</span> t)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; hash(<span class="number">128</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> c: t) hash[c]++;</span><br><span class="line">        <span class="keyword">int</span> count = t.<span class="built_in">size</span>(), start = <span class="number">0</span>, <span class="built_in">end</span> = <span class="number">0</span>, minStart, minLen = INT_MAX;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">end</span> &lt; s.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="keyword">if</span>(hash[s[<span class="built_in">end</span>]] &gt; <span class="number">0</span>) count--;</span><br><span class="line">            hash[s[<span class="built_in">end</span>]]--;</span><br><span class="line">            <span class="built_in">end</span>++;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span>(count == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span>(hash[s[start]] == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="built_in">end</span> - start &lt; minLen) &#123;</span><br><span class="line">                        minStart = start;</span><br><span class="line">                        minLen = <span class="built_in">end</span> - start;</span><br><span class="line">                    &#125;</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">                hash[s[start]]++;</span><br><span class="line">                start++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(minLen == INT_MAX) <span class="keyword">return</span> <span class="string">""</span>;</span><br><span class="line">        <span class="keyword">return</span> s.substr(minStart, minLen);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å®ƒä¹Ÿæ˜¯ç±»ä¼¼ slide window çš„åšæ³•, ä¸è¿‡æ¯”æˆ‘ç®€æ´å¾—å¤š, ä»å®ç°è§’åº¦ä¸Š, æ¯”æˆ‘è¦å¥½ä¸€äº›</p>
<p>PS : è¿™æ˜¯ hard éš¾åº¦çš„é¢˜, ä½†æ˜¯åšå®Œåæ„Ÿè§‰ä¹Ÿå°±é‚£æ ·â€¦  </p>
<p>æ˜¯ä¸æ˜¯æ‰€æœ‰ hard éš¾åº¦çš„é¢˜å…¶å®æœ¬è´¨ä¸Šçš„è§£å†³æ–¹æ³•éƒ½ä¸éš¾ ? æˆ–è®¸æˆ‘å¯¹äºè¿™äº›çš„ç†è§£è¿˜ä¸å¤Ÿæ·±åˆ»</p>
<p>æ„Ÿè§‰æˆ‘å†åŠ æ·±ä¸€ä¸‹, åº”è¯¥å°±èƒ½è¾ƒä¸ºè½»æ¾åº”å¯¹ hard äº† :) (è†¨èƒ€ingâ€¦ )</p>
]]></content>
  </entry>
  <entry>
    <title>read/LocksSetbyDifferentSQLStatementsinInnoDB</title>
    <url>/2020/01/09/read/LocksSetbyDifferentSQLStatementsinInnoDB/</url>
    <content><![CDATA[<h3 id="15-7-3-Locks-Set-by-Different-SQL-Statements-in-InnoDB"><a href="#15-7-3-Locks-Set-by-Different-SQL-Statements-in-InnoDB" class="headerlink" title="15.7.3 Locks Set by Different SQL Statements in InnoDB"></a>15.7.3 Locks Set by Different SQL Statements in InnoDB</h3><p>If a secondary index is used in a search and index record locks to be set are exclusive, <code>InnoDB</code> also retrieves the corresponding clustered index records and sets locks on them.</p>
<p>å¦‚æœåœ¨æœç´¢ä¸­ä½¿ç”¨æ¬¡çº§ç´¢å¼•, å¹¶ä¸”ç´¢å¼•è®°å½•é”è¢«è®¾ç½®ä¸ºäº’æ–¥. InnoDB è¿˜æ£€ç´¢ç›¸åº”çš„èšç°‡ç´¢å¼•è®°å½•, åœ¨è®°å½•ä¸Šè®¾ç½®é”</p>
<p>If you have no indexes suitable for your statement and MySQL must scan the entire table to process the statement, every row of the table becomes locked, which in turn blocks all inserts by other users to the table. It is important to create good indexes so that your queries do not unnecessarily scan many rows.</p>
<p>å¦‚æœè¯­å¥æ²¡æœ‰é€‚å½“çš„ç´¢å¼•, MySQL å¿…é¡»æ‰«ææ•´ä¸ªè¡¨. è¡¨çš„æ¯è¡Œéƒ½è¢«åŠ é”, è¿™ä¼šå¯¼è‡´å…¶ä»–ç”¨æˆ·åœ¨è¯¥è¡¨çš„æ’å…¥æ“ä½œè¢«é˜»å¡. åˆ›å»ºå¥½çš„ç´¢å¼•éå¸¸é‡è¦, è¿™æ ·æŸ¥è¯¢è¯­å¥å°±ä¸éœ€è¦æ‰«æå¤§é‡è¡Œ</p>
<p><code>InnoDB</code> sets specific types of locks as follows.</p>
<ul>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT ... FROM</code></a> is a consistent read, reading a snapshot of the database and setting no locks unless the transaction isolation level is set to <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_serializable" target="_blank" rel="noopener"><code>SERIALIZABLE</code></a>. For<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_serializable" target="_blank" rel="noopener"><code>SERIALIZABLE</code></a> level, the search sets shared next-key locks on the index records it encounters. However, only an index record lock is required for statements that lock rows using a unique index to search for a unique row.</p>
<p>SELECT â€¦ FROM å…·æœ‰ä¸€è‡´è¯»å±æ€§, è¯»å–æ•°æ®åº“çš„å¿«ç…§, é™¤éäº‹åŠ¡éš”ç¦»ç­‰çº§è®¾ç½®ä¸ºåºåˆ—åŒ–, å¦åˆ™ä¸åŠ é”.</p>
<p>å¯¹åºåˆ—åŒ–éš”ç¦»ç­‰çº§, æœç´¢è®¾ç½®å…±äº«çš„ next-key é”åœ¨é‡åˆ°çš„ç´¢å¼•è®°å½•ä¸Š, ç„¶è€Œ, ä½¿ç”¨å”¯ä¸€ç´¢å¼•å»æœç´¢å”¯ä¸€è¡Œçš„è¯­å¥, åªæœ‰ç´¢å¼•è®°å½•é”æ˜¯å¿…é¡»çš„ (PS. æˆ‘ä¸æ‡‚ = =â€¦ )</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT ... FOR UPDATE</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT ... FOR SHARE</code></a> statements that use a unique index acquire locks for scanned rows, and release the locks for rows that do not qualify for inclusion in the result set (for example, if they do not meet the criteria given in the <code>WHERE</code> clause). However, in some cases, rows might not be unlocked immediately because the relationship between a result row and its original source is lost during query execution. For example, in a <a href="https://dev.mysql.com/doc/refman/8.0/en/union.html" target="_blank" rel="noopener"><code>UNION</code></a>, scanned (and locked) rows from a table might be inserted into a temporary table before evaluation whether they qualify for the result set. In this circumstance, the relationship of the rows in the temporary table to the rows in the original table is lost and the latter rows are not unlocked until the end of query execution.</p>
<p>SELECT â€¦ FOR UPDATE å’Œ SELECT â€¦ FOR SHARE è¯­å¥ä½¿ç”¨å”¯ä¸€ç´¢å¼•è·å–é”æ‰«æè¡Œ, é‡Šæ”¾ä¸ç¬¦åˆè¿”å›é›†åˆçš„é” (æ¯”å¦‚, å¦‚æœå®ƒä»¬ä¸åœ¨ WHERE å­å¥æ¡ä»¶ä¸­). ç„¶è€Œ, åœ¨æŸäº›æ¡ä»¶ä¸‹, è¡Œå¯èƒ½ä¸ä¼šè¢«ç«‹å³è§£é”, å› ä¸ºè¿”å›è¡Œå’Œå®ƒåŸå§‹èµ„æºåœ¨æŸ¥è¯¢è¯­å¥æ‰§è¡ŒæœŸé—´ä¸¢å¤±äº†. æ¯”å¦‚, åœ¨ UNION è¯­å¥ä¸­, æ¥è‡ªè¡¨çš„å·²æ‰«æ(å’Œå·²é”)è¡Œåœ¨å®ƒä»¬è¢«è¯„ä¼°æ˜¯å¦ç¬¦åˆæœç´¢ç»“æœæ—¶, å¯èƒ½è¢«æ’å…¥åˆ°ä¸´æ—¶è¡¨ä¸­, åœ¨è¿™æ ·çš„ç¯å¢ƒä¸‹, ä¸´æ—¶è¡¨ä¸­çš„è¡Œä¸åŸå§‹è¡¨ä¸­çš„è¡Œçš„å…³ç³»å°†ä¼šä¸¢å¤±, åé¢çš„è¡Œç›´åˆ°æŸ¥è¯¢ç»“æŸåæ‰è§£é”</p>
</li>
<li><p>For <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_locking_read" target="_blank" rel="noopener">locking reads</a> (<a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT</code></a> with <code>FOR UPDATE</code> or <code>FOR SHARE</code>), <a href="https://dev.mysql.com/doc/refman/8.0/en/update.html" target="_blank" rel="noopener"><code>UPDATE</code></a>, and <a href="https://dev.mysql.com/doc/refman/8.0/en/delete.html" target="_blank" rel="noopener"><code>DELETE</code></a> statements, the locks that are taken depend on whether the statement uses a unique index with a unique search condition, or a range-type search condition.</p>
<p>å¯¹äºåŠ é”è¯»(SELECT å’Œ FRO UPDATE æˆ– FOR SHARED é…åˆ), UPDATE, å’Œ DELETE è¯­å¥, æ˜¯å¦åŠ é”å–å†³äºè¯­å¥æ˜¯å¦ä½¿ç”¨å…·æœ‰å”¯ä¸€æœç´¢æ¡ä»¶æˆ–èŒƒå›´ç±»å‹æœç´¢æ¡ä»¶çš„å”¯ä¸€ç´¢å¼•</p>
<ul>
<li><p>For a unique index with a unique search condition, <code>InnoDB</code> locks only the index record found, not the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_gap" target="_blank" rel="noopener">gap</a> before it.</p>
<p>å¯¹äºå…·æœ‰å”¯ä¸€æœç´¢æ¡ä»¶çš„å”¯ä¸€ç´¢å¼•è€Œè¨€, InnoDB åªé”å®šæŸ¥æ‰¾åˆ°çš„ç´¢å¼•è®°å½•, ä¸åŒ…å«å‰é¢çš„é—´éš™</p>
</li>
<li><p>For other search conditions, and for non-unique indexes, <code>InnoDB</code> locks the index range scanned, using <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_gap_lock" target="_blank" rel="noopener">gap locks</a> or <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_next_key_lock" target="_blank" rel="noopener">next-key locks</a> to block insertions by other sessions into the gaps covered by the range. For information about gap locks and next-key locks, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-locking.html" target="_blank" rel="noopener">Section 15.7.1, â€œInnoDB Lockingâ€</a>.</p>
<p>å¯¹äºå…¶ä»–æœç´¢æ¡ä»¶, ä»¥åŠéå”¯ä¸€ç´¢å¼•, InnoDB é”å®šèŒƒå›´æ‰«æçš„ç´¢å¼•, ä½¿ç”¨é—´éš™é”æˆ– next-key (PS. æˆ‘çœŸä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘è¿™ä¸ªæ¯”è¾ƒä¼˜é›… = =) é”é˜»å¡å…¶ä»–ä¼šè¯åŒ…å«èŒƒå›´çš„æ’å…¥</p>
</li>
</ul>
</li>
<li><p>For index records the search encounters, <a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT ... FOR UPDATE</code></a> blocks other sessions from doing <a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT ... FOR SHARE</code></a> or from reading in certain transaction isolation levels. Consistent reads ignore any locks set on the records that exist in the read view.</p>
<p>æœç´¢æ‰€é‡è§çš„ç´¢å¼•è®°å½•, SELECT â€¦ FOR UPDATE é˜»å¡å…¶ä»–æ¥è‡ª SELECT â€¦ FOR SHARE æˆ– æ¥è‡ªåœ¨æŸä¸€éš”ç¦»çº§åˆ«çš„è¯»å–æ“ä½œçš„ä¼šè¯, ä¸€è‡´è¯»å¿½ç•¥ä»»ä½•åœ¨è¯»å–è§†å›¾ä¸­çš„è®°å½•ä¸Šè®¾ç½®çš„é”</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/update.html" target="_blank" rel="noopener"><code>UPDATE ... WHERE ...</code></a> sets an exclusive next-key lock on every record the search encounters. However, only an index record lock is required for statements that lock rows using a unique index to search for a unique row.</p>
<p>UPDATE â€¦ WHERE â€¦ è®¾ç½®äº’æ–¥ next-key é”åˆ°æ¯ä¸ªæœç´¢é‡åˆ°çš„è®°å½•ä¸Š, ç„¶è€Œ, ä½¿ç”¨å”¯ä¸€ç´¢å¼•æŸ¥æ‰¾å”¯ä¸€è¡Œçš„è¯­å¥åªéœ€è¦ä¸€ä¸ªç´¢å¼•è®°å½•é”</p>
</li>
<li><p>When <a href="https://dev.mysql.com/doc/refman/8.0/en/update.html" target="_blank" rel="noopener"><code>UPDATE</code></a> modifies a clustered index record, implicit locks are taken on affected secondary index records. The <a href="https://dev.mysql.com/doc/refman/8.0/en/update.html" target="_blank" rel="noopener"><code>UPDATE</code></a> operation also takes shared locks on affected secondary index records when performing duplicate check scans prior to inserting new secondary index records, and when inserting new secondary index records.</p>
<p>å½“ UPDATE æ›´æ”¹èšç°‡ç´¢å¼•è®°å½•æ—¶, åœ¨å—å½±å“çš„æ¬¡çº§ç´¢å¼•ä¸Šæ·»åŠ ä¸€ä¸ªéšå¼é”. UPDATE è¿˜ä¼šåœ¨æ’å…¥æ–°çš„æ¬¡çº§ç´¢å¼•è®°å½•å‰, æ‰§è¡Œé‡å¤æ£€æŸ¥æ‰«ææ—¶, å‘å—å½±å“çš„æ¬¡çº§ç´¢å¼•è®°å½•ä¸Šæ·»åŠ å…±äº«é”</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/delete.html" target="_blank" rel="noopener"><code>DELETE FROM ... WHERE ...</code></a> sets an exclusive next-key lock on every record the search encounters. However, only an index record lock is required for statements that lock rows using a unique index to search for a unique row.</p>
<p>DELETE FROM â€¦ WHERE â€¦ ç»™æ¯ä¸ªæœç´¢é‡åˆ°çš„è®°å½•è®¾ç½®ä¸€ä¸ªäº’æ–¥é”, ç„¶è€Œ, (PS. ä¸€æ¨¡ä¸€æ · = =)</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/insert.html" target="_blank" rel="noopener"><code>INSERT</code></a> sets an exclusive lock on the inserted row. This lock is an index-record lock, not a next-key lock (that is, there is no gap lock) and does not prevent other sessions from inserting into the gap before the inserted row.</p>
<p>INSERT åœ¨æ’å…¥è¡Œè®¾ç½®äº’æ–¥é”, è¿™æ˜¯ä¸€ä¸ªç´¢å¼•è®°å½•é”, è€Œé next-key é” (ä¹Ÿå°±æ˜¯è¯´, ä¸æ˜¯é—´éš™é”)</p>
<p>Prior to inserting the row, a type of gap lock called an insert intention gap lock is set. This lock signals the intent to insert in such a way that multiple transactions inserting into the same index gap need not wait for each other if they are not inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to insert values of 5 and 6 each lock the gap between 4 and 7 with insert intention locks prior to obtaining the exclusive lock on the inserted row, but do not block each other because the rows are nonconflicting.</p>
<p>åœ¨æ’å…¥è¡Œä¹‹å‰, ä¸€ç§ç§°ä¸ºæ’å…¥æ„å›¾é—´éš™é”çš„é—´éš™é”è¢«è®¾ç½®. è¿™ä¸ªé”è¡¨ç¤ºæ„å›¾ä¸€ç§æ’å…¥æ–¹å¼ : å¤šä¸ªäº‹åŠ¡æ’å…¥åŒæ ·çš„ç´¢å¼•é—´éš™, å¦‚æœå®ƒä»¬ä¸æ˜¯æ’å…¥é—´éš™ä¸­çš„åŒæ ·ä½ç½®, é‚£ä¹ˆä¸å¿…ç­‰å¾…å…¶ä»–äº‹åŠ¡å®Œæˆ (PS. ä¾‹å¦‚, ä½ æƒ³æ’å…¥ 4 å’Œ 5 åˆ° 3 å’Œ7 ä¹‹é—´, 4 å’Œ 5 è™½ç„¶æ’å…¥çš„æ˜¯åŒæ ·çš„é—´éš™, ä½†æ˜¯å®ƒä»¬æ’å…¥çš„ä½ç½®æ˜¯ä¸åŒçš„, æ‰€ä»¥ä¸åº”è¯¥é˜»å¡å½¼æ­¤) å‡è®¾æœ‰å€¼ä¸º 4 å’Œ 7 çš„ç´¢å¼•è®°å½•, äº‹åŠ¡åˆ†åˆ«å°è¯•æ’å…¥å€¼ 5 å’Œ 6, æ¯ä¸ªäº‹åŠ¡åœ¨è·å–è¡Œçš„äº’æ–¥é”ä¹‹å‰éƒ½ä½¿ç”¨æ’å…¥é—´éš™é”é”ä½é—´éš™ 4 åˆ° 7, ä½†æ˜¯å› ä¸ºè¡Œä¸å†²çª, æ‰€ä»¥ä¸ä¼šé˜»å¡å½¼æ­¤</p>
<p>If a duplicate-key error occurs, a shared lock on the duplicate index record is set. This use of a shared lock can result in deadlock should there be multiple sessions trying to insert the same row if another session already has an exclusive lock. This can occur if another session deletes the row. Suppose that an <code>InnoDB</code> table <code>t1</code> has the following structure:</p>
<p>å¦‚æœå‘ç”Ÿé‡å¤é”®é”™è¯¯, åœ¨é‡å¤æ‰€ä»¥è®°å½•ä¸Šè®¾ç½®ä¸€ä¸ªå…±äº«é”, è¿™ç§å…±äº«é”çš„ç”¨æ³•ä¼šå¯¼è‡´æ­»é” : å¯èƒ½ä¼šæœ‰å¤šä¸ªä¼šè¯å°è¯•æ’å…¥åŒæ ·çš„è¡Œ, ä½†å½¼æ­¤éƒ½å·²ç»æœ‰äº†ä¸€ä¸ªäº’æ–¥é”. å¦‚æœå…¶ä»–çš„äº‹åŠ¡å°è¯•åˆ é™¤è¡Œ, é‚£ä¹ˆå¯èƒ½ä¼šå‡ºé”™. å‡è®¾ InnoDB è¡¨ t1 æœ‰å¦‚ä¸‹ç»“æ„ : </p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (i <span class="built_in">INT</span>, PRIMARY <span class="keyword">KEY</span> (i)) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>

<p>Now suppose that three sessions perform the following operations in order:</p>
<p>Session 1:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Session 2:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Session 3:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Session 1:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">ROLLBACK</span>;</span><br></pre></td></tr></table></figure>

<p>The first operation by session 1 acquires an exclusive lock for the row. The operations by sessions 2 and 3 both result in a duplicate-key error and they both request a shared lock for the row. When session 1 rolls back, it releases its exclusive lock on the row and the queued shared lock requests for sessions 2 and 3 are granted. At this point, sessions 2 and 3 deadlock: Neither can acquire an exclusive lock for the row because of the shared lock held by the other.</p>
<p>ä¼šè¯1 çš„æ“ä½œè·å–è¡Œçš„äº’æ–¥é”, ä¼šè¯2 å’Œ ä¼šè¯3 éƒ½ä¼šå¯¼è‡´é‡å¤é”®é”™è¯¯, éƒ½è¯·æ±‚è·å¾—å…±äº«é”. å½“ ä¼šè¯1 å›æ»šå, é‡Šæ”¾å®ƒåœ¨è¡Œä¸Šçš„äº’æ–¥é”, æ’é˜Ÿçš„ ä¼šè¯2 å’Œ ä¼šè¯3 è¢«æˆæƒå…±äº«é”è¯·æ±‚, æ­¤æ—¶, ä¼šè¯2 å’Œ ä¼šè¯3 å°†ä¼šé™·å…¥æ­»é”çŠ¶æ€. æ²¡æœ‰ä¼šè¯èƒ½è·å–è¡Œäº’æ–¥é”, å› ä¸ºå½¼æ­¤æŒæœ‰å…±äº«é”</p>
<p>A similar situation occurs if the table already contains a row with key value 1 and three sessions perform the following operations in order:</p>
<p>ç±»ä¼¼çš„æƒ…å†µè¿˜æœ‰ : å¦‚æœè¡¨å·²ç»åŒ…å«äº†å…·æœ‰é”®å€¼ 1 çš„è¡Œ, ä¸‰ä¸ªä¼šè¯é¡ºåºæ‰§è¡Œå¦‚ä¸‹æ“ä½œ</p>
<p>Session 1:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> t1 <span class="keyword">WHERE</span> i = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>Session 2:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Session 3:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">START</span> <span class="keyword">TRANSACTION</span>;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t1 <span class="keyword">VALUES</span>(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p>Session 1:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">COMMIT</span>;</span><br></pre></td></tr></table></figure>

<p>The first operation by session 1 acquires an exclusive lock for the row. The operations by sessions 2 and 3 both result in a duplicate-key error and they both request a shared lock for the row. When session 1 commits, it releases its exclusive lock on the row and the queued shared lock requests for sessions 2 and 3 are granted. At this point, sessions 2 and 3 deadlock: Neither can acquire an exclusive lock for the row because of the shared lock held by the other.</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/insert-on-duplicate.html" target="_blank" rel="noopener"><code>INSERT ... ON DUPLICATE KEY UPDATE</code></a> differs from a simple <a href="https://dev.mysql.com/doc/refman/8.0/en/insert.html" target="_blank" rel="noopener"><code>INSERT</code></a> in that an exclusive lock rather than a shared lock is placed on the row to be updated when a duplicate-key error occurs. An exclusive index-record lock is taken for a duplicate primary key value. An exclusive next-key lock is taken for a duplicate unique key value.</p>
<p>INSERT â€¦ ON DUPLICATE KEY UPDATE ä¸åŒäºç®€å•çš„ INSERT, å½“é‡å¤é”®é”™è¯¯å‘ç”Ÿæ—¶, å®ƒè·å–è¡Œçš„äº’æ–¥é”è€Œéå…±äº«é”, é‡å¤ä¸»é”®å€¼è·å–äº’æ–¥ç´¢å¼•è®°å½•é”, é‡å¤å”¯ä¸€é”®å€¼è·å–äº’æ–¥ next-key é”</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/replace.html" target="_blank" rel="noopener"><code>REPLACE</code></a> is done like an <a href="https://dev.mysql.com/doc/refman/8.0/en/insert.html" target="_blank" rel="noopener"><code>INSERT</code></a> if there is no collision on a unique key. Otherwise, an exclusive next-key lock is placed on the row to be replaced.</p>
<p>å¦‚æœæ²¡æœ‰å”¯ä¸€é”®ç¢°æ’, REPLACE è¡Œä¸ºç±»ä¼¼ INSERT. å…¶ä»–æƒ…å†µä¸‹, è·å–è¡Œçš„äº’æ–¥ next-key é”</p>
</li>
<li><p><code>INSERT INTO T SELECT ... FROM S WHERE ...</code> sets an exclusive index record lock (without a gap lock) on each row inserted into <code>T</code>. If the transaction isolation level is <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-isolation-levels.html#isolevel_read-committed" target="_blank" rel="noopener"><code>READ COMMITTED</code></a>, <code>InnoDB</code> does the search on <code>S</code> as a consistent read (no locks). Otherwise, <code>InnoDB</code> sets shared next-key locks on rows from <code>S</code>. <code>InnoDB</code> has to set locks in the latter case: During roll-forward recovery using a statement-based binary log, every SQL statement must be executed in exactly the same way it was done originally.</p>
<p><a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE ... SELECT ...</code></a> performs the <a href="https://dev.mysql.com/doc/refman/8.0/en/select.html" target="_blank" rel="noopener"><code>SELECT</code></a> with shared next-key locks or as a consistent read, as for <a href="https://dev.mysql.com/doc/refman/8.0/en/insert-select.html" target="_blank" rel="noopener"><code>INSERT ... SELECT</code></a>.</p>
<p>INSERT INTO T SELECT â€¦ FROM S WHERE â€¦ åœ¨æ¯ä¸ªæ’å…¥åˆ° T çš„è¡Œä¸Šè®¾ç½®ä¸€ä¸ªäº’æ–¥ç´¢å¼•è®°å½•é”. </p>
<p>å¦‚æœäº‹åŠ¡éš”ç¦»ç­‰çº§æ˜¯ READ COMMITTED, InnoDB åœ¨ S ä¸Šæ‰§è¡Œä¸€è‡´è¯», å…¶ä»–æƒ…å†µ, InnoDB åœ¨æ¥è‡ª S çš„è¡Œä¸Šè®¾ç½®å…±äº« next-key é”. InnoDB éœ€è¦åœ¨åä¸€ç§æƒ…å†µä¸‹è®¾ç½®é” : åœ¨ roll-forward æ¢å¤æœŸé—´, ä½¿ç”¨åŸºäºè¯­å¥çš„äºŒè¿›åˆ¶æ—¥å¿—, æ¯ä¸ª SQL è¯­å¥å¿…é¡»ä»¥ä¸åˆå§‹è¯­å¥å®Œå…¨ç›¸åŒçš„æ–¹å¼æ‰§è¡Œ.</p>
<p>CREATE TABLE â€¦ SELECT â€¦ æ‰§è¡Œå¸¦æœ‰å…±äº« next-key é”æˆ–ä¸€è‡´è¯»çš„ SELECT è¯­å¥, å°±åƒ INSERT â€¦ SELECT ä¸€æ ·</p>
<p>When a <code>SELECT</code> is used in the constructs <code>REPLACE INTO t SELECT ... FROM s WHERE ...</code> or <code>UPDATE t ... WHERE col IN (SELECT ... FROM s ...)</code>, <code>InnoDB</code>sets shared next-key locks on rows from table <code>s</code>.</p>
<p>å½“ SELECT åœ¨æ„é€  REPLACE INTO t SELECT â€¦ FROM s WHERE â€¦ æˆ– UPDATE t â€¦ WHERE col IN (SELECR â€¦ FROM s â€¦) è¯­å¥æ—¶, InnoDB åœ¨ s ä¸­çš„è¡Œä¸Šè®¾ç½®å…±äº«é”</p>
</li>
<li><p>While initializing a previously specified <code>AUTO_INCREMENT</code> column on a table, <code>InnoDB</code> sets an exclusive lock on the end of the index associated with the <code>AUTO_INCREMENT</code>column. In accessing the auto-increment counter, <code>InnoDB</code> uses a specific <code>AUTO-INC</code> table lock mode where the lock lasts only to the end of the current SQL statement, not to the end of the entire transaction. Other sessions cannot insert into the table while the <code>AUTO-INC</code> table lock is held; see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-transaction-model.html" target="_blank" rel="noopener">Section 15.7.2, â€œInnoDB Transaction Modelâ€</a>.</p>
<p>å½“åˆå§‹åŒ–åœ¨è¡¨ä¸Šä¹‹å‰æŒ‡å®šå¸¦æœ‰ AUTO_INCREMENT å…³é”®å­—çš„åˆ—æ—¶, InnoDB åœ¨ä¸ AUTO_INCREMENT å…³è”çš„ç´¢å¼•æœ«å°¾è®¾ç½®äº’æ–¥é”. åœ¨è®¿é—®è‡ªå¢è®¡æ•°å™¨æ—¶, InnoDB ä½¿ç”¨ç‰¹æ®Šçš„ AUTO-INC è¡¨é”æ¨¡å¼, é”åªæŒç»­å½“å‰ SQL è¯­å¥çš„æœ«å°¾, è€Œä¸æ˜¯å½“å‰äº‹åŠ¡çš„æœ«å°¾. å…¶ä»–ä¼šè¯ä¸èƒ½åœ¨ AUTO-INC è¡¨é”å·²è·å¾—çš„æƒ…å†µä¸‹æ’å…¥æ•°æ®è¿›è¯¥è¡¨ä¸­</p>
<p><code>InnoDB</code> fetches the value of a previously initialized <code>AUTO_INCREMENT</code> column without setting any locks.</p>
<p>InnoDB æ— éœ€åŠ é”å³å¯è·å–ä¹‹å‰åˆå§‹åŒ–çš„ AUTO_INCREMENT åˆ—çš„å€¼</p>
</li>
<li><p>If a <code>FOREIGN KEY</code> constraint is defined on a table, any insert, update, or delete that requires the constraint condition to be checked sets shared record-level locks on the records that it looks at to check the constraint. <code>InnoDB</code> also sets these locks in the case where the constraint fails.</p>
<p>å¦‚æœè¡¨ä¸Šå®šä¹‰äº† FOREIGN KEY çº¦æŸ, ä»»ä½•æ’å…¥, æ›´æ–°, æˆ–åˆ é™¤éƒ½éœ€è¦æ£€æŸ¥çº¦æŸæ¡ä»¶, åœ¨æ£€æŸ¥çº¦æŸçš„è®°å½•ä¸Šè®¾ç½®å…±äº«çš„, è®°å½•çº§é”</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES</code></a> sets table locks, but it is the higher MySQL layer above the <code>InnoDB</code> layer that sets these locks. <code>InnoDB</code> is aware of table locks if <code>innodb_table_locks = 1</code>(the default) and <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_autocommit" target="_blank" rel="noopener"><code>autocommit = 0</code></a>, and the MySQL layer above <code>InnoDB</code> knows about row-level locks.</p>
<p>LOCK TABLES è®¾ç½®è¡¨é”, è¿™æ˜¯é«˜äº InnoDB å±‚çš„ MySQL å±‚è®¾ç½®çš„é”. å¦‚æœ innodb_table_locks = 1 (é»˜è®¤) å¹¶ä¸” autocommit = 0, åˆ™ InnoDB èƒ½å¤Ÿæ„ŸçŸ¥è¡¨é”, MySQL å±‚çŸ¥é“è¡Œçº§é”</p>
<p>Otherwise, <code>InnoDB</code>â€˜s automatic deadlock detection cannot detect deadlocks where such table locks are involved. Also, because in this case the higher MySQL layer does not know about row-level locks, it is possible to get a table lock on a table where another session currently has row-level locks. However, this does not endanger transaction integrity, as discussed in <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-deadlock-detection.html" target="_blank" rel="noopener">Section 15.7.5.2, â€œDeadlock Detection and Rollbackâ€</a>. See also <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-restrictions.html" target="_blank" rel="noopener">Section 15.6.1.6, â€œLimits on InnoDB Tablesâ€</a>.</p>
<p>å…¶ä»–æƒ…å†µ, InnoDB çš„è‡ªåŠ¨æ­»é”å‘ç°æœºåˆ¶ä¸èƒ½å¯Ÿè§‰æ¶‰åŠè¿™æ ·çš„è¡¨é”çš„æ­»é”, åŒæ ·, å› ä¸ºåœ¨è¿™æ ·çš„æƒ…å†µä¸‹ MySQL å±‚ä¸èƒ½å¯Ÿè§‰è¡Œçº§é”, å¯ä»¥åœ¨å¦ä¸€ä¸ªä¼šè¯å½“å‰æ‹¥æœ‰è¡Œçº§é”çš„è¡¨ä¸Šè·å–è¡¨é”. ç„¶è€Œ, è¿™ä¼šå±å®³äº‹åŠ¡çš„å®Œæ•´æ€§</p>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>read/LimitsonInnoDBTables</title>
    <url>/2020/01/09/read/LimitsonInnoDBTables/</url>
    <content><![CDATA[<h4 id="15-6-1-6-Limits-on-InnoDB-Tables"><a href="#15-6-1-6-Limits-on-InnoDB-Tables" class="headerlink" title="15.6.1.6 Limits on InnoDB Tables"></a>15.6.1.6 Limits on InnoDB Tables</h4><p>Limits on <code>InnoDB</code> tables are described under the following topics in this section:</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-restrictions.html#innodb-maximums-minimums" target="_blank" rel="noopener">Maximums and Minimums</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-restrictions.html#innodb-table-restrictions" target="_blank" rel="noopener">Restrictions on InnoDB Tables</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-restrictions.html#innodb-locking-transactions" target="_blank" rel="noopener">Locking and Transactions</a></li>
</ul>
<p>InnoDBè¡¨çš„é™åˆ¶åœ¨ä»¥ä¸‹å‡ ä¸ªè¯é¢˜ä¸­è®¨è®º : æœ€å¤§å’Œæœ€å°, InnoDBè¡¨çš„é™åˆ¶, é”å’Œäº‹åŠ¡</p>
<h5 id="Maximums-and-Minimums"><a href="#Maximums-and-Minimums" class="headerlink" title="Maximums and Minimums"></a>Maximums and Minimums</h5><ul>
<li><p>A table can contain a maximum of 1017 columns. Virtual generated columns are included in this limit.</p>
<p>è¡¨æœ€å¤šå¯ä»¥åŒ…å« 1017 åˆ—, è™šæ‹Ÿåˆ›å»ºçš„åˆ—ä¹ŸåŒ…å«åœ¨å…¶ä¸­</p>
</li>
<li><p>A table can contain a maximum of 64 <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_secondary_index" target="_blank" rel="noopener">secondary indexes</a>.</p>
<p>è¡¨æœ€å¤šèƒ½æœ‰ 64 ä¸ªæ¬¡çº§ç´¢å¼•</p>
</li>
<li><p>The index key prefix length limit is 3072 bytes for <code>InnoDB</code> tables that use <code>DYNAMIC</code> or <code>COMPRESSED</code> row format.</p>
<p>ä½¿ç”¨ DYNAMIC æˆ– COMPRESSED è¡Œå­˜å‚¨çš„ InnoDB è¡¨ç´¢å¼•é”®çš„å‰ç¼€å®½åº¦è¢«é™åˆ¶åœ¨ 3072 å­—èŠ‚å†… (&lt;=)</p>
<p>The index key prefix length limit is 767 bytes for <code>InnoDB</code> tables that use <code>REDUNDANT</code> or <code>COMPACT</code> row format. For example, you might hit this limit with a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_column_prefix" target="_blank" rel="noopener">column prefix</a>index of more than 191 characters on a <code>TEXT</code> or <code>VARCHAR</code> column, assuming a <code>utf8mb4</code> character set and the maximum of 4 bytes for each character.</p>
<p>ä½¿ç”¨ REDUNDANT æˆ– COMPACT  è¡Œå­˜å‚¨çš„ InnoDB è¡¨ç´¢å¼•é—´çš„å‰ç¼€å®½åº¦è¢«é™åˆ¶åœ¨ 767 å­—èŠ‚å†… (&lt;=)</p>
<p>Attempting to use an index key prefix length that exceeds the limit returns an error.</p>
<p>å°è¯•ä½¿ç”¨è¶…è¿‡é™åˆ¶çš„å­—èŠ‚å‰ç¼€å®½åº¦ä¼šè¿”å›é”™è¯¯</p>
<p>The limits that apply to index key prefixes also apply to full-column index keys.</p>
<p>é€‚ç”¨äºç´¢å¼•é”®å‰ç¼€çš„é™åˆ¶ä¹Ÿé€‚ç”¨äºå…¨åˆ—ç´¢å¼•é”®</p>
</li>
<li><p>If you reduce the <code>InnoDB</code> <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_page_size" target="_blank" rel="noopener">page size</a> to 8KB or 4KB by specifying the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size" target="_blank" rel="noopener"><code>innodb_page_size</code></a> option when creating the MySQL instance, the maximum length of the index key is lowered proportionally, based on the limit of 3072 bytes for a 16KB page size. That is, the maximum index key length is 1536 bytes when the page size is 8KB, and 768 bytes when the page size is 4KB.</p>
<p>å¦‚æœåœ¨åˆ›å»º MySQL å®ä¾‹æ—¶æ˜¾å¼æŒ‡å®š innodb_page_size å‡å°‘ InnoDB çš„é¡µé¢å¤§å°(8kb -&gt; 4kb)ç´¢å¼•é”®çš„æœ€å¤§é•¿åº¦ä¹Ÿä¼šæˆæ¯”ä¾‹å‡å°‘</p>
<p>16kb é¡µå¤§å°é™åˆ¶åœ¨ 3072 å­—èŠ‚, 8kb é¡µå¤§å°é™åˆ¶åœ¨ 1536 å­—èŠ‚, è€Œ 4kb é¡µé¢å¤§å°é™åˆ¶åœ¨ 768 å­—èŠ‚</p>
</li>
<li><p>A maximum of 16 columns is permitted for multicolumn indexes. Exceeding the limit returns an error.</p>
<p>å¤šåˆ—ç´¢å¼•å­åˆ—æ•°ä¸èƒ½è¶…è¿‡ 16 ä¸ª</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">ERROR 1070 (42000): Too many key parts specified; max 16 parts allowed</span><br></pre></td></tr></table></figure>
</li>
<li><p>The maximum row length, except for variable-length columns (<a href="https://dev.mysql.com/doc/refman/8.0/en/binary-varbinary.html" target="_blank" rel="noopener"><code>VARBINARY</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a>), is slightly less than half of a page for 4KB, 8KB, 16KB, and 32KB page sizes. For example, the maximum row length for the default <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size" target="_blank" rel="noopener"><code>innodb_page_size</code></a> of 16KB is about 8000 bytes. However, for an <code>InnoDB</code> page size of 64KB, the maximum row length is approximately 16000 bytes. <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>LONGBLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>LONGTEXT</code></a> columns must be less than 4GB, and the total row length, including <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a>columns, must be less than 4GB.</p>
<p>é™¤å˜é•¿åˆ—(VARBINARY, VATCHAR, BLOB, TEXT)å¤–, åˆ—çš„é•¿åº¦éƒ½ç¨å°‘äºä¸€åŠé¡µçš„å¤§å°. æ¯”å¦‚, é¡µé¢å¤§å°ä¸º 16kb çš„è¡Œé•¿åº¦æœ€å¤§ 8000 å­—èŠ‚å·¦å³, ç„¶è€Œ InnoDB 64kb çš„é¡µæœ€å¤§åœ¨ 16000 å­—èŠ‚å·¦å³. LONGBLOB å’Œ LONGTEXT åˆ—å¿…é¡»å°‘äº 4GB, æ•´ä¸ªè¡Œçš„é•¿åº¦, åŒ…æ‹¬ BLOB å’Œ TEXT åˆ—, ä¹Ÿå¿…é¡»å°‘äº 4GB.</p>
<p>If a row is less than half a page long, all of it is stored locally within the page. If it exceeds half a page, variable-length columns are chosen for external off-page storage until the row fits within half a page, as described in <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-file-space.html" target="_blank" rel="noopener">Section 15.11.2, â€œFile Space Managementâ€</a>.</p>
<p>å¦‚æœè¡Œå°äºé¡µçš„ä¸€èˆ¬, æ•°æ®åˆ™å…¨éƒ¨ä¿å­˜åœ¨é¡µä¸­, å¦‚æœè¶…è¿‡, å˜é•¿åˆ—è¢«é€‰æ‹©é¡µå¤–å­˜å‚¨ç›´åˆ°åˆ—çš„å¤§å°ç¬¦åˆä¸ºæ­¢</p>
</li>
<li><p>Although <code>InnoDB</code> supports row sizes larger than 65,535 bytes internally, MySQL itself imposes a row-size limit of 65,535 for the combined size of all columns:</p>
<p>å°½ç®¡ InnoDB æ”¯æŒè¶…è¿‡ 65535 å­—èŠ‚çš„è¡Œ, MySQL è‡ªèº«çº¦æŸåˆ—çš„ç»„åˆå¤§å°ä¸èƒ½è¶…è¿‡ 65535</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE t (a VARCHAR(8000), b VARCHAR(10000),</span><br><span class="line">    -&gt; c VARCHAR(10000), d VARCHAR(10000), e VARCHAR(10000),</span><br><span class="line">    -&gt; f VARCHAR(10000), g VARCHAR(10000)) ENGINE=InnoDB;</span><br><span class="line">ERROR 1118 (42000): Row size too large. The maximum row size for the</span><br><span class="line">used table type, not counting BLOBs, is 65535. You have to <span class="keyword">change</span> <span class="keyword">some</span></span><br><span class="line"><span class="keyword">columns</span> <span class="keyword">to</span> <span class="built_in">TEXT</span> <span class="keyword">or</span> BLOBs</span><br></pre></td></tr></table></figure>

<p>See <a href="https://dev.mysql.com/doc/refman/8.0/en/column-count-limit.html" target="_blank" rel="noopener">Section C.10.4, â€œLimits on Table Column Count and Row Sizeâ€</a>.</p>
</li>
<li><p>On some older operating systems, files must be less than 2GB. This is not a limitation of <code>InnoDB</code> itself, but if you require a large tablespace, configure it using several smaller data files rather than one large data file.</p>
<p>åœ¨ä¸€äº›è¾ƒè€çš„æ“ä½œç³»ç»Ÿä¸Š, æ–‡ä»¶å¿…é¡»å°äº 2GB. è¿™ä¸æ˜¯ InnoDB çš„é™åˆ¶, ä½†æ˜¯å¦‚æœä½ éœ€è¦ä¸€ä¸ªå¤§çš„è¡¨ç©ºé—´, å¯ä»¥é…ç½®æˆä½¿ç”¨äº›è®¸è¾ƒå°çš„æ•°æ®æ–‡ä»¶, è€Œä¸æ˜¯ä¸€ä¸ªå¤§çš„æ•°æ®æ–‡ä»¶</p>
</li>
<li><p>The combined size of the <code>InnoDB</code> log files can be up to 512GB.</p>
<p>InnoDB æ—¥å¿—æ–‡ä»¶çš„ç»„åˆå¤§å°æœ€å¤§ 512GB</p>
</li>
<li><p>The minimum tablespace size is slightly larger than 10MB. The maximum tablespace size depends on the <code>InnoDB</code> page size.</p>
<p>è¡¨çš„æœ€å°å®¹é‡ç¨å¤§äº 10mb, æœ€å¤§çš„è¡¨å¤§å°å–å†³äº InnoDB é¡µå¤§å°</p>
<p><strong>Table 15.3 InnoDB Maximum Tablespace Size</strong></p>
<table>
<thead>
<tr>
<th>InnoDB Page Size</th>
<th>Maximum Tablespace Size</th>
</tr>
</thead>
<tbody><tr>
<td>4KB</td>
<td>16TB</td>
</tr>
<tr>
<td>8KB</td>
<td>32TB</td>
</tr>
<tr>
<td>16KB</td>
<td>64TB</td>
</tr>
<tr>
<td>32KB</td>
<td>128TB</td>
</tr>
<tr>
<td>64KB</td>
<td>256TB</td>
</tr>
</tbody></table>
<p>The maximum tablespace size is also the maximum size for a table.</p>
<p>æœ€å¤§è¡¨ç©ºé—´å¤§å°ä¹Ÿæ˜¯æœ€å¤§è¡¨å¤§å°</p>
</li>
<li><p>The path of a tablespace file, including the file name, cannot exceed the <code>MAX_PATH</code> limit on Windows. Prior to Windows 10, the <code>MAX_PATH</code> limit is 260 characters. As of Windows 10, version 1607, <code>MAX_PATH</code> limitations are removed from common Win32 file and directory functions, but you must enable the new behavior.</p>
<p>è¡¨ç©ºé—´æ–‡ä»¶çš„è·¯å¾„, åŒ…æ‹¬è¡¨å, åœ¨ windows ä¸Šä¸èƒ½è¶…è¿‡ MAX_PATH é™åˆ¶, åœ¨ win10 ä»¥å‰ MAX_PATH é™åˆ¶ä¸º 260 å­—ç¬¦. win10 1607 ç‰ˆæœ¬åç§»é™¤äº†è¯¥é™åˆ¶</p>
</li>
<li><p>The default page size in <code>InnoDB</code> is 16KB. You can increase or decrease the page size by configuring the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size" target="_blank" rel="noopener"><code>innodb_page_size</code></a> option when creating the MySQL instance.</p>
<p>InnoDB é»˜è®¤é¡µå¤§å°ä¸º 16kb, åˆ›å»º MySQL å®ä¾‹æ—¶å¯ä»¥é€šè¿‡è®¾ç½® innodb_page_size æ›´æ”¹(PS. é¡µå¤§å°åœ¨åˆ›å»ºåæ˜¯å±äºè¡¨çš„å±€éƒ¨å¸¸é‡ä¹ˆ?)</p>
<p>32KB and 64KB page sizes are supported, but <code>ROW_FORMAT=COMPRESSED</code> is unsupported for page sizes greater than 16KB. For both 32KB and 64KB page sizes, the maximum record size is 16KB. For <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size" target="_blank" rel="noopener"><code>innodb_page_size=32KB</code></a>, extent size is 2MB. For <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_page_size" target="_blank" rel="noopener"><code>innodb_page_size=64KB</code></a>, extent size is 4MB.</p>
<p>A MySQL instance using a particular <code>InnoDB</code> page size cannot use data files or log files from an instance that uses a different page size.</p>
<p>32kb å’Œ 64kb çš„é¡µä¹Ÿæ˜¯æ”¯æŒçš„, ä½†æ˜¯è¡Œå­˜å‚¨ä¸º COMPRESSED ä¸æ”¯æŒè¶…è¿‡ 16kb å¤§å°çš„é¡µ. å¯¹äº 32kb å’Œ 64kb å¤§å°çš„ä¹Ÿ, æœ€å¤§è®°å½•çš„å¤§å°å…¶å®æ˜¯ 16kb. </p>
<p>MySQL å®ä¾‹ä¸èƒ½ä½¿ç”¨åº•å±‚é¡µé¢ä¸ä¸€è‡´çš„æ•°æ®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶</p>
</li>
</ul>
<h5 id="Restrictions-on-InnoDB-Tables"><a href="#Restrictions-on-InnoDB-Tables" class="headerlink" title="Restrictions on InnoDB Tables"></a>Restrictions on InnoDB Tables</h5><ul>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> determines index cardinality (as displayed in the <code>Cardinality</code> column of <a href="https://dev.mysql.com/doc/refman/8.0/en/show-index.html" target="_blank" rel="noopener"><code>SHOW INDEX</code></a> output) by performing <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_random_dive" target="_blank" rel="noopener">random dives</a> on each of the index trees and updating index cardinality estimates accordingly. Because these are only estimates, repeated runs of <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> could produce different numbers. This makes<a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> fast on <code>InnoDB</code> tables but not 100% accurate because it does not take all rows into account.</p>
<p>ANALYZE TABLE è¯­å¥æ¯ä¸ªç´¢å¼•æ ‘æ‰§è¡Œéšæœºæ½œæ°´(PS. ???)æ›´æ–°é¢„ä¼°ç´¢å¼•çš„åŸºæ•°(åœ¨ SHOW INDEX çš„è¾“å‡ºä¸­ Cardinality åˆ—æ˜¾ç¤º)</p>
<p>å› ä¸ºåªæ˜¯ä¼°è®¡, é‡å¤æ‰§è¡Œ ANALYZE TABLE å°†ä¼šäº§ç”Ÿä¸åŒçš„å€¼, è¿™ä½¿å¾— ANALYZE TABLE åœ¨ InnoDB ä¸Šè¿è¡Œåœ°å¾ˆå¿«, ä½†å¹¶ä¸æ˜¯ 100% æ­£ç¡®, å› ä¸ºå¹¶ä¸ä¼šä¼°è®¡æ‰€æœ‰çš„è¡Œ</p>
<p>(PS. ANALYZE TABLE å°†ä¼šåˆ†æè¡¨, å…¶ä¸­éƒ¨åˆ†åˆ†æç»“æœå¯ä»¥åœ¨ SHOW INDEX ä¸­æŸ¥çœ‹. è¿™é‡Œä»¥åˆ—çš„åŸºæ•°ä¸ºä¾‹)</p>
<p>You can make the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_statistics" target="_blank" rel="noopener">statistics</a> collected by <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> more precise and more stable by turning on the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_stats_persistent" target="_blank" rel="noopener"><code>innodb_stats_persistent</code></a> configuration option, as explained in <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-persistent-stats.html" target="_blank" rel="noopener">Section 15.8.10.1, â€œConfiguring Persistent Optimizer Statistics Parametersâ€</a>. When that setting is enabled, it is important to run <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> after major changes to indexed column data, because the statistics are not recalculated periodically (such as after a server restart).</p>
<p>é€šè¿‡å¯ç”¨ innodb_stats_persistent ä½¿ ANALYZE TABLE çš„æ•°æ®ç»Ÿè®¡æ›´åŠ ç²¾ç¡®, å½“å¯ç”¨è¿™ä¸ªé€‰é¡¹å, éœ€è¦åœ¨å¯¹ç´¢å¼•åˆ—æ•°æ®è¿›è¡Œä¸»è¦æ›´æ”¹åå†ä½¿ç”¨ ANALYZE TABLE, å› ä¸ºç»Ÿè®¡ä¿¡æ¯ä¸æ˜¯å®šæœŸé‡æ–°è®¡ç®—çš„</p>
<p>If the persistent statistics setting is enabled, you can change the number of random dives by modifying the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_stats_persistent_sample_pages" target="_blank" rel="noopener"><code>innodb_stats_persistent_sample_pages</code></a> system variable. If the persistent statistics setting is disabled, modify the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_stats_transient_sample_pages" target="_blank" rel="noopener"><code>innodb_stats_transient_sample_pages</code></a> system variable instead.</p>
<p>å¦‚æœå¯ç”¨äº†æŒç»­æ€§ç»Ÿè®¡, å¯ä»¥æ›´æ”¹ innodb_stats_persistent_sample_pages ç³»ç»Ÿå˜é‡, å¦‚æœæŒä¹…æ€§ç»Ÿè®¡è®¾ç½®å–æ¶ˆ, åˆ™å¯ä»¥é€šè¿‡ innodb_stats_transient_sampke_pages æ›´æ”¹</p>
<p>MySQL uses index cardinality estimates in join optimization. If a join is not optimized in the right way, try using <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a>. In the few cases that <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a>does not produce values good enough for your particular tables, you can use <code>FORCE INDEX</code> with your queries to force the use of a particular index, or set the<a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_max_seeks_for_key" target="_blank" rel="noopener"><code>max_seeks_for_key</code></a> system variable to ensure that MySQL prefers index lookups over table scans. See <a href="https://dev.mysql.com/doc/refman/8.0/en/optimizer-issues.html" target="_blank" rel="noopener">Section B.4.5, â€œOptimizer-Related Issuesâ€</a>.</p>
<p>MySQL åœ¨ Join ä¼˜åŒ–ä¸­ä½¿ç”¨ç´¢å¼•åŸºæ•°ä¼°è®¡, å¦‚æœ Join ä¸èƒ½æ­£ç¡®ä¼˜åŒ–, å°è¯•ä½¿ç”¨ ANALYZE_TABLE. åœ¨å°‘æ•°æƒ…å†µä¸‹ ANALYZE_TABLE ä¸èƒ½ä¸ºæŒ‡å®šçš„è¡¨äº§ç”Ÿè¶³å¤Ÿå¥½çš„å€¼, å¯ä»¥ä½¿ç”¨ FORCE INDEX é…åˆæŸ¥è¯¢, å¼ºåˆ¶ä½¿ç”¨æŒ‡å®šçš„ç´¢å¼•æˆ–è€…è®¾ç½® max_seeks_for_key ç³»ç»Ÿå˜é‡ç¡®ä¿ MySQL æ›´åå‘äºç´¢å¼•æŸ¥æ‰¾è€Œä¸æ˜¯è¡¨æ‰«æ</p>
</li>
<li><p>If statements or transactions are running on a table, and <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> is run on the same table followed by a second <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> operation, the second <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> operation is blocked until the statements or transactions are completed. This behavior occurs because <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> marks the currently loaded table definition as obsolete when <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> is finished running. New statements or transactions (including a second <a href="https://dev.mysql.com/doc/refman/8.0/en/analyze-table.html" target="_blank" rel="noopener"><code>ANALYZE TABLE</code></a> statement) must load the new table definition into the table cache, which cannot occur until currently running statements or transactions are completed and the old table definition is purged. Loading multiple concurrent table definitions is not supported.</p>
<p>å¦‚æœè¯­å¥å’Œäº‹åŠ¡æ­£åœ¨è¿è¡Œäºè¡¨ä¸Š, ANALYZE TABLE åŒæ ·è¿è¡Œäºè¿™å¼ è¡¨ä¸Š, ä¹‹åç»§ç»­æ‰§è¡Œ ANALYZE_TABLE æ“ä½œ, ç¬¬äºŒä¸ª ANALYZE TABLE æ“ä½œå°†ä¼šé˜»å¡ç›´åˆ°ä¹‹å‰çš„äº‹åŠ¡/è¯­å¥æ‰§è¡Œå®Œæˆ. ä¼šå‘ç”Ÿè¿™æ ·çš„æƒ…å†µæ˜¯å› ä¸º ANALYZE_TABLE åœ¨æ‰§è¡Œå®Œæˆæ—¶ä¼šå°†å½“å‰åŠ è½½çš„è¡¨æ ‡è®°ä¸ºå·²è¿‡æ—¶, æ–°çš„è¯­å¥/äº‹åŠ¡(åŒ…æ‹¬ç¬¬äºŒä¸ª ANALYZE_TABLE è¯­å¥)å¿…é¡»åŠ è½½æ–°çš„è¡¨åˆ°è¡¨ç¼“å­˜ä¸­, æ”¹æ“ä½œåœ¨å½“å‰è¯­å¥/äº‹åŠ¡å·²ç»å®Œæˆ, å¹¶ä¸”æ—§è¡¨çš„å®šä¹‰å·²ç»è¢«æ¸…ç†åæ‰èƒ½å‘ç”Ÿ, ä¸æ”¯æŒåŠ è½½å¤šä¸ªå¹¶å‘è¡¨</p>
</li>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/show-table-status.html" target="_blank" rel="noopener"><code>SHOW TABLE STATUS</code></a> does not give accurate statistics on <code>InnoDB</code> tables except for the physical size reserved by the table. The row count is only a rough estimate used in SQL optimization.</p>
<p>SHOW TABLE STATUS ä¸æä¾› InnoDB è¡¨é™¤è¡¨å­˜å‚¨çš„ç‰©ç†å¤§å°å¤–, å…¶ä»–ç»Ÿè®¡ä¿¡æ¯çš„ç²¾ç¡®æ€§, è¡Œæ•°é‡åªæ˜¯ä¸€ä¸ª SQL ä¼˜åŒ–ä¸­ç²—ç•¥çš„ä¼°è®¡</p>
</li>
<li><p><code>InnoDB</code> does not keep an internal count of rows in a table because concurrent transactions might â€œseeâ€ different numbers of rows at the same time. Consequently, <code>SELECT COUNT(*)</code> statements only count rows visible to the current transaction.</p>
<p>InnoDB ä¸ä¿å­˜è¡¨ä¸­è¡Œçš„å†…éƒ¨è®¡æ•°, å› ä¸ºå¹¶å‘äº‹åŠ¡å¯èƒ½åœ¨åŒæ ·çš„æ—¶é—´è§åˆ°ä¸åŒçš„å€¼. </p>
<p>å› æ­¤, SELECT COUNT(*) è¯­å¥åªè®¡æ•°å¯¹å½“å‰äº‹åŠ¡å¯è§çš„è¡Œ</p>
<p>For information about how <code>InnoDB</code> processes <code>SELECT COUNT(*)</code> statements, refer to the <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html#function_count" target="_blank" rel="noopener"><code>COUNT()</code></a> description in <a href="https://dev.mysql.com/doc/refman/8.0/en/group-by-functions.html" target="_blank" rel="noopener">Section 12.20.1, â€œAggregate (GROUP BY) Function Descriptionsâ€</a>.</p>
</li>
<li><p>On Windows, <code>InnoDB</code> always stores database and table names internally in lowercase. To move databases in a binary format from Unix to Windows or from Windows to Unix, create all databases and tables using lowercase names.</p>
<p>åœ¨ Windows ä¸Š, InnoDB æ€»æ˜¯ä»¥å°å†™å­˜å‚¨æ•°æ®åº“å’Œè¡¨çš„åå­—(å¤§å°å†™ä¸æ•æ„Ÿ = =)</p>
</li>
<li><p>An <code>AUTO_INCREMENT</code> column <em>ai_col</em> must be defined as part of an index such that it is possible to perform the equivalent of an indexed <code>SELECT MAX(*ai_col*)</code> lookup on the table to obtain the maximum column value. Typically, this is achieved by making the column the first column of some table index.</p>
<p>AUTO_INCREMENT åˆ— ai_col å¿…é¡»è¢«å®šä¹‰æˆç´¢å¼•çš„ä¸€éƒ¨åˆ†, è¿™æ ·å°±å¯ä»¥æ‰§è¡Œå·²è¢«ç´¢å¼•çš„ SELECT MAX(ai_col) ç›¸ç­‰æ€§åˆ¤æ–­, è·å–æœ€å¤§çš„åˆ—å€¼. é€šå¸¸éƒ½æ˜¯å…¬å›½å°†åˆ—æˆä¸ºåˆ—çš„é¦–åˆ—æ¥è·å¾—çš„</p>
</li>
<li><p><code>InnoDB</code> sets an exclusive lock on the end of the index associated with the <code>AUTO_INCREMENT</code> column while initializing a previously specified <code>AUTO_INCREMENT</code> column on a table.</p>
<p>InnoDB åœ¨å’Œ AUTO_INCREMENT åˆ—ç›¸å…³çš„ç´¢å¼•æœ«å°¾è®¾ç½®äº’æ–¥é”</p>
<p>With <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoinc_lock_mode" target="_blank" rel="noopener"><code>innodb_autoinc_lock_mode=0</code></a>, <code>InnoDB</code> uses a special <code>AUTO-INC</code> table lock mode where the lock is obtained and held to the end of the current SQL statement while accessing the auto-increment counter. Other clients cannot insert into the table while the <code>AUTO-INC</code> table lock is held. The same behavior occurs for â€œbulk insertsâ€with <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoinc_lock_mode" target="_blank" rel="noopener"><code>innodb_autoinc_lock_mode=1</code></a>. Table-level <code>AUTO-INC</code> locks are not used with <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_autoinc_lock_mode" target="_blank" rel="noopener"><code>innodb_autoinc_lock_mode=2</code></a>. For more information, See <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-auto-increment-handling.html" target="_blank" rel="noopener">Section 15.6.1.4, â€œAUTO_INCREMENT Handling in InnoDBâ€</a>.</p>
<p>innodb_automic_lock_mod è®¾ç½®ä¸º 0 æ—¶, InnoDB ä½¿ç”¨ç‰¹æ®Šçš„ AUTO_INC è¡¨é”æ¨¡å¼. åœ¨è®¿é—®è‡ªå¢è®¡æ•°å™¨æ—¶é”è¢«æŒæœ‰ç›´åˆ°å½“å‰ SQL è¯­å¥ç»“æŸ</p>
</li>
<li><p>When an <code>AUTO_INCREMENT</code> integer column runs out of values, a subsequent <code>INSERT</code> operation returns a duplicate-key error. This is general MySQL behavior.</p>
<p>å½“ AUTO_INCREMENT è¶Šç•Œ, æ’å…¥æ“ä½œä¼šè¿”å› é‡å¤çš„é”® é”™è¯¯, è¿™æ˜¯é€šå¸¸ MySQL çš„è¡Œä¸º</p>
</li>
<li><p><code>DELETE FROM *tbl_name*</code> does not regenerate the table but instead deletes all rows, one by one.</p>
<p>DELETE FROM tbl_name ä¸å†ç”Ÿè¡¨, è€Œæ˜¯ä¾æ¬¡åˆ é™¤æ‰€æœ‰è¡Œ </p>
</li>
<li><p>Cascaded foreign key actions do not activate triggers.</p>
<p>çº§è”å¤–é”®æ“ä½œä¸æ¿€æ´»è§¦å‘å™¨</p>
</li>
<li><p>You cannot create a table with a column name that matches the name of an internal <code>InnoDB</code> column (including <code>DB_ROW_ID</code>, <code>DB_TRX_ID</code>, <code>DB_ROLL_PTR</code>, and <code>DB_MIX_ID</code>). This restriction applies to use of the names in any letter case.</p>
<p>ä½ ä¸èƒ½åˆ›å»ºå’Œå†…éƒ¨ InnoDB åˆ—é‡åçš„åˆ—, åŒ…æ‹¬(DB_ROW_ID, DB_TRX_ID, DB_ROLL_PTR, DB_MIX_ID)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; CREATE TABLE t1 (c1 INT, db_row_id INT) ENGINE=INNODB;</span><br><span class="line">ERROR 1166 (42000): Incorrect column name 'db_row_id'</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h5 id="Locking-and-Transactions"><a href="#Locking-and-Transactions" class="headerlink" title="Locking and Transactions"></a>Locking and Transactions</h5><ul>
<li><p><a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES</code></a> acquires two locks on each table if <code>innodb_table_locks=1</code> (the default). In addition to a table lock on the MySQL layer, it also acquires an <code>InnoDB</code> table lock. Versions of MySQL before 4.1.2 did not acquire <code>InnoDB</code> table locks; the old behavior can be selected by setting <code>innodb_table_locks=0</code>. If no <code>InnoDB</code> table lock is acquired, <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES</code></a> completes even if some records of the tables are being locked by other transactions.</p>
<p>å¦‚æœ innodb_table_locks = 1 åˆ™ LOCK TABLES åœ¨æ¯ä¸ªè¡¨ä¸Šè·å–ä¸¤ä¸ªé”, é™¤äº†åœ¨ MySQL å±‚ä¸Šçš„é”, è¿˜è·å– InnoDB è¡¨é”, å¦‚æœæ²¡æœ‰è·å– InnoDB è¡¨é”, å³ä½¿ä¸€äº›è®°å½•è¢«å…¶ä»–äº‹åŠ¡é”å®š, LOCK TABLES ä¹Ÿä¼šå®Œæˆ</p>
<p>In MySQL 8.0, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_table_locks" target="_blank" rel="noopener"><code>innodb_table_locks=0</code></a> has no effect for tables locked explicitly with <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES ... WRITE</code></a>. It does have an effect for tables locked for read or write by <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES ... WRITE</code></a> implicitly (for example, through triggers) or by <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES ... READ</code></a>.</p>
</li>
<li><p>All <code>InnoDB</code> locks held by a transaction are released when the transaction is committed or aborted. Thus, it does not make much sense to invoke <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES</code></a> on<code>InnoDB</code> tables in <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_autocommit" target="_blank" rel="noopener"><code>autocommit=1</code></a> mode because the acquired <code>InnoDB</code> table locks would be released immediately.</p>
<p>é€šè¿‡äº‹åŠ¡è·å–çš„æ‰€æœ‰ InnoDB é”åœ¨äº‹åŠ¡æäº¤æˆ–é€€å‡ºæ—¶é‡Šæ”¾, å› æ­¤, åœ¨ autocommit = 1 æ¨¡å¼ä¸‹æ²¡æœ‰é‚£ä¹ˆå¿…è¦åœ¨ InnoDB è¡¨ä¸Šæ˜¾å¼è°ƒç”¨ LOCK TABLES è¯­å¥, å› ä¸ºè·å–çš„ InnoDB è¡¨é”ä¼šç«‹å³é‡Šæ”¾</p>
</li>
<li><p>You cannot lock additional tables in the middle of a transaction because <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>LOCK TABLES</code></a> performs an implicit <a href="https://dev.mysql.com/doc/refman/8.0/en/commit.html" target="_blank" rel="noopener"><code>COMMIT</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/lock-tables.html" target="_blank" rel="noopener"><code>UNLOCK TABLES</code></a>.</p>
<p>ä½ ä¸èƒ½åœ¨äº‹åŠ¡ä¸­é”é¢å¤–çš„è¡¨, å› ä¸º LOCK TABLES æ‰§è¡Œéšå¼çš„ COMMIT å’Œ UNLOCK TABLES</p>
</li>
<li><p>For limits associated with concurrent read-write transactions, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-undo-logs.html" target="_blank" rel="noopener">Section 15.6.6, â€œUndo Logsâ€</a>.</p>
</li>
</ul>
]]></content>
  </entry>
  <entry>
    <title>read/JVM-Memory-model</title>
    <url>/2020/01/09/read/JVM-Memory-model/</url>
    <content><![CDATA[<p><a href="https://www.journaldev.com/2856/java-jvm-memory-model-memory-management-in-java" target="_blank" rel="noopener">source link</a></p>
<h1 id="Java-JVM-Memory-Model-Memory-Management-in-Java"><a href="#Java-JVM-Memory-Model-Memory-Management-in-Java" class="headerlink" title="Java (JVM) Memory Model - Memory Management in Java"></a>Java (JVM) Memory Model - Memory Management in Java</h1><h2 id="Java-JVM-Memory-Model"><a href="#Java-JVM-Memory-Model" class="headerlink" title="Java (JVM) Memory Model"></a>Java (JVM) Memory Model</h2><p><a href="https://cdn.journaldev.com/wp-content/uploads/2014/05/Java-Memory-Model.png" target="_blank" rel="noopener"><img src="https://cdn.journaldev.com/wp-content/uploads/2014/05/Java-Memory-Model-450x186.png" alt="Java Memory Model, JVM Memory Model, Memory Management in Java, Java Memory Management"></a></p>
<p>As you can see in the above image, JVM memory is divided into separate parts. At broad level, JVM Heap memory is physically divided into two parts â€“ <strong>Young Generation</strong> and <strong>Old Generation</strong>.</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤º, JVM è¢«åˆ†ä¸ºäº†å¤šä¸ªéƒ¨åˆ†. JVM å †ç‰©ç†æ€§è¢«åˆ†ä¸ºä¸¤éƒ¨åˆ†, Young Generation å’Œ Old Generation</p>
<h2 id="Memory-Management-in-Java-â€“-Young-Generation"><a href="#Memory-Management-in-Java-â€“-Young-Generation" class="headerlink" title="Memory Management in Java â€“ Young Generation"></a>Memory Management in Java â€“ Young Generation</h2><p>The young generation is the place where all the new objects are created. When the young generation is filled, garbage collection is performed. This garbage collection is called <strong>Minor GC</strong>. Young Generation is divided into three parts â€“ <strong>Eden Memory</strong> and two <strong>Survivor Memory</strong> spaces.</p>
<p>æ‰€æœ‰æ–°åˆ›å»ºçš„å¯¹è±¡ä¸€å¼€å§‹éƒ½åœ¨ young generation ä¸­. GC åœ¨ young generation è¢«å¡«æ»¡æ—¶æ‰§è¡Œ. è¿™ä¸ª GC è¢«ç§°ä¸º Minor GC. Young Generation è¢«åˆ†ä¸ºä¸‰éƒ¨åˆ†, Eden Memory å’Œä¸¤ä¸ª Survivor Memory ç©ºé—´ </p>
<p>Important Points about Young Generation Spaces:</p>
<ul>
<li><p>Most of the newly created objects are located in the Eden memory space.</p>
</li>
<li><p>å¤§éƒ¨åˆ†æ–°åˆ›å»ºçš„å¯¹è±¡ä½äº Eden memory ç©ºé—´</p>
</li>
<li><p>When Eden space is filled with objects, Minor GC is performed and all the survivor objects are moved to one of the survivor spaces.</p>
</li>
<li><p>Minor GC åœ¨ Eden space è¢«å¯¹è±¡å¡«å……æ—¶æ‰§è¡Œ, æ‰€æœ‰çš„ survivor å¯¹è±¡è¢«ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ª survivor ç©ºé—´</p>
</li>
<li><p>Minor GC also checks the survivor objects and move them to the other survivor space. So at a time, one of the survivor space is always empty.</p>
</li>
<li><p>Minor GC å…ƒå…¥ä¼šæ£€æŸ¥ survivor å¯¹è±¡, å°†å…¶ç§»åŠ¨åˆ°å…¶ä»–çš„ survivor ç©ºé—´. æ‰€ä»¥åœ¨åŒä¸€æ—¶åˆ», æœ‰ä¸€ä¸ª survivor ç©ºé—´ä¸€ç›´æ˜¯ç©ºçš„</p>
</li>
<li><p>Objects that are survived after many cycles of GC, are moved to the Old generation memory space. Usually, itâ€™s done by setting a threshold for the age of the young generation objects before they become eligible to promote to Old generation.</p>
</li>
<li><p>åœ¨å¤šæ¬¡ GC å¾ªç¯åä»å¹¸å­˜çš„å¯¹è±¡å°†ä¼šè¢«ç§»åŠ¨åˆ° Old generation å†…å­˜ç©ºé—´. </p>
<p>é€šå¸¸, æ˜¯é€šè¿‡ç»™ young generation å¯¹è±¡è®¾ç½®ä¸€ä¸ªå¹´é¾„çš„é˜ˆå€¼æ¥å®ç°çš„ (è¶…è¿‡è¿™ä¸ªé˜ˆå€¼çš„å¯¹è±¡å°†ä¼šè¢«ç§»åŠ¨åˆ° Old Generation ä¸­)</p>
</li>
</ul>
<h2 id="Memory-Management-in-Java-â€“-Old-Generation"><a href="#Memory-Management-in-Java-â€“-Old-Generation" class="headerlink" title="Memory Management in Java â€“ Old Generation"></a>Memory Management in Java â€“ Old Generation</h2><p>Old Generation memory contains the objects that are long-lived and survived after many rounds of Minor GC. Usually, garbage collection is performed in Old Generation memory when itâ€™s full. Old Generation Garbage Collection is called <strong>Major GC</strong> and usually takes a longer time.</p>
<p>Old Generation å†…å­˜åŒ…å«åœ¨å¤šæ¬¡ Minor GC å¾ªç¯åä»å¹¸å­˜çš„å¯¹è±¡. é€šå¸¸, GC åœ¨ Old Generation è¢«å¡«æ»¡æ—¶æ‰§è¡Œ.</p>
<p>Old Generation GC è¢«æˆä¸º Major GC, é€šå¸¸èŠ±è´¹æ›´é•¿çš„æ—¶é—´</p>
<h3 id="Stop-the-World-Event"><a href="#Stop-the-World-Event" class="headerlink" title="Stop the World Event"></a>Stop the World Event</h3><p>All the Garbage Collections are â€œStop the Worldâ€ events because all application threads are stopped until the operation completes.</p>
<p>æ‰€æœ‰çš„ GC éƒ½æ˜¯ â€œStop the Worldâ€ äº‹ä»¶. å› ä¸ºæ‰€æœ‰çš„åº”ç”¨çº¿ç¨‹é˜»å¡ç›´åˆ°æ“ä½œå®Œæˆ</p>
<p>Since Young generation keeps short-lived objects, Minor GC is very fast and the application doesnâ€™t get affected by this.</p>
<p>å› ä¸º Young generation ä¿æŒçŸ­æœŸå­˜æ´»å¯¹è±¡, Minor GC ç›¸å½“å¿«, åº”ç”¨ä¸ä¼šå—æ­¤å½±å“</p>
<p>However, Major GC takes a long time because it checks all the live objects. Major GC should be minimized because it will make your application unresponsive for the garbage collection duration. So if you have a responsive application and there are a lot of Major Garbage Collection happening, you will notice timeout errors.</p>
<p>ç„¶è€Œ, Major GC èŠ±è´¹è¾ƒé•¿çš„æ—¶é—´, å› ä¸ºå®ƒä¼šæ£€æŸ¥æ‰€æœ‰çš„å­˜æ´»å¯¹è±¡, Major GC åº”è¯¥å°½é‡å°‘ä½¿ç”¨. å› ä¸ºå®ƒä¼šåœ¨ GC æœŸé—´, ä½¿ä½ çš„ç¨‹åºæ— ç›¸åº”. æ‰€ä»¥å¦‚æœä½ æœ‰ä¸€ä¸ªå“åº”åº”ç”¨, åŒæ—¶åœ¨åº”ç”¨ä¸­å­˜åœ¨å¤§é‡ Major GC å‘ç”Ÿæ—¶, ä½ åº”è¯¥æ³¨æ„æ˜¯å¦ä¼šäº§ç”Ÿè¶…æ—¶é”™è¯¯</p>
<p>The duration taken by garbage collector depends on the strategy used for garbage collection. Thatâ€™s why itâ€™s necessary to monitor and tune the garbage collector to avoid timeouts in the highly responsive applications.</p>
<p>GC å ç”¨æ—¶é—´å–å†³äº GC ç­–ç•¥, è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¦åœ¨é«˜å“åº”åº”ç”¨ç¨‹åºä¸­éœ€è¦ç›‘æ§å’Œè°ƒæ•´ GC ç­–ç•¥çš„åŸå› </p>
<h3 id="Java-Memory-Model-â€“-Permanent-Generation"><a href="#Java-Memory-Model-â€“-Permanent-Generation" class="headerlink" title="Java Memory Model â€“ Permanent Generation"></a>Java Memory Model â€“ Permanent Generation</h3><p>Permanent Generation or â€œPerm Genâ€ contains the application metadata required by the JVM to describe the classes and methods used in the application. Note that Perm Gen is not part of <a href="https://www.journaldev.com/4098/java-heap-space-vs-stack-memory" target="_blank" rel="noopener">Java Heap memory</a>.</p>
<p>Permanent Generation æˆ– â€œPerm Genâ€ åŒ…å« JVM æ‰€éœ€çš„åº”ç”¨å…ƒæ•°æ®, æè¿°åº”ç”¨äºåº”ç”¨ä¸­çš„ç±»å’Œæ–¹æ³•. æ³¨æ„, Perm Gen ä¸æ˜¯ Java Heap memory çš„ä¸€éƒ¨åˆ†</p>
<p>Perm Gen is populated by JVM at runtime based on the classes used by the application. Perm Gen also contains Java SE library classes and methods. Perm Gen objects are garbage collected in a full garbage collection.</p>
<p>Perm Gen ç”± JVM åœ¨è¿è¡Œæ—¶å¡«å……, åŸºäºè¢«åº”ç”¨ç¨‹åºä½¿ç”¨çš„ç±». Perm Gen ä¹ŸåŒ…å« Java SE åº“ç±»ä»¥åŠæ–¹æ³•. Perm Gen å¯¹è±¡åœ¨å®Œæ•´çš„ GC ä¸­è¢«å›æ”¶</p>
<h3 id="Java-Memory-Model-â€“-Method-Area"><a href="#Java-Memory-Model-â€“-Method-Area" class="headerlink" title="Java Memory Model â€“ Method Area"></a>Java Memory Model â€“ Method Area</h3><p>Method Area is part of space in the Perm Gen and used to store class structure (runtime constants and static variables) and code for methods and constructors.</p>
<p>Method Area æ˜¯ Perm Gen ç©ºé—´çš„ä¸€éƒ¨åˆ†. ç”¨äºå­˜å‚¨ç±»æ•°æ®ç»“æ„ (è¿è¡Œæ—¶å¸¸é‡å’Œé™æ€å˜é‡) ä»¥åŠ æ–¹æ³•çš„ä»£ç å’Œç»“æ„</p>
<h3 id="Java-Memory-Model-â€“-Memory-Pool"><a href="#Java-Memory-Model-â€“-Memory-Pool" class="headerlink" title="Java Memory Model â€“ Memory Pool"></a>Java Memory Model â€“ Memory Pool</h3><p>Memory Pools are created by JVM memory managers to create a pool of <a href="https://www.journaldev.com/129/how-to-create-immutable-class-in-java" target="_blank" rel="noopener">immutable</a> objects if the implementation supports it. String Pool is a good example of this kind of memory pool. Memory Pool can belong to Heap or Perm Gen, depending on the JVM memory manager implementation.</p>
<p>å†…å­˜æ± ç”± JVM å†…å­˜ç®¡ç†å™¨åˆ›å»º, åˆ›å»ºä¸€ä¸ªä¸å˜é‡å¯¹è±¡æ±  (å¦‚æœå®ç°æ”¯æŒçš„è¯). String æ± æ˜¯è¿™ç§å†…å­˜æ± çš„ä¸€ä¸ªå¾ˆå¥½çš„ä¾‹å­. å†…å­˜æ± å¯ä»¥å±äº Heap æˆ– Perm Gen, å–å†³äº JVM å†…å­˜ç®¡ç†å™¨çš„å®ç°</p>
<h3 id="Java-Memory-Model-â€“-Runtime-Constant-Pool"><a href="#Java-Memory-Model-â€“-Runtime-Constant-Pool" class="headerlink" title="Java Memory Model â€“ Runtime Constant Pool"></a>Java Memory Model â€“ Runtime Constant Pool</h3><p>Runtime constant pool is per-class runtime representation of constant pool in a class. It contains class runtime constants and static methods. Runtime constant pool is part of the method area.</p>
<p>è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯ç±»ä¸­å¸¸é‡æ± çš„æ¯ä¸ªç±»çš„è¿è¡Œæ—¶è¡¨ç¤º. åŒ…å«ç±»è¿è¡Œæ—¶å¸¸é‡å’Œé™æ€æ–¹æ³•. è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯ method åŒºåŸŸçš„ä¸€éƒ¨åˆ†</p>
<h3 id="Java-Memory-Model-â€“-Java-Stack-Memory"><a href="#Java-Memory-Model-â€“-Java-Stack-Memory" class="headerlink" title="Java Memory Model â€“ Java Stack Memory"></a>Java Memory Model â€“ Java Stack Memory</h3><p>Java Stack memory is used for execution of a thread. They contain method specific values that are short-lived and references to other objects in the heap that is getting referred from the method. You should read <a href="https://www.journaldev.com/4098/java-heap-space-vs-stack-memory" target="_blank" rel="noopener">Difference between Stack and Heap Memory</a>.</p>
<p>Java æ ˆå†…å­˜ç”¨æˆ·æ‰§è¡Œçº¿ç¨‹. å®ƒä»¬åŒ…å«æ–¹æ³•æŒ‡å®šå€¼ (ç”Ÿå‘½å‘¨æœŸçŸ­, æŒ‡å‘å †ä¸­çš„å¯¹è±¡)</p>
<h3 id="Memory-Management-in-Java-â€“-Java-Heap-Memory-Switches"><a href="#Memory-Management-in-Java-â€“-Java-Heap-Memory-Switches" class="headerlink" title="Memory Management in Java â€“ Java Heap Memory Switches"></a>Memory Management in Java â€“ Java Heap Memory Switches</h3><p>Java provides a lot of memory switches that we can use to set the memory sizes and their ratios. Some of the commonly used memory switches are:</p>
<p>Java æä¾›äº†å¤§é‡çš„å†…å­˜å¼€å…³, ç”¨äºè®¾ç½®å†…å­˜å¤§å°å’Œæ¯”ä¾‹. ä¸€äº›å¸¸ç”¨çš„å†…å­˜å¼€å…³æœ‰: </p>
<table>
<thead>
<tr>
<th align="left">VM Switch</th>
<th align="left">VM Switch Description</th>
</tr>
</thead>
<tbody><tr>
<td align="left">-Xms</td>
<td align="left">For setting the initial heap size when JVM starts</td>
</tr>
<tr>
<td align="left">-Xmx</td>
<td align="left">For setting the maximum heap size.</td>
</tr>
<tr>
<td align="left">-Xmn</td>
<td align="left">For setting the size of the Young Generation, rest of the space goes for Old Generation.</td>
</tr>
<tr>
<td align="left">-XX:PermGen</td>
<td align="left">For setting the initial size of the Permanent Generation memory</td>
</tr>
<tr>
<td align="left">-XX:MaxPermGen</td>
<td align="left">For setting the maximum size of Perm Gen</td>
</tr>
<tr>
<td align="left">-XX:SurvivorRatio</td>
<td align="left">For providing ratio of Eden space and Survivor Space, for example if Young Generation size is 10m and VM switch is -XX:SurvivorRatio=2 then 5m will be reserved for Eden Space and 2.5m each for both the Survivor spaces. The default value is 8.</td>
</tr>
<tr>
<td align="left">-XX:NewRatio</td>
<td align="left">For providing ratio of old/new generation sizes. The default value is 2.</td>
</tr>
</tbody></table>
<p>Most of the times, above options are sufficient, but if you want to check out other options too then please check <a href="https://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener">JVM Options Official Page</a>.</p>
<p>å¤§å¤šæ•°æ—¶å€™, ä¸Šé¢çš„é€‰é¡¹å°±è¶³å¤Ÿäº†, å…¶ä»–é€‰é¡¹å¯ä»¥å‚è§â€¦ </p>
<h3 id="Memory-Management-in-Java-â€“-Java-Garbage-Collection"><a href="#Memory-Management-in-Java-â€“-Java-Garbage-Collection" class="headerlink" title="Memory Management in Java â€“ Java Garbage Collection"></a>Memory Management in Java â€“ Java Garbage Collection</h3><p>Java Garbage Collection is the process to identify and remove the unused objects from the memory and free space to be allocated to objects created in future processing. One of the best features of Java programming language is the <strong>automatic garbage collection</strong>, unlike other programming languages such as C where memory allocation and deallocation is a manual process.</p>
<p>Java GC æ˜¯ç”¨äºä»å†…å­˜ä¸­ç¡®å®šå’Œç§»é™¤æœªä½¿ç”¨å¯¹è±¡çš„è¿›ç¨‹, é‡Šæ”¾å†…å­˜, ä»¥ç”¨äºå°†æ¥åˆ›å»ºçš„å¯¹è±¡. Java çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯è‡ªåŠ¨åƒåœ¾å›æ”¶, ä¸åƒå…¶ä»–è¯­è¨€éœ€è¦æ‰‹åŠ¨å¤„ç† (å…¶å®ä¹Ÿä¸æ˜¯å•¦, æ ˆæ˜¯ä¸éœ€è¦ç®¡çš„, ä¹Ÿå°±æ˜¯ heap éœ€è¦æ‰‹åŠ¨é‡Šæ”¾)</p>
<p><strong>Garbage Collector</strong> is the program running in the background that looks into all the objects in the memory and find out objects that are not referenced by any part of the program. All these unreferenced objects are deleted and space is reclaimed for allocation to other objects.</p>
<p>GC æ˜¯ä¸€ä¸ªè¿è¡Œäºåå°çš„ç¨‹åº, æŸ¥çœ‹åœ¨å†…å®¹ä¸­çš„æ‰€æœ‰å¯¹è±¡, æ‰¾åˆ°æ²¡æœ‰è¢«ç¨‹åºä¸­ä»»ä½•éƒ¨åˆ†å¼•ç”¨çš„å¯¹è±¡. æ‰€æœ‰è¿™äº›æœªå¼•ç”¨å¯¹è±¡éƒ½ä¼šè¢«åˆ é™¤, ç©ºé—´ä¼šå›æ”¶åˆ©ç”¨, ä»¥ç”¨äºå…¶ä»–å¯¹è±¡çš„åˆ†é…</p>
<p>One of the basic ways of garbage collection involves three steps:</p>
<ol>
<li><p><strong>Marking</strong>: This is the first step where garbage collector identifies which objects are in use and which ones are not in use.</p>
<p>Marking: è¿™æ˜¯ GC ç”¨äºç¡®å®šå¯¹è±¡æ˜¯å¦è¢«ä½¿ç”¨çš„ç¬¬ä¸€æ­¥</p>
</li>
<li><p><strong>Normal Deletion</strong>: Garbage Collector removes the unused objects and reclaim the free space to be allocated to other objects.</p>
<p>Normal Deletion: GC ç§»é™¤æœªä½¿ç”¨å¯¹è±¡, å›æ”¶èµ„æº</p>
</li>
<li><p><strong>Deletion with Compacting</strong>: For better performance, after deleting unused objects, all the survived objects can be moved to be together. This will increase the performance of allocation of memory to newer objects.</p>
<p>Deletion with Compacting: ä¸ºäº†è·å¾—æ›´å¥½çš„æ€§èƒ½, åœ¨åˆ é™¤æœªä½¿ç”¨å¯¹è±¡å, æ‰€æœ‰å¹¸å­˜å¯¹è±¡å¯ä»¥ç§»åˆ°ä¸€èµ·, è¿™å¯ä»¥å¢åŠ åˆ†é…æ–°å¯¹è±¡çš„æ€§èƒ½</p>
</li>
</ol>
<p>There are two problems with a simple mark and delete approach.</p>
<ol>
<li><p>First one is that itâ€™s not efficient because most of the newly created objects will become unused</p>
<p>é¦–å…ˆ, è¿™å¹¶ä¸é«˜æ•ˆ, å› ä¸ºå¤§éƒ¨åˆ†æ–°åˆ›å»ºçš„å¯¹è±¡å°†ä¼šå˜æˆæœªä½¿ç”¨</p>
</li>
<li><p>Secondly objects that are in-use for multiple garbage collection cycle are most likely to be in-use for future cycles too.</p>
<p>å…¶æ¬¡, å¤šä¸ª GC å¾ªç¯åä»ä½¿ç”¨çš„å¯¹è±¡åœ¨å°†æ¥ä¹Ÿå¯èƒ½æ˜¯ä½¿ç”¨çš„</p>
</li>
</ol>
<p>(æ€»ç»“æ¥è¯´å°±æ˜¯, å¤§å¤šæ•°å¯¹è±¡æ˜¯åˆ›å»ºåå°±å¤±æ•ˆçš„, ç»´æŠ¤èµ·æ¥æœ‰ä¸€å®šæˆä¸º. å…¶æ¬¡, ä¸€ä¸ªå¤šæ¬¡ GC åå­˜åœ¨çš„å¯¹è±¡åœ¨ä»¥åä¹Ÿå¤§æ¦‚ç‡ä¸ä¼šè¢«ç§»é™¤, è¿™åˆä¼šäº§ç”Ÿé¢å¤–çš„æ€§èƒ½æŸå¤±)</p>
<p>The above shortcomings with the simple approach is the reason that <strong>Java Garbage Collection is Generational</strong> and we have <strong>Young Generation</strong> and <strong>Old Generation</strong> spaces in the heap memory. I have already explained above how objects are scanned and moved from one generational space to another based on the Minor GC and Major GC.</p>
<p>ä»¥ä¸Šç®€å•æ–¹æ³•çš„ç¼ºç‚¹æ˜¯ Java GC æ˜¯åœ¨å †å†…å­˜ä¸­åˆ†ä»£, ä½¿ç”¨ Young Generation å’Œ Old Generation ç©ºé—´çš„åŸå› </p>
<h3 id="Memory-Management-in-Java-â€“-Java-Garbage-Collection-Types"><a href="#Memory-Management-in-Java-â€“-Java-Garbage-Collection-Types" class="headerlink" title="Memory Management in Java â€“ Java Garbage Collection Types"></a>Memory Management in Java â€“ Java Garbage Collection Types</h3><p>There are five types of garbage collection types that we can use in our applications. We just need to use the JVM switch to enable the garbage collection strategy for the application. Letâ€™s look at each of them one by one.</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„åº”ç”¨ä¸­ä½¿ç”¨äº”ç§ GC, ä»…éœ€ä½¿ç”¨ JVM å¼€å…³å°±å¯ä½¿ GC ç­–ç•¥åº”ç”¨äºåº”ç”¨. </p>
<ol>
<li><p><strong>Serial GC (-XX:+UseSerialGC)</strong>: Serial GC uses the simple <strong>mark-sweep-compact</strong> approach for young and old generations garbage collection i.e Minor and Major GC.</p>
<p>Serial GC is useful in client machines such as our simple stand-alone applications and machines with smaller CPU. It is good for small applications with low memory footprint.</p>
<p>Serial GC: Serial GC ä½¿ç”¨æœ€ç®€å•çš„ <strong>mark-sweep-compact</strong> æ–¹æ³•ç”¨äº young å’Œ old generations GC. æ¯”å¦‚, Minor å’Œ Major GC.</p>
<p>Serial GC åœ¨å¦‚æˆ‘ä»¬ç®€å•çš„, ç‹¬ç«‹çš„åº”ç”¨å’Œå°çš„ CPU ä¸Šå¾ˆæœ‰ç”¨, é€‚ç”¨äºä½å†…å­˜å ç”¨çš„å°å‹åº”ç”¨</p>
</li>
<li><p><strong>Parallel GC (-XX:+UseParallelGC)</strong>: Parallel GC is same as Serial GC except that is spawns N threads for young generation garbage collection where N is the number of CPU cores in the system. We can control the number of threads using <code>-XX:ParallelGCThreads=n</code> JVM option.</p>
<p>Parallel GC: Parallel GC ç±»ä¼¼äº Serial GC, é™¤äº†ä¸º young generation GC äº§ç”Ÿ N ä¸ªçº¿ç¨‹ (N æ˜¯CPUæ ¸å¿ƒæ•°). å¯ä»¥ä½¿ç”¨ JVM é€‰é¡¹æ§åˆ¶çº¿ç¨‹çš„æ•°é‡</p>
<p>Parallel Garbage Collector is also called throughput collector because it uses multiple CPUs to speed up the GC performance. Parallel GC uses a single thread for Old Generation garbage collection.</p>
<p>Parallel GC ä¹Ÿè¢«ç§°ä¸ºååé‡æ”¶é›†å™¨, å› ä¸ºå®ƒä½¿ç”¨å¤šä¸ªCPUæå‡GCæ€§èƒ½. Parallel GCä¸ºOld Generation GC å•ç‹¬åˆ†é…ä¸€ä¸ªçº¿ç¨‹</p>
</li>
<li><p><strong>Parallel Old GC (-XX:+UseParallelOldGC)</strong>: This is same as Parallel GC except that it uses multiple threads for both Young Generation and Old Generation garbage collection.</p>
<p>å’ŒParallel GCç›¸åŒ, ä½†å®ƒå¯¹ Young GC å’Œ Old GC éƒ½ä½¿ç”¨å¤šçº¿ç¨‹</p>
</li>
<li><p><strong>Concurrent Mark Sweep (CMS) Collector (-XX:+UseConcMarkSweepGC)</strong>: CMS Collector is also referred as concurrent low pause collector. It does the garbage collection for the Old generation. CMS collector tries to minimize the pauses due to garbage collection by doing most of the garbage collection work concurrently with the application threads.</p>
<p>CMS æ”¶é›†å™¨ä¹Ÿè¢«ç§°ä¸ºå¹¶å‘ä½æš‚åœæ”¶é›†å™¨. å®ƒä¸º Old generation åš GC æ“ä½œ. CMS æ”¶é›†å™¨å°è¯•ä½¿ç”¨åº”ç”¨çº¿ç¨‹, é€šè¿‡å¹¶å‘æ‰§è¡Œå¤§éƒ¨åˆ† GC æ“ä½œæ¥å°½å¯èƒ½å‡ä½ GC çš„æš‚åœ</p>
<p>CMS collector on the young generation uses the same algorithm as that of the parallel collector. This garbage collector is suitable for responsive applications where we canâ€™t afford longer pause times. We can limit the number of threads in CMS collector using <code>-XX:ParallelCMSThreads=n</code> JVM option.</p>
<p>CMS åœ¨ young generation ä¸Šåƒ parallel æ”¶é›†å™¨ä¸€æ ·ä½¿ç”¨åŒæ ·çš„ç®—æ³•, è¿™ä¸ªç®—æ³•é€‚ç”¨äºä¸èƒ½æ‰¿æ‹…é•¿æ—¶é—´æš‚åœçš„å“åº”ç¨‹åº, å¯ä»¥ä½¿ç”¨é€‰é¡¹é™åˆ¶ CMS æ”¶é›†å™¨ä½¿ç”¨çš„çº¿ç¨‹æ•°</p>
</li>
<li><p><strong>G1 Garbage Collector (-XX:+UseG1GC)</strong>: The Garbage First or G1 garbage collector is available from Java 7 and its long term goal is to replace the CMS collector. The G1 collector is a parallel, concurrent, and incrementally compacting low-pause garbage collector.Garbage First Collector doesnâ€™t work like other collectors and there is no concept of Young and Old generation space. It divides the heap space into multiple equal-sized heap regions. When a garbage collection is invoked, it first collects the region with lesser live data, hence â€œGarbage Firstâ€. You can find more details about it at Garbage-First Collector Oracle Documentation.</p>
<p>G1 GC ä» Java 7 å¼€å§‹æ”¯æŒ, å®ƒé•¿æœŸçš„ç›®æ ‡æ˜¯å–ä»£ CMS æ”¶é›†å™¨. G1 æ˜¯ä¸€ä¸ªå¹¶è¡Œ, å¹¶å‘ä»¥åŠé€’å¢å‹ç´§çš„ä½æš‚åœ GC. G1 ä¸åƒå…¶ä»–æ”¶é›†å™¨, å®ƒæ²¡æœ‰ Young å’Œ Old generation çš„æ¦‚å¿µ. å®ƒå°† heap ç©ºé—´åˆ†ä¸ºå¤šä¸ªç›¸åŒçš„ heap åŒºåŸŸ. å½“GC æ‰§è¡Œæ—¶, å®ƒé¦–å…ˆæ¸…ç†è¾ƒå°‘å­˜ç•™æ•°æ®çš„ heap åŒºåŸŸ, å› æ­¤æˆä¸ºâ€Garbage  Firstâ€. ä½ å¯ä»¥åœ¨ Oracle çš„æ–‡æ¡£ä¸­æ‰¾åˆ°æ›´å¤šå…³äº G1 æ”¶é›†å™¨çš„ä¿¡æ¯.</p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>read/IteratorsandReverseIterators</title>
    <url>/2020/01/09/read/IteratorsandReverseIterators/</url>
    <content><![CDATA[<h2 id="Iterators-and-Reverse-Iterators"><a href="#Iterators-and-Reverse-Iterators" class="headerlink" title="Iterators and Reverse Iterators"></a>Iterators and Reverse Iterators</h2><p>You can convert normal iterators into reverse iterators. Naturally, the iterators must be bidirectional<br>iterators, but note that the logical position of an iterator is moved during the conversion. Consider<br>the following program:</p>
<p>å¯ä»¥å°†æ™®é€šçš„è¿­ä»£å™¨è½¬æ¢ä¸ºåå‘è¿­ä»£å»(å½“ç„¶, è¿™ä¸ªè¿­ä»£å™¨å¿…é¡»æ˜¯åŒå‘çš„)</p>
<p>è¯·è®°ä½, è½¬æ¢åè¿­ä»£å™¨çš„é€»è¾‘ä½ç½®ä¼šå‘ç”Ÿæ”¹å˜, å‚è€ƒä»¥ä¸‹ç¨‹åº : </p>
<pre><code>// iter/reviter2.cpp
#include &lt;iterator&gt;
#include &lt;iostream&gt;
#include &lt;vector&gt;
#include &lt;algorithm&gt;

using namespace std;

int main()
{
    // create list with elements from 1 to 9
    vector&lt;int&gt; coll = { 1, 2, 3, 4, 5, 6, 7, 8, 9 };

    // find position of element with value 5
    vector&lt;int&gt;::const_iterator pos;
    pos = find (coll.cbegin(), coll.cend(),
    5);

    // print value to which iterator pos refers
    cout &lt;&lt; &quot;pos: &quot; &lt;&lt; *pos &lt;&lt; endl;

    // convert iterator to reverse iterator rpos
    vector&lt;int&gt;::const_reverse_iterator rpos(pos);

    // print value to which reverse iterator rpos refers
    cout &lt;&lt; &quot;rpos: &quot; &lt;&lt; *rpos &lt;&lt; endl;
}</code></pre><p>This program has the following output:<br>    pos: 5<br>    rpos: 4<br>Thus, if you print the value of an iterator and convert the iterator into a reverse iterator, the value has<br>changed. This is not a bug; itâ€™s a feature! This behavior is a consequence of the fact that ranges are<br>half open. To specify all elements of a container, you must use the position after the last argument.<br>However, for a reverse iterator, this is the position before the first element. Unfortunately, such a<br>position may not exist. Containers are not required to guarantee that the position before their first<br>element is valid. Consider that ordinary strings and arrays might also be containers, and the language<br>does not guarantee that arrays donâ€™t start at address zero.</p>
<p>å› æ­¤, æ›´æ”¹åè¿­ä»£å™¨çš„å€¼å‘ç”Ÿäº†å˜åŒ–. è¿™ä¸æ˜¯ä¸€ä¸ª bug, è€Œæ˜¯ä¸€ä¸ªç‰¹æ€§. è¿™æ˜¯ä¸€ä¸ªå› åŠå¼€åŒºé—´è€Œäº§ç”Ÿçš„ç»“æœ.</p>
<p>è¦æŒ‡å®šå®¹å™¨çš„æ‰€æœ‰å…ƒç´ , éœ€è¦ä½¿ç”¨æœ€åä¸€ä¸ªå…ƒç´ åçš„ä½ç½®. ç„¶è€Œ, å¯¹äºåå‘è¿­ä»£å™¨è€Œè¨€, å°±æ˜¯ä¸€ä¸ªåœ¨ç¬¬ä¸€ä¸ªå…ƒç´ ä¹‹å‰çš„ä½ç½®, ä¸å¹¸çš„æ˜¯, è¿™æ ·çš„ä½ç½®æ˜¯ä¸å­˜åœ¨çš„. å®¹å™¨ä¸ä¿è¯ä»–ä»¬ç¬¬ä¸€ä¸ªä½ç½®ä¹‹å‰çš„å…ƒç´ æ˜¯æœ‰æ•ˆçš„.</p>
<p>å‚è€ƒåŸå§‹å­—ç¬¦ä¸²å’Œæ•°ç»„å¯èƒ½ä¹Ÿä¼šæ˜¯å®¹å™¨, è¯­è¨€ä¸ä¿è¯æ•°ç»„ä¸ä»åœ°å€0å¼€å§‹</p>
<p>As a result, the designers of reverse iterators use a trick: They â€œphysicallyâ€ reverse the â€œhalf-open<br>principle.â€ Physically, in a range defined by reverse iterators, the beginning is not included, whereas<br>the end is. However, logically, they behave as usual. Thus, there is a distinction between the physical<br>position that defines the element to which the iterator refers and the logical position that defines the<br>value to which the iterator refers (Figure 9.3). The question is, what happens on a conversion from<br>an iterator to a reverse iterator? Does the iterator keep its logical position (the value) or its physical<br>position (the element)? As the previous example shows, the latter is the case. Thus, the value is<br>moved to the previous element (Figure 9.4) </p>
<p>ç»“è®ºæ˜¯, åå‘è¿­ä»£å™¨è®¾è®¡ç”¨äº†ä¸€ä¸ªæ–¹æ³• : å®ƒä»¬ç‰©ç†æ€§åœ°åå‘åŠå¼€åŒºé—´. ç‰©ç†æ€§åœ°, åœ¨åå‘è¿­ä»£å™¨çš„å®šä¹‰ä¸­, å¼€å§‹çš„å…ƒç´ ä¸åŒ…å«åœ¨å†…, è€Œå°¾ç«¯è¢«åŒ…å«. ç„¶è€Œ, é€»è¾‘ä¸Š, å®ƒä»¬çš„è¡Œä¸ºå’Œæ™®é€šçš„è¿­ä»£å™¨ä¸€æ ·. å› æ­¤, å®šä¹‰è¿­ä»£å™¨å¼•ç”¨çš„å…ƒç´ çš„ç‰©ç†ä½ç½®å’Œå®šä¹‰è¿­ä»£å™¨å¼•ç”¨çš„å€¼çš„é€»è¾‘ä½ç½®æ˜¯æœ‰åŒºåˆ«çš„. </p>
<p>é—®é¢˜æ˜¯, å½“æ™®é€šè¿­ä»£å™¨è½¬æ¢ä¸ºåå‘è¿­ä»£å™¨çš„æ—¶å€™, ä¼šå‘ç”Ÿä»€ä¹ˆ? è¿­ä»£å™¨ä¼šä¿æŒå®ƒçš„é€»è¾‘ä½ç½®, è¿˜æ˜¯ç‰©ç†ä½ç½®? åœ¨ä¸Šé¢çš„æ¡ˆä¾‹æ˜¾ç¤ºä¸­, å±äºåè€…. å› æ­¤, å€¼ç§»åŠ¨åˆ°äº†ä¹‹å‰çš„å…ƒç´ ä½ç½®.</p>
<p><img src="https://imgur.com/Xe1ifka.png" alt=""></p>
<p><img src="https://imgur.com/1rPZHcM.png" alt=""></p>
<h2 id="å†…éƒ¨å¦‚ä½•å¤„ç†çš„"><a href="#å†…éƒ¨å¦‚ä½•å¤„ç†çš„" class="headerlink" title="å†…éƒ¨å¦‚ä½•å¤„ç†çš„"></a>å†…éƒ¨å¦‚ä½•å¤„ç†çš„</h2><p>ä»¥ä¸Š, å°±æ˜¯è¿™ç¯‡ç¬”è®°çš„åŸå› , æˆ‘æƒ³çœ‹çœ‹åå‘è¿­ä»£å™¨å®ƒçš„å†…éƒ¨æ˜¯å¦‚ä½•å·¥ä½œçš„</p>
<p>è¿™æ¬¡çš„ç›®æ ‡æ˜¯è§£å†³å¦‚ä¸‹ç–‘é—®</p>
<ol>
<li>æ™®é€šè¿­ä»£å™¨è½¬æ¢æˆåå‘è¿­ä»£å™¨ä¼šåšä»€ä¹ˆ?</li>
<li>åå‘è¿­ä»£å™¨å¦‚ä½•è¿­ä»£çš„? </li>
<li>åå‘è¿­ä»£å™¨å¦‚ä½•ä¿è¯ä¸ä¼šè¶Šç•Œ? </li>
</ol>
<p>é¦–å…ˆ, å‚è€ƒä¸€ä¸‹ C++ ä»£ç  : </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">array</span>&lt;<span class="keyword">int</span>, 9&gt; v&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>&#125;;</span><br><span class="line">	<span class="keyword">auto</span> it = v.<span class="built_in">begin</span>();</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; *it &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="built_in">array</span>&lt;<span class="keyword">int</span>,9&gt;::<span class="function">const_reverse_iterator <span class="title">rit</span><span class="params">(it)</span></span>;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; *rit &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>ç„¶åæ˜¯æ±‡ç¼–ä»£ç  : </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB4368:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   subqâ–¹   $64, %rsp</span><br><span class="line">â–¹   movlâ–¹   $1, -64(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $2, -60(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $3, -56(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $4, -52(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $5, -48(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $6, -44(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $7, -40(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $8, -36(%rbp)</span><br><span class="line">â–¹   movlâ–¹   $9, -32(%rbp)</span><br><span class="line">â–¹   leaqâ–¹   -64(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSt5arrayIiLm9EE5beginEv	&#x2F;&#x2F; ä¸Šè¿°æ˜¯ array çš„åˆå§‹åŒ–ä»£ç </span><br><span class="line">â–¹   movqâ–¹   %rax, -8(%rbp)	&#x2F;&#x2F; æ„é€ çš„è¿”å›å€¼å³æ˜¯ begin</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax</span><br><span class="line">â–¹   movlâ–¹   (%rax), %eax	&#x2F;&#x2F; *it</span><br><span class="line">â–¹   movlâ–¹   %eax, %esi</span><br><span class="line">â–¹   movlâ–¹   $_ZSt4cout, %edi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEi</span><br><span class="line">â–¹   movlâ–¹   $_ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_, %esi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEPFRSoS_E</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rdx	&#x2F;&#x2F; -8(%rbp) å³ it</span><br><span class="line">â–¹   leaqâ–¹   -16(%rbp), %rax	&#x2F;&#x2F; è¿™æ˜¯ä¸€å—æœªä½¿ç”¨çš„å†…å­˜</span><br><span class="line">â–¹   movqâ–¹   %rdx, %rsi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSt16reverse_iteratorIPKiEC1ES1_	&#x2F;&#x2F; è¿™åº”å½“å°±æ˜¯ reverse_iterator çš„ construct</span><br><span class="line">â–¹   leaqâ–¹   -16(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNKSt16reverse_iteratorIPKiEdeEv	&#x2F;&#x2F; åœ¨è§£å¼•ç”¨ä¹‹å‰, ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°</span><br><span class="line">â–¹   movlâ–¹   (%rax), %eax	&#x2F;&#x2F; è¿”å›å€¼è§£å¼•ç”¨, å³ *rit</span><br><span class="line">â–¹   movlâ–¹   %eax, %esi</span><br><span class="line">â–¹   movlâ–¹   $_ZSt4cout, %edi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEi</span><br><span class="line">â–¹   movlâ–¹   $_ZSt4endlIcSt11char_traitsIcEERSt13basic_ostreamIT_T0_ES6_, %esi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSolsEPFRSoS_E</span><br><span class="line">â–¹   movlâ–¹   $0, %eax</span><br><span class="line">â–¹   leave</span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br></pre></td></tr></table></figure>

<p>å¯ä»¥çœ‹å‡º, å…³é”®ç‚¹åœ¨äº â€œ<em>ZNSt16reverse_iteratorIPKiEC1ES1</em>â€œ å’Œ â€œ_ZNKSt16reverse_iteratorIPKiEdeEvâ€ å°†æ˜¯å…³é”®</p>
<p>å…¶ä¸­, ZNSt16reverse_iteratorIPKiEC1ES1 çš„ä»£ç å¦‚ä¸‹æ‰€ç¤º (æ²¡æœ‰é”™, å°±æ˜¯è¿™ä¸ª)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZNSt16reverse_iteratorIPKiEC2ES1_:</span><br><span class="line">.LFB4445:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   subqâ–¹   $16, %rsp</span><br><span class="line">â–¹   movqâ–¹   %rdi, -8(%rbp)</span><br><span class="line">â–¹   movqâ–¹   %rsi, -16(%rbp)</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSt8iteratorISt26random_access_iterator_tagilPKiRS1_EC2Ev</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   -16(%rbp), %rdx</span><br><span class="line">â–¹   movqâ–¹   %rdx, (%rax)</span><br><span class="line">â–¹   leave</span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br></pre></td></tr></table></figure>

<p>ä»£ç é™¤ _ZNSt8iteratorISt26random_access_iterator_tagilPKiRS1_EC2Ev å¤–, å°±æ˜¯ç®€å•åœ°å°† %rsi(-8(%rbp) å³ it) çš„åœ°å€æ”¾å…¥ %rdi(-16(%rbp) æˆ‘æåˆ°è¿‡çš„é‚£å—æœªä½¿ç”¨çš„å†…å­˜)</p>
<p>_ZNSt8iteratorISt26random_access_iterator_tagilPKiRS1_EC2Ev ä»£ç å¦‚ä¸‹æ‰€ç¤º</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZNSt8iteratorISt26random_access_iterator_tagilPKiRS1_EC2Ev:</span><br><span class="line">.LFB4443:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   movqâ–¹   %rdi, -8(%rbp)</span><br><span class="line">â–¹   popqâ–¹   %rbp</span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br><span class="line">â–¹   .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>å¥½åƒâ€¦ ä»€ä¹ˆä¹Ÿæ²¡åš = = , è¿™ä¸ªå‡½æ•°æ²¡æœ‰æ ˆå¸§å¼€è¾Ÿ, movqâ–¹   %rdi, -8(%rbp) ä¹Ÿå¤§æ¦‚ç‡æ˜¯ä¸ªæ— ç”¨çš„è¯­å¥</p>
<p>é‚£ä¹ˆ, å¯ä»¥æš‚æ—¶å¾—å‡ºç»“è®º, åå‘è¿­ä»£å™¨æ˜¯ä¸€ä¸ªäºŒçº§æŒ‡é’ˆ, å®ƒä¿å­˜äº†æ™®é€šè¿­ä»£å™¨çš„åœ°å€</p>
<p>é‚£ä¹ˆ, æ¥çœ‹å¦å¤–ä¸€ä¸ªå‡½æ•° _ZNKSt16reverse_iteratorIPKiEdeEv</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZNKSt16reverse_iteratorIPKiEdeEv:</span><br><span class="line">.LFB4447:</span><br><span class="line">â–¹   .cfi_startproc</span><br><span class="line">â–¹   pushqâ–¹  %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_offset 16</span><br><span class="line">â–¹   .cfi_offset 6, -16</span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp</span><br><span class="line">â–¹   .cfi_def_cfa_register 6</span><br><span class="line">â–¹   movqâ–¹   %rdi, -24(%rbp)</span><br><span class="line">â–¹   movqâ–¹   -24(%rbp), %rax</span><br><span class="line">â–¹   movqâ–¹   (%rax), %rax</span><br><span class="line">â–¹   movqâ–¹   %rax, -8(%rbp)</span><br><span class="line">â–¹   subqâ–¹   $4, -8(%rbp)</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax</span><br><span class="line">â–¹   popqâ–¹   %rbp</span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br><span class="line">â–¹   .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>ä¸€å¥è¯æ¦‚æ‹¬: äºŒçº§æŒ‡é’ˆè§£å¼•ç”¨ -4. é‚£ä¹ˆå°±å’Œæ–‡æ¡£æ‰€è¯´çš„å»åˆäº†, åå‘è¿­ä»£å™¨ä¼šå¾€å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®</p>
<p>è¿™ä¸ªå‡½æ•°å‘ç”Ÿåœ¨åå‘è¿­ä»£å™¨è§£å¼•ç”¨æ—¶, å¤§æ¦‚å¯ä»¥çŒœå‡ºå®ƒçš„è¡Œä¸º</p>
<h2 id="æ›´è¿›ä¸€æ­¥"><a href="#æ›´è¿›ä¸€æ­¥" class="headerlink" title="æ›´è¿›ä¸€æ­¥"></a>æ›´è¿›ä¸€æ­¥</h2><p>ç–‘é—® 1 å’Œ ç–‘é—® 2 è§£å†³äº†, ä½†æ˜¯ç–‘é—® 3 è¿˜æœªè§£å†³</p>
<p>æˆ‘åŸæ¥æƒ³é€šè¿‡æ›´æ”¹å†…å­˜å€¼æ¥çœ‹çš„, ä½†æ˜¯è²Œä¼¼æœ‰ä»€ä¹ˆé˜²èŒƒæ“ä½œ </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Breakpoint 1, main () at t.cpp:13</span><br><span class="line">13	    array&lt;int, 9&gt; v&#123;1, 2, 3, 4, 5, 6, 7, 8, 9&#125;;</span><br><span class="line">(gdb) n</span><br><span class="line">14	    auto it &#x3D; v.begin();</span><br><span class="line">(gdb) p &#123;int&#125;0x7fffffffe480	&#x2F;&#x2F; è¿™é‡Œå°±æ˜¯ it</span><br><span class="line">$16 &#x3D; 1</span><br><span class="line">(gdb) set &#123;int&#125;0x7fffffffe480 &#x3D; 100	&#x2F;&#x2F; æ›´æ”¹ it ä¸­çš„å€¼</span><br><span class="line">(gdb) p &#123;int&#125;0x7fffffffe480	&#x2F;&#x2F; æˆåŠŸæ›´æ”¹</span><br><span class="line">$17 &#x3D; 100</span><br><span class="line">(gdb) n</span><br><span class="line">15	    cout &lt;&lt; *it &lt;&lt; endl;</span><br><span class="line">(gdb) n	&#x2F;&#x2F; æœ¬æ¥è¯¥æ‰“å° 1 çš„, æ›´æ”¹åæ‰“å°äº† 100 </span><br><span class="line">100</span><br><span class="line">16	    array&lt;int,9&gt;::const_reverse_iterator rit(it);</span><br><span class="line">(gdb) p v	&#x2F;&#x2F; å†æ¬¡éªŒè¯æ›´æ”¹æ˜¯æœ‰æ•ˆçš„</span><br><span class="line">$18 &#x3D; &#123;_M_elems &#x3D; &#123;100, 2, 3, 4, 5, 6, 7, 8, 9&#125;&#125;</span><br><span class="line">(gdb) p &#123;int&#125;0x7fffffffe47b	&#x2F;&#x2F; æ ¹æ®æ¨ç®—, è¿™ä¸ªå°±æ˜¯ rend çš„åœ°å€</span><br><span class="line">$19 &#x3D; 0</span><br><span class="line">(gdb) set &#123;int&#125;0x7fffffffe47b &#x3D; 200	&#x2F;&#x2F; æ›´æ”¹ rend ( åœ¨ç¨‹åºå´©æºƒçš„è¾¹ç¼˜ç–¯ç‹‚è¯•æ¢ :) )</span><br><span class="line">(gdb) p &#123;int&#125;0x7fffffffe47b</span><br><span class="line">$20 &#x3D; 200</span><br><span class="line">(gdb) n</span><br><span class="line">17	    cout &lt;&lt; *rit &lt;&lt; endl;</span><br><span class="line">(gdb) n	&#x2F;&#x2F; ç»“æœè®©äººå¾ˆå¤±æœ›</span><br><span class="line">0</span><br><span class="line">18	&#125;</span><br><span class="line">(gdb) p &#123;int&#125;0x7fffffffe47b &#x2F;&#x2F; è°è®©ä½ æ”¹å›å»çš„!?</span><br><span class="line">$21 &#x3D; 0</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä¹‹ååœ¨ end ä¸Šåšäº†åŒæ ·çš„æµ‹è¯•, å‘ç° end ä¹Ÿæœ‰é˜²èŒƒæ“ä½œ</p>
<p>ä½†æˆ‘ä¸çŸ¥é“å…·ä½“æ˜¯å“ªé‡Œé˜²èŒƒäº†æˆ‘è¿™ä¸ªæ“ä½œ, åº”è¯¥æ˜¯åœ¨è§£å¼•ç”¨æ—¶, ä½†æ˜¯é‡Œé¢ä»£ç ä¸ä¼šæ›´æ”¹åˆ°. </p>
<p>æˆ‘è¿˜çœ‹äº† objdump çš„æ±‡ç¼–ä»£ç , ä¾æ—§æ²¡æœ‰å‘ç°ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„, å’Œç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–ä»£ç æ˜¯ä¸€æ ·çš„â€¦ </p>
<p>ç®—äº†, ä¹Ÿç®—æœ‰æ‰€æ”¶è·å§â€¦ </p>
]]></content>
  </entry>
  <entry>
    <title>read/InnoDBRowFormat</title>
    <url>/2020/01/09/read/InnoDBRowFormat/</url>
    <content><![CDATA[<h2 id="15-10-InnoDB-Row-Formats"><a href="#15-10-InnoDB-Row-Formats" class="headerlink" title="15.10 InnoDB Row Formats"></a>15.10 InnoDB Row Formats</h2><p>The row format of a table determines how its rows are physically stored, which in turn can affect the performance of queries and DML operations. As more rows fit into a single disk page, queries and index lookups can work faster, less cache memory is required in the buffer pool, and less I/O is required to write out updated values.</p>
<p>è¡¨çš„è¡Œæ ¼å¼åŒ–ç¡®å®šäº†å¦‚ä½•ç‰©ç†å­˜å‚¨æ–¹å¼, åè¿‡æ¥ä¹Ÿä¼šå½±å“æŸ¥è¯¢çš„æ€§èƒ½å’Œ DML çš„æ“ä½œ.</p>
<p>æ›´å¤šçš„è¡Œæ”¾åœ¨å•ä¸ªç£ç›˜é¡µä¸Š, æŸ¥è¯¢å’Œç´¢å¼•æ£€ç´¢çš„é€Ÿåº¦ä¼šæ›´å¿«, ç¼“å­˜æ± éœ€è¦çš„ç©ºé—´ä¹Ÿæ›´å°‘, å†™å‡ºæ›´æ–°æ•°æ®çš„ I/O æ“ä½œä¹Ÿä¼šå‡å°‘</p>
<p>The data in each table is divided into pages. The pages that make up each table are arranged in a tree data structure called a B-tree index. Table data and secondary indexes both use this type of structure. The B-tree index that represents an entire table is known as the clustered index, which is organized according to the primary key columns. The nodes of a clustered index data structure contain the values of all columns in the row. The nodes of a secondary index structure contain the values of index columns and primary key columns.</p>
<p>è¡¨çš„æ•°æ®è¢«åˆ†æ•£åˆ°å¤šä¸ªé¡µä¸­, ç»„æˆè¡¨çš„é¡µçš„èŒƒå›´è¢«é™åˆ¶åœ¨ B-tree ç´¢å¼•çš„æ ‘ç»“æ„ä¸­, è¡¨çš„æ•°æ®å’Œæ¬¡çº§ç´¢å¼•éƒ½ä½¿ç”¨è¿™ç§ç»“æ„</p>
<p>è¡¨ç¤ºæ•´ä¸ªè¡¨çš„ B-tree ç´¢å¼•è¢«ç§°ä½œèšç°‡ç´¢å¼•, æ ¹æ®ä¸»é”®åˆ—æ„é€ . èšç°‡ç´¢å¼•çš„èŠ‚ç‚¹æ•°æ®ç»“æ„åŒ…å«è¡Œä¸­çš„æ‰€æœ‰åˆ—, è€Œæ¬¡çº§ç´¢å¼•æœºæ„åŒ…å«ç´¢å¼•åˆ—å’Œä¸»é”®åˆ—(PS. ç±»ä¼¼äºŒçº§æŒ‡é’ˆ)</p>
<p>Variable-length columns are an exception to the rule that column values are stored in B-tree index nodes. Variable-length columns that are too long to fit on a B-tree page are stored on separately allocated disk pages called overflow pages. Such columns are referred to as off-page columns. The values of off-page columns are stored in singly-linked lists of overflow pages, with each such column having its own list of one or more overflow pages. Depending on column length, all or a prefix of variable-length column values are stored in the B-tree to avoid wasting storage and having to read a separate page.</p>
<p>å¯å˜é•¿åº¦åˆ—æ˜¯åˆ—å€¼å­˜å‚¨åœ¨ B-tree ç´¢å¼•èŠ‚ç‚¹è§„åˆ™çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µ, å¯å˜é•¿åº¦åˆ—å¤ªé•¿, æ— æ³•å­˜å‚¨åœ¨å•ä¸ª B-tree ä¹Ÿä¸­, å¯å˜é•¿åº¦åˆ—å­˜å‚¨åœ¨å•ç‹¬åˆ†é…çš„ç£ç›˜é¡µä¸­, è¿™äº›é¡µå«åšæº¢å‡ºé¡µ, è¿™äº›åˆ—ä¹Ÿå«ä½œé¡µå¤–åˆ—</p>
<p>é¡µå¤–åˆ—ä»¥å•é“¾è¡¨å½¢å¼å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­, æ¯ä¸ªé¡µéƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæº¢å‡ºé¡µçš„åˆ—è¡¨</p>
<p>å–å†³äºåˆ—çš„é•¿åº¦, æ•´ä¸ª/å‰ç¼€éƒ¨åˆ† å˜é•¿åˆ—å¯ä»¥å­˜å‚¨åœ¨ B-tree ä¸­, é¿å…å­˜å‚¨æ¶ˆè€—å’Œè¯»å–é¢å¤–çš„é¡µ</p>
<p>The <code>InnoDB</code> storage engine supports four row formats: <code>REDUNDANT</code>, <code>COMPACT</code>, <code>DYNAMIC</code>, and <code>COMPRESSED</code>.</p>
<p>InnoDB å­˜å‚¨å¼•æ“æ”¯æŒ 4 ç§è¡Œæ ¼å¼åŒ–: REDUNDANT, COMPACT, DYNAMIC  å’Œ COMPRESSED</p>
<p><strong>Table 15.16 InnoDB Row Format Overview</strong></p>
<table>
<thead>
<tr>
<th>Row Format</th>
<th>Compact Storage Characteristics</th>
<th>Enhanced Variable-Length Column Storage</th>
<th>Large Index Key Prefix Support</th>
<th>Compression Support</th>
<th>Supported Tablespace Types</th>
</tr>
</thead>
<tbody><tr>
<td><code>REDUNDANT</code></td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>system, file-per-table, general</td>
</tr>
<tr>
<td><code>COMPACT</code></td>
<td>Yes</td>
<td>No</td>
<td>No</td>
<td>No</td>
<td>system, file-per-table, general</td>
</tr>
<tr>
<td><code>DYNAMIC</code></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>No</td>
<td>system, file-per-table, general</td>
</tr>
<tr>
<td><code>COMPRESSED</code></td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>Yes</td>
<td>file-per-table, general</td>
</tr>
</tbody></table>
<p>The topics that follow describe row format storage characteristics and how to define and determine the row format of a table.</p>
<ul>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-redundant" target="_blank" rel="noopener">REDUNDANT Row Format</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-compact" target="_blank" rel="noopener">COMPACT Row Format</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-dynamic" target="_blank" rel="noopener">DYNAMIC Row Format</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-compressed" target="_blank" rel="noopener">COMPRESSED Row Format</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-defining" target="_blank" rel="noopener">Defining the Row Format of a Table</a></li>
<li><a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-row-format-detrmining" target="_blank" rel="noopener">Determining the Row Format of a Table</a></li>
</ul>
<h3 id="REDUNDANT-Row-Format"><a href="#REDUNDANT-Row-Format" class="headerlink" title="REDUNDANT Row Format"></a>REDUNDANT Row Format</h3><p>Tables that use the <code>REDUNDANT</code> row format store the first 768 bytes of variable-length column values (<a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/binary-varbinary.html" target="_blank" rel="noopener"><code>VARBINARY</code></a>, and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a> types) in the index record within the B-tree node, with the remainder stored on overflow pages. Fixed-length columns greater than or equal to 768 bytes are encoded as variable-length columns, which can be stored off-page. For example, a <code>CHAR(255)</code> column can exceed 768 bytes if the maximum byte length of the character set is greater than 3, as it is with <code>utf8mb4</code>.</p>
<p>ä½¿ç”¨ REDUNDANT è¡Œæ ¼å¼åŒ–åœ¨ B-tree èŠ‚ç‚¹è®°å½•ä¸­åªå­˜å‚¨å˜é•¿åˆ—å€¼çš„å‰ 768 å­—èŠ‚(VARCHAR, VARBINARY, BLOB, TEXT ç±»å‹), å‰©ä¸‹çš„å­˜å‚¨åœ¨æº¢å‡ºé¡µä¸­, å›ºå®šé•¿åº¦ä½† &gt;= 768 å­—èŠ‚çš„åˆ—è¢«æŒ‰ç…§å˜é•¿åˆ—ç¼–ç , å­˜å‚¨åˆ°æº¢å‡ºé¡µä¸­</p>
<p>If the value of a column is 768 bytes or less, an overflow page is not used, and some savings in I/O may result, since the value is stored entirely in the B-tree node. This works well for relatively short <code>BLOB</code> column values, but may cause B-tree nodes to fill with data rather than key values, reducing their efficiency. Tables with many <code>BLOB</code>columns could cause B-tree nodes to become too full, and contain too few rows, making the entire index less efficient than if rows were shorter or column values were stored off-page.</p>
<p>å¦‚æœåˆ—çš„å€¼å°äº 768 å­—èŠ‚, æº¢å‡ºé¡µä¸ä¼šè¢«ç”¨åˆ°, ä¼šèŠ‚çœä¸€äº› I/O æ“ä½œ, å› ä¸ºå€¼å®Œæ•´å­˜å‚¨åœ¨ B-tree ç´¢å¼•ä¸­(PS. ç°åœ¨æˆ‘ä¸­æ–‡çš„è¯­åºéƒ½æœ‰ç‚¹ä¹±äº†, å› ä¸ºè¢«è‹±æ–‡è¯­æ³•çš„é¡ºåºå½±å“äº† = =)</p>
<p>è¿™åœ¨ç›¸å¯¹å°çš„ BLOB åˆ—ä¸Šè¡¨ç°å¾—å¾ˆå¥½, ä½†æ˜¯å¯èƒ½ä¼šå¯¼è‡´ B-tree èŠ‚ç‚¹è¢«æ•°æ®å¡«æ»¡, è€Œä¸æ˜¯é”®å€¼, æ•ˆç‡è¢«å‡å°‘äº†.</p>
<p>å…·æœ‰å¤ªå¤š BLOB åˆ—çš„è¡¨å¯èƒ½ä¼šå¯¼è‡´ B-tree è¿‡äºå……å®, åŒ…å«çš„è¡Œè¿‡äºå°‘. ä½¿æ•´ä¸ªç´¢å¼•çš„æ•ˆç‡ä½äºè¾ƒçŸ­çš„åˆ—æˆ–è€…åˆ—å­˜å‚¨åœ¨æº¢å‡ºé¡µ</p>
<h4 id="REDUNDANT-Row-Format-Storage-Characteristics"><a href="#REDUNDANT-Row-Format-Storage-Characteristics" class="headerlink" title="REDUNDANT Row Format Storage Characteristics"></a>REDUNDANT Row Format Storage Characteristics</h4><p>The <code>REDUNDANT</code> row format has the following storage characteristics:</p>
<ul>
<li><p>Each index record contains a 6-byte header. The header is used to link together consecutive records, and for row-level locking.</p>
<p>æ¯ä¸ªç´¢å¼•è®°å½•åŒ…å« 6 å­—èŠ‚çš„å¤´éƒ¨, ç”¨äºé“¾æ¥è¿ç»­çš„è®°å½•å’Œè¡Œçº§é”</p>
</li>
<li><p>Records in the clustered index contain fields for all user-defined columns. In addition, there is a 6-byte transaction ID field and a 7-byte roll pointer field.</p>
<p>åœ¨èšç°‡ç´¢å¼•è®°å½•ä¸­åŒ…å«äº†æ‰€æœ‰ç”¨æˆ·å®šä¹‰çš„åˆ—, é™¤æ­¤ä¹‹å¤–, è¿˜æœ‰ 6 å­—èŠ‚çš„äº‹åŠ¡IDå’Œ 7 å­—èŠ‚çš„å›æ»šæŒ‡é’ˆ</p>
</li>
<li><p>If no primary key is defined for a table, each clustered index record also contains a 6-byte row ID field.</p>
<p>å¦‚æœæ²¡æœ‰ä¸ºè¡¨å®šä¹‰ä¸€ä¸ªä¸»é”®, æ¯ä¸ªèšç°‡ç´¢å¼•è®°å½•è¿˜åŒ…å« 6 å­—èŠ‚çš„è¡Œ ID å­—æ®µ</p>
</li>
<li><p>Each secondary index record contains all the primary key columns defined for the clustered index key that are not in the secondary index.</p>
<p>æ¯ä¸ªæ¬¡çº§è®°å½•åŒ…å«ä¸ºèšç°‡ç´¢å¼•å®šä¹‰çš„ä¸åœ¨æ¬¡çº§ç´¢å¼•ä¸­çš„æ‰€æœ‰ä¸»é”®åˆ—</p>
</li>
<li><p>A record contains a pointer to each field of the record. If the total length of the fields in a record is less than 128 bytes, the pointer is one byte; otherwise, two bytes. The array of pointers is called the record directory. The area where the pointers point is the data part of the record.</p>
<p>è®°å½•åŒ…å«æŒ‡å‘è®°å½•æ¯ä¸ªå­—æ®µçš„æŒ‡é’ˆ, å¦‚æœè®°å½•ä¸­æ‰€æœ‰å­—æ®µé•¿åº¦æ€»å’Œå°äº 128 å­—èŠ‚, æŒ‡é’ˆå¤§å°ä¸º 1 å­—èŠ‚, å¦åˆ™ä¸º 2 å­—èŠ‚ (PS. è¿™é‡Œçš„ pointer å¯èƒ½ä¸æ˜¯æŒ‡é’ˆçš„æ„æ€, è€Œæ˜¯ç±»ä¼¼æŒ‡ç¤ºçš„å«ä¹‰, å®ƒå¯èƒ½æ˜¯åç§» offset)</p>
<p>æŒ‡é’ˆæ•°ç»„è¢«ç§°ä¸ºè®°å½•ç›®å½•, æŒ‡é’ˆæŒ‡å‘è®°å½•çš„æ•°æ®éƒ¨åˆ†</p>
</li>
<li><p>Internally, fixed-length character columns such as <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(10)</code></a> in stored in fixed-length format. Trailing spaces are not truncated from <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a> columns.</p>
<p>å›ºå®šé•¿åº¦çš„åˆ—, ä¾‹å¦‚ CHAR(10) ä»¥å›ºå®šé•¿åº¦æ ¼å¼åŒ–, VARCHAR ç»“å°¾ç©ºç™½ä¸ä¼šè¢«æˆªæ–­</p>
</li>
<li><p>Fixed-length columns greater than or equal to 768 bytes are encoded as variable-length columns, which can be stored off-page. For example, a <code>CHAR(255)</code> column can exceed 768 bytes if the maximum byte length of the character set is greater than 3, as it is with <code>utf8mb4</code>.</p>
<p>é•¿åº¦ &gt;= 768 å­—èŠ‚çš„åˆ—å³ä½¿æ˜¯å›ºå®šçš„, ä¹Ÿä¼šè¢«å½“åšå˜é•¿å®½åº¦åˆ—ç¼–ç , å­˜å‚¨åˆ°æº¢å‡ºé¡µ</p>
<p>æ¯”å¦‚, ä¸€ä¸ª CHAR(255) çš„åˆ—å¦‚æœå­—ç¬¦é›†çš„é•¿åº¦è¶…è¿‡3, é‚£ä¹ˆå°±è¶…è¿‡äº†768 å­—èŠ‚, æ­£å¦‚ utf8mb4</p>
</li>
<li><p>An SQL <code>NULL</code> value reserves one or two bytes in the record directory. An SQL <code>NULL</code> value reserves zero bytes in the data part of the record if stored in a variable-length column. For a fixed-length column, the fixed length of the column is reserved in the data part of the record. Reserving fixed space for <code>NULL</code> values permits columns to be updated in place from <code>NULL</code> to non-<code>NULL</code> values without causing index page fragmentation.</p>
<p>SQL NULL å€¼åœ¨è®°å½•ç›®å½•ä¸­å æœ‰ 1 æˆ– 2 ä¸ªå­—èŠ‚, å¦‚æœå­˜å‚¨åœ¨å˜é•¿åˆ—ä¸­, åœ¨è®°å½•çš„æ•°æ®éƒ¨åˆ†ä¸å ç©ºé—´. </p>
<p>å¯¹äºä¸€ä¸ªå›ºå®šé•¿åº¦çš„åˆ—, å­˜å‚¨åœ¨è®°å½•çš„æ•°æ®éƒ¨åˆ†, ä¸º NULL å€¼ä¿ç•™å›ºå®šçš„é•¿åº¦ä½¿åˆ—çš„æ›´æ–°å¯ä»¥å°±åœ°å‘ç”Ÿ, è€Œä¸ä¼šå¯¼è‡´ç´¢å¼•é¡µç¢ç‰‡</p>
</li>
</ul>
<h3 id="COMPACT-Row-Format"><a href="#COMPACT-Row-Format" class="headerlink" title="COMPACT Row Format"></a>COMPACT Row Format</h3><p>Tables that use the <code>COMPACT</code> row format store the first 768 bytes of variable-length column values (<a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/binary-varbinary.html" target="_blank" rel="noopener"><code>VARBINARY</code></a>, and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a> types) in the index record within the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_b_tree" target="_blank" rel="noopener">B-tree</a> node, with the remainder stored on overflow pages. Fixed-length columns greater than or equal to 768 bytes are encoded as variable-length columns, which can be stored off-page. For example, a <code>CHAR(255)</code> column can exceed 768 bytes if the maximum byte length of the character set is greater than 3, as it is with <code>utf8mb4</code>.</p>
<p>(PS. å’Œ REDUNDANT ä¸€æ ·çš„ = =)</p>
<p>If the value of a column is 768 bytes or less, an overflow page is not used, and some savings in I/O may result, since the value is stored entirely in the B-tree node. This works well for relatively short <code>BLOB</code> column values, but may cause B-tree nodes to fill with data rather than key values, reducing their efficiency. Tables with many <code>BLOB</code>columns could cause B-tree nodes to become too full, and contain too few rows, making the entire index less efficient than if rows were shorter or column values were stored off-page.</p>
<p>(PS. æ€ä¹ˆè¿˜æ˜¯ä¸€æ ·çš„ = = )</p>
<h4 id="COMPACT-Row-Format-Storage-Characteristics"><a href="#COMPACT-Row-Format-Storage-Characteristics" class="headerlink" title="COMPACT Row Format Storage Characteristics"></a>COMPACT Row Format Storage Characteristics</h4><p>The <code>COMPACT</code> row format has the following storage characteristics:</p>
<ul>
<li><p>Each index record contains a 5-byte header that may be preceded by a variable-length header. The header is used to link together consecutive records, and for row-level locking.</p>
<p>æ¯ä¸ªç´¢å¼•è®°å½•åŒ…å« 5 å­—èŠ‚çš„å¤´éƒ¨, å‰é¢å¯èƒ½æ˜¯å˜é•¿å¤´éƒ¨. å¤´éƒ¨ç”¨äºé“¾æ¥è®°å½•å’Œè¡Œé”</p>
</li>
<li><p>The variable-length part of the record header contains a bit vector for indicating <code>NULL</code> columns. If the number of columns in the index that can be <code>NULL</code> is <em>N</em>, the bit vector occupies <code>CEILING(*N*/8)</code> bytes. (For example, if there are anywhere from 9 to 16 columns that can be <code>NULL</code>, the bit vector uses two bytes.) Columns that are <code>NULL</code>do not occupy space other than the bit in this vector. The variable-length part of the header also contains the lengths of variable-length columns. Each length takes one or two bytes, depending on the maximum length of the column. If all columns in the index are <code>NOT NULL</code> and have a fixed length, the record header has no variable-length part.</p>
<p>å˜é•¿åˆ—è®°å½•å¤´éƒ¨åŒ…å«ç©ºåˆ—çš„ä½å‘é‡ NULL åˆ—, å¦‚æœç´¢å¼•ä¸­å¯ä»¥æ˜¯ NULL çš„åˆ—çš„æ•°é‡ä¸º N, å‘é‡å ç”¨ CEILING(N/8)å­—èŠ‚(ä¾‹å¦‚, å¦‚æœæœ‰ 9 åˆ° 16 åˆ—å¯ä»¥ä¸ºç©º, å‘é‡ä½¿ç”¨ 2 å­—èŠ‚) NULL åˆ—ä¸å ç”¨ç©ºé—´, åªå ç”¨å‘é‡ä¸­çš„ä½</p>
<p>å¤´éƒ¨çš„å˜é•¿éƒ¨åˆ†ä¹ŸåŒ…å«å˜é•¿åˆ—çš„é•¿åº¦, å ç”¨ 1 åˆ° 2 ä¸ªå­—èŠ‚, å–å†³äºåˆ—çš„æœ€å¤§é•¿åº¦, å¦‚æœç´¢å¼•ä¸­çš„æ‰€æœ‰åˆ—éç©º, å¹¶ä¸”æœ‰ä¸€ä¸ªå›ºå®šçš„é•¿åº¦, é‚£ä¹ˆè®°å½•å¤´éƒ¨ä¸ä¼šæœ‰å˜é•¿é•¿åº¦éƒ¨åˆ†</p>
</li>
<li><p>For each non-<code>NULL</code> variable-length field, the record header contains the length of the column in one or two bytes. Two bytes are only needed if part of the column is stored externally in overflow pages or the maximum length exceeds 255 bytes and the actual length exceeds 127 bytes. For an externally stored column, the 2-byte length indicates the length of the internally stored part plus the 20-byte pointer to the externally stored part. The internal part is 768 bytes, so the length is 768+20. The 20-byte pointer stores the true length of the column.</p>
<p>å¯¹äºæ¯ä¸ªéç©ºå˜é•¿å­—æ®µ, è®°å½•å¤´éƒ¨åŒ…å«åˆ—çš„é•¿åº¦, 1 ~ 2 å­—èŠ‚. 2 å­—èŠ‚ä»…åœ¨åˆ—çš„éƒ¨åˆ†å­˜å‚¨åœ¨æº¢å‡ºé¡µ, æˆ–æœ€å¤§é•¿åº¦è¶…è¿‡ 255 å­—èŠ‚, å¹¶ä¸”çœŸå®é•¿åº¦è¶…è¿‡ 127 å­—èŠ‚</p>
<p>å¯¹äºä¸€ä¸ªå¤–éƒ¨å­˜å‚¨çš„åˆ—, è¿™ 2 å­—èŠ‚é•¿åº¦ä»£è¡¨å†…éƒ¨å­˜å‚¨éƒ¨åˆ† + 20 å­—èŠ‚çš„æŒ‡å‘å¤–éƒ¨å­˜å‚¨éƒ¨åˆ†çš„æŒ‡é’ˆ </p>
<p>å†…éƒ¨éƒ¨åˆ†æ˜¯ 768 å­—èŠ‚, é•¿åº¦æ˜¯ 768 + 20, è¿™ 20 å­—èŠ‚æŒ‡é’ˆå­˜å‚¨åˆ—çš„çœŸå®é•¿åº¦ (PS. è¿™é‡Œæœ‰ç‚¹ä¸å¯¹)</p>
</li>
<li><p>The record header is followed by the data contents of non-<code>NULL</code> columns.</p>
<p>è®°å½•å¤´åè·Ÿç€éç©ºåˆ—çš„æ•°æ®å†…å®¹</p>
</li>
<li><p>Records in the clustered index contain fields for all user-defined columns. In addition, there is a 6-byte transaction ID field and a 7-byte roll pointer field.</p>
<p>èšç°‡ç´¢å¼•è®°å½•åŒ…å«æ‰€æœ‰ç”¨æˆ·å®šä¹‰åˆ—, åŒæ—¶æœ‰ 6 å­—èŠ‚çš„äº‹åŠ¡ ID å’Œ 7 å­—èŠ‚çš„å›æ»š ID</p>
</li>
<li><p>If no primary key is defined for a table, each clustered index record also contains a 6-byte row ID field.</p>
<p>å¦‚æœæ²¡æœ‰ä¸ºè¡¨å®šä¹‰ä¸»é”®, æ¯ä¸ªèšç°‡ç´¢å¼•è¿˜åŒ…å« 6 å­—èŠ‚çš„è¡Œ ID</p>
</li>
<li><p>Each secondary index record contains all the primary key columns defined for the clustered index key that are not in the secondary index. If any of the primary key columns are variable length, the record header for each secondary index has a variable-length part to record their lengths, even if the secondary index is defined on fixed-length columns.</p>
<p>æ¯ä¸ªæ¬¡çº§ç´¢å¼•è®°å½•åŒ…å«æ‰€æœ‰ä¸ºèšç°‡ç´¢å¼•å®šä¹‰çš„ä¸åœ¨æ¬¡çº§ç´¢å¼•ä¸­çš„ä¸»é”®, å¦‚æœæœ‰ä¸»é”®åˆ—æ˜¯å˜é•¿çš„, æ¯ä¸ªæ¬¡çº§ç´¢å¼•çš„å¤´éƒ¨æœ‰ä¸€ä¸ªå˜é•¿éƒ¨åˆ†è®°å½•æ¬¡çº§ç´¢å¼•çš„é•¿åº¦, å³ä½¿æ¬¡çº§ç´¢å¼•æ˜¯å›ºå®šçš„åˆ—</p>
</li>
<li><p>Internally, for nonvariable-length character sets, fixed-length character columns such as <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(10)</code></a> are stored in a fixed-length format.</p>
<p>Trailing spaces are not truncated from <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a> columns.</p>
<p>å¯¹éå˜é•¿å­—ç¬¦é›†, åƒ CHAR(10) è¿™æ ·çš„å›ºå®šå­—ç¬¦é›†åˆ—ä»¥å›ºå®šé•¿åº¦æ ¼å¼åŒ–</p>
<p>VARCHAR åˆ—å°¾éƒ¨ç©ºç™½ä¸ä¼šè¢«æˆªæ–­</p>
</li>
<li><p>Internally, for variable-length character sets such as <code>utf8mb3</code> and <code>utf8mb4</code>, <code>InnoDB</code> attempts to store <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(*N*)</code></a> in <em>N</em> bytes by trimming trailing spaces. If the byte length of a <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(*N*)</code></a> column value exceeds <em>N</em> bytes, trailing spaces are trimmed to a minimum of the column value byte length. The maximum length of a <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(*N*)</code></a> column is the maximum character byte length Ã— <em>N</em>.</p>
<p>å†…éƒ¨, å¦‚ utf8mb3 å’Œ utf8mb4 å˜é•¿å­—ç¬¦é›†, InnoDB é€šè¿‡è£å‰ªå°¾éšçš„ç©ºæ ¼å°† CHAR(N) å­˜å‚¨ N å­—èŠ‚</p>
<p>å¦‚æœ CHAR(N) åˆ—é•¿åº¦è¶…è¿‡ N å­—èŠ‚, å°¾ç«¯ç©ºç™½è¢«è£å‰ªåˆ°åˆ—å€¼å­—èŠ‚æ•°çš„æœ€å°å€¼, CHAR(N) åˆ—çš„æœ€å¤§é•¿åº¦æ˜¯æœ€å¤§å­—ç¬¦å­—èŠ‚å®½åº¦ x N</p>
<p>A minimum of <em>N</em> bytes is reserved for <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(*N*)</code></a>. Reserving the minimum space <em>N</em> in many cases enables column updates to be done in place without causing index page fragmentation. By comparison, <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>CHAR(*N*)</code></a> columns occupy the maximum character byte length Ã— <em>N</em> when using the <code>REDUNDANT</code> row format.</p>
<p>ä¸º CHAR(N) å­˜å‚¨ä¸€ä¸ªæœ€å° N å­—èŠ‚ç©ºé—´, å­˜å‚¨è¿™ä¸ªæœ€å°çš„ N ç©ºé—´åœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯åˆ—å€¼çš„æ›´æ–°å°±åœ°å‘ç”Ÿ, ä¸å¯¼è‡´é¡µç¢ç‰‡. å¯¹æ¯”è€Œè¨€, å½“ä½¿ç”¨ REDUNDANT è¡Œæ ¼å¼åŒ–æ—¶, CHAR(N) åˆ—å æœ‰æœ€å¤§å­—ç¬¦é•¿åº¦  x N </p>
<p>Fixed-length columns greater than or equal to 768 bytes are encoded as variable-length fields, which can be stored off-page. For example, a <code>CHAR(255)</code> column can exceed 768 bytes if the maximum byte length of the character set is greater than 3, as it is with <code>utf8mb4</code>.</p>
<p>å›ºå®šé•¿åº¦å¤§äºæˆ–ç­‰äº 768 å­—èŠ‚çš„åˆ—ä»¥å˜é•¿å­—æ®µç¼–ç , å­˜å‚¨åœ¨é¡µå¤–, â€¦ (PS. emmâ€¦ å¥½åƒæ˜¯ä¸€æ ·çš„äº†)</p>
</li>
</ul>
<p>(PS. REDUNDANT å’Œ COMPACT çš„åŒºåˆ«ä¸»è¦æœ‰ä¸¤ä¸ª : 1. COMPACT ä¸ä¿å­˜å›ºå®šå­—æ®µçš„é•¿åº¦ 2. COMPACT ä¼šè£å‰ªå°¾éšçš„ç©ºç™½å­—ç¬¦. æ‰€ä»¥ REDUNDANT å« REDUNDANT, COMPACT å« COMPACT, REDUNDANT ç‰ºç‰²äº†ç©ºé—´æ¢å–æ•ˆç‡)</p>
<h3 id="DYNAMIC-Row-Format"><a href="#DYNAMIC-Row-Format" class="headerlink" title="DYNAMIC Row Format"></a>DYNAMIC Row Format</h3><p>When a table is created with <code>ROW_FORMAT=DYNAMIC</code>, <code>InnoDB</code> can store long variable-length column values (for <a href="https://dev.mysql.com/doc/refman/8.0/en/char.html" target="_blank" rel="noopener"><code>VARCHAR</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/binary-varbinary.html" target="_blank" rel="noopener"><code>VARBINARY</code></a>, and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a> types) fully off-page, with the clustered index record containing only a 20-byte pointer to the overflow page. Fixed-length fields greater than or equal to 768 bytes are encoded as variable-length fields. For example, a <code>CHAR(255)</code> column can exceed 768 bytes if the maximum byte length of the character set is greater than 3, as it is with <code>utf8mb4</code>.</p>
<p>å½“è¡¨è¢«åˆ›å»ºä¸º DYNAMIC ç±»å‹æ—¶, InnoDB èƒ½å°†é•¿çš„å˜é•¿åˆ—å®Œå…¨å­˜å‚¨åœ¨é¡µå¤–, èšç°‡ç´¢å¼•åªåŒ…å« 20 å­—èŠ‚çš„æŒ‡å‘æº¢å‡ºé¡µçš„æŒ‡é’ˆ. å›ºå®šé•¿åº¦ &gt;= 768 çš„å­—æ®µæŒ‰ç…§å˜é•¿å­—æ®µå­˜å‚¨, æ¯”å¦‚ â€¦ (PS. ä¸€æ ·çš„, å°±ä¸æ¯”å¦‚äº†â€¦ = =)</p>
<p>Whether columns are stored off-page depends on the page size and the total size of the row. When a row is too long, the longest columns are chosen for off-page storage until the clustered index record fits on the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_b_tree" target="_blank" rel="noopener">B-tree</a> page. <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>TEXT</code></a> and <a href="https://dev.mysql.com/doc/refman/8.0/en/blob.html" target="_blank" rel="noopener"><code>BLOB</code></a> columns that are less than or equal to 40 bytes are stored in line.</p>
<p>åˆ—æ˜¯å¦å­˜å‚¨åœ¨é¡µå¤–å–å†³äºé¡µçš„å¤§å°å’Œè¡Œçš„æ€»å¤§å°. </p>
<p>å½“è¡Œå¤ªé•¿æ—¶, æœ€é•¿çš„åˆ—è¢«é€‰ä¸ºé¡µå¤–å­˜å‚¨, ç›´åˆ°èšç°‡ç´¢å¼•è®°å½•å¤§å°é€‚åˆä¿å­˜åœ¨ B-tree é¡µ, TEXT å’Œ BLOB åˆ— &lt;= 40 å­—èŠ‚æŒ‰è¡Œå­˜å‚¨</p>
<p>The <code>DYNAMIC</code> row format maintains the efficiency of storing the entire row in the index node if it fits (as do the <code>COMPACT</code> and <code>REDUNDANT</code> formats), but the <code>DYNAMIC</code> row format avoids the problem of filling B-tree nodes with a large number of data bytes of long columns. The <code>DYNAMIC</code> row format is based on the idea that if a portion of a long data value is stored off-page, it is usually most efficient to store the entire value off-page. With <code>DYNAMIC</code> format, shorter columns are likely to remain in the B-tree node, minimizing the number of overflow pages required for a given row.</p>
<p>DYNAMIC è¡Œå­˜å‚¨ç»´æŠ¤åœ¨ç´¢å¼•èŠ‚ç‚¹ä¸­å­˜å‚¨æ•´è¡Œ(å¦‚æœå¤§å°åŒ¹é…çš„è¯)çš„æ•ˆç‡(å°±åƒ COMPACT å’Œ REDUNDANT ä¸€æ ·), ä½†æ˜¯ DYNAMIC é¿å…äº† B-tree è¢«å¤§é‡é•¿åˆ—å¡«æ»¡çš„é—®é¢˜</p>
<p>DYNAMIC è¡Œå­˜å‚¨åŸºäºä¸€éƒ¨åˆ†æ•°æ®å­˜å‚¨åœ¨é¡µå¤–çš„æƒ³æ³•, é€šå¸¸æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯æ•´ä¸ªå€¼éƒ½å­˜å‚¨åœ¨é¡µå¤–</p>
<p>ä½¿ç”¨ DYNAMIC å­˜å‚¨, è¾ƒçŸ­çš„è¡Œæ›´å¯èƒ½ä¿å­˜åœ¨ B-tree èŠ‚ç‚¹, æœ€å°åŒ–è¡Œæ‰€éœ€è¦çš„æº¢å‡ºé¡µæ•°é‡</p>
<p>The <code>DYNAMIC</code> row format supports index key prefixes up to 3072 bytes. </p>
<p>DYNAMIC è¡Œå­˜å‚¨æ”¯æŒç´¢å¼•é”®å‰ç¼€, æœ€å¤§å¯è¾¾ 3072 å­—èŠ‚ (PS. = = è¿™ä¹ˆå¤§çš„ä¹ˆâ€¦) (éœ€è¦è®¾ç½® innodb_large_prefix=1)</p>
<p>Tables that use the <code>DYNAMIC</code> row format can be stored in the system tablespace, file-per-table tablespaces, and general tablespaces. To store <code>DYNAMIC</code> tables in the system tablespace, either disable <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> and use a regular <code>CREATE TABLE</code> or <code>ALTER TABLE</code> statement, or use the <code>TABLESPACE [=] innodb_system</code> table option with <code>CREATE TABLE</code> or <code>ALTER TABLE</code>. The <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> variable is not applicable to general tablespaces, nor is it applicable when using the <code>TABLESPACE [=] innodb_system</code> table option to store <code>DYNAMIC</code> tables in the system tablespace.</p>
<p>ä½¿ç”¨ DYNAMIC å­˜å‚¨çš„è¡Œèƒ½ä¿å­˜åœ¨ system tablespace, file-per-table tablespace, ä»¥åŠ general tablespace ä¸­. </p>
<p>å°† DYNAMIC è¡¨å­˜å‚¨åœ¨ system tablespace è¦ä¹ˆå–æ¶ˆ innodb_file_per_table ä»¥åŠä½¿ç”¨å¸¸è§„çš„ CREATE TABLE æˆ– ALTER TABLE è¯­å¥, æˆ–è€…åœ¨ CREATE TABLE æˆ– ALTER TABLE æ—¶ä½¿ç”¨ TABLESPACE [=] innodb_system è¡¨é€‰é¡¹.</p>
<p>innodb_file_per_table å˜é‡ä¸é€‚ç”¨äº general tablespace, ä¹Ÿä¸é€‚ç”¨äºä½¿ç”¨ TABLESPACE [=] innodb_system è¡¨é€‰é¡¹å»åœ¨ system tablespace ä¸­å­˜å‚¨ DYNAMIC è¡¨</p>
<h4 id="DYNAMIC-Row-Format-Storage-Characteristics"><a href="#DYNAMIC-Row-Format-Storage-Characteristics" class="headerlink" title="DYNAMIC Row Format Storage Characteristics"></a>DYNAMIC Row Format Storage Characteristics</h4><p>The <code>DYNAMIC</code> row format is a variation of the <code>COMPACT</code> row format. For storage characteristics, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-compact-row-format-characteristics" target="_blank" rel="noopener">COMPACT Row Format Storage Characteristics</a>.</p>
<p>DYNAMIC è¡Œå­˜å‚¨æ˜¯ COMPACT è¡Œå­˜å‚¨çš„ä¸€ç§å˜åŒ–</p>
<h3 id="COMPRESSED-Row-Format"><a href="#COMPRESSED-Row-Format" class="headerlink" title="COMPRESSED Row Format"></a>COMPRESSED Row Format</h3><p>The <code>COMPRESSED</code> row format uses similar internal details for off-page storage as the <code>DYNAMIC</code> row format, with additional storage and performance considerations from the table and index data being compressed and using smaller page sizes. With the <code>COMPRESSED</code> row format, the <code>KEY_BLOCK_SIZE</code> option controls how much column data is stored in the clustered index, and how much is placed on overflow pages. For more information about the <code>COMPRESSED</code> row format, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-compression.html" target="_blank" rel="noopener">Section 15.9, â€œInnoDB Table and Page Compressionâ€</a>.</p>
<p>COMPRESSED è¡Œå­˜å‚¨ä½¿ç”¨å’Œ DYNAMIC ç±»ä¼¼çš„å†…éƒ¨ç»†èŠ‚ : é¡µå¤–å­˜å‚¨, å‹ç¼©è¡¨å’Œç´¢å¼•æ•°æ®ä»¥ä½¿ç”¨æ›´å°‘çš„é¡µ, è€ƒè™‘é¢å¤–çš„å­˜å‚¨å’Œæ€§èƒ½. </p>
<p>ä½¿ç”¨ COMPRESSED è¡Œå­˜å‚¨, KEY_BLOCK_SIZE é€‰é¡¹æ§åˆ¶å¤šå°‘åˆ—æ•°æ®å­˜å‚¨åœ¨èšç°‡ç´¢å¼•, å¤šå°‘å­˜å‚¨åœ¨æº¢å‡ºé¡µ. </p>
<p>The <code>COMPRESSED</code> row format supports index key prefixes up to 3072 bytes.</p>
<p>COMPRESSED è¡Œå­˜å‚¨æ”¯æŒç´¢å¼•é”®å‰ç¼€, æœ€å¤§å¯è¾¾ 3072 å­—èŠ‚</p>
<p>Tables that use the <code>COMPRESSED</code> row format can be created in file-per-table tablespaces or general tablespaces. The system tablespace does not support the <code>COMPRESSED</code>row format. To store a <code>COMPRESSED</code> table in a file-per-table tablespace, the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> variable must be enabled. The <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> variable is not applicable to general tablespaces. General tablespaces support all row formats with the caveat that compressed and uncompressed tables cannot coexist in the same general tablespace due to different physical page sizes. For more information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html" target="_blank" rel="noopener">Section 15.6.3.3, â€œGeneral Tablespacesâ€</a>.</p>
<h4 id="Compressed-Row-Format-Storage-Characteristics"><a href="#Compressed-Row-Format-Storage-Characteristics" class="headerlink" title="Compressed Row Format Storage Characteristics"></a>Compressed Row Format Storage Characteristics</h4><p>The <code>COMPRESSED</code> row format is a variation of the <code>COMPACT</code> row format. For storage characteristics, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html#innodb-compact-row-format-characteristics" target="_blank" rel="noopener">COMPACT Row Format Storage Characteristics</a>.</p>
<h3 id="Defining-the-Row-Format-of-a-Table"><a href="#Defining-the-Row-Format-of-a-Table" class="headerlink" title="Defining the Row Format of a Table"></a>Defining the Row Format of a Table</h3><p>The default row format for <code>InnoDB</code> tables is defined by <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable, which has a default value of <code>DYNAMIC</code>. The default row format is used when the <code>ROW_FORMAT</code> table option is not defined explicitly or when <code>ROW_FORMAT=DEFAULT</code> is specified.</p>
<p>innodb_default_row_format æ§åˆ¶é»˜è®¤åˆ›å»ºçš„è¡¨è¡Œå­˜å‚¨ç±»å‹ (dynamic) , å½“è¡¨é€‰é¡¹ ROW_FORMAT æ²¡æœ‰æ˜¾å¼æŒ‡æ˜æ—¶æ‰ä¼šä½¿ç”¨é»˜è®¤é…ç½®</p>
<p>The row format of a table can be defined explicitly using the <code>ROW_FORMAT</code> table option in a <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> or <a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table.html" target="_blank" rel="noopener"><code>ALTER TABLE</code></a> statement. For example:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (c1 <span class="built_in">INT</span>) ROW_FORMAT=DYNAMIC;</span><br></pre></td></tr></table></figure>

<p>An explicitly defined <code>ROW_FORMAT</code> setting overrides the default row format. Specifying <code>ROW_FORMAT=DEFAULT</code> is equivalent to using the implicit default.</p>
<p>The <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable can be set dynamically:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL innodb_default_row_format=DYNAMIC;</span><br></pre></td></tr></table></figure>

<p>Valid <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> options include <code>DYNAMIC</code>, <code>COMPACT</code>, and <code>REDUNDANT</code>. The <code>COMPRESSED</code> row format, which is not supported for use in the system tablespace, cannot be defined as the default. It can only be specified explicitly in a <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> or <a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table.html" target="_blank" rel="noopener"><code>ALTER TABLE</code></a> statement. Attempting to set the<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable to <code>COMPRESSED</code> returns an error:</p>
<p>COMPRESSED ä¸èƒ½ç”¨äºé»˜è®¤è®¾ç½®, åªèƒ½æ˜¾å¼æŒ‡å®š</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL innodb_default_row_format=COMPRESSED;</span><br><span class="line">ERROR 1231 (42000): Variable 'innodb_default_row_format'</span><br><span class="line">can't be <span class="keyword">set</span> <span class="keyword">to</span> the <span class="keyword">value</span> <span class="keyword">of</span> <span class="string">'COMPRESSED'</span></span><br></pre></td></tr></table></figure>

<p>Newly created tables use the row format defined by the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable when a <code>ROW_FORMAT</code> option is not specified explicitly, or when<code>ROW_FORMAT=DEFAULT</code> is used. For example, the following <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> statements use the row format defined by the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (c1 <span class="built_in">INT</span>);</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t2 (c1 <span class="built_in">INT</span>) ROW_FORMAT=<span class="keyword">DEFAULT</span>;</span><br></pre></td></tr></table></figure>

<p>When a <code>ROW_FORMAT</code> option is not specified explicitly, or when <code>ROW_FORMAT=DEFAULT</code> is used, an operation that rebuilds a table silently changes the row format of the table to the format defined by the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable.</p>
<p>Table-rebuilding operations include <a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table.html" target="_blank" rel="noopener"><code>ALTER TABLE</code></a> operations that use <code>ALGORITHM=COPY</code> or <code>ALGORITHM=INPLACE</code> where table rebuilding is required. See <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-online-ddl-operations.html" target="_blank" rel="noopener">Section 15.12.1, â€œOnline DDL Operationsâ€</a> for more information. <a href="https://dev.mysql.com/doc/refman/8.0/en/optimize-table.html" target="_blank" rel="noopener"><code>OPTIMIZE TABLE</code></a> is also a table-rebuilding operation.</p>
<p>The following example demonstrates a table-rebuilding operation that silently changes the row format of a table created without an explicitly defined row format.</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT @@innodb_default_row_format;</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| @@innodb_default_row_format |</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line">| dynamic                     |</span><br><span class="line">+<span class="comment">-----------------------------+</span></span><br><span class="line"></span><br><span class="line">mysql&gt; CREATE TABLE t1 (c1 INT);</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME LIKE 'test/t1' \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     TABLE_ID: 54</span><br><span class="line">         NAME: test/t1</span><br><span class="line">         FLAG: 33</span><br><span class="line">       N_COLS: 4</span><br><span class="line">        SPACE: 35</span><br><span class="line">   ROW_FORMAT: Dynamic</span><br><span class="line">ZIP_PAGE_SIZE: 0</span><br><span class="line">   SPACE_TYPE: Single</span><br><span class="line"></span><br><span class="line">mysql&gt; SET GLOBAL innodb_default_row_format=COMPACT;</span><br><span class="line"></span><br><span class="line">mysql&gt; ALTER TABLE t1 ADD COLUMN (c2 INT);</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME LIKE 'test/t1' \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     TABLE_ID: 55</span><br><span class="line">         NAME: test/t1</span><br><span class="line">         FLAG: 1</span><br><span class="line">       N_COLS: 5</span><br><span class="line">        SPACE: 36</span><br><span class="line">   ROW_FORMAT: Compact</span><br><span class="line">ZIP_PAGE_SIZE: 0</span><br><span class="line">   SPACE_TYPE: Single</span><br></pre></td></tr></table></figure>

<p>(PS. è¿™ç§æƒ…å†µè¦æ ¼å¤–æ³¨æ„, æ›´æ”¹è¡¨æ“ä½œç›¸å½“äºé‡æ–°åˆ›å»º, ä¹‹å‰è®¾ç½®çš„ä¸€äº›é»˜è®¤é€‰é¡¹å¯èƒ½å·²ç»è¢«æ”¹å˜äº†)</p>
<p>Consider the following potential issues before changing the row format of existing tables from <code>REDUNDANT</code> or <code>COMPACT</code> to <code>DYNAMIC</code>.</p>
<ul>
<li><p>The <code>REDUNDANT</code> and <code>COMPACT</code> row formats support a maximum index key prefix length of 767 bytes whereas <code>DYNAMIC</code> and <code>COMPRESSED</code> row formats support an index key prefix length of 3072 bytes. In a replication environment, if the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> variable is set to <code>DYNAMIC</code> on the master, and set to <code>COMPACT</code> on the slave, the following DDL statement, which does not explicitly define a row format, succeeds on the master but fails on the slave:</p>
<p>REDUNDANT å’Œ COMPACT è¡Œå­˜å‚¨æ”¯æŒæœ€å¤§ 767 å­—èŠ‚çš„ç´¢å¼•é”®å‰ç¼€, ç„¶è€Œ DYNAMIC å’Œ COMPRESSED è¡Œå­˜å‚¨æ”¯æŒçš„é•¿åº¦å¯è¾¾ 3072 å­—èŠ‚.</p>
<p>åœ¨åŒæ ·çš„ç¯å¢ƒä¸‹, å¦‚æœ innodb_default_row_format åœ¨ä¸»ç¯å¢ƒä¸‹è®¾ç½®ä¸º DYNAMIC, è€Œåœ¨æ¬¡ç¯å¢ƒä¸‹è®¾ç½®ä¸º COMPACT, ä¸‹åˆ—æ²¡æœ‰æ˜¾å¼å®šä¹‰è¡Œå­˜å‚¨çš„è¯­å¥ä¼šåœ¨ä¸»ç¯å¢ƒä¸‹æˆåŠŸ, è€Œæ¬¡ç¯å¢ƒä¼šå¤±è´¥</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (c1 <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>, c2 <span class="built_in">VARCHAR</span>(<span class="number">5000</span>), <span class="keyword">KEY</span> i1(c2(<span class="number">3070</span>)));</span><br></pre></td></tr></table></figure>

<p>For related information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-restrictions.html" target="_blank" rel="noopener">Section 15.6.1.6, â€œLimits on InnoDB Tablesâ€</a>.</p>
<p>(PS. åŸå› æ˜¯ REDUNDANT å’Œ COMPACT è¡Œå­˜å‚¨é™åˆ¶äº†ç´¢å¼•å‰ç¼€å¿…é¡»ä½äº 768 å­—èŠ‚</p>
<p>è¿™é‡Œè¿˜è¦åŠ é™åˆ¶, å°±æ˜¯ c2(3070) çœŸæ­£å†…å­˜ &lt; 3072 )</p>
</li>
<li><p>Importing a table that does not explicitly define a row format results in a schema mismatch error if the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> setting on the source server differs from the setting on the destination server. For more information, refer to the limitations outlined in <a href="https://dev.mysql.com/doc/refman/8.0/en/tablespace-copying.html" target="_blank" rel="noopener">Section 15.6.3.7, â€œCopying Tablespaces to Another Instanceâ€</a>.</p>
<p>å¯¼å…¥ä¸€ä¸ªä¸ºæ˜¾å¼æŒ‡å®šè¡Œå­˜å‚¨çš„è¡¨æ—¶, è¢«å¯¼å…¥è¡¨çš„è¡Œå­˜å‚¨å’Œé»˜è®¤å­˜å‚¨è®¾ç½®ä¸ä¸€è‡´ä¼šäº§ç”Ÿé”™è¯¯</p>
</li>
</ul>
<h3 id="Determining-the-Row-Format-of-a-Table"><a href="#Determining-the-Row-Format-of-a-Table" class="headerlink" title="Determining the Row Format of a Table"></a>Determining the Row Format of a Table</h3><p>To determine the row format of a table, use <a href="https://dev.mysql.com/doc/refman/8.0/en/show-table-status.html" target="_blank" rel="noopener"><code>SHOW TABLE STATUS</code></a>:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW TABLE STATUS IN test1\G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: t1</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Dynamic</span><br><span class="line">           Rows: 0</span><br><span class="line"> Avg_row_length: 0</span><br><span class="line">    Data_length: 16384</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 16384</span><br><span class="line">      Data_free: 0</span><br><span class="line"> Auto_increment: 1</span><br><span class="line">    Create_time: 2016-09-14 16:29:38</span><br><span class="line">    Update_time: NULL</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: utf8mb4_0900_ai_ci</span><br><span class="line">       <span class="keyword">Checksum</span>: <span class="literal">NULL</span></span><br><span class="line"> Create_options: </span><br><span class="line">        <span class="keyword">Comment</span>:</span><br></pre></td></tr></table></figure>

<p>Alternatively, query the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-tables-table.html" target="_blank" rel="noopener"><code>INFORMATION_SCHEMA.INNODB_TABLES</code></a> table:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT NAME, ROW_FORMAT FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME='test1/t1';</span><br><span class="line">+<span class="comment">----------+------------+</span></span><br><span class="line">| NAME     | ROW_FORMAT |</span><br><span class="line">+<span class="comment">----------+------------+</span></span><br><span class="line">| test1/t1 | Dynamic    |</span><br><span class="line">+<span class="comment">----------+------------+</span></span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>read/InnoDBRedoLog</title>
    <url>/2020/01/09/read/InnoDBRedoLog/</url>
    <content><![CDATA[<h3 id="15-6-5-Redo-Log"><a href="#15-6-5-Redo-Log" class="headerlink" title="15.6.5 Redo Log"></a>15.6.5 Redo Log</h3><p>By default, the redo log is physically represented on disk by two files named <code>ib_logfile0</code> and <code>ib_logfile1</code>. MySQL writes to the redo log files in a circular fashion. Data in the redo log is encoded in terms of records affected; this data is collectively referred to as redo. The passage of data through the redo log is represented by an ever-increasing <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_lsn" target="_blank" rel="noopener">LSN</a> value.</p>
<p>é»˜è®¤ redo æ—¥å¿—é€šè¿‡ä¸¤ä¸ªå« ib_logfile0 å’Œ ib_logfile1 çš„æ–‡ä»¶ç‰©ç†åœ°è®°å½•åœ¨ç£ç›˜ä¸Š. MySQL ä»¥å¾ªç¯æ–¹å¼å†™å…¥åˆ°æ–‡ä»¶ä¸­. redo æ—¥å¿—ä¸­çš„æ•°æ®å—è®°å½•å½±å“ç¼–ç . è¿™äº›æ•°æ®ç»Ÿç§°ä¸º redo. æ•°æ®é€šè¿‡ redo æ—¥å¿—çš„ä¼ é€’ç”±ä¸€ä¸ªä¸æ–­å¢é•¿çš„ LSN å€¼è¡¨ç¤º</p>
<p>For related information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-init-startup-configuration.html#innodb-startup-log-file-configuration" target="_blank" rel="noopener">Redo Log File Configuration</a>, and <a href="https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-logging.html" target="_blank" rel="noopener">Section 8.5.4, â€œOptimizing InnoDB Redo Loggingâ€</a>.</p>
<p>For information about data-at-rest encryption for redo logs, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-tablespace-encryption.html#innodb-tablespace-encryption-redo-log" target="_blank" rel="noopener">Redo Log Encryption</a>.</p>
<h4 id="Changing-the-Number-or-Size-of-Redo-Log-Files"><a href="#Changing-the-Number-or-Size-of-Redo-Log-Files" class="headerlink" title="Changing the Number or Size of Redo Log Files"></a>Changing the Number or Size of Redo Log Files</h4><ol>
<li>Stop the MySQL server and make sure that it shuts down without errors.</li>
<li>Edit <code>my.cnf</code> to change the log file configuration. To change the log file size, configure <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_file_size" target="_blank" rel="noopener"><code>innodb_log_file_size</code></a>. To increase the number of log files, configure<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_files_in_group" target="_blank" rel="noopener"><code>innodb_log_files_in_group</code></a>.</li>
<li>Start the MySQL server again.</li>
</ol>
<p>If <code>InnoDB</code> detects that the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_file_size" target="_blank" rel="noopener"><code>innodb_log_file_size</code></a> differs from the redo log file size, it writes a log checkpoint, closes and removes the old log files, creates new log files at the requested size, and opens the new log files.</p>
<h4 id="Group-Commit-for-Redo-Log-Flushing"><a href="#Group-Commit-for-Redo-Log-Flushing" class="headerlink" title="Group Commit for Redo Log Flushing"></a>Group Commit for Redo Log Flushing</h4><p><code>InnoDB</code>, like any other <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_acid" target="_blank" rel="noopener">ACID</a>-compliant database engine, flushes the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_redo_log" target="_blank" rel="noopener">redo log</a> of a transaction before it is committed. <code>InnoDB</code> uses <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_group_commit" target="_blank" rel="noopener">group commit</a> functionality to group multiple such flush requests together to avoid one flush for each commit. With group commit, <code>InnoDB</code> issues a single write to the log file to perform the commit action for multiple user transactions that commit at about the same time, significantly improving throughput.</p>
<p>InnoDB åƒå…¶ä»– ACID æ•°æ®å¼•æ“ä¸€æ ·, åœ¨äº‹åŠ¡æäº¤å‰å†²åˆ· redo æ—¥å¿—, InnoDB ä½¿ç”¨ç»„æäº¤åŠŸèƒ½, å°†å¤šä¸ªæäº¤è¯·æ±‚åˆ†ç»„, é¿å…æ¯æ¬¡æäº¤éƒ½å†²åˆ·è®°å½•. åœ¨ç»„æäº¤ä¸­, InnoDB ä¸ºåœ¨å¤§çº¦åŒä¸€æ—¶é—´æäº¤çš„å¤šæ¬¡ç”¨æˆ·äº‹åŠ¡æ‰§è¡Œå•æ¬¡æ–‡ä»¶å†™å…¥, æ˜¾è‘—æé«˜äº†ååé‡</p>
<p>For more information about performance of <code>COMMIT</code> and other transactional operations, see <a href="https://dev.mysql.com/doc/refman/8.0/en/optimizing-innodb-transaction-management.html" target="_blank" rel="noopener">Section 8.5.2, â€œOptimizing InnoDB Transaction Managementâ€</a>.</p>
<h4 id="Redo-Log-Archiving"><a href="#Redo-Log-Archiving" class="headerlink" title="Redo Log Archiving"></a>Redo Log Archiving</h4><p>Backup utilities that copy redo log records may sometimes fail to keep pace with redo log generation while a backup operation is in progress, resulting in lost redo log records due to those records being overwritten. This issue most often occurs when there is significant MySQL server activity during the backup operation, and the redo log file storage media operates at a faster speed than the backup storage media. The redo log archiving feature, introduced in MySQL 8.0.17, addresses this issue by sequentially writing redo log records to an archive file in addition to the redo log files. Backup utilities can copy redo log records from the archive file as necessary, thereby avoiding the potential loss of data.</p>
<p>æ‹·è´ redo æ—¥å¿—è®°å½•çš„å¤‡ä»½å·¥å…·å¯èƒ½æœ‰æ—¶ä¼šè·Ÿä¸¢ redo è®°å½•æ—¥å¿—çš„ç”Ÿæˆé€Ÿåº¦, å½“å¤‡ä»½æ“ä½œè¿è¡Œä¸­, å› ä¸ºè¿™äº›è®°å½•è¢«è¦†å†™è€Œå¯¼è‡´ä¸¢å¤± redo æ—¥å¿—è®°å½•</p>
<p>å½“å¤‡ä»½æ“ä½œäº§ç”Ÿå¤§é‡çš„ MySQL æœåŠ¡å™¨æ´»åŠ¨æ—¶è¿™ä¸ªé—®é¢˜ç»å¸¸å‘ç”Ÿ, æ­¤æ—¶ redo æ—¥å¿—æ–‡ä»¶å­˜å‚¨åª’ä»‹æ“ä½œå¤„äºæ¯”å¤‡ä»½å­˜å‚¨åª’ä»‹æ“ä½œæ›´å¿«çš„é€Ÿç‡. åœ¨ MySQL 8.0.17 å¼•è¿›çš„ redo æ—¥å¿—å½’æ¡£åŠŸèƒ½, é€šè¿‡é™¤å†™å…¥ redo æ—¥å¿—å¤–, è¿˜åºåˆ—å†™å…¥ redo æ—¥å¿—è®°å½•åˆ°å½’æ¡£æ–‡ä»¶è§£å†³è¿™ä¸ªé—®é¢˜. å¤‡ä»½å·¥å…·å°½å¯èƒ½ä»å½’æ¡£æ–‡ä»¶ä¸­æ‹·è´ redo æ—¥å¿—è®°å½•, ä»è€Œè§„é¿æ½œåœ¨çš„æ•°æ®ä¸¢å¤±é—®é¢˜</p>
<p>If redo log archiving is configured on the server, <a href="https://dev.mysql.com/doc/mysql-enterprise-backup/8.0/en/" target="_blank" rel="noopener">MySQL Enterprise Backup</a>, available with the <a href="https://www.mysql.com/products/enterprise/" target="_blank" rel="noopener">MySQL Enterprise Edition</a>, uses the redo log archiving feature when backing up a MySQL server. </p>
<p>Enabling redo log archiving on the server requires setting a value for the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_redo_log_archive_dirs" target="_blank" rel="noopener"><code>innodb_redo_log_archive_dirs</code></a> system variable. The value is specified as a semicolon-separated list of labeled redo log archive directories. The <code>*label:directory*</code> pair is separated by a colon (<code>:</code>). For example:</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">mysql&gt; SET GLOBAL innodb_redo_log_archive_dirs='label1:directory_path1[;label2:directory_path2;â€¦]';</span><br></pre></td></tr></table></figure>

<p>The <em>label</em> is an arbitrary identifier for the archive directory. It can be any string of characters, with the exception of colons (:), which are not permitted. An empty label is also permitted, but the colon (:) is still required in this case. A <em>directory_path</em> must be specified. The directory that is selected for the redo log archive file must exist when redo log archiving is activated, or an error is returned. The path can contain colons (â€˜:â€™), but semicolons (;) are not permitted.</p>
<p>The <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_redo_log_archive_dirs" target="_blank" rel="noopener"><code>innodb_redo_log_archive_dirs</code></a> variable must be configured before the redo log archiving can be activated. The default value is <code>NULL</code>, which does not permit activating redo log archiving.</p>
<p>Notes</p>
<p>The archive directories that you specify must satisfy the following requirements. (The requirements are enforced when redo log archiving is activated.):</p>
<ul>
<li><p>Directories must exist. Directories are not created by the redo log archive process. Otherwise, the following error is returned:</p>
<p>ERROR 3844 (HY000): Redo log archive directory â€˜<em>directory_path1</em>â€˜ does not exist or is not a directory</p>
</li>
<li><p>Directories must not be world-accessible. This is to prevent the redo log data from being exposed to unauthorized users on the system. Otherwise, the following error is returned:</p>
<p>ERROR 3846 (HY000): Redo log archive directory â€˜<em>directory_path1</em>â€˜ is accessible to all OS users</p>
</li>
<li><p>Directories cannot be those defined by <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_datadir" target="_blank" rel="noopener"><code>datadir</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_data_home_dir" target="_blank" rel="noopener"><code>innodb_data_home_dir</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_directories" target="_blank" rel="noopener"><code>innodb_directories</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_log_group_home_dir" target="_blank" rel="noopener"><code>innodb_log_group_home_dir</code></a>,<a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_temp_tablespaces_dir" target="_blank" rel="noopener"><code>innodb_temp_tablespaces_dir</code></a>, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_tmpdir" target="_blank" rel="noopener"><code>innodb_tmpdir</code></a> <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_undo_directory" target="_blank" rel="noopener"><code>innodb_undo_directory</code></a>, or <a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_secure_file_priv" target="_blank" rel="noopener"><code>secure_file_priv</code></a>, nor can they be parent directories or subdirectories of those directories. Otherwise, an error similar to the following is returned:</p>
<p>ERROR 3845 (HY000): Redo log archive directory â€˜<em>directory_path1</em>â€˜ is in, under, or over server directory â€˜datadirâ€™ - â€˜<em>/path/to/data_directory</em>â€˜</p>
</li>
</ul>
<p>When a backup utility that supports redo log archiving initiates a backup, the backup utility activates redo log archiving by invoking the <code>innodb_redo_log_archive_start()</code> user-defined function.</p>
<p>If you are not using a backup utility that supports redo log archiving, redo log archiving can also be activated manually, as shown:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT innodb_redo_log_archive_start('label', 'subdir');</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| innodb_redo_log_archive_start('label') |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br><span class="line">| 0                                        |</span><br><span class="line">+<span class="comment">------------------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>Or:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; DO innodb_redo_log_archive_start('label', 'subdir');</span><br><span class="line">Query OK, 0 rows affected (0.09 sec)</span><br></pre></td></tr></table></figure>

<p>Note</p>
<p>The MySQL session that activates redo log archiving (using <code>innodb_redo_log_archive_start()</code>) must remain open for the duration of the archiving. The same session must deactivate redo log archiving (using <code>innodb_redo_log_archive_stop()</code>). If the session is terminated before the redo log archiving is explicitly deactivated, the server deactivates redo log archiving implicitly and removes the redo log archive file.</p>
<p>where <em>label</em> is a label defined by <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_redo_log_archive_dirs" target="_blank" rel="noopener"><code>innodb_redo_log_archive_dirs</code></a>; <code>subdir</code> is an optional argument for specifying a subdirectory of the directory identified by <em>label</em> for saving the archive file; it must be a simple directory name (no slash (/), backslash (), or colon (:) is permitted). <code>subdir</code> can be empty, null, or it can be left out.</p>
<p>Only users with the <a href="https://dev.mysql.com/doc/refman/8.0/en/privileges-provided.html#priv_innodb-redo-log-archive" target="_blank" rel="noopener"><code>INNODB_REDO_LOG_ARCHIVE</code></a> privilege can activate redo log archiving by invoking <code>innodb_redo_log_archive_start()</code>, or deactivate it using<code>innodb_redo_log_archive_stop()</code>. The MySQL user running the backup utility or the MySQL user activating and deactivating redo log archiving manually must have this privilege.</p>
<p>The redo log archive file path is <code>*directory_identified_by_label*/[*subdir*/]archive.*serverUUID*.000001.log</code>, where <code>*directory_identified_by_label*</code> is the archive directory identified by the <code>*label*</code> argument for <code>innodb_redo_log_archive_start()</code>. <code>*subdir*</code> is the optional argument used for <code>innodb_redo_log_archive_start()</code>.</p>
<p>For example, the full path and name for a redo log archive file appears similar to the following:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;directory_path&#x2F;subdirectory&#x2F;archive.e71a47dc-61f8-11e9-a3cb-080027154b4d.000001.log</span><br></pre></td></tr></table></figure>

<p>After the backup utility finishes copying <code>InnoDB</code> data files, it deactivates redo log archiving by calling the <code>innodb_redo_log_archive_stop()</code> user-defined function.</p>
<p>If you are not using a backup utility that supports redo log archiving, redo log archiving can also be deactivated manually, as shown:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT innodb_redo_log_archive_stop();</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| innodb_redo_log_archive_stop() |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br><span class="line">| 0                              |</span><br><span class="line">+<span class="comment">--------------------------------+</span></span><br></pre></td></tr></table></figure>

<p>Or:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; DO innodb_redo_log_archive_stop();</span><br><span class="line">Query OK, 0 rows affected (0.01 sec)</span><br></pre></td></tr></table></figure>

<p>After the stop function completes successfully, the backup utility looks for the relevant section of redo log data from the archive file and copies it into the backup.</p>
<p>After the backup utility finishes copying the redo log data and no longer needs the redo log archive file, it deletes the archive file.</p>
<p>Removal of the archive file is the responsibility of the backup utility in normal situations. However, if the redo log archiving operation quits unexpectedly before<code>innodb_redo_log_archive_stop()</code> is called, the MySQL server removes the file.</p>
<h5 id="Performance-Considerations"><a href="#Performance-Considerations" class="headerlink" title="Performance Considerations"></a>Performance Considerations</h5><p>Activating redo log archiving typically has a minor performance cost due to the additional write activity.</p>
<p>On Unix and Unix-like operating systems, the performance impact is typically minor, assuming there is not a sustained high rate of updates. On Windows, the performance impact is typically a bit higher, assuming the same.</p>
<p>If there is a sustained high rate of updates and the redo log archive file is on the same storage media as the redo log files, the performance impact may be more significant due to compounded write activity.</p>
<p>If there is a sustained high rate of updates and the redo log archive file is on slower storage media than the redo log files, performance is impacted arbitrarily.</p>
<p>Writing to the redo log archive file does not impede normal transactional logging except in the case that the redo log archive file storage media operates at a much slower rate than the redo log file storage media, and there is a large backlog of persisted redo log blocks waiting to be written to the redo log archive file. In this case, the transactional logging rate is reduced to a level that can be managed by the slower storage media where the redo log archive file resides.</p>
]]></content>
  </entry>
  <entry>
    <title>read/implementionThreadInUserAndKernelSpace</title>
    <url>/2020/01/09/read/implementionThreadInUserAndKernelSpace/</url>
    <content><![CDATA[<p>ä¹‹å‰å°±çœ‹è¿‡å…³äºåœ¨å†…æ ¸ä»¥åŠç”¨æˆ·ç©ºé—´å®ç°çº¿ç¨‹çš„æ–‡ç« , åˆ°ç°åœ¨è¿˜å¯¹äºå…¶ä¸­çš„ä¸€äº›ç‚¹ä¸€çŸ¥åŠè§£, æ¯”å¦‚: ä¸ºä»€ä¹ˆå®ç°åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹æ¯”å®ç°åœ¨å†…æ ¸ç©ºé—´çš„å¿«?. ä»Šå¤©ç¢°å·§çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« , åŸæ–‡å‡ºè‡ª &lt;modern operating system, fourth edition&gt;</p>
<h2 id="threads-implementation-in-kernel-and-user-space"><a href="#threads-implementation-in-kernel-and-user-space" class="headerlink" title="threads implementation in kernel and user space"></a>threads implementation in kernel and user space</h2><h3 id="2-2-4-Implementing-Threads-in-User-Space"><a href="#2-2-4-Implementing-Threads-in-User-Space" class="headerlink" title="2.2.4 Implementing Threads in User Space"></a>2.2.4 Implementing Threads in User Space</h3><p>There are two main places to implement threads: user space and the kernel.<br>The choice is a bit controversial, and a hybrid implementation is also possible. We<br>will now describe these methods, along with their advantages and disadvantages.</p>
<p>æœ‰ä¸¤ç§ä¸»è¦çš„åœ°æ–¹ç”¨äºå®ç°çº¿ç¨‹: ç”¨æˆ·ç©ºé—´ä»¥åŠå†…æ ¸ç©ºé—´. å¦‚ä½•åœ¨å“ªé‡Œå®ç°å…·æœ‰ä¸€å®šäº‰è®®æ€§, åŒæ—¶, ä¸€ç§æ··åˆçš„å®ç°ä¹Ÿæ˜¯å¯èƒ½çš„. æˆ‘ä»¬å°†ä¼šæ¦‚è¿°è¿™äº›æ–¹æ³•, ä»¥åŠä»–ä»¬çš„ä¼˜ç‚¹å’Œç¼ºç‚¹.</p>
<p>The first method is to put the threads package entirely in user space. The kernel knows nothing about them. As far as the kernel is concerned, it is managing<br>ordinary, single-threaded processes. The first, and most obvious, advantage is that<br>a user-level threads package can be implemented on an operating system that does<br>not support threads. All operating systems used to fall into this category, and even<br>now some still do. With this approach, threads are implemented by a library.</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°†æ•´ä¸ªçº¿ç¨‹åŒ…æ”¾åˆ°ç”¨æˆ·ç©ºé—´. å†…æ ¸å¯¹æ­¤æ¯«æ— æ‰€çŸ¥. å°±å†…æ ¸è€Œè¨€, å®ƒä¾æ—§åƒå¯¹å¾…å•çº¿ç¨‹å¯¹è±¡ä¸€æ ·.</p>
<p>é¦–å…ˆ, æœ€æ˜æ˜¾çš„ä¼˜ç‚¹æ˜¯, ç”¨æˆ·çº§åˆ«çš„çº¿ç¨‹å¯ä»¥å®ç°åœ¨ä¸€ä¸ªä¸æ”¯æŒå¤šçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸Š.æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿæ›¾ç»éƒ½æ˜¯è¿™ç§ç±»å‹, ç›´åˆ°ç°åœ¨è¿˜æœ‰éƒ¨åˆ†ä¿ç•™, åœ¨è¿™ç§æ–¹å¼ä¸‹, çº¿ç¨‹é€šè¿‡ä¸€ä¸ªåº“å®ç°.</p>
<p>All of these implementations have the same general structure, illustrated in<br>Fig. 2-16(a). The threads run on top of a run-time system, which is a collection of<br>procedures that manage threads. We have seen four of these already: pthread create, pthread exit, pthread join, and pthread yield, but usually there are more.</p>
<p>æ‰€æœ‰çš„å®ç°æœ‰åŒæ ·é€šç”¨çš„ç»“æ„, å¦‚å›¾2-16(a). çº¿ç¨‹è¿è¡Œäºè¿è¡Œæ—¶ç³»ç»Ÿä¸Š(ä¸€ç³»åˆ—ç®¡ç†çº¿ç¨‹çš„ç¨‹åº). æˆ‘ä»¬å·²ç»è§è¿‡å››ç§è¿™æ ·çš„ç¨‹åºäº†: çº¿ç¨‹åˆ›å»º, é€€å‡º, åŠ å…¥, æ”¾å¼ƒ(è¿™æ˜¯æœ¬ä¹¦å‰é¢éƒ¨åˆ†çš„å†…å®¹, ä½†ä¸ºä»€ä¹ˆæ˜¯ pthread å‘¢? éš¾é“æ˜¯åŸºäº posix æ ‡å‡†çš„çº¿ç¨‹å®ç°?)</p>
<p><img src="https://imgur.com/ljUry5a.png" alt=""></p>
<p>When threads are managed in user space, each process needs its own private<br>thread table to keep track of the threads in that process. This table is analogous to<br>the kernelâ€™s process table, except that it keeps track only of the per-thread proper-<br>ties, such as each threadâ€™s program counter, stack pointer, registers, state, and so<br>forth. The thread table is managed by the run-time system. When a thread is<br>moved to ready state or blocked state, the information needed to restart it is stored<br>in the thread table, exactly the same way as the kernel stores information about<br>processes in the process table.</p>
<p>å½“çº¿ç¨‹ç®¡ç†äºç”¨æˆ·ç©ºé—´æ—¶, æ¯ä¸ªè¿›ç¨‹éœ€è¦æ‹¥æœ‰ç‹¬æœ‰çš„çº¿ç¨‹è¡¨, ä»¥ç”¨äºæŒç»­è·Ÿè¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹. è¿™ä¸ªè¡¨ç±»ä¼¼ä¸å†…æ ¸çš„è¿›ç¨‹è¡¨, ä¸è¿‡å®ƒåªè·Ÿè¸ªæ¯ä¸ªçº¿ç¨‹çš„å±æ€§. æ¯”å¦‚æ¯ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨, æ ˆæŒ‡é’ˆ, å¯„å­˜å™¨, çŠ¶æ€, ä»¥åŠâ€¦ </p>
<p>çº¿ç¨‹è¡¨ç”±è¿è¡Œæ—¶ç³»ç»Ÿç®¡ç†, å½“çº¿ç¨‹è½¬å˜ä¸ºå°±ç»ª/é˜»å¡çŠ¶æ€æ—¶, ç”¨äºé‡å¯çš„ä¿¡æ¯å°±å­˜å‚¨åœ¨çº¿ç¨‹è¡¨ä¸­, å°±å’Œå†…æ ¸åœ¨è¿›ç¨‹è¡¨ä¸­å­˜å‚¨å…³äºè¿›ç¨‹çš„ä¿¡æ¯ä¸€æ ·.</p>
<p>When a thread does something that may cause it to become blocked locally, for<br>example, waiting for another thread in its process to complete some work, it calls a<br>run-time system procedure. This procedure checks to see if the thread must be put<br>into blocked state. If so, it stores the threadâ€™s registers (i.e., its own) in the thread<br>table, looks in the table for a ready thread to run, and reloads the machine registers<br>with the new threadâ€™s saved values. As soon as the stack pointer and program<br>counter have been switched, the new thread comes to life again automatically.</p>
<p>å¦‚æœçº¿ç¨‹åšäº†æŸäº›æ“ä½œå¯¼è‡´å®ƒæœ¬åœ°é˜»å¡æ—¶, æ¯”å¦‚: ç­‰å¾…è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å®ŒæˆæŸäº›å·¥ä½œ. å®ƒè°ƒç”¨ä¸€ä¸ªè¿è¡Œæ—¶ä½œä¸šè°ƒåº¦. </p>
<p>è¿™ä¸ªç¨‹åºæ£€æŸ¥çº¿ç¨‹æ˜¯å¦å¿…é¡»ç½®äºé˜»å¡æ€, å¦‚æœæ˜¯, å®ƒåœ¨çº¿ç¨‹è¡¨ä¸­å­˜å‚¨çº¿ç¨‹çš„å¯„å­˜å™¨(å®ƒè‡ªå·±çš„). åœ¨è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå°±ç»ªæ€çº¿ç¨‹è¿è¡Œ, é‡æ–°åŠ è½½æ–°çº¿ç¨‹çš„å¯„å­˜å™¨. åŒæ—¶æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨ä¹Ÿä¼šåˆ‡æ¢, æ–°çº¿ç¨‹å†æ¬¡è‡ªåŠ¨è¿è¡Œ.</p>
<p> If the machine happens to have an instruction to store all the registers and another<br>one to load them all, the entire thread switch can be done in just a handful of in-<br>structions. Doing thread switching like this is at least an order of magnitudeâ€”<br>maybe moreâ€”faster than trapping to the kernel and is a strong argument in favor<br>of user-level threads packages.</p>
<p>å¦‚æœæœºå™¨å¼€å§‹æœ‰ä¸€ä¸ªæŒ‡ä»¤å¯ä»¥å­˜å‚¨æ‰€æœ‰çš„å¯„å­˜å™¨, åŒæ—¶å¦ä¸€ä¸ªæŒ‡ä»¤åŠ è½½ä»–ä»¬, é‚£ä¹ˆæ•´ä¸ªçº¿ç¨‹çš„åˆ‡æ¢å°±åªéœ€è¦å°‘é‡çš„æŒ‡ä»¤.</p>
<p>è¦å®Œæˆè¿™æ ·çš„çº¿ç¨‹åˆ‡æ¢æ¯”æ•è·å†…æ ¸è‡³å°‘å¿«ä¸€ä¸ªæ•°é‡çº§, æˆ–è®¸æ›´å¿«. è¿™æ˜¯ä¸€ä¸ªå¯¹ç”¨æˆ·çº§çº¿ç¨‹æ‹¥æŠ¤è€…å¼ºæœ‰åŠ›çš„è®ºç‚¹.</p>
<p>However, there is one key difference with processes. When a thread is finished<br>running for the moment, for example, when it calls thread yield, the code of<br>thread yield can save the threadâ€™s information in the thread table itself. Fur-<br>thermore, it can then call the thread scheduler to pick another thread to run. The<br>procedure that saves the threadâ€™s state and the scheduler are just local procedures,<br>so invoking them is much more efficient than making a kernel call. Among other<br>issues, no trap is needed, no context switch is needed, the memory cache need not<br>be flushed, and so on. This makes thread scheduling very fast.</p>
<p>ç„¶è€Œ, æœ‰ä¸€ä¸ªå…³äºè¿›ç¨‹çš„å…³é”®ä¸åŒ. å½“çº¿ç¨‹æš‚åœæ—¶, æ¯”å¦‚: è°ƒç”¨ yield, ä¿å­˜çº¿ç¨‹çš„ä¿¡æ¯åˆ°çº¿ç¨‹è¡¨ä¸­.</p>
<p>æ›´è¿›æ­¥ä¸€, è°ƒç”¨çº¿ç¨‹è°ƒåº¦, é€‰æ‹©å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ. ç¨‹åºä¿å­˜çº¿ç¨‹çŠ¶æ€, å› ä¸ºè°ƒåº¦åªæ˜¯æœ¬åœ°ç¨‹åº, æ‰€ä»¥è°ƒç”¨å…¶ä¼šæ¯”å†…æ ¸è°ƒç”¨æ›´åŠ é«˜æ•ˆ. å…¶ä»–æ–¹é¢, æ²¡æœ‰æ•è·, æ²¡æœ‰ç¯å¢ƒåˆ‡æ¢, å†…å­˜ç¼“å†²ä¹Ÿä¸éœ€è¦åˆ·æ–°, ç­‰ç­‰. è¿™ä½¿å¾—çº¿ç¨‹è°ƒåº¦éå¸¸å¿«.</p>
<p>User-level threads also have other advantages. They allow each process to have<br>its own customized scheduling algorithm. For some applications, for example,<br>those with a garbage-collector thread, not having to worry about a thread being<br>stopped at an inconvenient moment is a plus. They also scale better, since kernel<br>threads invariably require some table space and stack space in the kernel, which<br>can be a problem if there are a very large number of threads.</p>
<p>ç”¨æˆ·çº§çº¿ç¨‹è¿˜æœ‰å…¶ä»–ä¼˜ç‚¹. å®ƒä½¿æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ç‰¹å®šè°ƒåº¦ç®—æ³•. å¯¹äºä¸€äº›åº”ç”¨, æ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹, ä¸ç”¨æ‹…å¿ƒçº¿ç¨‹åœ¨ä¸é€‚å½“æ—¶å€™åœä¸‹æ¥, è¿™æ˜¯ä¸€ä¸ªä¼˜ç‚¹. ä»–ä»¬æ‹¥æœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§, å› ä¸ºå†…æ ¸çº¿ç¨‹æ€»æ˜¯éœ€è¦ä¸€äº›è¡¨ç©ºé—´å’Œæ ˆç©ºé—´, å½“çº¿ç¨‹é€æ¸å¢åŠ æ—¶, ä¼šé€ æˆéº»çƒ¦.</p>
<p>Despite their better performance, user-level threads packages have some major<br>problems. First among these is the problem of how blocking system calls are im-<br>plemented. Suppose that a thread reads from the keyboard before any keys hav e<br>been hit. Letting the thread actually make the system call is unacceptable, since<br>this will stop all the threads. One of the main goals of having threads in the first<br>place was to allow each one to use blocking calls, but to prevent one blocked<br>thread from affecting the others. With blocking system calls, it is hard to see how<br>this goal can be achieved readily.</p>
<p>å³ä½¿å®ƒä»¬æ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½, ç”¨æˆ·çº§çº¿ç¨‹åŒ…ä¹Ÿæœ‰ä¸€äº›å›ºæœ‰çš„é—®é¢˜. </p>
<p>é¦–å…ˆ, å¦‚ä½•å®ç°é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨. å‡å¦‚çº¿ç¨‹ç­‰å¾…æ¥è‡ªé”®ç›˜çš„è¾“å…¥, è®©è¿™ä¸ªçº¿ç¨‹å‡†ç¡®æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸å…è®¸çš„, å› ä¸ºè¿™ä¼šé˜»å¡æ‰€æœ‰çº¿ç¨‹, çº¿ç¨‹çš„é¦–è¦ç›®çš„ä¹‹ä¸€æ˜¯å…è®¸æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨é˜»å¡è°ƒç”¨, ä½†æ˜¯ä¿è¯ä¸€ä¸ªé˜»å¡çº¿ç¨‹ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹. å¯ä»¥çœ‹å‡ºè¿™å¾ˆéš¾å®ç°.</p>
<p>The system calls could all be changed to be nonblocking (e.g., a read on the<br>keyboard would just return 0 bytes if no characters were already buffered), but re-<br>quiring changes to the operating system is unattractive. Besides, one argument for<br>user-level threads was precisely that they could run with existing operating sys-<br>tems. In addition, changing the semantics of read will require changes to many<br>user programs.</p>
<p>ç³»ç»Ÿè°ƒç”¨å¿…é¡»éƒ½å˜ä¸ºéé˜»å¡çš„(æ¯”å¦‚, è¯»å–é”®ç›˜è¾“å…¥åº”è¯¥åœ¨æ²¡æœ‰ä»»ä½•å­—ç¬¦è¢«ç¼“å­˜æ—¶è¿”å›0), ä½†æ˜¯è¿™å¯¹äºæ“ä½œç³»ç»Ÿè€Œå·²ä¸å¤ªå‹å¥½. æ¬¡å¤–(æˆ‘çœŸä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘è¿™å¥â€¦). å¦å¤–, æ”¹å˜è¯»å–çš„è¯­ä¹‰å°†ä¼šå½±å“åˆ°å¤§é‡ç”¨æˆ·ç¨‹åº.</p>
<p>Another alternative is available in the event that it is possible to tell in advance<br>if a call will block. In most versions of UNIX, a system call, select , exists, which<br>allows the caller to tell whether a prospective read will block. When this call is<br>present, the library procedure read can be replaced with a new one that first does a<br>select call and then does the read call only if it is safe (i.e., will not block). If the<br>read call will block, the call is not made. Instead, another thread is run. The next<br>time the run-time system gets control, it can check again to see if the read is now<br>safe. This approach requires rewriting parts of the system call library, and is inef-<br>ficient and inelegant, but there is little choice. The code placed around the system<br>call to do the checking is called a jacket or wrapper.</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•: æå‰å‘ŠçŸ¥ä¸€ä¸ªè°ƒç”¨å°†ä¼šè¢«é˜»å¡æ˜¯å¯è¡Œçš„(??? å•¥æ„æ€å•Š = =).</p>
<p>åœ¨å¤šä¸ª UNIX ç‰ˆæœ¬ä¸­, é€‰æ‹©æ€§åœ°å­˜åœ¨ç³»ç»Ÿè°ƒç”¨è¿è¡Œè°ƒç”¨è€…åˆ¤æ–­æœªæ¥çš„è¯»æ“ä½œå°†ä¼šé˜»å¡. å½“è¿™æ ·çš„è°ƒç”¨å­˜åœ¨æ—¶, åº“ç¨‹åºè¯»å–æ›¿æ¢æˆä¸€ä¸ªé¦–å…ˆåšåˆ¤æ–­, ç„¶åå½“ç¡®å®šæ˜¯å®‰å…¨çš„æ—¶å€™è¯»å–(æ¯”å¦‚, éé˜»å¡).ä¸ä¼šæ‰§è¡Œä¼šé˜»å¡çš„è¯»æ“ä½œ, å¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè¿è¡Œ. </p>
<p>åœ¨ä¸‹æ¬¡è¿è¡Œæ—¶ç³»ç»Ÿè·å¾—æ§åˆ¶æ—¶, ä¼šå†æ¬¡æ£€æŸ¥è¯»æ“ä½œæ˜¯å¦æ˜¯å®‰å…¨çš„. è¿™ä¸ªæ–¹æ³•éœ€è¦é‡å†™éƒ¨åˆ†ç³»ç»Ÿè°ƒç”¨åº“. ä¸é‚£ä¹ˆé«˜æ•ˆå’Œä¼˜é›…. ä¸è¿‡è¿™æ˜¯ä¸€ä¸ªé€‰æ‹©, æ”¾ç½®åœ¨ç³»ç»Ÿå‡½æ•°å‘¨å›´çš„ä»£ç å»æ£€æŸ¥çš„è¿™ç§æ–¹æ³•è¢«ç§°ä¸º jacket æˆ– wrapper.</p>
<p>Somewhat analogous to the problem of blocking system calls is the problem of<br>page faults. We will study these in Chap. 3. For the moment, suffice it to say that<br>computers can be set up in such a way that not all of the program is in main memo-<br>ry at once. If the program calls or jumps to an instruction that is not in memory, a<br>page fault occurs and the operating system will go and get the missing instruction<br>(and its neighbors) from disk. This is called a page fault. The process is blocked<br>while the necessary instruction is being located and read in. If a thread causes a<br>page fault, the kernel, unaware of even the existence of threads, naturally blocks<br>the entire process until the disk I/O is complete, even though other threads might<br>be runnable.01</p>
<p>(ç®€å•æ¥è¯´, è¿™æ®µè¯´çš„æ˜¯é¡µé”™è¯¯, ä¸»å­˜å’Œç£ç›˜é—´è™šæ‹Ÿç©ºé—´å†…å®¹çš„äº¤æ¢.)</p>
<p>Another problem with user-level thread packages is that if a thread starts run-<br>ning, no other thread in that process will ever run unless the first thread voluntarily<br>gives up the CPU. Within a single process, there are no clock interrupts, making it<br>impossible to schedule processes round-robin fashion (taking turns). Unless a<br>thread enters the run-time system of its own free will, the scheduler will never get a<br>chance.</p>
<p>ç”¨æˆ·çº§çº¿ç¨‹å°†é¢ä¸´çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯: å½“çº¿ç¨‹å¼€å§‹æ‰§è¡Œæ—¶, é™¤éè‡ªæ„¿æ”¾å¼ƒ, ä¸ç„¶å…¶ä»–çº¿ç¨‹æ— æ³•æ‰§è¡Œ. </p>
<p>å•çº¿ç¨‹ç¨‹åº, ä¸ä¼šäº§ç”Ÿæ—¶é’Ÿç»ˆç«¯, ä½¿ç”¨ round-robin è°ƒåº¦å™¨ç®¡ç†è¿›ç¨‹æ˜¯ä¸å¯èƒ½çš„. é™¤éçº¿ç¨‹è‡ªæ„¿è¿›å…¥è¿è¡Œæ—¶ç³»ç»Ÿ. å¦åˆ™è°ƒåº¦å™¨å°†ä¸ä¼šç”Ÿæ•ˆ.</p>
<p>One possible solution to the problem of threads running forever is to have the<br>run-time system request a clock signal (interrupt) once a second to give it control,<br>but this, too, is crude and messy to program. Periodic clock interrupts at a higher<br>frequency are not always possible, and even if they are, the total overhead may be<br>substantial. Furthermore, a thread might also need a clock interrupt, interfering<br>with the run-time systemâ€™s use of the clock.</p>
<p>ä¸€ä¸ªå¯èƒ½çš„æ–¹æ³•æ˜¯: è®©è¿è¡Œæ—¶ç³»ç»Ÿæ¯ç§’è¯·æ±‚ä¸€ä¸ªæ—¶é’Ÿä¿¡å·æ¥æ§åˆ¶å®ƒ(æ€»è€Œè¨€ä¹‹è¿™æ˜¯ä¸€ä¸ªé¦Šä¸»æ„).</p>
<p>Another, and really the most devastating, argument against user-level threads is<br>that programmers generally want threads precisely in applications where the<br>threads block often, as, for example, in a multithreaded Web server. These threads<br>are constantly making system calls. Once a trap has occurred to the kernel to carry<br>out the system call, it is hardly any more work for the kernel to switch threads if<br>the old one has blocked, and having the kernel do this eliminates the need for con-<br>stantly making select system calls that check to see if read system calls are safe.<br>For applications that are essentially entirely CPU bound and rarely block, what is<br>the point of having threads at all? No one would seriously propose computing the<br>first n prime numbers or playing chess using threads because there is nothing to be<br>gained by doing it that way.</p>
<p>å¦ä¸€ä¸ªåå¯¹ç”¨æˆ·çº§çº¿ç¨‹çš„è®ºè¯(ä¹Ÿæ˜¯æœ€å…·ç ´åæ€§çš„)æ˜¯, ç¨‹åºå‘˜é€šå¸¸å¸Œæœ›çº¿ç¨‹åœ¨çº¿ç¨‹ç»å¸¸é˜»å¡çš„åº”ç”¨ä¸­ä½¿ç”¨, æ¯”å¦‚, åœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ web æœåŠ¡å™¨ä¸­. çº¿ç¨‹ä¸é—´æ–­åœ°ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨, ä¸€æ—¦å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨, å¦‚æœæ—§çº¿ç¨‹å·²è¢«é˜»å¡, é‚£ä¹ˆåˆ‡æ¢çº¿ç¨‹å°±å‡ ä¹æ²¡æœ‰å…¶ä»–éœ€è¦åšçš„äº†. â€¦(åé¢æˆ‘ç¿»ä¸ä¸‹å»äº†, å¤§æ¦‚æ„æ€æ˜¯, è¿™æ ·çš„è¯, ç¨‹åºå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨å¤šçº¿ç¨‹äº†)</p>
<p>(æ€»ç»“å½’çº³ä¸€ä¸‹: å¤§æ¦‚æ„æ€æ˜¯, ç”¨æˆ·çº§çº¿ç¨‹æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åœ¨äºå…¶åˆ‡æ¢èµ·æ¥å¾ˆå¿«, ä½†æ˜¯æˆ‘ä»¬é€šå¸¸å¸Œæœ›åœ¨é¢‘ç¹å‘ç”Ÿçº¿ç¨‹é˜»å¡çš„åº”ç”¨ä¸­ä½¿ç”¨çº¿ç¨‹, è€Œåœ¨è¿™ç§æƒ…å†µä¸‹, çº¿ç¨‹åˆ‡æ¢æ‰€éœ€çš„æ“ä½œå°±ä¼šå˜å°‘(å¦‚æœæ—§çº¿ç¨‹å·²ç»è¢«é˜»å¡äº†çš„è¯), é‚£ä¹ˆ ç”¨æˆ·çº§çº¿ç¨‹å­˜åœ¨çš„æ„ä¹‰å°±ä¸å¤§äº†)</p>
<h3 id="2-2-5-Implementing-Threads-in-the-Kernel"><a href="#2-2-5-Implementing-Threads-in-the-Kernel" class="headerlink" title="2.2.5 Implementing Threads in the Kernel"></a>2.2.5 Implementing Threads in the Kernel</h3><p>Now let us consider having the kernel know about and manage the threads. No<br>run-time system is needed in each, as shown in Fig. 2-16(b). Also, there is no<br>thread table in each process. Instead, the kernel has a thread table that keeps track<br>of all the threads in the system. When a thread wants to create a new thread or<br>destroy an existing thread, it makes a kernel call, which then does the creation or<br>destruction by updating the kernel thread table.</p>
<p>ç°åœ¨, è®©æˆ‘ä»¬è€ƒè™‘è®©å†…æ ¸çŸ¥é“å¦‚ä½•ç®¡ç†çº¿ç¨‹. å¦‚å›¾ 2-16(b) æ‰€ç¤º, åœ¨è¿›ç¨‹ä¸­æ²¡æœ‰è¿è¡Œæ—¶ç³»ç»Ÿ, ä¹Ÿæ²¡æœ‰çº¿ç¨‹è¡¨. å†…æ ¸æœ‰å¼ çº¿ç¨‹è¡¨, ç”¨äºè·Ÿè¸ªç³»ç»Ÿä¸­çš„æ‰€æœ‰çº¿ç¨‹. å½“çº¿ç¨‹æƒ³è¦åˆ›å»ºæˆ–åˆ é™¤ä¸€ä¸ªçº¿ç¨‹æ—¶, ä½¿ç”¨ä¸€ä¸ªå†…æ ¸è°ƒç”¨, ç„¶åé€šè¿‡æ›´æ–°å†…æ ¸çº¿ç¨‹è¡¨æ¥åˆ›å»ºæˆ–åˆ é™¤.</p>
<p>The kernelâ€™s thread table holds each threadâ€™s registers, state, and other infor-<br>mation. The information is the same as with user-level threads, but now kept in the<br>kernel instead of in user space (inside the run-time system). This information is a<br>subset of the information that traditional kernels maintain about their single-<br>threaded processes, that is, the process state. In addition, the kernel also maintains<br>the traditional process table to keep track of processes.</p>
<p>å†…æ ¸çš„çº¿ç¨‹è¡¨ä¿å­˜æ¯ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨, çŠ¶æ€, ä»¥åŠå…¶ä»–ä¿¡æ¯. ä¸ç”¨æˆ·çº§çº¿ç¨‹ä¿å­˜çš„ä¿¡æ¯ä¸€è‡´, åªæ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­. </p>
<p>è¿™äº›ä¿¡æ¯æ˜¯ä¼ ç»Ÿå†…æ ¸ç®¡ç†çš„å•çº¿ç¨‹è¿›ç¨‹ä¿¡æ¯çš„å­é›†. å†…æ ¸ä¹ŸåŒæ ·ç®¡ç†ä¼ ç»Ÿçš„è¿›ç¨‹è¡¨, ä»¥ç”¨äºè·Ÿè¸ªè¿›ç¨‹.</p>
<p>All calls that might block a thread are implemented as system calls, at consid-<br>erably greater cost than a call to a run-time system procedure. When a thread<br>blocks, the kernel, at its option, can run either another thread from the same proc-<br>ess (if one is ready) or a thread from a different process. With user-level threads,<br>the run-time system keeps running threads from its own process until the kernel<br>takes the CPU away from it (or there are no ready threads left to run).</p>
<p>æ‰€æœ‰å¯èƒ½é˜»å¡çº¿ç¨‹çš„è°ƒç”¨éƒ½è¢«å®ç°ä¸ºç³»ç»Ÿè°ƒç”¨, ç›¸å¯¹è¿è¡Œæ—¶ç³»ç»Ÿçš„è°ƒç”¨, æ˜æ˜¾æœ‰å¾ˆå¤§çš„é¢å¤–æ¶ˆè€—. å½“çº¿ç¨‹é˜»å¡æ—¶, å†…æ ¸å¯ä»¥é€‰æ‹©åŒè¿›ç¨‹ä¸‹çš„çº¿ç¨‹è¿è¡Œ, ä¹Ÿå¯ä»¥è¿è¡Œå¦ä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹. ä½†ç”¨æˆ·çº§çº¿ç¨‹åªä¼šè¿è¡Œæœ¬è¿›ç¨‹çš„çº¿ç¨‹, ç›´åˆ°å†…æ ¸ä¸è®©å…¶ä½¿ç”¨ CPU èµ„æº.</p>
<p>Due to the relatively greater cost of creating and destroying threads in the ker-<br>nel, some systems take an environmentally correct approach and recycle their<br>threads. When a thread is destroyed, it is marked as not runnable, but its kernel<br>data structures are not otherwise affected. Later, when a new thread must be creat-<br>ed, an old thread is reactivated, saving some overhead. Thread recycling is also<br>possible for user-level threads, but since the thread-management overhead is much<br>smaller, there is less incentive to do this.</p>
<p>å› ä¸ºåœ¨å†…æ ¸ä¸­åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ“ä½œç›¸å¯¹æ›´è´¹åŠ›, ä¸€äº›ç³»ç»Ÿä½¿ç”¨ä¸ç¯å¢ƒç›¸å…³çš„æ–¹æ³•, é‡åˆ©ç”¨å®ƒä»¬çš„çº¿ç¨‹. </p>
<p>å½“çº¿ç¨‹é”€æ¯æ—¶, å°†å…¶æ ‡è®°ä¸ºä¸å¯è¿è¡Œ, ä½†æ˜¯å…¶å†…æ ¸æ•°æ®ç»“æ„ä¸å—å½±å“, éšå, å½“æ–°çº¿ç¨‹éœ€è¦åˆ›å»ºæ—¶, é‡æ–°åˆ©ç”¨è¿™äº›èµ„æº.  ç”¨æˆ·çº§çº¿ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•, ä¸è¿‡å› ä¸ºçº¿ç¨‹ç®¡ç†çš„æ¶ˆè€—è¾ƒå°, å¹¶ä¸æ˜¯å¾ˆæœ‰å¿…è¦è¿™ä¹ˆåš</p>
<p>Kernel threads do not require any new, nonblocking system calls. In addition,<br>if one thread in a process causes a page fault, the kernel can easily check to see if<br>the process has any other runnable threads, and if so, run one of them while wait-<br>ing for the required page to be brought in from the disk. Their main disadvantage is<br>that the cost of a system call is substantial, so if thread operations (creation, termi-<br>nation, etc.) a common, much more overhead will be incurred.</p>
<p>å†…æ ¸çº¿ç¨‹ä¸éœ€è¦ä»»ä½•æ–°çš„, éé˜»å¡ç³»ç»Ÿè°ƒç”¨. å¦å¤–, å¦‚æœçº¿ç¨‹å¯¼è‡´äº†é¡µé”™è¯¯, å†…æ ¸å¯ä»¥è½»æ¾åœ°æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹å¯è¿è¡Œ, å¦‚æœæœ‰, åœ¨ç­‰å¾…æ‰€éœ€çš„é¡µåŠ è½½å…¥å†…å­˜ä¸­æ—¶, æ‰§è¡Œè¯¥çº¿ç¨‹. å®ƒä»¬æ½œåœ¨çš„é—®é¢˜æ˜¯: ç³»ç»Ÿè°ƒç”¨æ¯”è¾ƒè€—æ—¶, æ‰€ä»¥å¦‚æœçº¿ç¨‹æ“ä½œæ¯”è¾ƒå¸¸è§, åˆ™ä¼šæœ‰æ›´å¤šçš„è´Ÿè½½.</p>
<p>While kernel threads solve some problems, they do not solve all problems. For<br>example, what happens when a multithreaded process forks? Does the new proc-<br>ess have as many threads as the old one did, or does it have just one? In many<br>cases, the best choice depends on what the process is planning to do next. If it is<br>going to call exec to start a new program, probably one thread is the correct choice,<br>but if it continues to execute, reproducing all the threads is probably best.</p>
<p>å†…æ ¸çº¿ç¨‹ä¾æ—§æœ‰ä¸€äº›æœªèƒ½è§£å†³çš„é—®é¢˜, æ¯”å¦‚, å½“å¤šçº¿ç¨‹è¿›ç¨‹æ‰§è¡Œ fork çš„æ—¶å€™, ä¼šå‘ç”Ÿä»€ä¹ˆ? æ–°çš„è¿›ç¨‹æ˜¯å¦ä¼šåƒæ—§è¿›ç¨‹ä¸€æ ·æ‹¥æœ‰åŒæ ·å¤šçš„çº¿ç¨‹å‘¢? è¿˜æ˜¯åªæ‹¥æœ‰ä¸€ä¸ªå‘¢? åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, å–å†³äºè¿›ç¨‹å°†è¦åšä»€ä¹ˆ, å¦‚æœå®ƒå°†ä¼šè°ƒç”¨ exec æ‰§è¡Œä¸€ä¸ªæ–°çš„ç¨‹åº, å½“ç„¶åªæœ‰ä¸€ä¸ªå¥½, ä½†æ˜¯å¦‚æœæ˜¯ç»§ç»­è¿è¡Œçš„è¯, åˆ™ä¿ç•™æ‰€æœ‰çš„çº¿ç¨‹åˆ™æ˜¯æœ€å¥½çš„.</p>
<p>(PS: åœ¨ linux posix çº¿ç¨‹ä¸‹, é»˜è®¤æ˜¯åŒæ ·å¤šçš„çº¿ç¨‹)</p>
<p>Another issue is signals. Remember that signals are sent to processes, not to<br>threads, at least in the classical model. When a signal comes in, which thread<br>should handle it? Possibly threads could register their interest in certain signals, so<br>when a signal came in it would be given to the thread that said it wants it. But what<br>happens if two or more threads register for the same signal? These are only two of<br>the problems threads introduce, and there are more.</p>
<p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¿¡å·. ä¿¡å·æ˜¯å‘ç»™è¿›ç¨‹çš„, è€Œå¹¶éçº¿ç¨‹(è‡³å°‘åœ¨ç»å…¸æ¨¡å‹ä¸‹). å½“ä¿¡å·åˆ°è¾¾æ—¶, é‚£ä¸ªçº¿ç¨‹æ¥å¤„ç†å®ƒå‘¢? å¯èƒ½çº¿ç¨‹ä¼šæ³¨å†Œè‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡å·, æ‰€ä»¥, å½“ä¿¡å·åˆ°è¾¾, ä¼šäº¤ç”±é‚£ä¸ªæ³¨å†Œçº¿ç¨‹å¤„ç†. ä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹æ³¨å†Œäº†åŒæ ·çš„ä¿¡å·å‘¢? è¿™ä»…ä»…æ˜¯çº¿ç¨‹å¼•å…¥çš„å…¶ä¸­ä¸¤ä¸ªé—®é¢˜.</p>
<h3 id="2-2-6-Hybrid-Implementations"><a href="#2-2-6-Hybrid-Implementations" class="headerlink" title="2.2.6 Hybrid Implementations"></a>2.2.6 Hybrid Implementations</h3><p>Various ways have been investigated to try to combine the advantages of user-<br>level threads with kernel-level threads. One way is use kernel-level threads and<br>then multiplex user-level threads onto some or all of them, as shown in Fig. 2-17.<br>When this approach is used, the programmer can determine how many kernel<br>threads to use and how many user-level threads to multiplex on each one. This<br>model gives the ultimate in flexibility.</p>
<p>å·²ç»æœ‰å¤šç§æ–¹æ³•è¢«ç ”ç©¶å‡ºæ¥, ç”¨äºèåˆç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹. å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å†…æ ¸çº§åˆ«çº¿ç¨‹, ç„¶åæ¯ä¸ªå†…æ ¸çº¿ç¨‹ä½¿ç”¨å¤šä¸ªç”¨æˆ·çº§åˆ«çº¿ç¨‹. å¦‚ 2-17. </p>
<p>ç¨‹åºèƒ½å¤ŸçŸ¥æ™“å¤šå°‘å†…æ ¸çº¿ç¨‹, å¤šå°‘ç”¨æˆ·çº¿ç¨‹è¢«ä½¿ç”¨. è¿™ç§æ¨¡å‹ç»™äºˆäº†å¾ˆå¤§çš„çµæ´»æ€§.</p>
<p><img src="https://imgur.com/Bcc4Uzh.png" alt=""></p>
<p>With this approach, the kernel is aware of only the kernel-level threads and<br>schedules those. Some of those threads may have multiple user-level threads multi-<br>plexed on top of them. These user-level threads are created, destroyed, and sched-<br>uled just like user-level threads in a process that runs on an operating system with-<br>out multithreading capability. In this model, each kernel-level thread has some set<br>of user-level threads that take turns using it.</p>
<p>åœ¨è¿™ç§æ–¹æ³•ä¸‹, å†…æ ¸åªè‡³å°‘å†…æ ¸çº¿ç¨‹, å¹¶è°ƒåº¦å®ƒä»¬. å…¶ä¸­ä¸€äº›å†…æ ¸çº¿ç¨‹ä¸Šå¯èƒ½å­˜åœ¨å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹. è¿™äº›ç”¨æˆ·çº¿ç¨‹å°†ä¼šåœ¨è¿›ç¨‹ä¸­ç®¡æ§. </p>
<p>å†…æ ¸çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹å„æœ‰å…¶ä¼˜åŠ¿, ç”¨æˆ·çº¿ç¨‹æ•ˆç‡æ›´é«˜, ä½†æ˜¯æ“ä½œç³»ç»Ÿä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹, ä¼šäº§ç”Ÿè®¸å¤šé€»è¾‘ä¸Šæ˜¯å¤šçº¿ç¨‹, ä½†ç‰©ç†ä¸Šä¾æ—§æ˜¯å•çº¿ç¨‹æ‰ä¼šäº§ç”Ÿçš„é”™è¯¯. æ¯”å¦‚ ä¿¡å·, ä¸­æ–­. è€Œå†…æ ¸çº¿ç¨‹è™½ç„¶ç›¸å¯¹æ•ˆç‡ä½, å¹¶ä¸”å ç”¨å†…æ ¸ç©ºé—´, ä½†æ˜¯æ“ä½œç³»ç»ŸçŸ¥æ™“æ˜¯å¤šçº¿ç¨‹, ä¸æ“ä½œç³»ç»Ÿé—´æœ‰æ›´å¤šåä½œçš„ç©ºé—´.</p>
]]></content>
  </entry>
  <entry>
    <title>read/fsync</title>
    <url>/2020/01/09/read/fsync/</url>
    <content><![CDATA[<p>çœ‹ MySQL å®˜æ–¹æ–‡æ¡£, æœ‰å…³ InnoDB æ•°æ®ç®¡ç†çš„æ—¶å€™, çœ‹åˆ°æœ‰æåˆ° fsync </p>
<p>ä»”ç»†æŸ¥äº†ä¸€ä¸‹, æ‰å‘ç°è‡ªå·±å¥½åƒå¯¹è¿™ä¸œè¥¿, ä¹ƒè‡³æ–‡ä»¶ç³»ç»Ÿéƒ½ä¸€æ— æ‰€çŸ¥â€¦  </p>
<p>åŸåœ°å€ : <a href="http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/" target="_blank" rel="noopener">http://blog.httrack.com/blog/2013/11/15/everything-you-always-wanted-to-know-about-fsync/</a></p>
<h1 id="Everything-You-Always-Wanted-to-Know-About-Fsync"><a href="#Everything-You-Always-Wanted-to-Know-About-Fsync" class="headerlink" title="Everything You Always Wanted to Know About Fsync()"></a>Everything You Always Wanted to Know About Fsync()</h1><p>NOV 15TH, 2013</p>
<p>And then the developer wondered:</p>
<blockquote>
<p>is my file properly syncâ€™ed on disk ?</p>
</blockquote>
<p>You probably know <em>more or less</em> how databases (or things that look like one) store their data on disk in a <em>permanent</em> and <em>safe</em> way. Or at least, you know the basic principles. Or not ?</p>
<p>ä½ å¯èƒ½æˆ–å¤šæˆ–å°‘çŸ¥é“æ•°æ®åº“å¦‚ä½•ä»¥æŒä¹…å¹¶å®‰å…¨çš„æ–¹å¼å°†æ•°æ®å­˜å‚¨åˆ°ç£ç›˜</p>
<p>æœ€å°‘, ä½ çŸ¥é“åŸºç¡€çš„åŸåˆ™, æˆ–è€…ä¸çŸ¥é“?</p>
<h3 id="Being-on-AC-I-D"><a href="#Being-on-AC-I-D" class="headerlink" title="Being on AC(I)D"></a>Being on <strong>AC</strong>(I)<strong>D</strong></h3><p>There are a bunch of concepts that first must be understood: what is <strong>atomicity</strong>, <strong>consistency</strong>, and <strong>durability</strong> ? These concepts apply on databases (see <a href="http://en.wikipedia.org/wiki/ACID" target="_blank" rel="noopener">ACID</a>), but also on the underlying filesystem.</p>
<p>è¿™é‡Œæœ‰ä¸€ç³»åˆ—å¿…é¡»ç†è§£çš„åŸåˆ™: ä»€ä¹ˆæ˜¯ åŸå­æ€§, ä¸€è‡´æ€§, æŒä¹…æ€§? </p>
<p>è¿™äº›åŸåˆ™ä¸ä»…ç”¨äºæ•°æ®åº“, åŒæ—¶ä¹Ÿç”¨äºåº•å±‚æ–‡ä»¶ç³»ç»Ÿ</p>
<ul>
<li><p><strong>Atomicity</strong>: a write operation is fully executed at once, and is not <em>interleaved</em> with another one (if, for example, someone else is writing to the same location)</p>
<p>åŸå­æ€§ : å†™æ“ä½œä¸€æ¬¡å½»åº•å®Œæˆ, ä¸ä¼šå’Œå¦å¤–ä¸€ä¸ªå†™æ“ä½œäº¤é”™(å…¶ä»–å†™æ“ä½œåœ¨åŒæ—¶æ›´æ”¹åŒæ ·çš„åŒºåŸŸ)</p>
<p>Atomicity is typically guaranteed in operations involving filename handling ; for example, for <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/rename.html" target="_blank" rel="noopener">rename</a>, â€œ<em>specification requires that the action of the function be atomic</em>â€ â€“ that is, when renaming a file from the old name to the new one, at no circumstances should you ever see the two files at the same time.</p>
<p>æ¶‰åŠåˆ°æ–‡ä»¶åç®¡ç†çš„æ“ä½œé€šå¸¸æ˜¯ä¿å­˜å…¶åŸå­æ€§çš„, æ¯”å¦‚, é‡å‘½å, è§„åˆ™æè¿°éœ€è¦è¿™ä¸ªå‡½æ•°å¿…é¡»æ˜¯åŸå­çš„. </p>
<p>ä¹Ÿå°±æ˜¯è¯´, å½“é‡å‘½åæ–‡ä»¶æ—¶, ä¸åº”è¯¥åŒæ—¶å­˜åœ¨ä¸¤ä¸ªç›¸åŒæ–‡ä»¶åçš„æ–‡ä»¶</p>
</li>
<li><p><strong>Consistency</strong>: integrity of data must be maintained when executing an operation, even in a crash event â€“ for example, a power outage in the middle of a <code>rename()</code> operation shall not leave the filesystem in a â€œweirdâ€ state, with the filename being unreachable because its metadata has been corrupted. (ie. either the operation is lost, or the operation is committed.)</p>
<p>ä¸€è‡´æ€§ : å½“æ‰§è¡Œæ“ä½œæ—¶, æ•°æ®çš„ä¸€è‡´æ€§å¿…é¡»è¢«ç»´æŠ¤, å³ä½¿æ˜¯åœ¨å´©æºƒäº‹ä»¶ä¸­, æ¯”å¦‚ : æ–­ç”µä¸ä¼šä½¿æ–‡ä»¶ç³»ç»Ÿå¤„äºå› å…¶å…ƒæ•°æ®æŸå, æ–‡ä»¶åä¸å¯è¢«æ£€ç´¢åˆ°çš„å¥‡æ€ªçŠ¶æ€(å³, æ“ä½œè¦ä¹ˆä¸¢å¤±, è¦ä¹ˆè¢«æäº¤)</p>
<p>(PS. meta ? ä»€ä¹ˆæ˜¯ meta ? æ ¹æ® wiki çš„è§£é‡Š : </p>
<p>â€‹    <strong>Meta</strong> (from the <a href="https://en.wikipedia.org/wiki/Greek_language" target="_blank" rel="noopener">Greek</a> <em>meta-</em> Î¼ÎµÏ„Î¬- meaning â€œafterâ€ or â€œbeyondâ€) is a prefix used in <a href="https://en.wikipedia.org/wiki/English_language" target="_blank" rel="noopener">English</a> to indicate a concept that is an <a href="https://en.wikipedia.org/wiki/Abstraction" target="_blank" rel="noopener">abstraction</a> behind another concept, used to complete or add to the latter.</p>
<p>â€‹    å…ƒæ˜¯ä¸€ä¸ªæ¦‚å¿µèƒŒåçš„æŠ½è±¡æ¦‚å¿µ, ç”¨æ¥å®Œæ•´å‰è€… </p>
<p>ä»¥åŠæœ‰ about è¯­ä¹‰, ä¸¤è€…ç›¸åŒ, å‰è€…å…³è”åè€…, metaprogramming(writing programs manipulate programs) )</p>
<p>Consistency is guaranteed on the filesystem level ; but you also need to have the same guarantee if you build a database on disk, for example by serializing/locking certain operations on a working area, and committing the transaction by changing some kind of generation number.</p>
<p>ä¸€è‡´æ€§åœ¨æ–‡ä»¶ç³»ç»Ÿå±‚é¢ä¸Šç¡®ä¿, ä½†å½“åœ¨ç£ç›˜ä¸Šæ„å»ºæ•°æ®åº“æ—¶, ä¹Ÿéœ€è¦å…¶ç¡®ä¿ä¸€è‡´æ€§, æ¯”å¦‚é€šè¿‡åºåˆ—åŒ–/é”å®šæŸäº›åœ¨å·¥ä½œåŒºåŸŸä¸Šçš„æ“ä½œ, é€šè¿‡æ›´æ”¹ä¸€äº›ç”Ÿæˆçš„æ•°å­—æäº¤äº‹åŠ¡</p>
</li>
<li><p><strong>Durability</strong>: the write operation is durable, that is, unplugging the power cord (or a kernel panic, a crashâ€¦) shall not lose any data (hitting the hard disk with a hammer is however not covered!)</p>
<p>â€‹    å†™æ“ä½œæ˜¯è€ä¹…çš„, ä¹Ÿå°±æ˜¯è¯´, æ‹”æ‰ç”µæºçº¿(æˆ–è€…å†…æ ¸é”™è¯¯, å´©æºƒ)å°†ä¸ä¼šä¸¢å¤±ä»»ä½•æ•°æ®(ç”¨é”¤å­ç ¸ç¡¬ç›˜å½“ç„¶ä¸åŒ…å«åœ¨å…¶ä¸­!)( PS.æŒºå–œæ¬¢æœ‰å¹½é»˜æ„Ÿçš„ä½œè€… :) )</p>
<p>This is an important one â€“ at a given point, you must ensure that the data is actually written on disk <em>physically</em>, preventing any loss of data in case of a sudden power outage, for example. This is absolutely critical when dealing with a client/server architecture: the client may have its connection or transaction aborted at any time without troubles (ie. the transaction will be retried later), but once the server acknowledges it, no event should ever cause it to be lost (think of responsibility in a commercial transaction, or a digital signature, for example). For this reason, having the data committed in the internal system or hard disk cache is NOT durable for obvious reasons (unless there is a guarantee that no such power outage could happen â€“ if a battery is used on a RAID array, for example).</p>
<p>åœ¨æŸç§è§‚ç‚¹æ¥çœ‹, è¿™æ˜¯å¾ˆé‡è¦çš„ä¸€ç‚¹. ä½ å¿…é¡»ç¡®ä¿æ•°æ®æ­£ç¡®åœ°ç‰©ç†æ€§åœ°å†™å…¥äº†ç£ç›˜, é˜²æ­¢æ–­ç”µè€Œå¼•å‘çš„æ•°æ®ä¸¢å¤±</p>
<p>åº”ç”¨ä¸CSæ¨¡å‹æ—¶, ç›¸å½“å…³é”®: å®¢æˆ·ç«¯ä¼šåœ¨ä»»æ„æ—¶åˆ»æ— å›°éš¾æ–­å¼€è¿æ¥/äº‹åŠ¡(æ¢å¥è¯è¯´, äº‹åŠ¡ä¼šåœ¨ä¹‹åé‡è¯•). ä½†æ˜¯ä¸€æ—¦æœåŠ¡å™¨ç¡®è®¤å, å°±åº”è¯¥æ²¡æœ‰ä»»ä½•äº‹ä»¶å¯¼è‡´å®ƒè¢«ä¸¢å¤±(è€ƒè™‘ä¼ä¸šäº‹åŠ¡æˆ–æ•°å­—ç­¾åä¸­çš„è´£ä»»)</p>
<p>å› ä¸ºè¿™ä¸ªç†ç”±, åœ¨å†…éƒ¨ç³»ç»Ÿæˆ–ç¡¬ç›˜ç¼“å­˜ä¸­æäº¤æ•°æ®æ˜¯ä¸æ˜¯å¯ä¸€è‡´çš„(é™¤éä¿è¯æ²¡æœ‰ç±»ä¼¼æ–­ç”µçš„è¡Œä¸ºä¼šå‘ç”Ÿ - æ¯”å¦‚, RDID ç£ç›˜é˜µåˆ—ç”¨äº†è“„ç”µæ± )</p>
<p>On POSIX systems, durability is achieved through sync operations (<a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/fsync.html" target="_blank" rel="noopener"><code>fsync()</code></a>, <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/fdatasync.html" target="_blank" rel="noopener"><code>fdatasync()</code></a>, <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/aio_fsync.html" target="_blank" rel="noopener"><code>aio_fsync()</code></a>): â€œ<em>The fsync() function is intended to force a physical write of data from the buffer cache, and to assure that after a system crash or other failure that all data up to the time of the fsync() call is recorded on the disk.</em>â€. [Note: The difference between fsync() and fdatasync() is that the later does not necessarily update the meta-data associated with a file â€“ such as the â€œlast modifiedâ€ date â€“ but only the file data.]</p>
<p>åœ¨ POSIX ç³»ç»Ÿ, æŒä¹…æ€§é€šè¿‡ sync æ“ä½œ(fsync, fdatasync, aio_fsync) è·å¾— (PS. fsync å’Œ fdatasync çš„åŒºåˆ«åœ¨äº, åè€…ä¸å†²åˆ· metadata) fsync å‡½æ•°æ•…æ„å¼ºåˆ¶ç‰©ç†æ€§çš„ç¼“å†²çš„æ•°æ®å†™å…¥, ä¿è¯åœ¨ç³»ç»Ÿå´©æºƒæˆ–å…¶ä»–é”™è¯¯ä¹‹å, æ‰€æœ‰ fsync è°ƒç”¨æ—¶çš„æ•°æ®éƒ½è¢«è®°å½•åœ¨ç£ç›˜ä¸­</p>
</li>
</ul>
<p>Now that these concepts are a bit clearer, letâ€™s go back to our filesystem!</p>
<h3 id="Hey-What-is-a-File-By-The-Way"><a href="#Hey-What-is-a-File-By-The-Way" class="headerlink" title="Hey, What is a File, By The Way ?"></a>Hey, What is a File, By The Way ?</h3><p>If we want to simplify the concept, letâ€™s consider the filesystem on POSIX platforms as a very simple <em>flat</em> storage manager, allowing to read/write data blobs and basic properties (such as the modified time) indexed by an <em>integer</em> number (hint: they sometimes call that the <em>inode number</em>).</p>
<p>å¦‚æœæƒ³è¦ç®€åŒ–è¿™ä¸ªæ¦‚å¿µ, è®©æˆ‘ä»¬è€ƒè™‘åœ¨ POSIX å¹³å°ä¸Š, æ–‡ä»¶ç³»ç»Ÿä½œä¸ºä¸€ä¸ªéå¸¸ç®€å•çš„æ‰å¹³å­˜å‚¨ç®¡ç†å™¨, å…è®¸è¯»/å†™äºŒè¿›åˆ¶æ•°æ®å’Œå…¶åŸºç¡€å±æ€§(æ¯”å¦‚æ›´æ”¹æ—¶é—´) è¢«ä¸€ä¸ªæ•´å‹æ•°å­—ç´¢å¼• (æœ‰æ—¶è¢«ç§°ä½œ inode æ•°å­—)</p>
<p>For example, you may want to read the file #4242â€™s data. And later, write some data on file #1234.</p>
<p>To have a more convenient way to handle files (because â€œI need to send you the presentation number 155324â€ would not be really convenient in the real world), we use the <strong>filename/directory</strong> concepts. A file has a name, and it is <em>contained</em> within a <em>directory structure</em>. You may put files and directories in a directory, building a hierarchical structure. But everything rely on our previous basic data blobs to store both filename and the associated index.</p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿åœ°æ“ä½œæ–‡ä»¶(å› ä¸º â€œæˆ‘éœ€è¦å‘é€ä½ æè¿°ç¼–å·ä¸º155324â€ åœ¨çœŸå®ä¸–ç•Œä¸­å¾ˆä¸æ–¹ä¾¿) æˆ‘ä»¬ä½¿ç”¨ æ–‡ä»¶å/ç›®å½• æ¦‚å¿µ. </p>
<p>æ–‡ä»¶æœ‰ä¸€ä¸ªåå­—, è¢«åŒ…å«ä¸€ä¸ªç›®å½•ç»“æ„ä¸­, ä½ å¯ä»¥å°†æ–‡ä»¶å’Œç›®å½•æ”¾åˆ°å¦å¤–ä¸€ä¸ªç›®å½•ä¸‹,  æ„å»ºä¸€ä¸ªå±‚æ¬¡çš„ç»“æ„</p>
<p>ä½†æ˜¯, æ‰€æœ‰éƒ½ä¾èµ–äºä¹‹å‰çš„åŸºç¡€æ•°æ®é›†åˆå­˜å‚¨æ–‡ä»¶åå’Œç›¸å…³è”çš„ç´¢å¼•</p>
<p>As an example, reading the file <code>foo/bar.txt</code> (ie. the file <code>bar.txt</code> within the <code>foo</code> directory) will require to access the data blob associated with the directory <code>foo</code>. After parsing this opaque data blob, the system will fetch the entry for <code>bar.txt</code>, and open the associated data blob. (And yes, there is obviously a root entry, storing references to first-level entries, allowing to access any file top-down)</p>
<p>If I now want to create a new file named <code>foo/baz.txt</code>, it will require the system to access the data blob associated with the directory <code>foo</code>, add an entry named <code>baz.txt</code> with a new allocated index for the upcoming file, and write the updated directory blob back, and from this point, write to the newly allocated blob. The operation therefore involves <strong>two</strong> data structures: the <strong>directory entry</strong>, and the <strong>file</strong> itself.</p>
<h3 id="Keeping-My-File-name-Safe"><a href="#Keeping-My-File-name-Safe" class="headerlink" title="Keeping My File(name) Safe"></a>Keeping My File(name) Safe</h3><p>Letâ€™s go back to our database problem: what is the impact of having <em>two</em> data structures for our files ?</p>
<p><strong>Atomicity</strong> and <strong>consistency</strong> of filenames are handled for us by the filesystem, so this is not really a bother.</p>
<p>What about <strong>durability</strong> ?</p>
<p>è®©æˆ‘ä»¬å›åˆ°æ•°æ®åº“çš„é—®é¢˜(PS. æˆ‘è§‰å¾—, å¥½åƒè¶Šè¯´è¶Šå¤šäº† = =) : å¦‚æœæˆ‘ä»¬çš„æ–‡ä»¶æœ‰ä¸¤ä¸ªæ•°æ®ç»“æ„çš„è¯, ä¼šæ€æ ·? </p>
<p>æ–‡ä»¶ååŸå­æ€§å’Œä¸€è‡´æ€§ç”±æˆ‘ä»¬é€šè¿‡æ–‡ä»¶ç³»ç»Ÿæ§åˆ¶, è¿™ä¸ä¼šé€ æˆä»€ä¹ˆéº»çƒ¦, ä½†æ˜¯æŒä¹…æ€§å‘¢?</p>
<p>We know that <code>fsync()</code> provides guarantees related to data and meta-data syncâ€™ing. But if you look closer to the specification, the only data involved are the one related to the file itself â€“ not its directory entry. The â€œmetadataâ€ concept involves modified time, access time etc. â€“ <strong>not</strong> the <em>directory entry</em> itself.</p>
<p>æˆ‘ä»¬çŸ¥é“ fsync æä¾›ç›¸å…³æ–‡ä»¶å’Œå…ƒæ•°æ®çš„åŒæ­¥ä¿è¯</p>
<p>ä½†æ˜¯æ·±å…¥äº†è§£è§„æ ¼, å”¯ä¸€æ¶‰åŠçš„æ•°æ®æ˜¯å’Œæ–‡ä»¶æœ¬èº«ç›¸å…³çš„æ•°æ®, ä¸æ˜¯å®ƒçš„ç›®å½•å…¥å£</p>
<p>å…ƒæ•°æ®æ¦‚å¿µåŒ…å«æ›´æ”¹æ—¶é—´, è®¿é—®æ—¶é—´ç­‰ç­‰, ä½†ä¸åŒ…å«ç›®å½•å…¥å£</p>
<p>It would be cumbersome for a filesystem to provide this guarantee, by the way: on POSIX systems, you can have an arbitrary number of directory links to a filename (or to another directory entry). The most common case is <em>one</em>, of course. But you may delete a file being used (the file entry will be removed by the system when the file is closed) â€“ the very reason why erasing a log file which is flooding a filesystem is a futile and deadly action â€“ in such case, the number of links will be <em>zero</em>. And you may also create as many <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/link.html" target="_blank" rel="noopener">hard-links</a> as you want for a given file/directory entry.</p>
<p>Therefore, in theory, you may create a file, write some data, synchronize it, close the file, and see your <a href="http://upload.wikimedia.org/wikipedia/en/e/e0/Gollum.PNG" target="_blank" rel="noopener">precious</a> file lost forever because of a power outage. Oh, the filesystem must guarantee consistency, of course, but not durability unless <em>explicitly</em> asked by the client â€“ which means that a filesystem check <em>may</em> find your directory entry partially written, and decide to achieve consistency by taking the previous directory blob entry, <strong>wiping</strong> the unreferenced file entry (note: if you are â€œluckyâ€ enough, the file will be expelled in <code>lost+found</code>)</p>
<p>The filesystem can, of course, decide to be gentle, and commit all filename operations when fsyncâ€™ing. It may also, such as for ext3, commit <a href="https://ext4.wiki.kernel.org/index.php/Ext3_Data%3DOrdered_vs_Data%3DWriteback_mode" target="_blank" rel="noopener"><strong>everything</strong></a> when fsyncâ€™ing a file â€“ causing the <a href="http://lwn.net/Articles/328363/" target="_blank" rel="noopener">infamous</a> and <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=421482" target="_blank" rel="noopener">horrendous</a> lags in firefox or thunderbird.</p>
<p>But if you need to have <strong>guarantees</strong>, and not just <em>hope</em> the filesystem â€œ<em>will be gentle<em>â€, and do not want to â€œ</em>trust the filesystem*â€ (yes, someone actually told me that: you *need</em> to â€œtrust the filesystemâ€ â€“ I swear it), you have to actually make sure that your <strong>filename</strong> entry is properly syncâ€™ed on disk following the POSIX specification.</p>
<p>Oh, and by the way: according to <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/fsync.html" target="_blank" rel="noopener">POSIX</a>, <em>The fsync() function is intended to force a physical write of data from the buffer cache, and to assure that after a system crash or other failure that all data up to the time of the fsync() call is recorded on the disk</em>.</p>
<p><em>But</em> things are sometimes a bit obscure on the implementation side :</p>
<ul>
<li><p><a href="http://unixhelp.ed.ac.uk/CGI/man-cgi?fsync" target="_blank" rel="noopener"><strong>Linux/ext3</strong></a>: <em>If the underlying hard disk has write caching enabled, then the data may not really be on permanent storage when fsync() / fdatasync() return.</em> (doâ€™h!)</p>
<p>å¦‚æœåº•å±‚ç£ç›˜å…è®¸å†™å…¥ç¼“å­˜, å½“ fsync/fdatasync æ—¶æ•°æ®å¯èƒ½ä¸ä¼šçœŸæ­£çš„æ°¸ä¹…æ€§å­˜å‚¨</p>
</li>
<li><p><a href="http://linux.die.net/man/2/fsync" target="_blank" rel="noopener"><strong>Linux/ext4</strong></a>: <em>The fsync() implementations in older kernels and lesser used filesystems does not know how to flush disk caches.</em> (doâ€™h!) â€“ issue adressed quite <a href="http://lwn.net/Articles/270891/" target="_blank" rel="noopener">recently</a></p>
</li>
<li><p><a href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man2/fsync.2.html" target="_blank" rel="noopener"><strong>OSX</strong></a>: <em>For applications that require tighter guarantees about the integrity of their data, Mac OS X provides the F_FULLFSYNC fcntl. The F_FULLFSYNC fcntl asks the drive to flush all buffered data to permanent storage</em> (hey, fsync was supposed to do that, no ? guys ?) <em>(Edit: no, fsync is actually not required to do that â€“ thanks for the clarification Florent!)</em></p>
</li>
</ul>
<p>But we may assume that on Linux with <a href="http://monolight.cc/2011/06/barriers-caches-filesystems/" target="_blank" rel="noopener">ext4</a> (and OSX with proper flags ?) the system is properly propagating <a href="http://docs.fedoraproject.org/en-US/Fedora/14/html/Storage_Administration_Guide/writebarr.html" target="_blank" rel="noopener">write barriers</a>.</p>
<p>On Windows, using <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa364439.aspx" target="_blank" rel="noopener"><code>FlushFileBuffers()</code></a> is probably the way to go.</p>
<p>(PS. å¾ˆæƒ­æ„§, æœ‰äº›æˆ‘æ²¡æœ‰è¯»æ‡‚â€¦ ä¸è¿‡æœ‰ä¸€ä»¶äº‹æƒ…æ˜¯æ˜ç™½çš„ : æˆ‘å¥½åƒå¯¹æ–‡ä»¶ç³»ç»ŸçœŸçš„ä¸€æ— æ‰€çŸ¥â€¦ )</p>
<h3 id="Syncing-Filenames"><a href="#Syncing-Filenames" class="headerlink" title="Syncing Filenames"></a>Syncing Filenames</h3><p>I told you that a filesystem was actually a bunch of <em>flat</em> data blobs with associated metadata, and that a file had actually two parts: its directory entry (letâ€™s assume there is only one directory entry for the sake of simplicity), and its actual data. We already know how to sync the later one ; do we have a way to do the same for the directory container itself ?</p>
<p>æˆ‘å·²ç»å‘Šè¯‰ä½ , æ–‡ä»¶ç³»ç»Ÿå®é™…ä¸Šæ˜¯ä¸€å †æ‰å¹³çš„ä¸å…ƒæ•°æ®å…³è”çš„æ•°æ®å—, æ–‡ä»¶å®é™…ä¸Šæœ‰ä¸¤éƒ¨åˆ† : å®ƒçš„ç›®å½•å…¥å£(ä¸ºäº†ç®€å•èµ·è§, å‡è®¾åªæœ‰ä¸€ä¸ªç›®å½•å…¥å£), ä»¥åŠå®ƒçš„å®é™…æ•°æ®, æˆ‘ä»¬å·²ç»çŸ¥é“å¦‚ä½•åŒæ­¥åé¢çš„ä¸€éƒ¨åˆ†, æˆ‘ä»¬æœ‰åŒæ ·çš„åˆšå‘åŒæ­¥ç›®å½•å®¹å™¨è‡ªèº«ä¹ˆ?</p>
<p>On POSIX, you may actually open a directory as if you were opening a file (hint: a directory is <a href="http://pubs.opengroup.org/onlinepubs/9699919799/basedefs/V1_chap03.html" target="_blank" rel="noopener"><em>a file that contains directory entries</em></a>). It means that <code>open()</code> <em>may</em> successfully open a directory entry. But on the other hand, you generally can not open a directory entry for <em>writing</em> (see POSIX <a href="http://pubs.opengroup.org/onlinepubs/009695299/functions/open.html" target="_blank" rel="noopener">remark</a> regarding <code>EISDIR</code>: <em>The named file is a directory and oflag includes O_WRONLY or O_RDWR</em>), and this is perfectly logical: by directly writing to the internal directory entry, you may be able to mess up with the directory structure, ruining the filesystem <strong>consistency</strong>.</p>
<p>åœ¨ POSIX ä¸‹, ä½ å¯èƒ½æ­£å¸¸åœ°åƒæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ä¸€æ ·æ‰“å¼€ç›®å½•(ç›®å½•æ˜¯ä¸€ä¸ªåŒ…å«ç›®å½•å…¥å£çš„æ–‡ä»¶)(PS. MD æˆ‘è¦ç–¯äº†, å®ƒè¯´çš„ directory entries åˆ°åº•æ˜¯ä»€ä¹ˆä¸œè¥¿, ç›´è¯‘ç›®å½•å…¥å£? ä»€ä¹ˆé¬¼ä¸œè¥¿å•Š, inode?é‚£æ€ä¹ˆä¸å« inode/vnode ? æ ¹æ® google å‡ºçš„è§£ç­” <a href="https://unix.stackexchange.com/questions/186992/what-is-directory-entry" target="_blank" rel="noopener">https://unix.stackexchange.com/questions/186992/what-is-directory-entry</a> é‚£æ˜¯ä¸€ä¸ªç›®å½•å’Œæ–‡ä»¶åç›¸å…³çš„ç»“æ„ä½“)  </p>
<p>But can we fsync() written data using a file descriptor opened <em>only</em> for reading ? The question isâ€¦ yes, or at least â€œ<em>yes it should*â€ â€“ even POSIX group had *editorial</em> inconsistencies regarding <a href="http://austingroupbugs.net/view.php?id=501" target="_blank" rel="noopener">fdatasync</a> and <a href="http://austingroupbugs.net/view.php?id=671" target="_blank" rel="noopener">aio_fsync()</a>, leading to incorrect <a href="http://cygwin.com/frysk/bugzilla/show_bug.cgi?id=15361" target="_blank" rel="noopener">behavior</a> on various implementations. And the reason it should execute the operation is because requesting the completion of a write operation does not have to require actual write access â€“ which have already been checked and enforced.</p>
<p>On Windowsâ€¦ err, there is no clear answer. You can not call <code>FlushFileBuffers()</code> on a directory handle as far as I can see.</p>
<p>Oh, a last funny note: how do you sync the <strong>content</strong> of a <em>symbolic link</em> (and its related meta-data), that is, the filename pointed by this link ? The answer isâ€¦ you canâ€™t. Nope. This is not possible with the current standard (hint: you can not <code>open()</code> a symbolic link). Which means that if you handle some kind of database generation update based on symbolic links (ie. changing a â€œlast-versionâ€ symlink to the latest built generation file), you have zero guarantee over durability.</p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>Does it means that we need to call <code>fsync()</code> <em>twice</em>, one on the file data, and one on its parent directory ? When you need to achieve <em>durability</em>, the answer is obviously <strong>yes</strong>. (Remember that file file/filename will be syncâ€™ed on disk anyway by the operating system, so you do not actually need to do that for every single file â€“ only for those you want to have a durability guarantee at a given time)</p>
<p>However, the question is causing some headache on the POSIX standard, and as a follow-up to the <a href="http://comments.gmane.org/gmane.comp.standards.posix.austin.general/6952" target="_blank" rel="noopener">austin-group</a> (ie. POSIX mailing-list) discussion, an <a href="http://austingroupbugs.net/view.php?id=672" target="_blank" rel="noopener">editorial clarification request</a> is still pending and is waiting for feedback from various implementors. (you may also have a look at the <a href="http://unix.derkeiler.com/Newsgroups/comp.unix.programmer/2013-03/msg00016.html" target="_blank" rel="noopener">comp.unix.programmer</a> discussion)</p>
<p><strong>TL;DR</strong>: syncing a file is not as simple as it seems!</p>
]]></content>
  </entry>
  <entry>
    <title>read/CreateInnoDBTables</title>
    <url>/2020/01/09/read/CreateInnoDBTables/</url>
    <content><![CDATA[<ul>
<li><h4 id="15-6-1-1-Creating-InnoDB-Tables"><a href="#15-6-1-1-Creating-InnoDB-Tables" class="headerlink" title="15.6.1.1 Creating InnoDB Tables"></a>15.6.1.1 Creating InnoDB Tables</h4></li>
</ul>
<p>  To create an <code>InnoDB</code> table, use the <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> statement.</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (a <span class="built_in">INT</span>, b <span class="built_in">CHAR</span> (<span class="number">20</span>), PRIMARY <span class="keyword">KEY</span> (a)) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span>;</span><br></pre></td></tr></table></figure>

<p>  You do not need to specify the <code>ENGINE=InnoDB</code> clause if <code>InnoDB</code> is defined as the default storage engine, which it is by default. To check the default storage engine, issue the following statement:</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT @@default_storage_engine;</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br><span class="line">| @@default_storage_engine |</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br><span class="line">| InnoDB                   |</span><br><span class="line">+<span class="comment">--------------------------+</span></span><br></pre></td></tr></table></figure>

<p>  You might still use <code>ENGINE=InnoDB</code> clause if you plan to use <a href="https://dev.mysql.com/doc/refman/8.0/en/mysqldump.html" target="_blank" rel="noopener"><strong>mysqldump</strong></a> or replication to replay the <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> statement on a server where the default storage engine is not <code>InnoDB</code>.</p>
<p>  å¦‚æœä½ è®¡åˆ’ä½¿ç”¨ mysqldump/å¤åˆ¶ å°† CREATE TABLE è¯­å¥å¤ç°åœ¨å¦å¤–ä¸€ä¸ªé»˜è®¤å­˜å‚¨å¼•æ“ä¸æ˜¯ InnoDB çš„æœåŠ¡å™¨ä¸Š, å°±åšæŒä½¿ç”¨ ENGINE=InnoDB å­å¥ (ä¸è¿‡æˆ‘çœ‹ mysqldump å‡ºçš„è¯­å¥ä¸­ä¼šæ˜¾å¼æŒ‡å®šå­˜å‚¨å¼•æ“ç±»å‹)</p>
<p>  An <code>InnoDB</code> table and its indexes can be created in the <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_system_tablespace" target="_blank" rel="noopener">system tablespace</a>, in a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_file_per_table" target="_blank" rel="noopener">file-per-table</a> tablespace, or in a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_general_tablespace" target="_blank" rel="noopener">general tablespace</a>. When <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> is enabled, which is the default, an <code>InnoDB</code> table is implicitly created in an individual file-per-table tablespace. Conversely, when <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> is disabled, an <code>InnoDB</code> table is implicitly created in the <code>InnoDB</code> system tablespace. To create a table in a general tablespace, use <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE ... TABLESPACE</code></a> syntax. For more information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html" target="_blank" rel="noopener">Section 15.6.3.3, â€œGeneral Tablespacesâ€</a>.</p>
<p>  InnoDB è¡¨åŠå®ƒçš„ç´¢å¼•å¯ä»¥åˆ›å»ºåœ¨ system tablespace, file-per-table tablespace  æˆ– general tablespace. å½“ innodb_file_per_table å¯ç”¨, InnoDB è¡¨é»˜è®¤åˆ›å»ºåœ¨å•ç‹¬çš„ file-per-rable è¡¨ç©ºé—´ä¸­, ç›¸å, åˆ™åˆ›å»ºåœ¨ system tablespace ä¸­. </p>
<p>  ä½¿ç”¨ CREATE TABLE â€¦ TABLESPACE è¯­æ³•å¯ä»¥åˆ›å»ºåœ¨ general tablespace ä¸­</p>
<p>  When you create a table in a file-per-table tablespace, MySQL creates an <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_ibd_file" target="_blank" rel="noopener">.ibd</a> tablespace file in a database directory under the MySQL data directory, by default. A table created in the <code>InnoDB</code> system tablespace is created in an existing <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_ibd_file" target="_blank" rel="noopener">ibdata file</a>, which resides in the MySQL data directory. A table created in a general tablespace is created in an existing general tablespace <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_ibd_file" target="_blank" rel="noopener">.ibd file</a>. General tablespace files can be created inside or outside of the MySQL data directory. For more information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html" target="_blank" rel="noopener">Section 15.6.3.3, â€œGeneral Tablespacesâ€</a>.</p>
<p>  å½“ä½ åˆ›å»ºä¸€ä¸ªåœ¨ file-per-table è¡¨ç©ºé—´ä¸­çš„è¡¨æ—¶, MySQL åœ¨ä¸»ç›®å½•ä¸‹çš„å•ä¸ªæ•°æ®åº“ç›®å½•ä¸­åˆ›å»º .idb æ–‡ä»¶  </p>
<p>  åœ¨ InnoDB system è¡¨ç©ºé—´ä¸­åˆ™åˆ›å»ºåœ¨ä¸€ä¸ªåœ¨ MySQL ä¸»ç›®å½•ä¸‹å·²å­˜åœ¨çš„ ibdata æ–‡ä»¶ä¸­(PS. é‚£ä¹ˆ ibdata æ–‡ä»¶æ˜¯ä»€ä¹ˆæ—¶å€™åˆ›å»ºçš„? å¦‚ä½•å¢é•¿?) </p>
<p>  Internally, <code>InnoDB</code> adds an entry for each table to the data dictionary. The entry includes the database name. For example, if table <code>t1</code> is created in the <code>test</code> database, the data dictionary entry for the database name is <code>&#39;test/t1&#39;</code>. This means you can create a table of the same name (<code>t1</code>) in a different database, and the table names do not collide inside <code>InnoDB</code>.</p>
<h5 id="InnoDB-Tables-and-Row-Formats"><a href="#InnoDB-Tables-and-Row-Formats" class="headerlink" title="InnoDB Tables and Row Formats"></a>InnoDB Tables and Row Formats</h5><p>  The default row format for <code>InnoDB</code> tables is defined by the <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_default_row_format" target="_blank" rel="noopener"><code>innodb_default_row_format</code></a> configuration option, which has a default value of <code>DYNAMIC</code>. <code>Dynamic</code> and<code>Compressed</code> row format allow you to take advantage of <code>InnoDB</code> features such as table compression and efficient off-page storage of long column values. To use these row formats, <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-parameters.html#sysvar_innodb_file_per_table" target="_blank" rel="noopener"><code>innodb_file_per_table</code></a> must be enabled (the default).</p>
<p>  InnoDB è¡¨çš„è¡Œæ ¼å¼åŒ–ç”± innodb_default_row_format å®šä¹‰, é»˜è®¤æ˜¯ DYNAMIC </p>
<p>  Dynamic å’Œ Compressed è¡Œæ ¼å¼åŒ–æä¾›äº† InnoDB é«˜çº§ç‰¹æ€§, æ¯”å¦‚ å‹ç¼©è¡¨, é«˜æ•ˆçš„é•¿åˆ—å€¼é¡µå¤–å­˜å‚¨</p>
<p>  ä½¿ç”¨è¿™äº›è¡Œæ ¼å¼åŒ–, å¿…é¡»å¯ç”¨ innodb_file_per_table</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span> innodb_file_per_table=<span class="number">1</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t3 (a <span class="built_in">INT</span>, b <span class="built_in">CHAR</span> (<span class="number">20</span>), PRIMARY <span class="keyword">KEY</span> (a)) ROW_FORMAT=DYNAMIC;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t4 (a <span class="built_in">INT</span>, b <span class="built_in">CHAR</span> (<span class="number">20</span>), PRIMARY <span class="keyword">KEY</span> (a)) ROW_FORMAT=COMPRESSED;</span><br></pre></td></tr></table></figure>

<p>  Alternatively, you can use <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE ... TABLESPACE</code></a> syntax to create an <code>InnoDB</code> table in a general tablespace. General tablespaces support all row formats. For more information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/general-tablespaces.html" target="_blank" rel="noopener">Section 15.6.3.3, â€œGeneral Tablespacesâ€</a>.</p>
<p>  å¦å¤–, ä½ å¯ä»¥ä½¿ç”¨ CREATE TABLE â€¦ TABLESAPCE è¯­æ³•åœ¨ general tablespace åˆ›å»º InnoDB è¡¨. general tablespace æ”¯æŒæ‰€æœ‰çš„è¡Œæ ¼å¼åŒ–</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (c1 <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>) <span class="keyword">TABLESPACE</span> ts1 ROW_FORMAT=DYNAMIC;</span><br></pre></td></tr></table></figure>

<p>  <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE ... TABLESPACE</code></a> syntax can also be used to create <code>InnoDB</code> tables with a <code>Dynamic</code> row format in the system tablespace, alongside tables with a <code>Compact</code> or<code>Redundant</code> row format.</p>
<p>  CREATE TABLE â€¦ TABLESPACE è¯­æ³•ä¹Ÿå¯ä»¥è¢«ç”¨ä½œåœ¨ system tablespace ä¸­åˆ›å»º Dynamic æ ¼å¼åŒ–çš„è¡¨, ä»¥åŠ Compacr æˆ– Redundant æ ¼å¼åŒ–</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (c1 <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>) <span class="keyword">TABLESPACE</span> = innodb_system ROW_FORMAT=DYNAMIC;</span><br></pre></td></tr></table></figure>

<p>  For more information about <code>InnoDB</code> row formats, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html" target="_blank" rel="noopener">Section 15.10, â€œInnoDB Row Formatsâ€</a>. For how to determine the row format of an <code>InnoDB</code> table and the physical characteristics of <code>InnoDB</code> row formats, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-row-format.html" target="_blank" rel="noopener">Section 15.10, â€œInnoDB Row Formatsâ€</a>.</p>
<h5 id="InnoDB-Tables-and-Primary-Keys"><a href="#InnoDB-Tables-and-Primary-Keys" class="headerlink" title="InnoDB Tables and Primary Keys"></a>InnoDB Tables and Primary Keys</h5><p>  Always define a <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_primary_key" target="_blank" rel="noopener">primary key</a> for an <code>InnoDB</code> table, specifying the column or columns that:</p>
<ul>
<li><p>Are referenced by the most important queries.</p>
</li>
<li><p>Are never left blank.</p>
</li>
<li><p>Never have duplicate values.</p>
</li>
<li><p>Rarely if ever change value once inserted.</p>
<p>é€šå¸¸ä¼šä¸º InnoDB è¡¨å®šä¹‰ä¸€ä¸ªä¸»é”®, è¯´æ˜åˆ—å…·æœ‰: è¢«æœ€é‡è¦çš„æŸ¥è¯¢å¼•ç”¨, æ°¸è¿œä¸ä¸ºç©º, æ°¸è¿œä¸é‡å¤, ä¸€æ—¦æ’å…¥, åˆ™å¾ˆå°‘æ”¹åŠ¨</p>
<p>For example, in a table containing information about people, you would not create a primary key on <code>(firstname, lastname)</code> because more than one person can have the same name, some people have blank last names, and sometimes people change their names. With so many constraints, often there is not an obvious set of columns to use as a primary key, so you create a new column with a numeric ID to serve as all or part of the primary key. You can declare an <a href="https://dev.mysql.com/doc/refman/8.0/en/glossary.html#glos_auto_increment" target="_blank" rel="noopener">auto-increment</a> column so that ascending values are filled in automatically as rows are inserted:</p>
<p>æ¯”å¦‚, åœ¨ä¸€ä¸ªåŒ…å«æ°‘ä¼—ä¿¡æ¯çš„è¡¨ä¸­, ä¸èƒ½åˆ›å»ºä»¥ (firstname, lastname) ç»„åˆçš„å€¼ä¸ºä¸»é”®, å› ä¸ºåå­—å¾ˆå¯èƒ½é‡å¤, ä¸€äº›äººæ²¡æœ‰ lastname, ä¸€äº›äººä¼šæ”¹å˜ä»–ä»¬çš„åå­—. </p>
<p>æ¶‰åŠåˆ°è¿™ä¹ˆå¤šçš„é™åˆ¶, è¿›ç¨‹æ²¡æœ‰ä¸€ä¸ªæ˜æ˜¾åˆ—çš„é›†åˆèƒ½ä½œä¸ºä¸»é”®. æ‰€ä»¥å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„æ•°å­—åˆ—ç”¨ä½œæ•´ä¸ªæˆ–éƒ¨åˆ†ä¸»é”®, å£°æ˜ä¸º auto-increament  å¯ä»¥ä½¿è¡Œåœ¨æ’å…¥æ—¶è‡ªå¢</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment"># The value of ID can act like a pointer between related items in different tables.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t5 (<span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT, b <span class="built_in">CHAR</span> (<span class="number">20</span>), PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment"># The primary key can consist of more than one column. Any autoinc column must come first.</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t6 (<span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT, a <span class="built_in">INT</span>, b <span class="built_in">CHAR</span> (<span class="number">20</span>), PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>,a));</span><br></pre></td></tr></table></figure>

<p>Although the table works correctly without defining a primary key, the primary key is involved with many aspects of performance and is a crucial design aspect for any large or frequently used table. It is recommended that you always specify a primary key in the <a href="https://dev.mysql.com/doc/refman/8.0/en/create-table.html" target="_blank" rel="noopener"><code>CREATE TABLE</code></a> statement. If you create the table, load data, and then run <a href="https://dev.mysql.com/doc/refman/8.0/en/alter-table.html" target="_blank" rel="noopener"><code>ALTER TABLE</code></a> to add a primary key later, that operation is much slower than defining the primary key when creating the table.</p>
<p>å°½ç®¡æ²¡æœ‰å®šä¹‰ä¸»é”® è¡¨ä¹Ÿå¯ä»¥æ­£å¸¸è¿è¡Œ, ä½†æ˜¯ä¸»é”®åŒ…å«äº†è®¸å¤šæ€§èƒ½æ–¹é¢å’Œé‡è¦çš„ä¸ºå¤§å®¹é‡æˆ–é¢‘ç¹ä½¿ç”¨è¡¨åšçš„è®¾è®¡, å»ºè®®ä½ æ€»æ˜¯åœ¨è¡¨ä¸­æŒ‡å®šä¸€ä¸ªä¸»é”®. </p>
<p>åœ¨åˆ›å»ºå’ŒåŠ è½½è¡¨ä¹‹åä½¿ç”¨ ALTER TABLE è¯­å¥å¢åŠ ä¸»é”®, é€Ÿåº¦ä¼šè¿œæ…¢äºä¸€å¼€å§‹åˆ›å»ºæ—¶æŒ‡å®šä¸»é”®</p>
</li>
</ul>
<h5 id="Viewing-InnoDB-Table-Properties"><a href="#Viewing-InnoDB-Table-Properties" class="headerlink" title="Viewing InnoDB Table Properties"></a>Viewing InnoDB Table Properties</h5><p>  To view the properties of an <code>InnoDB</code> table, issue a <a href="https://dev.mysql.com/doc/refman/8.0/en/show-table-status.html" target="_blank" rel="noopener"><code>SHOW TABLE STATUS</code></a> statement:</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SHOW TABLE STATUS FROM test LIKE 't%' \G;</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">           Name: t1</span><br><span class="line">         Engine: InnoDB</span><br><span class="line">        Version: 10</span><br><span class="line">     Row_format: Compact</span><br><span class="line">           Rows: 0</span><br><span class="line"> Avg_row_length: 0</span><br><span class="line">    Data_length: 16384</span><br><span class="line">Max_data_length: 0</span><br><span class="line">   Index_length: 0</span><br><span class="line">      Data_free: 0</span><br><span class="line"> Auto_increment: NULL</span><br><span class="line">    Create_time: 2015-03-16 15:13:31</span><br><span class="line">    Update_time: NULL</span><br><span class="line">     Check_time: NULL</span><br><span class="line">      Collation: utf8mb4_0900_ai_ci</span><br><span class="line">       <span class="keyword">Checksum</span>: <span class="literal">NULL</span></span><br><span class="line"> Create_options:</span><br><span class="line">        <span class="keyword">Comment</span>:</span><br></pre></td></tr></table></figure>

<p>  For information about <a href="https://dev.mysql.com/doc/refman/8.0/en/show-table-status.html" target="_blank" rel="noopener"><code>SHOW TABLE STATUS</code></a> output, see <a href="https://dev.mysql.com/doc/refman/8.0/en/show-table-status.html" target="_blank" rel="noopener">Section 13.7.6.36, â€œSHOW TABLE STATUS Syntaxâ€</a>.</p>
<p>  <code>InnoDB</code> table properties may also be queried using the <code>InnoDB</code> Information Schema system tables:</p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM INFORMATION_SCHEMA.INNODB_TABLES WHERE NAME='test/t1' \G</span><br><span class="line">*************************** 1. row ***************************</span><br><span class="line">     TABLE_ID: 45</span><br><span class="line">         NAME: test/t1</span><br><span class="line">         FLAG: 1</span><br><span class="line">       N_COLS: 5</span><br><span class="line">        SPACE: 35</span><br><span class="line">   ROW_FORMAT: Compact</span><br><span class="line">ZIP_PAGE_SIZE: 0</span><br><span class="line">   SPACE_TYPE: Single</span><br></pre></td></tr></table></figure>

<p>  For more information, see <a href="https://dev.mysql.com/doc/refman/8.0/en/innodb-information-schema-system-tables.html" target="_blank" rel="noopener">Section 15.14.3, â€œInnoDB INFORMATION_SCHEMA Schema Object Tablesâ€</a>.</p>
]]></content>
  </entry>
  <entry>
    <title>read/Choosing_the_best_indexes_for_MySQL_query_optimization</title>
    <url>/2020/01/09/read/Choosing_the_best_indexes_for_MySQL_query_optimization/</url>
    <content><![CDATA[<h2 id="åŸæ–‡-https-www-eversql-com-choosing-the-best-indexes-for-mysql-query-optimization"><a href="#åŸæ–‡-https-www-eversql-com-choosing-the-best-indexes-for-mysql-query-optimization" class="headerlink" title="åŸæ–‡ : https://www.eversql.com/choosing-the-best-indexes-for-mysql-query-optimization/"></a>åŸæ–‡ : <a href="https://www.eversql.com/choosing-the-best-indexes-for-mysql-query-optimization/" target="_blank" rel="noopener">https://www.eversql.com/choosing-the-best-indexes-for-mysql-query-optimization/</a></h2><h2 id="Which-indexes-should-I-create-for-an-SQL-query"><a href="#Which-indexes-should-I-create-for-an-SQL-query" class="headerlink" title="Which indexes should I create for an SQL query?"></a>Which indexes should I create for an SQL query?</h2><h2 id="æˆ‘åº”è¯¥ä¸ºSQLæŸ¥è¯¢åˆ›å»ºå“ªäº›ç´¢å¼•"><a href="#æˆ‘åº”è¯¥ä¸ºSQLæŸ¥è¯¢åˆ›å»ºå“ªäº›ç´¢å¼•" class="headerlink" title="æˆ‘åº”è¯¥ä¸ºSQLæŸ¥è¯¢åˆ›å»ºå“ªäº›ç´¢å¼•?"></a>æˆ‘åº”è¯¥ä¸ºSQLæŸ¥è¯¢åˆ›å»ºå“ªäº›ç´¢å¼•?</h2><p>As a general rule of thumb, MySQL can only use one index for each table in the query. Therefore, there is no point in creating more than one index for each query. Preferably, same indexes should match as many of the queries as possible, as it will reduce the load on the database when inserting or updating data (which requires updating the indexes as well).</p>
<p>æŒ‰ç…§ä¸€èˆ¬çš„ç»éªŒæ³•åˆ™, MySQLæŸ¥è¯¢ä¸­çš„æ¯ä¸ªè¡¨åªèƒ½ä½¿ç”¨ä¸€ä¸ªç´¢å¼•</p>
<p>(High Performance MySQL ä¸­æ¾„æ¸…äº†, æœ‰å¯èƒ½ä¼šç»„åˆ, ä½†æœ€å¥½ä¸è¦ä¾èµ–äºå®ƒ)</p>
<p>æ‰€ä»¥, ä¸ºæ¯ä¸ªæŸ¥è¯¢åˆ›å»ºå¤šä¸ªç´¢å¼•æ˜¯æ²¡æœ‰æ„ä¹‰çš„, æ›´æ°å½“çš„æƒ…å†µæ˜¯, åŒæ ·çš„ç´¢å¼•åŒ¹é…å°½å¯èƒ½å¤šçš„æŸ¥è¯¢</p>
<p>å› ä¸ºè¿™å°†ä¼šåœ¨æ’å…¥æˆ–æ›´æ”¹æ•°æ®æ—¶, å‡å°‘æ•°æ®åº“çš„è´Ÿè½½(è¯¥æ“ä½œåŒæ ·ä¹Ÿéœ€è¦æ›´æ–°ç´¢å¼•)</p>
<p>When creating an index, the most important parts are the equality conditions in the WHERE and JOIN conditions. In most cases, conditions such as name = â€˜Johnâ€™ will allow the database to filter most of the rows from the table and go through a small amount of rows to return the required results. Therefore, we should start indexing by adding these columns to the index.</p>
<p>å½“åˆ›å»ºç´¢å¼•æ—¶, æœ€é‡è¦çš„æ˜¯åœ¨ WHERE å’Œ JOIN ä¸­çš„ç­‰å¼æ¡ä»¶ </p>
<p>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, åƒ name = â€˜Johnâ€™ è¿™æ ·çš„æ¡ä»¶ä¼šä½¿æ•°æ®åŒºä»è¡¨ä¸­ç­›é€‰è¡Œ, é€šè¿‡å°‘é‡çš„è¡Œè¿”å›éœ€è¦çš„æ•°æ®</p>
<p>æˆ‘ä»¬åº”è¯¥é€šè¿‡å¢åŠ è¿™äº›åˆ—åˆ°ç´¢å¼•ä¸­æ¥å¼€å§‹ç´¢å¼•</p>
<p>Then, you should look into the range conditions, but you should only add one of them â€“ the most selective one, as MySQL canâ€™t handle more of them. In some cases when there are no range conditions, it makes sense to add the GROUP BY / ORDER BY columns, assuming the ordering is done in only one direction (ASC / DESC).</p>
<p>ç„¶å, ä½ åº”è¯¥å…³æ³¨èŒƒå›´æ¡ä»¶, ä½†æ˜¯ä½ åªèƒ½å¢åŠ å…¶ä¸­ä¸€ä¸ª, å¯é€‰æ€§æœ€å¤§çš„ä¸€ä¸ª, å› ä¸ºMySQLä¸èƒ½å¤„ç†æ›´å¤š</p>
<p>(PS. å…³äº selectivity, High Performance MySQL 5.3 èŠ‚ä¸­ Choosing a Good Column Order ä¸­æœ‰ä»‹ç»)</p>
<p>(ç®€å•æ¥ç†è§£çš„è¯, å°±æ˜¯æœ€å…·å¯é€‰æ€§, æœ€èƒ½åˆ†è¾¨çš„åˆ—)</p>
<p>åœ¨æŸäº›æƒ…å†µä¸‹æ²¡æœ‰èŒƒå›´æ¡ä»¶, å¢åŠ  GROUP BY/ORDER BY åˆ—, å‡è®¾é¡ºåºç”±å…¶ä¸­ä¸€ä¸ªæ–¹å‘ç¡®å®š(ASC/DESC)</p>
<p>In some cases, it also makes sense to create a separate index that contains the ORDER BY clauseâ€™s columns, as MySQL sometimes chooses to use it. Please note though that for this to happen, the index should contain all columns from the ORDER BY clause and they should all be specified with the same order (ASC / DESC). This doesnâ€™t guarantee that the databaseâ€™s optimizer will pick this index rather than the other compound indexes, but itâ€™s worth a try.</p>
<p>æœ‰æ—¶å€™, ä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„ç´¢å¼•åŒ…å« ORDER BY å­å¥çš„åˆ—, å› ä¸º MySQL æœ‰æ—¶ä¼šé€‰æ‹©ä½¿ç”¨å®ƒ</p>
<p>è¯·è®°ä½, ä¸ºäº†å®ç°è¿™ä¸€ç‚¹, ç´¢å¼•åº”è¯¥åŒ…å« ORDER BY å­å¥ä¸­æ‰€æœ‰çš„åˆ—, å¹¶ä¸”è¢«æŒ‡å®šä¸ºç›¸åŒçš„é¡ºåº(ASC/DESC) </p>
<p>è¿™ä¸ä¿è¯æ•°æ®åº“çš„ä¼˜åŒ–æ˜¯å¦ä¼šé€‰æ‹©è¿™ä¸ª, è€Œä¸æ˜¯å…¶ä»–ç»„åˆç´¢å¼•, ä½†æ˜¯å€¼å¾—ä¸€è¯•</p>
<p>Also, in some cases, it makes sense to also add the columns from the SELECT clause to the index, to have a complete covering index. This only relevant if the index isnâ€™t already â€˜too largeâ€™. Whatâ€™s too large? Well, no official rule of thumb here, but letâ€™s sayâ€¦ 5-7 columns? Creating a covering index allows the database to not only filter using the index, but to also fetch the information required by the SELECT clause directly from the index, which saves precious I/O operations.</p>
<p>åŒæ ·çš„, æœ‰æ—¶å¢åŠ  SELECT ä¸­çš„åˆ—, ä»¥æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„è¦†ç›–ç´¢å¼•ä¹Ÿæ˜¯æœ‰å¿…è¦çš„, ä½†åªå½“ç´¢å¼•ä¸é•¿æ—¶, æ‰æœ‰æ„ä¹‰</p>
<p>é‚£ä¹ˆ, å¤šé•¿æ‰æ˜¯é•¿ä¹ˆ? emmâ€¦ æ²¡æœ‰å®˜æ–¹è§„å®šè¿™ä¸ª, ä½†æ˜¯ä¼°è®¡ä¸€ä¸‹â€¦ 5-7åˆ—? </p>
<p>åˆ›å»ºè¦†ç›–ç´¢å¼•ä½¿æ•°æ®åº“ä¸ä»…èƒ½è¿‡æ»¤, åŒæ—¶ä¹Ÿèƒ½ç›´æ¥ä»ç´¢å¼•ä¸­è·å– SELECT å­å¥éœ€è¦çš„ä¿¡æ¯, ä»¥èŠ‚çœå®è´µçš„ I/O æ“ä½œ</p>
<p>Letâ€™s look at an example to clarify: (é€šè¿‡ä¸€ä¸ªä¾‹å­ç†è§£ä¸€ä¸‹)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    <span class="keyword">id</span>, first_name, last_name, age</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    employees</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    first_name = <span class="string">'John'</span></span><br><span class="line">        <span class="keyword">AND</span> last_name = <span class="string">'Brack'</span></span><br><span class="line">        <span class="keyword">AND</span> age &gt; <span class="number">25</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> age <span class="keyword">ASC</span>;</span><br></pre></td></tr></table></figure>
<p>For this query, weâ€™ll start with adding the columns <em>first_name</em> and <em>last_name</em>, which are compared with an equality operator. Then, weâ€™ll add the <em>age</em> column which is compared with a range condition. No need to have the ORDER BY clause indexed here, as the <em>age</em> column is already in the index. Last but not least, weâ€™ll add <em>id</em> from the SELECT clause to the index to have a covering index.</p>
<p>å°±è¿™ä¸ªä¾‹å­, æˆ‘ä»¬åº”è¯¥ä¸€å¼€å§‹å¢åŠ åœ¨ WHERE å­å¥ä¸­æœ‰ç›¸ç­‰æ¯”è¾ƒæ“ä½œçš„åˆ— first_name å’Œ last_name</p>
<p>ç„¶å, å¢åŠ å…·æœ‰æ¯”è¾ƒçš„ age åˆ—. åœ¨è¿™é‡Œä¸éœ€è¦æœ‰ ORDER BY å­å¥, å› ä¸º age åˆ—å·²ç»åœ¨ç´¢å¼•ä¸­äº† </p>
<p>æœ€å, ä½†å¹¶ä¸æ˜¯æœ€ä¸é‡è¦çš„. å¢åŠ åœ¨ SELECT å­å¥ä¸­çš„ id åˆ—, ä»¥è·å¾—ä¸€ä¸ªè¦†ç›–ç´¢å¼•</p>
<p>So to index this query properly, you should add the index: (ä¸ºäº†é€‚å½“åœ°ç´¢å¼•è¿™ä¸ªæŸ¥è¯¢, ä½ åº”è¯¥å¢åŠ è¿™ä¸ªç´¢å¼•)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">employees (first_name, last_name, age, id).</span><br><span class="line">mysql : <span class="keyword">CREATE</span> <span class="keyword">INDEX</span> [INDEX_NAME] <span class="keyword">ON</span> [TABLE_NAME] (first_name, last_name, age, <span class="keyword">id</span>)</span><br></pre></td></tr></table></figure>

<p>The above is a very simplified pseudo-algorithm that will allow you to build simple indexes for rather simple SQL queries.</p>
<p>ä¸Šé¢æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„(= = è¿™ä¸œè¥¿å’‹ç¿»è¯‘æ¥ç€â€¦ è™šæ‹Ÿæ–¹æ³•? æ€»ä¹‹å°±æ˜¯ä¸€ç§æ–¹æ³•)</p>
<p>è®©ä½ ä¸ºç®€å•çš„ SQL æŸ¥è¯¢æ„å»ºç®€å•çš„ç´¢å¼•</p>
<p>(å®é™…æƒ…å†µå¯èƒ½ä¼šå¤æ‚ä¸€äº›, å‚è€ƒ High Performance MySQL ç¬¬ 5 ç« )</p>
<p>If youâ€™re looking for a way to automate your index creation, while also adding the benefit of a proprietary indexing algorithm and query optimization recommendations, you can try out <a href="http://www.eversql.com/?utm_source=blog&utm_campaign=p502" target="_blank" rel="noopener">EverSQL Query Optimizer</a> which does all the heavy lifting for you.</p>
<p>(å¹¿å‘Š = =)</p>
<h2 id="What-not-to-do-when-indexing-or-writing-SQL-queries"><a href="#What-not-to-do-when-indexing-or-writing-SQL-queries" class="headerlink" title="What not to do when indexing (or writing SQL queries)?"></a>What not to do when indexing (or writing SQL queries)?</h2><h2 id="ä½¿ç”¨ç´¢å¼•æ—¶-ä¸è¦åšçš„äº‹æƒ…"><a href="#ä½¿ç”¨ç´¢å¼•æ—¶-ä¸è¦åšçš„äº‹æƒ…" class="headerlink" title="ä½¿ç”¨ç´¢å¼•æ—¶, ä¸è¦åšçš„äº‹æƒ…"></a>ä½¿ç”¨ç´¢å¼•æ—¶, ä¸è¦åšçš„äº‹æƒ…</h2><p>We gathered some of the most common mistakes we see programmers and database administrators do when writing queries and indexing their tables.</p>
<p>æˆ‘ä»¬æ”¶é›†äº†ä¸€äº›å½“ç¨‹åº/DBAå†™æŸ¥è¯¢è¯­å¥å’Œç´¢å¼•ä»–ä»¬çš„è¡¨æ—¶, ä¼šçŠ¯çš„å¸¸è§é”™è¯¯</p>
<h3 id="Indexing-each-and-every-column-in-the-table-separately"><a href="#Indexing-each-and-every-column-in-the-table-separately" class="headerlink" title="Indexing each and every column in the table separately"></a>Indexing each and every column in the table separately</h3><h3 id="ç´¢å¼•æ¯ä¸€ä¸ªè¡¨ä¸­æ¯ä¸€åˆ—"><a href="#ç´¢å¼•æ¯ä¸€ä¸ªè¡¨ä¸­æ¯ä¸€åˆ—" class="headerlink" title="ç´¢å¼•æ¯ä¸€ä¸ªè¡¨ä¸­æ¯ä¸€åˆ—"></a>ç´¢å¼•æ¯ä¸€ä¸ªè¡¨ä¸­æ¯ä¸€åˆ—</h3><p>In most cases, MySQL wonâ€™t be able to use more than one index for each table in the query.</p>
<p>Therefore, when creating a separate index for each column in the table, the database is bound to perform only one of the search operations using an index, and the rest of them will be significantly slower, as the database canâ€™t use an index to execute them.</p>
<p>We recommend using compound indexes (explained later in this article) rather than single-column indexes.</p>
<p>é€šå¸¸, MySQLä¸èƒ½åœ¨æŸ¥è¯¢è¯­å¥ä¸­, ä¸ºåŒä¸€å¼ è¡¨ä½¿ç”¨è¶…è¿‡ä¸€ä¸ªç´¢å¼•</p>
<p>æ‰€ä»¥, å½“ä¸ºè¡¨ä¸­çš„æ¯ä¸ªåˆ—åˆ›å»ºä¸€ä¸ªç´¢å¼•, MySQLè¢«é™åˆ¶åªä½¿ç”¨å…¶ä¸­ä¸€ä¸ªç´¢å¼•, è€Œå…¶ä»–çš„ä¼šæ…¢å¾ˆå¤š</p>
<p>æ‰€ä»¥æ•°æ®åº“ä¸èƒ½ä½¿ç”¨ç´¢å¼•å»æ‰§è¡Œå®ƒä»¬</p>
<p>æˆ‘ä»¬å»ºè®®ä½¿ç”¨å¤åˆç´¢å¼•(å°†ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¹‹åä»‹ç»), è€Œä¸æ˜¯ä½¿ç”¨å•åˆ—ç´¢å¼•</p>
<h2 id="The-OR-operator-in-filtering-conditions"><a href="#The-OR-operator-in-filtering-conditions" class="headerlink" title="The OR operator in filtering conditions"></a>The OR operator in filtering conditions</h2><h3 id="è¿‡æ»¤ä¸­çš„-OR-æ“ä½œ"><a href="#è¿‡æ»¤ä¸­çš„-OR-æ“ä½œ" class="headerlink" title="è¿‡æ»¤ä¸­çš„ OR æ“ä½œ"></a>è¿‡æ»¤ä¸­çš„ OR æ“ä½œ</h3><p>Consider this query: (è€ƒè™‘è¿™ä¸ªæŸ¥è¯¢)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">    a, b</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    tbl</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">    a = <span class="number">3</span> <span class="keyword">OR</span> b = <span class="number">8</span>;</span><br></pre></td></tr></table></figure>
<p>In many cases, MySQL wonâ€™t be able to use an index to apply an OR condition, and as a result, this query is not index-able.</p>
<p>Therefore, we recommend to avoid such OR conditions and consider splitting the query to two parts, combined with a UNION DISTINCT (or even better, UNION ALL, in case you know there wonâ€™t be any duplicate results)</p>
<p>é€šå¸¸, MySQLä¸èƒ½ä½¿ç”¨ä¸€ä¸ªç´¢å¼•æ‰§è¡Œ OR æ“ä½œ, æ‰€ä»¥, è¿™ä¸ªç´¢å¼•æ˜¯ ä¸å¯ç´¢å¼• çš„</p>
<p>æ‰€ä»¥, æˆ‘ä»¬å»ºè®®é¿å…è¿™æ ·çš„ OR æ“ä½œ, å°†å…¶åˆ‡åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†, ç”± UNION DISTINCT ç»„åˆ</p>
<p>(æˆ–è€…æ›´å¥½åœ°, UNION ALL, ä½ çŸ¥é“åœ¨è¿™ä¸ªä¾‹å­ä¸­ä¸ä¼šæœ‰é‡å¤çš„å…ƒç´ )</p>
<p>(PS. æ˜¯çš„, åœ¨è¿™æ ·çš„æƒ…å†µä¸‹, MySQLä¸ä¼šä½¿ç”¨ç´¢å¼• )</p>
<h2 id="The-order-of-columns-in-an-index-is-important"><a href="#The-order-of-columns-in-an-index-is-important" class="headerlink" title="The order of columns in an index is important"></a>The order of columns in an index is important</h2><h3 id="ç´¢å¼•ä¸­åˆ—çš„é¡ºåºå¾ˆé‡è¦"><a href="#ç´¢å¼•ä¸­åˆ—çš„é¡ºåºå¾ˆé‡è¦" class="headerlink" title="ç´¢å¼•ä¸­åˆ—çš„é¡ºåºå¾ˆé‡è¦"></a>ç´¢å¼•ä¸­åˆ—çš„é¡ºåºå¾ˆé‡è¦</h3><p>Letâ€™s say I hand you my contacts phone book which is ordered by the contactâ€™s first name and ask you to count how many people are there named â€œJohnâ€ in the book. Youâ€™ll grab the book in both hands and say â€œno problemâ€. You will navigate to the page that holds all names starting with John, and start counting from there.</p>
<p>å‡è®¾æˆ‘æŠŠæˆ‘çš„ç”±è”ç³»äººçš„å§“ä½œä¸ºé¡ºåºæ’åºçš„é€šè®¯å½•ç»™ä½ , é—®ä½ åœ¨è¿™ä¸ªé€šè®¯å½•ä¸­, æœ‰å¤šå°‘å§“ â€œJohnâ€ çš„äºº</p>
<p>ä½ ä¼šæ‹¿ç€è¿™æœ¬ä¹¦è¯´â€æ²¡é—®é¢˜â€, ä½ ä¼šæ‰¾åˆ°ä»¥ â€œJohnâ€ å¼€å§‹çš„ä¹¦é¡µ, ç„¶åå¼€å§‹è®¡æ•°</p>
<p>Now, letâ€™s say I change the assignment and hand you a phone book that is ordered by the contactâ€™s last name, but ask you to still count all contacts with the first name â€œJohnâ€. How would you approach that? Well, the database scratches his head in this situation as well.</p>
<p>å¦‚æœæˆ‘å°†ä¹¦çš„é¡ºåºæ‰“ä¹±, ä»¥åæ’åº, é—®ä½ åŒæ ·çš„é—®é¢˜, ä½ å¦‚ä½•å›ç­”è¿™ä¸ªé—®é¢˜? </p>
<p>æ•°æ®åº“ä¹Ÿä¼šé¢ä¸´åŒæ ·çš„éº»çƒ¦</p>
<p>Now lets look at an SQL query to demonstrate the same behavior with the MySQL optimizer:</p>
<p>ç°åœ¨, å…³æ³¨ä¸€ä¸ª SQL è¯­å¥æ¥å’Œ MySQL ä¼˜åŒ–å™¨æ¼”ç¤ºè¿™ä¸ªè¡Œä¸º</p>
<p>Having the index contacts (first_name, last_name) is ideal here, because the index starts with our filtering condition and ends with another column in the SELECT clause.</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªç´¢å¼•ç»„åˆ (first_name, last_name) åœ¨è¿™é‡Œæ˜¯å¾ˆå¥½çš„, å› ä¸ºç´¢å¼•ç”± first_name å¼€å§‹, ç”± last_name ç»“æŸ</p>
<p>(PS. å…¶å®è¿™ä¸ª High Performance MySQL ç¬¬ 5 èŠ‚æœ‰è¯¦ç»†è®¨è®º) </p>
<p>(è¿™é‡Œçš„ä¼˜åŒ–çš„å‰ææ˜¯, è¯¥ç´¢å¼•æ˜¯ B-tree ç±»å‹, å¦‚æœæ˜¯å…¶ä»–çš„, æ¯”å¦‚ hash ç±»å‹, é‚£ä¹ˆå¯èƒ½å°±æ²¡æœ‰ä»€ä¹ˆä¼˜åŒ–æ•ˆæœ)</p>
<p>But, having the reverse index contacts (last_name, first_name) is rather useless, as the database canâ€™t use the index for filtering, as the column we need is second in the index and not first.</p>
<p>å¦‚æœæœ‰ä¸€ä¸ªç›¸åé¡ºåºçš„ç´¢å¼•, é‚£ä¹ˆå°±æ˜¯æ— ç”¨çš„</p>
<p>(å› ä¸ºå¦‚æœæ˜¯ B-tree çš„è¯, æ ¹æœ¬æ— æ³•ç´¢å¼• = =)</p>
<p>The conclusion from this example is that the order of columns in an index is rather important.</p>
<p>æœ€åç‚¹äº†ä¸€ä¸‹é¢˜</p>
<h2 id="Adding-redundant-indexes"><a href="#Adding-redundant-indexes" class="headerlink" title="Adding redundant indexes"></a>Adding redundant indexes</h2><h2 id="å¢åŠ å†—ä½™ç´¢å¼•"><a href="#å¢åŠ å†—ä½™ç´¢å¼•" class="headerlink" title="å¢åŠ å†—ä½™ç´¢å¼•"></a>å¢åŠ å†—ä½™ç´¢å¼•</h2><p>Indexes are magnificent when trying to optimize your SQL queries and they can improve performance significantly.</p>
<p>ç´¢å¼•åœ¨ä¼˜åŒ–ä½ çš„ SQL è¯­å¥å’Œæ˜¾è‘—æå‡æ€§èƒ½ä¸Šå¾ˆæœ‰å¸®åŠ©</p>
<p>But, they come with a downside as well. Each index youâ€™re creating should be kept updated and in sync when changes occur in your databases. So for each INSERT / UPDATE / DELETE in your databases, all relevant indexes should be updated. This update can take sometime, especially with large tables / indexes.</p>
<p>ä½†æ˜¯, å®ƒä»¬ä¹Ÿæœ‰ä¸€äº›ç¼ºç‚¹, æ¯ä¸ªä½ åˆ›å»ºçš„ç´¢å¼•åœ¨ä½ æ•°æ®åº“å˜åŒ–æ—¶å¿…é¡»ä¿æŒæ›´æ–°å’ŒåŒæ­¥</p>
<p>æ‰€ä»¥ æ¯ä¸ª INSERT/UPDATE/DELETE æ“ä½œéƒ½ä¼šå¼•èµ·ç›¸å…³ç´¢å¼•çš„æ›´æ–°, è¿™äº›æ“ä½œæ‰€å¼•èµ·çš„ç´¢å¼•å¯èƒ½ä¼šå¾ˆè€—æ—¶</p>
<p>Therefore, do not create indexes unless you know youâ€™ll need them.</p>
<p>Also, we highly recommend to analyze your database once in a while, searching for any <a href="https://www.eversql.com/how-to-find-unused-indexes-in-a-mysql-database/" target="_blank" rel="noopener">redundant indexes that can be removed</a>.</p>
<p>æ‰€ä»¥, é™¤éä½ çŸ¥é“ä½ éœ€è¦å®ƒä»¬, å¦åˆ™ä¸è¦åˆ›å»ºæ— ç”¨çš„ç´¢å¼•</p>
<p>åŒæ ·åœ°, æˆ‘ä»¬æåŠ›æ¨èæ¯ä¸ªä¸€æ®µæ—¶é—´, åˆ†æä¸€ä¸‹æ•°æ®åº“, åˆ é™¤å†—ä½™çš„ç´¢å¼•</p>
<h3 id="How-to-automate-index-creation-and-SQL-query-optimization"><a href="#How-to-automate-index-creation-and-SQL-query-optimization" class="headerlink" title="How to automate index creation and SQL query optimization?"></a>How to automate index creation and SQL query optimization?</h3><p>If youâ€™re looking for a way to automate your index creation, while also adding the benefit of a proprietary indexing algorithm and query optimization recommendations, you can try out <a href="https://www.eversql.com/" target="_blank" rel="noopener">EverSQL Query Optimizer</a> which does all the heavy lifting for you.</p>
<p>(å¹¿å‘Š, æœ‰å…´è¶£å¯ä»¥å»åŸé¡µé¢è¯•è¯•)</p>
<h2 id="How-to-track-redundant-indexes-in-MySQL"><a href="#How-to-track-redundant-indexes-in-MySQL" class="headerlink" title="How to track redundant indexes in MySQL?"></a>How to track redundant indexes in MySQL?</h2><p>(è¿™æ˜¯åœ¨å¦ä¸€ä¸ªé¡µé¢çš„ç‰‡æ®µ)</p>
<p>å¦‚ä½•è·Ÿè¸ª MySQL ä¸­å†—ä½™çš„ç´¢å¼•</p>
<p>Starting MySQL 5.6, the database keeps track of index usage as part of its PERFORMANCE SCHEMA. This data can be queried using the <strong>schema_unused_indexes</strong> view, which displays indexes for which there are no events. Having no events indicates that these indexes might be redundant and unused for a while.</p>
<p>è‡ª MySQL 5.6 å¼€å§‹, æ•°æ®åº“æŒç»­è·Ÿè¸ªå®ƒ PERFORMANCE SCHEMA ä¸­æœªä½¿ç”¨çš„ç´¢å¼•</p>
<p>è¿™äº›æ•°æ®å¯ä»¥ç”¨ schema_unused_indexes æ¥æŸ¥è¯¢</p>
<p>æ˜¾ç¤ºå“ªäº›ç´¢å¼•æ²¡æœ‰å·¥ä½œè¿‡, è¿™è¡¨ç¤ºè¿™äº›ç´¢å¼•æ˜¯å†—ä½™çš„, åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰ä½¿ç”¨è¿‡</p>
<p>But life isnâ€™t that good, not yet at least. The potential obstacle here is that this information is re-counted every time MySQL is restarted. Therefore, in order to get reliable information, you should query these views a while after the MySQL instance was started. How long after the startup youâ€™re asking? Well, that depends. My question back to you will be â€“ how busy your database is? Do you know if all types of queries are usually executed in the database in a specific period of time? If so, thatâ€™s your window.</p>
<p>ä½†æ˜¯ç”Ÿæ´»æ²¡æœ‰é‚£ä¹ˆç¾å¥½, è‡³å°‘ç°åœ¨æ²¡æœ‰. æ½œåœ¨çš„éšœç¢æ˜¯è¿™äº›ä¿¡æ¯ä¼šåœ¨æ¯æ¬¡ MySQL é‡å¯æ—¶é‡æ–°ç»Ÿè®¡</p>
<p>æ‰€ä»¥, ä¸ºäº†é¿å…è¿™ç§æƒ…å†µ, ä½ åº”è¯¥åœ¨ MySQL å¯åŠ¨ä¸€æ®µæ—¶é—´åå»æŸ¥è¯¢è¿™äº›æ•°æ®</p>
<p>è¿™æ—¶é—´çš„é•¿çŸ­å–å†³ä¸ä½ æ•°æ®åº“çš„å¿™ç¢Œç¨‹åº¦</p>
<p>So letâ€™s take a look at how itâ€™s done: (è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹å¦‚ä½•å®Œæˆ)</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> sys.schema_unused_indexes;</span><br><span class="line"></span><br><span class="line">object_schema	object_name	index_name</span><br><span class="line">mydb			age			agecountry_index</span><br><span class="line">mydb			country		agecountry_index</span><br></pre></td></tr></table></figure>
<p>(PS. æ˜¾ç„¶, å¦‚æœæ•°æ®å¯é , é‚£ä¹ˆ age è¡¨ä¸­çš„ agecountry_index å’Œ country è¡¨ä¸­çš„ agecountry_index æ˜¯å¯ä»¥åˆ é™¤çš„)</p>
]]></content>
  </entry>
  <entry>
    <title>read/B-tree</title>
    <url>/2020/01/09/read/B-tree/</url>
    <content><![CDATA[<h2 id="åŸæ–‡åœ°å€-https-en-wikipedia-org-wiki-B-tree"><a href="#åŸæ–‡åœ°å€-https-en-wikipedia-org-wiki-B-tree" class="headerlink" title="åŸæ–‡åœ°å€ : https://en.wikipedia.org/wiki/B-tree"></a>åŸæ–‡åœ°å€ : <a href="https://en.wikipedia.org/wiki/B-tree" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/B-tree</a></h2><h2 id="B-tree"><a href="#B-tree" class="headerlink" title="B-tree"></a>B-tree</h2><p>In <a href="https://en.wikipedia.org/wiki/Computer_science" target="_blank" rel="noopener">computer science</a>, a <strong>B-tree</strong> is a self-balancing <a href="https://en.wikipedia.org/wiki/Tree_data_structure" target="_blank" rel="noopener">tree data structure</a> that maintains sorted data and allows searches, sequential access, insertions, and deletions in <a href="https://en.wikipedia.org/wiki/Logarithmic_time" target="_blank" rel="noopener">logarithmic time</a>. The B-tree is a generalization of a <a href="https://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="noopener">binary search tree</a> in that a node can have more than two children.<a href="https://en.wikipedia.org/wiki/B-tree#cite_note-Comer-1" target="_blank" rel="noopener">[1]</a> Unlike other <a href="https://en.wikipedia.org/wiki/Self-balancing_binary_search_tree" target="_blank" rel="noopener">self-balancing binary search trees</a>, the B-tree is well suited for storage systems that read and write relatively large blocks of data, such as discs. It is commonly used in <a href="https://en.wikipedia.org/wiki/Database" target="_blank" rel="noopener">databases</a> and <a href="https://en.wikipedia.org/wiki/File_system" target="_blank" rel="noopener">file systems</a>.</p>
<p>What, if anything, the <em>B</em> stands for has never been established.</p>
<p>åœ¨è®¡ç®—æœºç§‘å­¦ä¸­, B-tree æ˜¯è‡ªå¹³è¡¡æ ‘æ•°æ®ç»“æ„, ç®¡ç†æ’åºåçš„æ•°æ®, èƒ½å¸¸é‡æ—¶é—´å†…æœç´¢. åºåˆ—è®¿é—®, æ’å…¥å’Œåˆ é™¤æ“ä½œ</p>
<p>B-tree æ˜¯äºŒåˆ†æŸ¥æ‰¾æ ‘çš„å¹¿æ³›å®ç°, å³ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰è¶…è¿‡ä¸¤ä¸ªå­èŠ‚ç‚¹</p>
<p>ä¸åƒå…¶ä»–è‡ªå¹³è¡¡äºŒåˆ†æŸ¥æ‰¾æ ‘, B-tree é€‚ç”¨äºå­˜å‚¨ç³»ç»Ÿ, ç”¨ä½œè¯»å–å’Œå†™å…¥ç›¸å½“åºå¤§çš„æ•°æ®</p>
<p>æ¯”å¦‚ discs, é€šå¸¸è¢«æ•°æ®åº“å’Œæ“ä½œç³»ç»Ÿä½¿ç”¨</p>
<h3 id="Overview-æ¦‚è§ˆ"><a href="#Overview-æ¦‚è§ˆ" class="headerlink" title="Overview (æ¦‚è§ˆ)"></a>Overview (æ¦‚è§ˆ)</h3><p>In B-trees, internal (<a href="https://en.wikipedia.org/wiki/Leaf_node" target="_blank" rel="noopener">non-leaf</a>) nodes can have a variable number of child nodes within some pre-defined range. When data is inserted or removed from a node, its number of child nodes changes. In order to maintain the pre-defined range, internal nodes may be joined or split. Because a range of child nodes is permitted, B-trees do not need re-balancing as frequently as other self-balancing search trees, but may waste some space, since nodes are not entirely full. The lower and upper bounds on the number of child nodes are typically fixed for a particular implementation. For example, in a <a href="https://en.wikipedia.org/wiki/2-3_tree" target="_blank" rel="noopener">2-3 B-tree</a> (often simply referred to as a <strong>2-3 tree</strong>), each internal node may have only 2 or 3 child nodes.</p>
<p>Each internal node of a B-tree contains a number of <a href="https://en.wikipedia.org/wiki/Unique_key" target="_blank" rel="noopener">keys</a>. The keys act as separation values which divide its <a href="https://en.wikipedia.org/wiki/Subtree" target="_blank" rel="noopener">subtrees</a>. For example, if an internal node has 3 child nodes (or subtrees) then it must have 2 keys: <em>a</em>1 and <em>a</em>2. All values in the leftmost subtree will be less than <em>a</em>1, all values in the middle subtree will be between <em>a</em>1 and <em>a</em>2, and all values in the rightmost subtree will be greater than <em>a</em>2.</p>
<p>åœ¨ B-tree ä¸­, å†…éƒ¨(éå¶å­)èŠ‚ç‚¹å¯ä»¥åœ¨é¢„å®šä¹‰èŒƒå›´å†…æ‹¥æœ‰å¯å˜æ•°é‡çš„å­èŠ‚ç‚¹</p>
<p>å½“ä»èŠ‚ç‚¹ä¸­æ’å…¥æˆ–åˆ é™¤æ•°æ®æ—¶, å­èŠ‚ç‚¹çš„æ•°é‡æ”¹å˜. ä¸ºäº†ç®¡ç†é¢„å®šä¹‰çš„èŒƒå›´, å†…éƒ¨èŠ‚ç‚¹å¯ä»¥è¿æ¥æˆ–åˆ†è£‚</p>
<p>å› ä¸ºå­èŠ‚ç‚¹çš„èŒƒå›´æ˜¯å—é™çš„, B-tree ä¸éœ€è¦åƒå…¶ä»–è‡ªå¹³è¡¡äºŒåˆ†æŸ¥æ‰¾æ•°ä¸€æ ·é¢‘ç¹åœ°é‡å¹³è¡¡, ä½†æ˜¯ä¼šæµªè´¹ä¸€äº›ç©ºé—´, å› ä¸ºèŠ‚ç‚¹ä¸æ˜¯å¡«å……æ»¡çš„</p>
<p>å­èŠ‚ç‚¹æ•°é‡çš„ä¸Šé™å’Œä¸‹é™é€šå¸¸æœ‰å…·ä½“çš„å®ç°å›ºå®š, æ¯”å¦‚ 2-3 B-tree(é€šå¸¸ç®€ç§° 2-3 tree) æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹åªæœ‰ 2 ä¸ª æˆ– 3ä¸ªå­èŠ‚ç‚¹</p>
<p>æ¯ä¸ª B-tree çš„å†…éƒ¨èŠ‚ç‚¹å«æœ‰ä¸€äº› keys, keys å……å½“åˆ†ç¦»çš„å€¼ åˆ†ç¦»å­æ ‘</p>
<p>æ¯”å¦‚, å¦‚æœå†…éƒ¨èŠ‚ç‚¹æœ‰ 3 ä¸ªå­èŠ‚ç‚¹(æˆ–å­æ ‘) é‚£ä¹ˆ, å®ƒå¿…é¡»æœ‰ 2 ä¸ª keys : a1 å’Œ a2</p>
<p>æ‰€æœ‰åœ¨æœ€å·¦è¾¹å­æ ‘çš„å€¼ &lt;a1, æ‰€æœ‰åœ¨ä¸­é—´å­æ ‘çš„å€¼ &gt;a1 &lt;a2, åœ¨æœ€å³å­æ ‘ä¸­çš„æ‰€æœ‰å€¼ &gt;a2</p>
<p>(PS. è¿™é‡Œæ²¡æœ‰è€ƒè™‘ = çš„æƒ…å†µ, ä¸è¿‡è¿˜è¡Œ, ç­‰äºæ”¾åœ¨å€¼çš„å·¦è¾¹è¿˜æ˜¯å³è¾¹, ä¸ä¼šæœ‰å¤ªå¤§å½±å“)</p>
<p>Usually, the number of keys is chosen to vary between {\displaystyle d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e85ff03cbe0c7341af6b982e47e9f90d235c66ab" alt="d"> and {\displaystyle 2d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d8106478cb4da6af49992eeb3a3b8690d27797ad" alt="2d">, where {\displaystyle d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e85ff03cbe0c7341af6b982e47e9f90d235c66ab" alt="d"> is the minimum number of keys, and {\displaystyle d+1}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/056e0c06c828dbe71a0f9021b2828ff176a3d337" alt="d+1"> is the minimum <a href="https://en.wikipedia.org/wiki/Outdegree#Indegree_and_outdegree" target="_blank" rel="noopener">degree</a> or <a href="https://en.wikipedia.org/wiki/Branching_factor" target="_blank" rel="noopener">branching factor</a> of the tree. In practice, the keys take up the most space in a node. The factor of 2 will guarantee that nodes can be split or combined. If an internal node has {\displaystyle 2d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d8106478cb4da6af49992eeb3a3b8690d27797ad" alt="2d"> keys, then adding a key to that node can be accomplished by splitting the hypothetical {\displaystyle 2d+1}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d68ab692c5c4a44b63f3bd320249b8cb8d035191" alt="2d+1"> key node into two {\displaystyle d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e85ff03cbe0c7341af6b982e47e9f90d235c66ab" alt="d"> key nodes and moving the key that would have been in the middle to the parent node. Each split node has the required minimum number of keys. Similarly, if an internal node and its neighbor each have {\displaystyle d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e85ff03cbe0c7341af6b982e47e9f90d235c66ab" alt="d"> keys, then a key may be deleted from the internal node by combining it with its neighbor. Deleting the key would make the internal node have {\displaystyle d-1}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/0195b64ba44bcc80b4c98e9d34256b4043fe519e" alt="d-1"> keys; joining the neighbor would add {\displaystyle d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e85ff03cbe0c7341af6b982e47e9f90d235c66ab" alt="d"> keys plus one more key brought down from the neighborâ€™s parent. The result is an entirely full node of {\displaystyle 2d}<img src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d8106478cb4da6af49992eeb3a3b8690d27797ad" alt="2d"> keys.</p>
]]></content>
  </entry>
  <entry>
    <title>other/aQuestionAboutStaticKeyword</title>
    <url>/2020/01/09/other/aQuestionAboutStaticKeyword/</url>
    <content><![CDATA[<h3 id="ä¸€ä¸ªå…³äº-static-çš„é—®é¢˜"><a href="#ä¸€ä¸ªå…³äº-static-çš„é—®é¢˜" class="headerlink" title="ä¸€ä¸ªå…³äº static çš„é—®é¢˜"></a>ä¸€ä¸ªå…³äº static çš„é—®é¢˜</h3><p>2019å¹´4æœˆ22æ—¥19:42:18  </p>
<p>æ—¥å¸¸çš„ä¸€å¤©, åšåš leetcode, ä½†æ˜¯çªç„¶å‘ç°äº†å…³äº leetcode ä»£ç ä¼˜åŒ–çš„é—®é¢˜ </p>
<p><img src="https://imgur.com/cH0JYBG.png" alt=""></p>
<p>é¢˜ç›®å¤§æ¦‚æ˜¯è¦ä½ ä¸­åºéå†æ ‘</p>
<p>(çœ‹åˆ°é¢˜ç›®çš„æ—¶å€™æ„£äº†ä¸€ä¸‹, æ€€ç–‘è‡ªå·±æ˜¯ä¸æ˜¯çœ¼èŠ±äº†, ç›´åˆ°çœ‹åˆ°äº† Follow upâ€¦  emmm, å¥½å§, è¿­ä»£)</p>
<p>æ€»ä¹‹æˆ‘å…ˆç”¨é€’å½’è¯•äº†ä¸€ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for a binary tree node.</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     TreeNode *left;</span></span><br><span class="line"><span class="comment"> *     TreeNode *right;</span></span><br><span class="line"><span class="comment"> *     TreeNode(int x) : val(x), left(NULL), right(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; inorderTraversal(TreeNode* root) &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ret;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> ret;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (root-&gt;left)</span><br><span class="line">            inorderTraversal(root-&gt;left);</span><br><span class="line"></span><br><span class="line">        ret.push_back(root-&gt;val);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (root-&gt;right)</span><br><span class="line">            inorderTraversal(root-&gt;right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><img src="https://imgur.com/NMNndgq.png" alt=""></p>
<p>ä½†æ˜¯å®ƒæ€»æ˜¯ç»™æˆ‘æŠ¥è¿™ä¸ªé”™</p>
<p>è¿™æ˜¯æ²¡æœ‰ç†ç”±çš„! æˆ‘ä»£ç ä¸­ä¸å¯èƒ½æ— ä¸­ç”Ÿæœ‰</p>
<p>æˆ‘æ€€ç–‘è¿™æ˜¯ leetcode å¹³å°å¯¹äºç”¨æˆ·æ‰€åšçš„ä¸€ç§ä¼˜åŒ–  </p>
<p>è€Œè¿™ç§ä¼˜åŒ–ä¸æˆ‘ä½¿ç”¨ static å…³é”®å­—ç›¸å†²çª</p>
]]></content>
  </entry>
  <entry>
    <title>other/O(n)</title>
    <url>/2020/01/09/other/O(n)/</url>
    <content><![CDATA[<h2 id="æ—¶é—´å¤æ‚åº¦"><a href="#æ—¶é—´å¤æ‚åº¦" class="headerlink" title="æ—¶é—´å¤æ‚åº¦"></a>æ—¶é—´å¤æ‚åº¦</h2><p>æ—¶é—´å¤æ‚åº¦ç”¨äºæè¿°ç®—æ³•çš„æ•ˆç‡, æ˜¯è¡¡é‡ç®—æ³•ä¼˜åŠ£çš„é‡è¦æŒ‡æ ‡  </p>
<h3 id="O-1"><a href="#O-1" class="headerlink" title="O(1)"></a>O(1)</h3><pre><code>void func(int n){
    std::cout &lt;&lt; n &lt;&lt; std::cout;
}</code></pre><p>å°†è‡ªå˜é‡è§†ä½œn, nåœ¨æ­¤æƒ…æ™¯ä¸‹ä¸ºä¼ å…¥çš„å‚æ•°<br>å°†å› å˜é‡è§†ä½œt, tåœ¨æ­¤æƒ…æ™¯ä¸‹ä¸ºå‡½æ•°æ‰§è¡Œçš„æŒ‡ä»¤æ¬¡æ•°(è¿™ä¸ªå°±æ˜¯æ—¶é—´å¤æ‚åº¦)<br>ä¸Šè¿°ç®—æ³•ä¸­, æ— è®ºnæ˜¯å¤šå°‘, téƒ½ä¸º1, åˆ™æ­¤ç®—æ³•å¤æ‚åº¦è®°åš: O(1)</p>
<p>O(1)å¤æ‚åº¦çš„ç®—æ³•æ•ˆç‡ä¸å› å¤–ç•Œå› ç´ è€Œæ”¹å˜  </p>
<p>PS: ä¹Ÿç§°ä½œå¸¸é‡çº§å¤æ‚åº¦, æ˜¯æœ€ç†æƒ³çš„å¤æ‚åº¦  </p>
<h3 id="O-2n"><a href="#O-2n" class="headerlink" title="O(2n)"></a>O(2n)</h3><p>ç•¥</p>
<p>PS: å…¶ä¸­O(2n)å°±æ˜¯å‘ˆ2å€å¤æ‚åº¦å¢åŠ , è€ŒO(nn)åˆ™æ„ä¸ºnå€å¢åŠ   </p>
<h3 id="O-n"><a href="#O-n" class="headerlink" title="O(n)"></a>O(n)</h3><pre><code>void func(int n){
    for(int i = 0; i &lt; n; ++i){
        std::cout &lt;&lt; i &lt;&lt; std::endl;
    }
}</code></pre><p>ä¸Šè¿°ç®—æ³•ä¸­ t = n + 1(å…¶ä¸­çš„1ä¸ºæœ€åä¸€æ¬¡çš„å¤±è´¥), ç®—æ³•å¤æ‚åº¦ä¸ºO(n)</p>
<p>O(n)å¤æ‚åº¦çš„ç®—æ³•æ•ˆç‡ä¼šå› å¤–ç•Œå› ç´ è€Œæ”¹å˜, å…¶è§„å¾‹ä¸º: å¤æ‚åº¦å‘ˆ1:1å½¢å¼å¢åŠ     </p>
<p>PS: O(n)æ˜¯æ¯”è¾ƒå¸¸è§çš„å¤æ‚åº¦, æ•ˆç‡ä¸€èˆ¬  </p>
<h3 id="O-n-2-O-n-n"><a href="#O-n-2-O-n-n" class="headerlink" title="O(n^2)/O(n^n)"></a>O(n^2)/O(n^n)</h3><pre><code>void func(int n){
    for(int i = 0; i &lt; n; ++i){
        for(int j = 0; j &lt; n; ++i){
            std::cout &lt;&lt; i &lt;&lt; std::endl;
        }
    }
}</code></pre><p>ä¸Šè¿°ç®—æ³•ä¸­ t = n * n + 1, è®°åš: O(n^2)  </p>
<p>O(n^2)å¤æ‚åº¦çš„ç®—æ³•æ•ˆç‡ä¼šéšå¤–ç•Œçš„å½±å“å¹³æ–¹å€å˜åŒ–<br>åŒç†, åˆ™O(n^n)å¤æ‚åº¦çš„ç®—æ³•æ•ˆç‡ä¼šéšå¤–ç•Œçš„å½±å“å‘ˆnæ¬¡æ–¹å€å¢åŠ  </p>
<p>PS: å‡ºç°è¿™ç§å¤æ‚åº¦çš„ä»£ç , åˆ™éœ€è¦è€ƒè™‘ä¼˜åŒ–</p>
<h3 id="O-log-n"><a href="#O-log-n" class="headerlink" title="O(log n)"></a>O(log n)</h3><p>è¦æƒ³æ˜ç™½O(log n)æ—¶é—´å¤æ‚åº¦, åˆ™å…ˆå¾—å¤ä¹ <a href="https://zh.wikipedia.org/wiki/%E5%AF%B9%E6%95%B0" target="_blank" rel="noopener">å¯¹æ•°</a><br>(å¦‚æœä½ è¿˜æ²¡æŠŠæ•°å­¦è¿˜ç»™æ•°å­¦è€å¸ˆçš„è¯, å°±ä¸å¿…äº†)</p>
<p>è¿™ä¸œè¥¿æˆ‘ä¹Ÿä¸å¤§è¯´å¾—æ¸…æ¥š, å°±ç›´æ¥ç²˜è´´ç½‘ä¸Šçš„æ¡ˆä¾‹äº†:</p>
<p><img src="https://i.imgur.com/JGXST7I.png" alt=""></p>
<p>PS: O(log n)çš„å¤æ‚åº¦è®¡ç®—å¥½åƒä¸å¤ªå®¹æ˜“, ä¸€èˆ¬äººè¿˜ä¸ä¸€å®šè®¡ç®—å¾—å‡ºæ¥â€¦ </p>
<p>RET: æ€»çš„æ¥è¯´æ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€ä¸ªéšç€è®¡ç®—æ•°æ®å¢åŠ , ç®—æ³•æ•ˆç‡å‘ˆä½•ç§å½¢å¼å¢åŠ çš„ä¸€ç§è§„å¾‹<br>äº†è§£ä¸€ä¸‹æ—¶é—´å¤æ‚åº¦æ˜¯å¾ˆæœ‰å¿…è¦çš„<br>ä»¥ååˆ«äººé—®ä½  ä½ çš„ç®—æ³•æ•ˆç‡å¦‚ä½•çš„æ—¶å€™. å°±å¯ä»¥å›ç­”: æˆ‘çš„ç®—æ³•æ—¶é—´å¤æ‚åº¦æ˜¯O(1)!  </p>
<p>ä»¥ä¸Šç»éªŒå‚ç…§è‡ª<a href="https://www.jianshu.com/p/f4cca5ce055a" target="_blank" rel="noopener">ç®€ä¹¦</a></p>
]]></content>
  </entry>
  <entry>
    <title>other/crontab</title>
    <url>/2020/01/09/other/crontab/</url>
    <content><![CDATA[<h3 id="éœ€æ±‚æè¿°"><a href="#éœ€æ±‚æè¿°" class="headerlink" title="éœ€æ±‚æè¿°"></a>éœ€æ±‚æè¿°</h3><p>è®¾è®¡ä¸€ä¸ªå®šæ—¶å…³æœºçš„å·¥å…·  </p>
<p>è¯¥å·¥å…·ä½¿ç”¨luaè¯­è¨€, é€šè¿‡PLINKé“¾æ¥æœåŠ¡å™¨  </p>
<p>æ¥æ”¶ç”¨æˆ·è¾“å…¥, ä½¿ç”¨crontab/atè®¾ç½®å®šæ—¶å™¨</p>
<h3 id="è¯¦ç»†ä»£ç "><a href="#è¯¦ç»†ä»£ç " class="headerlink" title="è¯¦ç»†ä»£ç "></a>è¯¦ç»†ä»£ç </h3><h4 id="timer-table"><a href="#timer-table" class="headerlink" title="timer table"></a>timer table</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="built_in">package</span>.<span class="built_in">path</span> = <span class="built_in">package</span>.<span class="built_in">path</span> .. <span class="string">";../../script/?.lua"</span></span><br><span class="line"><span class="comment">-- incæ˜¯å·¥å…·ç±»</span></span><br><span class="line"><span class="keyword">local</span> inc = <span class="built_in">require</span>(<span class="string">"inc"</span>)</span><br><span class="line"><span class="comment">-- configè®°å½•äº†æœåŠ¡å™¨çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">local</span> <span class="built_in">config</span> = <span class="built_in">require</span>(<span class="string">"config"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- timerç”¨äºå¤„ç†æ•´ä¸ªå®šæ—¶ä»»åŠ¡</span></span><br><span class="line"><span class="keyword">local</span> timer = &#123;&#125;</span><br><span class="line">timer.file = <span class="string">"crontabtask.sh"</span>			<span class="comment">-- æ–‡ä»¶å, å› ä¸ºä½¿ç”¨ crontab [file]å½¢å¼æ·»åŠ ä»»åŠ¡</span></span><br><span class="line">timer.<span class="built_in">path</span> = <span class="string">"/tmp/"</span>					<span class="comment">-- æ–‡ä»¶ä½äºæœåŠ¡å™¨é‚£ä¸ªè·¯å¾„ä¸‹</span></span><br><span class="line">timer.fullName = timer.<span class="built_in">path</span>..timer.file	<span class="comment">-- è·¯å¾„+æ–‡ä»¶å, å½“å‰ä¸º: /tmp/crontabtask.sh</span></span><br><span class="line">timer.filenamemask = <span class="string">"CRONTAB_TASK_"</span>	<span class="comment">-- æ©ç , ç”¨äºåŒºåˆ†ä»»åŠ¡</span></span><br><span class="line">timer.servername = <span class="literal">nil</span>					<span class="comment">-- æœåŠ¡å™¨åç§°, è¿™é‡Œä»…ä»…å ä½, ä¼šåœ¨ä¹‹åè®¾ç½®</span></span><br></pre></td></tr></table></figure>

<p>timeræ˜¯ä»»åŠ¡å¤„ç†è¡¨(ç±»), å› ä¸ºbashä¸‹, æ²¡æœ‰åŠæ³•ç›´æ¥ä½¿ç”¨vimç¼–è¾‘(æˆ–è€…è¯´æˆ‘ä¸çŸ¥é“æœ‰ä»€ä¹ˆåŠæ³•èƒ½è¿™ä¹ˆåš)  </p>
<p>æ‰€ä»¥ crontab -e çš„æ–¹å¼è¢«èˆå¼ƒäº†, ä½¿ç”¨ crontab [filename] çš„å½¢å¼æ¥æ·»åŠ ä»»åŠ¡ </p>
<p>(è¿™æ ·çš„å¥½å¤„æ˜¯ç»Ÿä¸€ä½¿ç”¨æŸä¸€æ–‡ä»¶ä½œä¸ºä»»åŠ¡æ–‡ä»¶,  åç»­å¯ä»¥ä½¿ç”¨æŸç§æ‰‹æ®µ(æ¯”å¦‚ä¿®æ”¹é…ç½®), æ¥é‡æ–°å®šä¹‰crontab -e)</p>
<p>(åå¤„å°±æ˜¯åŠ¨åˆ°äº†ç³»ç»Ÿçš„ä¸œè¥¿, è¿™å¹¶ä¸ä¸€å®šæ˜¯å¥½äº‹)</p>
<h4 id="lobby"><a href="#lobby" class="headerlink" title="lobby"></a>lobby</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¤§å…</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.lobby</span><span class="params">()</span></span></span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥è¦æ“ä½œçš„æœåŠ¡å™¨ID"</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">local</span> serverID = <span class="built_in">tonumber</span>(<span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>())</span><br><span class="line">    <span class="keyword">local</span> scfg, servercfg = inc.getserverinfo(serverID)</span><br><span class="line"></span><br><span class="line">    inc.confirm_oper_server(scfg, &#123;servercfg&#125;, <span class="string">"å³å°†æ“ä½œè¯¥æœåŠ¡å™¨"</span>)</span><br><span class="line">    <span class="comment">-- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line">    timer.checkFileExists(scfg, servercfg)</span><br><span class="line">    <span class="keyword">local</span> sFolder = <span class="built_in">string</span>.<span class="built_in">format</span>(<span class="string">"%s%d.p%d"</span>, </span><br><span class="line">        <span class="built_in">config</span>.gamename, servercfg.id, servercfg.port)</span><br><span class="line">    timer.servername = sFolder</span><br><span class="line">    <span class="comment">-- æ ¹æ®ç”¨æˆ·çš„é€‰é¡¹, æˆ‘ä»¬é‡æ–°è®¾ç½®äº†æ–‡ä»¶æ©ç , åŠ ä¸Šäº†å½“å‰æœåŠ¡å™¨å</span></span><br><span class="line">    <span class="comment">-- è¿™æ ·æ›´åŠ å®‰å…¨, ä¹Ÿå¯ä»¥ç­›é€‰ç»Ÿä¸€ä¸»æœºä¸‹, ä¸åŒæœåŠ¡å™¨ä»»åŠ¡äº†</span></span><br><span class="line">    timer.filenamemask = timer.filenamemask..timer.servername</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>)</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">        inc.p(<span class="string">"\né€‰æ‹©æ“ä½œç±»å‹[1: å¢åŠ , 2: åˆ é™¤, 4:æŸ¥è¯¢]"</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">local</span> operatetype = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">        <span class="keyword">if</span> operatetype == <span class="string">'1'</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- å¢åŠ å®šæ—¶å™¨</span></span><br><span class="line">            timer.addTimerTask(scfg, servercfg)</span><br><span class="line">            <span class="comment">-- åˆ¤æ–­æ˜¯å¦å¢åŠ æˆåŠŸ</span></span><br><span class="line">            timer.isAddSuccess(scfg, servercfg)</span><br><span class="line">            <span class="comment">-- è‡ªåŠ¨åˆ·æ–°å®šæ—¶å™¨åˆ—è¡¨</span></span><br><span class="line">            timer.searchTimerTask(scfg, servercfg)</span><br><span class="line">        <span class="keyword">elseif</span> operatetype == <span class="string">'2'</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- åˆ é™¤å®šæ—¶å™¨</span></span><br><span class="line">            timer.deleteTimerTask(scfg, servercfg)</span><br><span class="line">            <span class="comment">-- è‡ªåŠ¨åˆ·æ–°å®šæ—¶å™¨åˆ—è¡¨</span></span><br><span class="line">            timer.searchTimerTask(scfg, servercfg)</span><br><span class="line">        <span class="keyword">elseif</span> operatetype == <span class="string">'3'</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- é¢„ç•™</span></span><br><span class="line">        <span class="keyword">elseif</span> operatetype == <span class="string">'4'</span> <span class="keyword">then</span></span><br><span class="line">            <span class="comment">-- åˆ·æ–°å®šæ—¶å™¨åˆ—è¡¨</span></span><br><span class="line">            timer.searchTimerTask(scfg, servercfg)</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            inc.p(<span class="string">"æ“ä½œç å¼‚å¸¸"</span>, <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>å¤§å…ç•Œé¢, å…ˆè®©ç”¨æˆ·é€‰æ‹©ä¸€ä¸ªæ“ä½œçš„æœåŠ¡å™¨, è®¾ç½®ç›¸åº”çš„å‚æ•°, ç„¶åè®©ç”¨æˆ·ä¸€ç›´æ“ä½œè¯¥æœåŠ¡å™¨</p>
<h4 id="checkFileExists"><a href="#checkFileExists" class="headerlink" title="checkFileExists"></a>checkFileExists</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.checkFileExists</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="comment">-- çœ‹ä¸€ä¸‹ç›®å½•ä¸‹æ˜¯å¦å­˜é…ç½®æ–‡ä»¶</span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"cd "</span>..timer.<span class="built_in">path</span>)</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"ls crontab*"</span>);</span><br><span class="line">    <span class="keyword">local</span> filename;</span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span></span><br><span class="line">        <span class="comment">-- å› ä¸ºæŸäº›åŸå› , ä¸ç”¨åœ¨æ„è¿™è¡Œä»£ç . å®ƒçš„ä½œç”¨æ˜¯è·å–æ–‡ä»¶å</span></span><br><span class="line">        filename = res[<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">end</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">string</span>.<span class="built_in">find</span>(filename, <span class="string">"crontab"</span>) == <span class="literal">nil</span>) <span class="keyword">then</span></span><br><span class="line">        <span class="comment">-- æ²¡æ‰¾åˆ°é…ç½®æ–‡ä»¶, å°±æ–°å»ºä¸€ä¸ª</span></span><br><span class="line">        inc.p(<span class="string">"æœªæ‰¾åˆ°æ–‡ä»¶, å³å°†åˆ›å»ºç©ºæ–‡ä»¶: "</span>, <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">        <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"touch "</span>..timer.fullName)</span><br><span class="line">        inc.popen_server_cmds(scfg, cmds, <span class="literal">nil</span>, <span class="literal">true</span>)</span><br><span class="line">        inc.p(<span class="string">"åˆ›å»ºæˆåŠŸ: "</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">else</span> </span><br><span class="line">        <span class="comment">-- å¦‚æœé…ç½®æ–‡ä»¶å·²ç»å­˜åœ¨äº†, é‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨å½“å‰æ–‡ä»¶</span></span><br><span class="line">        inc.p(<span class="string">"å·²æ‰¾åˆ°æ–‡ä»¶: "</span>..filename, <span class="number">10</span>)</span><br><span class="line">        timer.file = filename</span><br><span class="line">        timer.fullName = timer.<span class="built_in">path</span>..timer.file</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å·²å­˜åœ¨, å­˜åœ¨åˆ™ä¸–ç•Œä½¿ç”¨å®ƒ, ä¸å­˜åœ¨, åˆ™åˆ›å»ºä¸€ä¸ª</p>
<h4 id="addTimerTask"><a href="#addTimerTask" class="headerlink" title="addTimerTask"></a>addTimerTask</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å¢åŠ å®šæ—¶å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.addTimerTask</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="comment">-- è®¾ç½®æ—¶é—´</span></span><br><span class="line">    <span class="keyword">local</span> timetab = &#123;&#125;</span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥ä»»åŠ¡å"</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">local</span> taskname = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    <span class="keyword">local</span> ttaskname = taskname..timer.filenamemask</span><br><span class="line">    <span class="comment">-- æ£€æµ‹ä»»åŠ¡åæ˜¯å¦å­˜åœ¨, ä»»åŠ¡åç”¨äºåˆ , æŸ¥ä»»åŠ¡</span></span><br><span class="line">    <span class="keyword">while</span> (timer.checkTaskName(scfg, servercfg, ttaskname) == <span class="literal">true</span>) <span class="keyword">do</span></span><br><span class="line">        inc.p(<span class="string">"ä»»åŠ¡é‡å, è¯·é‡æ–°è¾“å…¥"</span>, <span class="number">14</span>)</span><br><span class="line">        taskname = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">        ttaskname = taskname..timer.filenamemask</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- è®¾ç½®å®šæ—¶å™¨è§¦å‘æ—¶é—´</span></span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥æœåŠ¡å™¨å…³é—­æ—¶é—´(æœˆ)"</span>, <span class="number">10</span>)</span><br><span class="line">    timetab.month = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥æœåŠ¡å™¨å…³é—­æ—¶é—´(æ—¥)"</span>, <span class="number">10</span>)</span><br><span class="line">    timetab.day = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥æœåŠ¡å™¨å…³é—­æ—¶é—´(æ—¶)"</span>, <span class="number">10</span>)</span><br><span class="line">    timetab.hour = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥æœåŠ¡å™¨å…³é—­æ—¶é—´(åˆ†)"</span>, <span class="number">10</span>)</span><br><span class="line">    timetab.minute = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    inc.p(<span class="string">"æœåŠ¡å™¨å°†è®¡åˆ’äº "</span>..timetab.month..<span class="string">"æœˆ"</span>..timetab.day..<span class="string">"æ—¥"</span>..</span><br><span class="line">        timetab.hour..<span class="string">"æ—¶"</span>..timetab.minute..<span class="string">"åˆ† å…³é—­, ç¡®å®š? [è¾“å…¥yç»§ç»­]"</span>, <span class="number">12</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>() ~= <span class="string">'y'</span> <span class="keyword">then</span> <span class="keyword">return</span> <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">-- è¿™é‡Œæ„é€ äº†ä¸€æ¡å‘½ä»¤, è¿™æ¡å‘½ä»¤å®ç°äº†æ·»åŠ ä¸€ä¸ªå®šæ—¶å™¨</span></span><br><span class="line">    <span class="comment">-- è¿™ä¸ªå®šæ—¶å™¨ä¼šåˆ°æŒ‡å®šçš„æœåŠ¡å™¨ä¸‹, è°ƒç”¨ kill.net æ¥å…³é—­æœåŠ¡å™¨</span></span><br><span class="line">    <span class="comment">-- å…³é—­ä¹‹å, å†ä½¿ç”¨ sed å‘½ä»¤, å°†å®šæ—¶å™¨åˆ é™¤, ç„¶åé‡ç½®å®šæ—¶å™¨</span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;;</span><br><span class="line">    <span class="keyword">local</span> dir = timer.getFullPath(servercfg)</span><br><span class="line">    <span class="keyword">local</span> timestamp = timetab.minute..<span class="string">' '</span>..timetab.hour..<span class="string">' '</span>..timetab.day..<span class="string">' '</span>..</span><br><span class="line">        timetab.month..<span class="string">' '</span>..<span class="string">'*'</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"echo \""</span>..timestamp..<span class="string">" echo \""</span>..ttaskname..<span class="string">"\""</span></span><br><span class="line">        ..<span class="string">';cd '</span>..dir..<span class="string">';./kill.net'</span>..</span><br><span class="line">        <span class="string">";sed -i \"/"</span>..ttaskname..<span class="string">"/d\" "</span>..timer.fullName..</span><br><span class="line">        <span class="string">";crontab "</span>..timer.fullName..<span class="string">"\" &gt;&gt; "</span>..timer.fullName)</span><br><span class="line">    <span class="built_in">print</span> (cmds[<span class="number">1</span>]);</span><br><span class="line">    <span class="comment">-- è¿™æ˜¯ä¸€ä¸ªå¤–éƒ¨å·¥å…·ç±»ä¸­çš„å‡½æ•°, ä¸»è¦æ˜¯ä½¿ç”¨PLINKæºå¸¦ç”¨æˆ·ä¿¡æ¯å’ŒéªŒè¯, é“¾æ¥æœåŠ¡å™¨</span></span><br><span class="line">    <span class="comment">-- ç„¶åæ‰§è¡Œ cmds ä¸­ä¿å­˜çš„å‘½ä»¤</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="literal">nil</span>, <span class="literal">true</span>)</span><br><span class="line">    <span class="comment">-- ä¿å­˜å½“å‰ä»»åŠ¡å, ç”¨äºåˆ¤æ–­ä»»åŠ¡æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    timer.lastTask = ttaskname;</span><br><span class="line">    timer.syncTask(scfg, servercfg)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="checkTaskName"><a href="#checkTaskName" class="headerlink" title="checkTaskName"></a>checkTaskName</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ£€æŸ¥æ–‡ä»¶å</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.checkTaskName</span><span class="params">(scfg, servercfg, ttaskname)</span></span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"crontab -l"</span>)</span><br><span class="line">    <span class="keyword">local</span> dupname = <span class="literal">false</span></span><br><span class="line">    <span class="comment">-- ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°, resä¸­å­˜å‚¨äº†æ‰§è¡Œ cmds å, æœåŠ¡å™¨çš„è¾“å‡º</span></span><br><span class="line">    <span class="comment">-- ä½¿ç”¨ crontab -l æŸ¥çœ‹äº†å½“å‰å·²æœ‰çš„ä»»åŠ¡, å¦‚æœæ‰¾åˆ°äº†ä»»åŠ¡å, åˆ™è¯´æ˜ä»»åŠ¡åé‡å¤</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span></span><br><span class="line">        <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(res) <span class="keyword">do</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.<span class="built_in">find</span>(v, ttaskname)) <span class="keyword">then</span></span><br><span class="line">                dupname = <span class="literal">true</span></span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dupname</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="syncTask"><a href="#syncTask" class="headerlink" title="syncTask"></a>syncTask</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åŒæ­¥ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.syncTask</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"cd "</span>..timer.<span class="built_in">path</span>)</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"crontab "</span>..<span class="string">'./'</span>..timer.file);</span><br><span class="line">    <span class="comment">-- å…¶å®å°±æ˜¯æ‰§è¡Œ crontab [filename], è¿™é‡Œå¯ä»¥åˆä¸ºä¸€å¥çš„</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="literal">nil</span>, <span class="literal">true</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="isAddSuccess"><a href="#isAddSuccess" class="headerlink" title="isAddSuccess"></a>isAddSuccess</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ˜¯å¦å¢åŠ æˆåŠŸ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.isAddSuccess</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"cat "</span>..timer.fullName);</span><br><span class="line">    <span class="keyword">local</span> size1 = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">-- è·å–æ–‡ä»¶ä¸­çš„è¡Œæ•°</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span></span><br><span class="line">        size1 = #res</span><br><span class="line">    <span class="keyword">end</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"crontab -l"</span>);</span><br><span class="line">    <span class="keyword">local</span> size2 = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">-- è·å–å®é™… crontab ä»»åŠ¡çš„è¡Œæ•°</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span></span><br><span class="line">        size2 = #res</span><br><span class="line">    <span class="keyword">end</span>, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">-- å¦‚æœè¡Œæ•°ä¸ä¸€è‡´, é‚£ä¹ˆå°±è¯´æ˜åŠ å…¥å¤±è´¥</span></span><br><span class="line">    <span class="comment">-- åŠ å…¥å¤±è´¥ä¸€èˆ¬åªæœ‰ä¸€ç§åŸå› : æ—¶é—´æ ¼å¼é”™è¯¯</span></span><br><span class="line">    <span class="comment">-- æˆ‘ä»¬ä¹Ÿå¯ä»¥ç¼–å†™ä»£ç åœ¨æ‰§è¡ŒåŠ å…¥å‰å°±åˆ¤æ–­, ä½†æ˜¯åˆ¤æ–­æ—¶é—´çš„è¯, æ¶‰åŠåˆ°å¹³å¹´å’Œæ¶¦å¹´, è¿˜æ¶‰åŠå¤§å°æœˆ</span></span><br><span class="line">    <span class="comment">-- å¹¶ä¸”æ˜¯æœåŠ¡å™¨çš„æ—¶é—´, æ‰€ä»¥ä¹Ÿä¸èƒ½ç›´æ¥åœ¨windowsä¸Šè°ƒç”¨å‡½æ•°å¤„ç†</span></span><br><span class="line">    <span class="comment">-- è€ƒè™‘åˆ°è¿™äº›åŸå› , å°±è®©linuxå¸®æˆ‘ä»¬åšäº†è¿™ä»¶äº‹(åæ­£è¡Œæ•°ä¸ä¸€è‡´, è‚¯å®šæ˜¯å¤±è´¥äº†)</span></span><br><span class="line">    <span class="keyword">if</span> size1 ~= size2 <span class="keyword">then</span> </span><br><span class="line">        <span class="comment">-- æ·»åŠ å¤±è´¥å°±å›æ»šä¸€æ¬¡ä»»åŠ¡</span></span><br><span class="line">        timer.rollBack(scfg, servercfg)</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        inc.p(<span class="string">"æ·»åŠ å®šæ—¶ä»»åŠ¡æˆåŠŸ"</span>, <span class="number">14</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="rollBack"><a href="#rollBack" class="headerlink" title="rollBack"></a>rollBack</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- å›æ»šä¸€æ¬¡ä»»åŠ¡</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.rollBack</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="comment">-- è¿™é‡Œä½¿ç”¨äº† sed æ¥å¤„ç†, å…¶ä¸­ç”¨åˆ°äº†æˆ‘ä»¬ä¹‹å‰è®°å½•çš„ lastTask</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"sed -i "</span>..<span class="string">'/'</span>..timer.lastTask..<span class="string">"/d"</span>..</span><br><span class="line">        <span class="string">' '</span>..timer.fullName);</span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="literal">nil</span>, <span class="literal">true</span>)</span><br><span class="line">    inc.p(<span class="string">"æ—¶é—´æ ¼å¼é”™è¯¯, å·²å›æ»š"</span>, <span class="number">12</span>)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="searchTimerTask"><a href="#searchTimerTask" class="headerlink" title="searchTimerTask"></a>searchTimerTask</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢å®šæ—¶å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.searchTimerTask</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"crontab -l"</span>)</span><br><span class="line">    inc.p(<span class="string">"\nå½“å‰å·²æœ‰ä»»åŠ¡: "</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">local</span> orisrc = &#123;&#125;</span><br><span class="line">    <span class="comment">-- æŸ¥çœ‹å½“å‰å·²æœ‰çš„ä»»åŠ¡</span></span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="function"><span class="keyword">function</span> <span class="params">(res)</span></span></span><br><span class="line">        orisrc = res</span><br><span class="line">    <span class="keyword">end</span>, <span class="literal">true</span>)</span><br><span class="line">	</span><br><span class="line">    <span class="comment">-- è¿™é‡Œæ˜¯ä¸ºäº†å°†æ•°æ®æ ¼å¼åŒ–æˆæ–¹ä¾¿çœ‹æ‡‚çš„æ ¼å¼</span></span><br><span class="line">    timer.regex(orisrc, servercfg)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="regex"><a href="#regex" class="headerlink" title="regex"></a>regex</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- æ£€æµ‹è®°å½•, ç­›é€‰ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.regex</span><span class="params">(orisrc, servercfg)</span></span></span><br><span class="line">    <span class="keyword">for</span> i, v <span class="keyword">in</span> <span class="built_in">pairs</span>(orisrc) <span class="keyword">do</span></span><br><span class="line">        <span class="comment">-- è·å–ä»»åŠ¡æ—¶é—´æˆ³</span></span><br><span class="line">        <span class="keyword">local</span> taskstamp;</span><br><span class="line">        <span class="keyword">for</span> v2 <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(v, <span class="string">"%d+%s%d+%s%d+%s%d+"</span>) <span class="keyword">do</span> </span><br><span class="line">            taskstamp = v2</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- è·å–ä»»åŠ¡å</span></span><br><span class="line">        <span class="keyword">local</span> taskname;</span><br><span class="line">        <span class="keyword">for</span> v3 <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(v, <span class="string">"echo.*"</span>..timer.filenamemask..<span class="string">';'</span>) <span class="keyword">do</span> </span><br><span class="line">            v3 = <span class="built_in">string</span>.<span class="built_in">sub</span>(v3, <span class="number">6</span>, #v3 - #timer.filenamemask - <span class="number">1</span>)</span><br><span class="line">            taskname = v3 </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- è·å–æœåŠ¡å™¨å</span></span><br><span class="line">        <span class="keyword">local</span> hostname;</span><br><span class="line">        <span class="keyword">for</span> v4 <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(v, <span class="string">"CRONTAB_TASK.*;cd%s/data/server/"</span>) <span class="keyword">do</span> </span><br><span class="line">            v4 = <span class="built_in">string</span>.<span class="built_in">sub</span>(v4, <span class="number">14</span>, #v4 - <span class="number">17</span>)</span><br><span class="line">            hostname = v4 </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">-- å¦‚æœè¿™æ¡ä¿¡æ¯æ˜¯ä»»åŠ¡ä¿¡æ¯, æ ¼å¼åŒ–æ‰“å°å‡ºæ¥</span></span><br><span class="line">        <span class="keyword">if</span> (taskstamp ~= <span class="literal">nil</span> <span class="keyword">and</span> taskname ~= <span class="literal">nil</span> <span class="keyword">and</span> hostname == timer.servername) <span class="keyword">then</span></span><br><span class="line">            <span class="keyword">local</span> timetab = &#123;&#125;</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">string</span>.<span class="built_in">gmatch</span>(taskstamp, <span class="string">"%d+"</span>) <span class="keyword">do</span></span><br><span class="line">                <span class="built_in">table</span>.<span class="built_in">insert</span>(timetab, i);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">            inc.p(<span class="string">"æœåŠ¡å™¨: "</span>..hostname..<span class="string">"  ========  ä»»åŠ¡å: "</span>..taskname..</span><br><span class="line">                <span class="string">"  ========  æ—¶é—´: "</span>..</span><br><span class="line">                timetab[<span class="number">4</span>]..<span class="string">"æœˆ"</span>..timetab[<span class="number">3</span>]..<span class="string">"æ—¥"</span>..</span><br><span class="line">                timetab[<span class="number">2</span>]..<span class="string">"æ—¶"</span>..timetab[<span class="number">1</span>]..<span class="string">"åˆ†"</span>, <span class="number">14</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<h4 id="deleteTimerTask"><a href="#deleteTimerTask" class="headerlink" title="deleteTimerTask"></a>deleteTimerTask</h4><figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- åˆ é™¤å®šæ—¶å™¨</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer.deleteTimerTask</span><span class="params">(scfg, servercfg)</span></span></span><br><span class="line">    inc.p(<span class="string">"è¯·è¾“å…¥ä»»åŠ¡å(æš‚ä¸æ”¯æŒä¸­æ–‡)"</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">local</span> taskname = <span class="built_in">io</span>.<span class="built_in">stdin</span>:<span class="built_in">read</span>()</span><br><span class="line">    <span class="keyword">local</span> dir = timer.getFullPath(servercfg)</span><br><span class="line">    <span class="keyword">local</span> cmds = &#123;&#125;</span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"cd "</span>..dir)</span><br><span class="line">    <span class="keyword">local</span> ttaskname = taskname..timer.filenamemask</span><br><span class="line">    <span class="comment">-- æ‰§è¡Œä¸€æ¡ sed å‘½ä»¤, åˆ é™¤ä¸€ä¸ªä»»åŠ¡</span></span><br><span class="line">    <span class="built_in">table</span>.<span class="built_in">insert</span>(cmds, <span class="string">"sed -i "</span>..<span class="string">'/'</span>..ttaskname..<span class="string">"/d"</span>..</span><br><span class="line">        <span class="string">' '</span>..timer.fullName);</span><br><span class="line">    inc.popen_server_cmds(scfg, cmds, <span class="literal">nil</span>, <span class="literal">true</span>)</span><br><span class="line">    <span class="comment">-- åŒæ­¥ä¸€æ¬¡</span></span><br><span class="line">    timer.syncTask(scfg, servercfg)</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>


<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>é‚£ä¹ˆä»£ç å°±è¿™äº›äº†, å…¶ä¸­ä¸»è¦å°±æ˜¯ä½¿ç”¨luaç¼–å†™ç¨‹åº, é€šè¿‡PLINKä¼ é€’å‘½ä»¤è¡Œä¿¡æ¯</p>
<p>ä»¥æ­¤è¾¾åˆ°è¿œç¨‹æ§åˆ¶æœåŠ¡å™¨å®šæ—¶å™¨çš„æ•ˆæœ</p>
<p>å…¶ä¸­æœ€ä¸»è¦çš„æŠ€æœ¯æ˜¯: </p>
<p>luaè¯­è¨€åŸºç¡€, luaæ­£åˆ™è¡¨è¾¾å¼  </p>
<p>{ crontab, sed } å‘½ä»¤è¡Œ, æ•°æ®æµé‡å®šå‘  </p>
<p>(emmmmmmâ€¦ çœ‹èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆå‰å®³çš„â€¦)</p>
<p>ä»¥åŠä»&lt;é‡æ„&gt;ä¸­å­¦åˆ°çš„ä»£ç æŠ€æœ¯  </p>
<p>(ä¸€å¼€å§‹çœ‹é‡æ„è¿™æœ¬ä¹¦çš„æ—¶å€™, æœ¬æ¥å¯¹é‡Œé¢ä¸€äº›é™ä½æ•ˆç‡çš„åšæ³•ä¸å¤ªæ»¡æ„)</p>
<p>(ä½†æ˜¯çœŸçš„ä½¿ç”¨äº†ä¹‹å, å‘ç°ä»£ç çš„ç¡®å¥½å¤šäº†, æ— è®ºæ˜¯æ˜“è¯», ç¼–å†™, è°ƒè¯•, å¢åŠ /åˆ é™¤æ–¹é¢, éƒ½æœ‰æ˜æ˜¾æå‡)</p>
<p>(ä¸è¿‡å¯æƒœæ²¡æœ‰è¿ç”¨åˆ°&lt;è®¾è®¡æ¨¡å¼&gt;ä¸­çš„ä¸œè¥¿(æˆ–è®¸æˆ‘ç”¨åˆ°äº†, åªæ˜¯æ²¡æ³¨æ„åˆ°?) )</p>
]]></content>
  </entry>
  <entry>
    <title>other/firstClassValue</title>
    <url>/2020/01/09/other/firstClassValue/</url>
    <content><![CDATA[<h4 id="ç¬¬ä¸€çº§å€¼"><a href="#ç¬¬ä¸€çº§å€¼" class="headerlink" title="ç¬¬ä¸€çº§å€¼"></a>ç¬¬ä¸€çº§å€¼</h4><p>é•¿ä¹…ä»¥æ¥ä¸€ç›´ä¸å¤ªæ˜ç™½ä¹‹å‰åœ¨ lua ä¸€æœ¬ä¹¦ä¸­æåˆ°çš„ â€œç¬¬ä¸€ç±»å€¼â€   </p>
<p>ç›´åˆ°ä»Šå¤©åœ¨ä¸€æœ¬ä¹¦ä¸Šçœ‹åˆ°ç±»ä¼¼çš„è§£é‡Š:</p>
<pre><code>ä¸€èˆ¬è€Œè¨€, ç¨‹åºè®¾è®¡è¯­è¨€æ€»ä¼šå¯¹è®¡ç®—å…ƒç´ çš„å¯èƒ½ä½¿ç”¨æ–¹å¼å¼ºåŠ ä¸ŠæŸäº›é™åˆ¶  
å¸¦æœ‰æœ€å°‘é™åˆ¶çš„å…ƒç´ å…·æœ‰&quot;ç¬¬ä¸€çº§&quot;çš„çŠ¶æ€, ç¬¬ä¸€çº§å…ƒç´ çš„æŸäº›ç‰¹æƒåŒ…æ‹¬:
* å¯ä»¥ç”¨å˜é‡å‘½å
* å¯ä»¥æä¾›ç»™è¿‡ç¨‹ä½œä¸ºå‚æ•°
* å¯ä»¥ç”±è¿‡ç¨‹ä½œä¸ºç»“æœè¿”å›
* å¯ä»¥åŒ…å«åœ¨æ•°æ®ç»“æ„ä¸­</code></pre><p>ä¸Šè¿°è¯´çš„æ˜¯ç¬¬ä¸€çº§å€¼, çŒœæƒ³åº”è¯¥æ˜¯ç¬¬ä¸€ç±»å€¼æ‹¥æœ‰ç¬¬ä¸€çº§ç‰¹æƒ</p>
<h4 id="ç¬¬ä¸€ç±»å‡½æ•°"><a href="#ç¬¬ä¸€ç±»å‡½æ•°" class="headerlink" title="ç¬¬ä¸€ç±»å‡½æ•°"></a>ç¬¬ä¸€ç±»å‡½æ•°</h4><p>ä»¥ä¸‹æ‘˜è‡ª wiki å¯¹ç¬¬ä¸€ç±»å‡½æ•°(first-class function)çš„è§£é‡Š</p>
<pre><code>In computer science, a programming language is said to have first-    class functions if it treats functions as first-class citizens. This means the language supports passing functions as arguments to other functions, returning them as the values from other functions, and assigning them to variables or storing them in data structures
åœ¨è®¡ç®—æœºç§‘å­¦ä¸­, ä¸€ä¸ªç¼–ç¨‹è¯­è¨€å¦‚æœå¯¹ä»–å‡½æ•°å°±åƒç¬¬ä¸€ç±»å…¬æ°‘(??)ä¸€æ ·, é‚£ä¹ˆå°±è¯´ä»–æœ‰ç¬¬ä¸€ç±»å‡½æ•°
è¿™æ„å‘³ç€è¯­è¨€æ”¯æŒå°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°
ä»å…¶ä»–å‡½æ•°ä¸­å°†å…¶ä½œä¸ºå€¼è¿”å›
å°†å…¶å¤åˆ¶ç»™å˜é‡, æˆ–è€…ä¿å­˜åˆ°æ•°æ®ç»“æ„ä¸­</code></pre><h4 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h4><p>é¡ºä¾¿ wiki è¯´äº†ä¸€ä¸‹ä»€ä¹ˆæ˜¯é«˜é˜¶å‡½æ•°</p>
<pre><code>First-class functions are a necessity for the functional programming style, in which the use of higher-order functions is a standard practice. A simple example of a higher-ordered function is the map function, which takes, as its arguments, a function and a list, and returns the list formed by applying the function to each member of the list. For a language to support map, it must support passing a function as an argument.
ç¬¬ä¸€ç±»å‡½æ•°å¯¹äºå‡½æ•°åŒ–ç¼–ç¨‹æ˜¯å¿…è¦çš„
å…¶ä¸­ä½¿ç”¨é«˜é˜¶å‡½æ•°å°±æ˜¯ä¸€ä¸ªæ ‡å‡†çš„å®è·µ
ä¸€ä¸ªé«˜é˜¶å‡½æ•°çš„ç®€å•æ¡ˆä¾‹å°±æ˜¯mapå‡½æ•°
(...èƒ½æ„ä¼š, ä½†æ²¡æ³•ç¿»è¯‘...)
å®ƒå¿…é¡»æ”¯æŒä¼ é€’å‡½æ•°ä½œä¸ºå‚æ•°</code></pre><h4 id="lambda-æ˜¯å¦‚ä½•å·¥ä½œçš„"><a href="#lambda-æ˜¯å¦‚ä½•å·¥ä½œçš„" class="headerlink" title="lambda æ˜¯å¦‚ä½•å·¥ä½œçš„"></a>lambda æ˜¯å¦‚ä½•å·¥ä½œçš„</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int main() &#123;                                    </span><br><span class="line">    auto f &#x3D; [](int x, int y) &#123; return x + y; &#125;;</span><br><span class="line">    printf(&quot;%d\n&quot;,  f(1, 2) );                                                        </span><br><span class="line">    return 0;                                   </span><br><span class="line">&#125;                                               </span><br><span class="line">...</span><br><span class="line">_ZZ4mainENKUliiE_clEii:         </span><br><span class="line">.LFB3999:                       </span><br><span class="line">â–¹   .cfi_startproc              </span><br><span class="line">â–¹   pushqâ–¹  %rbp                </span><br><span class="line">â–¹   .cfi_def_cfa_offset 16      </span><br><span class="line">â–¹   .cfi_offset 6, -16          </span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp          </span><br><span class="line">â–¹   .cfi_def_cfa_register 6     </span><br><span class="line">â–¹   movqâ–¹   %rdi, -8(%rbp)      &#x2F;&#x2F; å”¯ä¸€çš„åŒºåˆ«åœ¨äº, å¤šä¼ äº†ä¸€ä¸ª&quot;this&quot;</span><br><span class="line">â–¹   movlâ–¹   %esi, -12(%rbp)     </span><br><span class="line">â–¹   movlâ–¹   %edx, -16(%rbp)     </span><br><span class="line">â–¹   movlâ–¹   -16(%rbp), %eax     </span><br><span class="line">â–¹   movlâ–¹   -12(%rbp), %edx     </span><br><span class="line">â–¹   addlâ–¹   %edx, %eax          </span><br><span class="line">â–¹   popqâ–¹   %rbp                </span><br><span class="line">â–¹   .cfi_def_cfa 7, 8           </span><br><span class="line">â–¹   ret                         </span><br><span class="line">...</span><br><span class="line">â–¹   subqâ–¹   $16, %rsp</span><br><span class="line">â–¹   leaqâ–¹   -1(%rbp), %rax	&#x2F;&#x2F; è¿™ä¸ª this æŒ‡å‘äº†å½“å‰æ ˆå¸§, ä½†æ˜¯è¿™é‡Œä¸ºä»€ä¹ˆè¦ -1 ?</span><br><span class="line">â–¹   movlâ–¹   $2, %edx</span><br><span class="line">â–¹   movlâ–¹   $1, %esi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi            </span><br><span class="line">â–¹   callâ–¹   _ZZ4mainENKUliiE_clEii</span><br></pre></td></tr></table></figure>

<p>åœ¨ä¸Šé¢åŸºç¡€ä¸Š, è®© lambda æ•è·å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int gi &#x3D; 11;</span><br><span class="line">int main() &#123;</span><br><span class="line">    int i &#x3D; 10;</span><br><span class="line">    auto f &#x3D; [i, gi](int x, int y) &#123; return i + gi + x + y; &#125;;</span><br><span class="line">    printf(&quot;%d\n&quot;,  f(1, 2) );</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line">...</span><br><span class="line">_ZZ4mainENKUliiE_clEii:     </span><br><span class="line">.LFB3999:                   </span><br><span class="line">â–¹   .cfi_startproc          </span><br><span class="line">â–¹   pushqâ–¹  %rbp            </span><br><span class="line">â–¹   .cfi_def_cfa_offset 16  </span><br><span class="line">â–¹   .cfi_offset 6, -16      </span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp      </span><br><span class="line">â–¹   .cfi_def_cfa_register 6 </span><br><span class="line">â–¹   movqâ–¹   %rdi, -8(%rbp)  </span><br><span class="line">â–¹   movlâ–¹   %esi, -12(%rbp) </span><br><span class="line">â–¹   movlâ–¹   %edx, -16(%rbp) </span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax  </span><br><span class="line">â–¹   movlâ–¹   (%rax), %edx    </span><br><span class="line">â–¹   movlâ–¹   gi(%rip), %eax  	&#x2F;&#x2F; @warning å³ä½¿æ˜¯æŒ‰å€¼æ•è·, å…¨å±€å˜é‡ä¹Ÿå¹¶æœªäº§ç”Ÿå¤åˆ¶</span><br><span class="line">â–¹   addlâ–¹   %eax, %edx      </span><br><span class="line">â–¹   movlâ–¹   -12(%rbp), %eax </span><br><span class="line">â–¹   addlâ–¹   %eax, %edx      </span><br><span class="line">â–¹   movlâ–¹   -16(%rbp), %eax </span><br><span class="line">â–¹   addlâ–¹   %edx, %eax      </span><br><span class="line">â–¹   popqâ–¹   %rbp            </span><br><span class="line">â–¹   .cfi_def_cfa 7, 8       </span><br><span class="line">â–¹   ret                    </span><br><span class="line">...</span><br><span class="line">â–¹   subqâ–¹   $16, %rsp             </span><br><span class="line">â–¹   movlâ–¹   $10, -4(%rbp)         </span><br><span class="line">â–¹   movlâ–¹   -4(%rbp), %eax        </span><br><span class="line">â–¹   movlâ–¹   %eax, -16(%rbp)       &#x2F;&#x2F; å¤åˆ¶äº†ä¸€ä»½ i</span><br><span class="line">â–¹   leaqâ–¹   -16(%rbp), %rax       </span><br><span class="line">â–¹   movlâ–¹   $2, %edx              </span><br><span class="line">â–¹   movlâ–¹   $1, %esi              </span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi            </span><br><span class="line">â–¹   callâ–¹   _ZZ4mainENKUliiE_clEii</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­å…³é”®ä¹‹å¤„åœ¨äºå¯¹å¾…å…¨å±€å˜é‡çš„æ–¹å¼, è¿™æœ‰å¯èƒ½äº§ç”Ÿé”™è¯¯, äº‹å®ä¹Ÿçš„ç¡®é”™äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,  f(<span class="number">1</span>, <span class="number">2</span>) );</span><br><span class="line">gi = <span class="number">100</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,  f(<span class="number">1</span>, <span class="number">2</span>) );</span><br><span class="line">...</span><br><span class="line"><span class="number">24</span></span><br><span class="line"><span class="number">113</span> <span class="comment">// gi çš„å€¼æ”¹å˜å, è¾“å‡ºç»“æœä¹Ÿéšä¹‹æ”¹å˜, è¿™ä¸åº”è¯¥æ˜¯æŒ‰å€¼æ•è·çš„ç»“æœ</span></span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆå¦‚æœæˆ‘åŠ ä¸Š mutable å»æ›´æ”¹è¿™ä¸ª gi å‘¢?</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> f = [i, gi](<span class="keyword">int</span> x, <span class="keyword">int</span> y) <span class="keyword">mutable</span> &#123; gi = <span class="number">110</span>; <span class="keyword">return</span> i + gi + x + y; &#125;;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,  gi);      </span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,  f(<span class="number">1</span>, <span class="number">2</span>) );</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>,  gi);</span><br><span class="line">...</span><br><span class="line"><span class="number">11</span></span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">110</span>	<span class="comment">// æ”¹å˜äº†! è¿™å¯æ˜¯å¾ˆé‡è¦çš„ç»†èŠ‚</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°ç»“æœ, ç¼–è¯‘å™¨(gcc 4.8.5)åªæœ‰ä¸€ä¸ªè­¦å‘Š</p>
<p>ä½†æ˜¯å¦‚æœä¸æ³¨æ„è¿™ä¸ªç»†èŠ‚, å»æ•è·å…¨å±€å˜é‡, å¯èƒ½ä¼šæœ‰å¾ˆä¸¥é‡çš„é”™è¯¯</p>
<p>æ¥ä¸‹æ¥ä¸“æ³¨ä¸€ä¸‹ç±»ç±»å‹å˜é‡, ä»–ä¼šå¦‚ä½•æ•è· (è¿™é‡Œçš„ä»£ç å°±æœ‰ç‚¹å¤´ç–¼äº†)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int main() &#123;                                   </span><br><span class="line">    vector&lt;int&gt; v &#123;1, 2, 3, 4&#125;;                </span><br><span class="line">    int i &#x3D; 10;                                </span><br><span class="line">    auto f &#x3D; [i, gi, v](int x, int y) mutable &#123;</span><br><span class="line">        v[2] &#x3D; 10; gi &#x3D; 110;Â·                  </span><br><span class="line">        return i + gi + x + y; &#125;;              </span><br><span class="line">    printf(&quot;%d\n&quot;,  gi);                       </span><br><span class="line">    printf(&quot;%d\n&quot;,  f(1, 2) );                 </span><br><span class="line">    printf(&quot;%d\n&quot;,  v[2]);                     </span><br><span class="line"></span><br><span class="line">    return 0;                                  </span><br><span class="line">&#125;                                           </span><br><span class="line">...</span><br><span class="line">main:                                                          </span><br><span class="line">.LFB3998:          </span><br><span class="line">â–¹   pushqâ–¹  %rbp                                                                       </span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp                                         </span><br><span class="line">â–¹   pushqâ–¹  %r13                                               </span><br><span class="line">â–¹   pushqâ–¹  %r12                                               </span><br><span class="line">â–¹   pushqâ–¹  %rbx                                               </span><br><span class="line">â–¹   subqâ–¹   $72, %rsp                                          </span><br><span class="line">â–¹   leaqâ–¹   -37(%rbp), %rax                                    </span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi                                         </span><br><span class="line">â–¹   callâ–¹   _ZNSaIiEC1Ev                                       </span><br><span class="line">â–¹   movlâ–¹   $._91, %r12d                                       </span><br><span class="line">â–¹   movlâ–¹   $4, %r13d           &#x2F;&#x2F; è¿™é‡Œçš„ 4 æ˜¯å‘Šè¯‰ vector, æœ‰ 4 ä¸ªå…ƒç´  (çŒœçš„)</span><br><span class="line">â–¹   leaqâ–¹   -37(%rbp), %rdi                                    </span><br><span class="line">â–¹   movqâ–¹   %r12, %rcx                                         </span><br><span class="line">â–¹   movqâ–¹   %r13, %rbx                                         </span><br><span class="line">â–¹   movqâ–¹   %r12, %rax                                         </span><br><span class="line">â–¹   movqâ–¹   %r13, %rdx                                         </span><br><span class="line">â–¹   movqâ–¹   %rcx, %rsi                                         </span><br><span class="line">â–¹   leaqâ–¹   -64(%rbp), %rax     &#x2F;&#x2F; æŒ‰ç…§ä¸Šä¸‹æ–‡ç†è§£, è¿™åº”è¯¥å°±æ˜¯ vector çš„ this æŒ‡é’ˆ   </span><br><span class="line">â–¹   movqâ–¹   %rdi, %rcx                                         </span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi                                         </span><br><span class="line">.LEHB0:                                                        </span><br><span class="line">â–¹   callâ–¹   _ZNSt6vectorIiSaIiEEC1ESt16initializer_listIiERKS0_ &#x2F;&#x2F; çœŸæ˜¯ä¸ªä¸‘é™‹çš„å°ä¸œè¥¿ &#x3D; &#x3D; </span><br><span class="line">.LEHE0:                                                        </span><br><span class="line">â–¹   leaqâ–¹   -37(%rbp), %rax                                    </span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi                                         </span><br><span class="line">â–¹   callâ–¹   _ZNSaIiED1Ev                                       </span><br><span class="line">â–¹   movlâ–¹   $10, -36(%rbp)                                     </span><br><span class="line">â–¹   movlâ–¹   -36(%rbp), %eax                                    </span><br><span class="line">â–¹   movlâ–¹   %eax, -96(%rbp)       &#x2F;&#x2F; ä¸Šé¢çš„ 10 æ˜¯è·¯æ ‡, è¿™ä¸ªåº”è¯¥å°±æ˜¯ lambda çš„ this æŒ‡é’ˆ</span><br><span class="line">â–¹   leaqâ–¹   -64(%rbp), %rax       </span><br><span class="line">â–¹   leaqâ–¹   -96(%rbp), %rdx</span><br><span class="line">â–¹   addqâ–¹   $8, %rdx                                           </span><br><span class="line">â–¹   movqâ–¹   %rax, %rsi                                         </span><br><span class="line">â–¹   movqâ–¹   %rdx, %rdi                                         </span><br><span class="line">.LEHB1:                                                        </span><br><span class="line">â–¹   callâ–¹   _ZNSt6vectorIiSaIiEEC1ERKS1_      &#x2F;&#x2F; ä¸Šé¢é‚£å¥æœ€é•¿çš„åº”è¯¥æ˜¯åˆ—è¡¨åˆå§‹åŒ–, è€Œè¿™ä¸€å¥                 								&#x2F;&#x2F; å¯èƒ½æ˜¯æ‹·è´æˆ–è€…æ„é€ ? </span><br><span class="line">.LEHE1:                               </span><br><span class="line">â–¹   movlâ–¹   gi(%rip), %eax       </span><br><span class="line">â–¹   movlâ–¹   %eax, %esi</span><br><span class="line">â–¹   movlâ–¹   $.LC0, %edi</span><br><span class="line">â–¹   movlâ–¹   $0, %eax</span><br><span class="line">.LEHB2:</span><br><span class="line">â–¹   callâ–¹   printf</span><br><span class="line">â–¹   leaqâ–¹   -96(%rbp), %rax</span><br><span class="line">â–¹   movlâ–¹   $2, %edx</span><br><span class="line">â–¹   movlâ–¹   $1, %esi</span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZZ4mainENUliiE_clEii</span><br><span class="line">...</span><br><span class="line">_ZZ4mainENUliiE_clEii:              </span><br><span class="line">.LFB4000:                           </span><br><span class="line">â–¹   .cfi_startproc                  </span><br><span class="line">â–¹   pushqâ–¹  %rbp                    </span><br><span class="line">â–¹   .cfi_def_cfa_offset 16          </span><br><span class="line">â–¹   .cfi_offset 6, -16              </span><br><span class="line">â–¹   movqâ–¹   %rsp, %rbp              </span><br><span class="line">â–¹   .cfi_def_cfa_register 6         </span><br><span class="line">â–¹   subqâ–¹   $16, %rsp               </span><br><span class="line">â–¹   movqâ–¹   %rdi, -8(%rbp)        &#x2F;&#x2F; this æŒ‡é’ˆ  </span><br><span class="line">â–¹   movlâ–¹   %esi, -12(%rbp)         </span><br><span class="line">â–¹   movlâ–¹   %edx, -16(%rbp)         </span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax          </span><br><span class="line">â–¹   addqâ–¹   $8, %rax                </span><br><span class="line">â–¹   movlâ–¹   $2, %esi                </span><br><span class="line">â–¹   movqâ–¹   %rax, %rdi</span><br><span class="line">â–¹   callâ–¹   _ZNSt6vectorIiSaIiEEixEm</span><br><span class="line">â–¹   movlâ–¹   $10, (%rax)             &#x2F;&#x2F; èµ‹å€¼</span><br><span class="line">â–¹   movlâ–¹   $110, gi(%rip)</span><br><span class="line">â–¹   movqâ–¹   -8(%rbp), %rax</span><br><span class="line">â–¹   movlâ–¹   (%rax), %edx</span><br><span class="line">â–¹   movlâ–¹   gi(%rip), %eax</span><br><span class="line">â–¹   addlâ–¹   %eax, %edx</span><br><span class="line">â–¹   movlâ–¹   -12(%rbp), %eax</span><br><span class="line">â–¹   addlâ–¹   %eax, %edx</span><br><span class="line">â–¹   movlâ–¹   -16(%rbp), %eax</span><br><span class="line">â–¹   addlâ–¹   %edx, %eax</span><br><span class="line">â–¹   leave</span><br><span class="line">â–¹   .cfi_def_cfa 7, 8</span><br><span class="line">â–¹   ret</span><br></pre></td></tr></table></figure>
<p>å€¼æ‹·è´ç±»çš„æ—¶å€™, ä¼šå°†æ•´ä¸ªç±»æ‹·è´ä¸€æ¬¡, å¹¶æ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„</p>
<p><strong>åŒ¿åå‡½æ•°ä¸å…¶è¯´æ˜¯å‡½æ•°, ä¸å¦‚è¯´æ˜¯ç±»</strong> ä»–å°±åƒä¸€ä¸ªé‡è½½äº†è°ƒç”¨è¿ç®—ç¬¦çš„ç±»ä¸€æ ·</p>
]]></content>
  </entry>
  <entry>
    <title>other/float</title>
    <url>/2020/01/09/other/float/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>åœ¨çœ‹åˆ°&lt;æ·±å…¥ç†è§£è®¡ç®—æœºç³»ç»Ÿ&gt;çš„æµ®ç‚¹æ•°æ—¶, ç¬¬ä¸€æƒ³æ³•æ˜¯:</p>
<ul>
<li>æ— æ³•ç²¾ç¡®ä¿å­˜å¤§å¤šæ•°æµ®ç‚¹æ•°</li>
<li>ç²¾åº¦ä¸Šçš„ç¼ºå¤±</li>
</ul>
<h3 id="é›¶å€¼çš„æ¯”è¾ƒ"><a href="#é›¶å€¼çš„æ¯”è¾ƒ" class="headerlink" title="é›¶å€¼çš„æ¯”è¾ƒ"></a>é›¶å€¼çš„æ¯”è¾ƒ</h3><p>å¾ˆå¤šé¢è¯•é¢˜éƒ½ä¼šè€ƒä¸€é“æµ®ç‚¹æ•°é›¶å€¼æ¯”è¾ƒçš„é¢˜(ä¸€èˆ¬æ˜¯å•ç²¾åº¦, åŒç²¾åº¦å¤ªé•¿äº†)</p>
<p>æˆ‘è§‰å¾—ç­”æ¡ˆåº”è¯¥æ˜¯:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">f &gt; <span class="number">-0.000001f</span> &amp;&amp; f &lt; <span class="number">0.000001f</span></span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªé¢˜çš„æ ¸å¿ƒåœ¨äº float ä»€ä¹ˆæ—¶å€™ç¼ºå¤±ç²¾åº¦</p>
<p>è¿™é‡Œæˆ‘æ²¡æœ‰ä½¿ç”¨ç­‰äº, å› ä¸ºæˆ‘è®¤ä¸º 0.000001f å’Œ -0.000001f å¹¶ä¸ç®—ç¼ºå¤±äº†ç²¾åº¦ </p>
<p>(ç™¾åº¦ä¸Šçš„ç­”æ¡ˆæ˜¯æœ‰ç­‰äºçš„, æˆ‘å¾ˆæ€€ç–‘è¿™ä¸ªç­”æ¡ˆ, ç”šè‡³æœ‰äººè¿˜ç”¨çš„æ˜¯ 0.00001 (ëˆˆ_ëˆˆ) )</p>
<p>(è€Œgoogleä¸Šæˆ‘å¥½åƒæ²¡æœ‰æ‰¾åˆ°ç±»ä¼¼çš„ç­”æ¡ˆ, å†æ ¹æ®ç¼–è¯‘å™¨ç»™æˆ‘çš„ç»“æœ, æˆ‘åªèƒ½å¦‚æ­¤æ¨æ–­)</p>
<p>ä¸‹é¢æ˜¯æˆ‘æ¨æ–­çš„ä¾æ®:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, <span class="number">0.000001f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, <span class="number">0.0000006f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, <span class="number">0.0000005f</span>);</span><br></pre></td></tr></table></figure>
<p>ä½ è§‰å¾—ä¸Šé¢ä¼šæ‰“å°ä»€ä¹ˆå‘¢?  è¾“å‡ºç»“æœæ˜¯:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">0.000001</span></span><br><span class="line"><span class="number">0.000001</span></span><br><span class="line"><span class="number">0.000000</span></span><br></pre></td></tr></table></figure>
<p>è¿™ä¹Ÿå°±æ˜¯æˆ‘è®¤ä¸º 0.000001 å®ƒå¹¶æœªæŸå¤±ç²¾åº¦çš„åŸå› , æ—¢ç„¶æœªæŸå¤±, é‚£ä¹ˆå°±ä¸èƒ½å½“åš 0 å€¼æ¥å¯¹å¾…</p>
<p>(å†æ¬¡çœ‹ä¸èµ·ç™¾åº¦ä¸Šçš„è§£ç­”(ëˆˆ_ëˆˆ), ä¸è¿‡â€¦ ä¸‡ä¸€æ˜¯casé”™äº†å‘¢?)</p>
<p>(æŸå¤±ç²¾åº¦è¿˜æœ‰æ›´ç²¾ç¡®çš„ 0.00000055f, è¿™ä¸ªæ•°å­—ä¹Ÿè¢«è®¤ä¸ºæ˜¯ 0.000001)</p>
<h3 id="æ•°å­—çš„ç²¾åº¦å–å†³äºæœ‰å¤šå°‘ä½è¡¨ç¤º"><a href="#æ•°å­—çš„ç²¾åº¦å–å†³äºæœ‰å¤šå°‘ä½è¡¨ç¤º" class="headerlink" title="æ•°å­—çš„ç²¾åº¦å–å†³äºæœ‰å¤šå°‘ä½è¡¨ç¤º"></a>æ•°å­—çš„ç²¾åº¦å–å†³äºæœ‰å¤šå°‘ä½è¡¨ç¤º</h3><p>ä¸Šé¢çœ‹åˆ°äº†6ä¸ºç²¾åº¦çš„æƒ…å†µ, ä»–å‡†ç¡®è¡¨ç¤ºäº†0.1 (è™½ç„¶å®ƒæŠŠ 0.0000006f å½“åšäº†0.1â€¦)</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹å…¶ä»–çš„ç»“æœ, æ¯”å¦‚:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, <span class="number">255.1f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200001f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200002f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200003f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200004f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200005f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200006f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200007f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200008f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.200009f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199999f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199998f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199997f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199996f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199995f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199994f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199993f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199992f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199991f</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, <span class="number">254.2f</span> == <span class="number">254.199990f</span>);</span><br></pre></td></tr></table></figure>
<p>ä½ è§‰å¾—è¿™æ¬¡åˆä¼šè¾“å‡ºä»€ä¹ˆå‘¢?</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">255.100006</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>(è¾“å‡ºç»“æœæˆ‘åšäº†ç¼©å‡, ä¸ç„¶å¤ªé•¿äº†)</p>
<p>ä¹Ÿå°±æ˜¯è¯´, é™¤äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">254.200005f</span></span><br><span class="line"><span class="number">254.200006f</span></span><br><span class="line"><span class="number">254.200007f</span></span><br><span class="line"><span class="number">254.200008f</span></span><br><span class="line"><span class="number">254.200009f</span></span><br></pre></td></tr></table></figure>
<p>ä¹‹å¤–, ç¼–è¯‘å™¨è®¤ä¸ºå®ƒä»¬éƒ½æ˜¯ç›¸ç­‰çš„, ä¸ºä»€ä¹ˆå‘¢?</p>
<p>ç²¾åº¦å†æ¬¡ç¼ºå¤±(æˆ‘åªèƒ½å¦‚æ­¤çŒœæµ‹), å› ä¸ºæ•´æ•°çš„æ•°å­—è¿‡å¤§, å‰©ä¸‹çš„ç•™ç»™å°æ•°çš„ä½æ•°ä¸è¶³ä»¥è¾¾åˆ°6ä½ç²¾åº¦  </p>
<p>æ‰€ä»¥è¿™æ¬¡çš„ç²¾åº¦ç¼©å‡åˆ°äº†5ä½, è€Œå› ä¸ºå››èˆäº”å…¥(æˆ‘åªèƒ½å†æ¬¡å¦‚æ­¤çŒœæµ‹ (ëˆˆ_ëˆˆ))çš„å…³ç³»</p>
<p>(å…¶å®è¯´å››èˆäº”å…¥æœ‰ç‚¹ä¸å¯¹, åº”è¯¥æ˜¯: æ•°å­—çš„äºŒè¿›åˆ¶è¡¨ç¤ºåˆšå¥½è¿›å…¥äº†æœ‰æ•ˆçš„åŒºé—´)</p>
<p>ä¸€äº›èƒ½è¾¾åˆ° 254.20001 çš„æ•°å­—è¢«åˆ¤æ®µä¸ºä¸ç­‰, è€Œä¸€äº› 254.19999 çš„æ•°å­—åˆå¯å››èˆäº”å…¥çš„å…³ç³»è¢«åˆ¤æ–­ä¸ºç›¸ç­‰  </p>
<p>æ‰€ä»¥, æ•´æ•°æ•°å­—çš„å¤§å°ä¼šå½±å“å°æ•°çš„ç²¾åº¦ (æˆ‘æ„Ÿè§‰æˆ‘åœ¨è¯´åºŸè¯ (ëˆˆ_ëˆˆ)), è€Œå½“æ•´æ•°è¿‡å¤§æ—¶, æ¯”å¦‚ 0x7fffffffff </p>
<p>æ‰€æœ‰çš„å°æ•°ç²¾åº¦å…¨éƒ½ä¼šç¼ºå¤±(unsigned float å¯èƒ½æ˜¯ä¾‹å¤–, ä¸è¿‡ä¸å½±å“ç»“è®º)</p>
<p>ä¸‹é¢æˆ‘åˆåšäº†ä¸€æ¬¡æ¯”è¾ƒ, æˆ‘å°†254æ¢æˆäº†126, è¾“å‡ºç»“æœæ˜¯</p>
<pre><code>0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 0 0 0</code></pre><p>emmmâ€¦ å…¶å®è¿™æ¬¡çš„æœ‰æ•ˆç²¾åº¦è¿˜æ˜¯æ¥è¿‘5ä½</p>
<p>ä¸è¿‡èƒ½å¤Ÿåœ¨5ä½ä¹‹å¤–, èƒ½åˆ¤æ–­æ›´å¤šçš„æ•°å­—äº†</p>
<p>(è¿™ä¸ªæ•°å­—å¹¶æœªå®Œå…¨è¾¾åˆ°6ä½, ä¹Ÿè®¸ 0.000005 èƒ½åˆ¤æ–­åˆ°, 0.000004 å´ä¸èƒ½, å°±åƒä¸Šé¢é‚£æ ·) </p>
<h3 id="åº•å±‚åˆ°åº•å¯¹æˆ‘ä»¬çš„ä»£ç åšäº†ä»€ä¹ˆ"><a href="#åº•å±‚åˆ°åº•å¯¹æˆ‘ä»¬çš„ä»£ç åšäº†ä»€ä¹ˆ" class="headerlink" title="åº•å±‚åˆ°åº•å¯¹æˆ‘ä»¬çš„ä»£ç åšäº†ä»€ä¹ˆ"></a>åº•å±‚åˆ°åº•å¯¹æˆ‘ä»¬çš„ä»£ç åšäº†ä»€ä¹ˆ</h3><p>åˆåˆ°äº†å–œé—»ä¹è§çš„çœ‹æ±‡ç¼–ç¯èŠ‚ â”‘(ï¿£Ğ” ï¿£)â”</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">float</span> f = <span class="number">0.1f</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, f);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, f * <span class="number">2</span>);</span><br><span class="line"><span class="keyword">float</span> f2 = <span class="number">0x7fff</span> + <span class="number">0.1f</span>;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, f2);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, f2 * <span class="number">2</span>);</span><br></pre></td></tr></table></figure>
<p>å®ƒåœ¨æ±‡ç¼–ä¸­çš„æ ·å­:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.cfi_startproc</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    .cfi_def_cfa_offset 16</span><br><span class="line">    .cfi_offset 6, -16</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .cfi_def_cfa_register 6</span><br><span class="line">    subq    $16, %rsp			&#x2F;&#x2F; ä¾æ—§æ˜¯å¼€è¾Ÿäº†16ä¸ªç›´æ¥çš„æ ˆå¸§, ä¸ºä»€ä¹ˆä¸æ˜¯8(æˆ‘æœ‰ä¸¤ä¸ªfloat)?</span><br><span class="line">    movl    .LC0(%rip), %eax	&#x2F;&#x2F; .long   1036831949</span><br><span class="line">    movl    %eax, -4(%rbp)		&#x2F;&#x2F; å°†å˜é‡æ”¾åˆ°äº†æ ˆä¸­</span><br><span class="line">    movss   -4(%rbp), %xmm0		&#x2F;&#x2F; æ”¾åˆ°äº†æµ®ç‚¹æ•°å¯„å­˜å™¨ä¸­</span><br><span class="line">    cvtps2pd        %xmm0, %xmm0	&#x2F;&#x2F; emmm... PS2PD Single-Precision Double-Precision</span><br><span class="line">    						&#x2F;&#x2F; å®ƒå°†ä¸¤ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°è½¬åŒ–æˆäº†åŒç²¾åº¦, è¿™å¯ä¸åœ¨æˆ‘çš„é¢„æ–™ä¹‹ä¸­ âˆ‘(ï¿£â–¡ï¿£;)</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $1, %eax</span><br><span class="line">    call    printf</span><br><span class="line">    movss   -4(%rbp), %xmm0</span><br><span class="line">    addss   %xmm0, %xmm0</span><br><span class="line">    unpcklps        %xmm0, %xmm0</span><br><span class="line">    cvtps2pd        %xmm0, %xmm0</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $1, %eax</span><br><span class="line">    call    printf</span><br><span class="line">    movl    .LC2(%rip), %eax	&#x2F;&#x2F; .long   1191181875</span><br><span class="line">    movl    %eax, -8(%rbp)</span><br><span class="line">    movss   -8(%rbp), %xmm0</span><br><span class="line">    cvtps2pd        %xmm0, %xmm0</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $1, %eax</span><br><span class="line">    call    printf</span><br><span class="line">    movss   -8(%rbp), %xmm0</span><br><span class="line">    addss   %xmm0, %xmm0</span><br><span class="line">    unpcklps        %xmm0, %xmm0</span><br><span class="line">    cvtps2pd        %xmm0, %xmm0</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $1, %eax</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    leave</span><br><span class="line">    .cfi_def_cfa 7, 8</span><br><span class="line">    ret</span><br><span class="line">    .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>å…³é”®ç‚¹åœ¨äº .LC1 å’Œ .LC2, ä»–ä»¬çš„æ•°å­—, ä¸è¿‡ä¸€ç‚¹æ•°å­—çœ‹ä¸å‡ºä»€ä¹ˆ, éœ€è¦å¤šä¸€äº›æ•°æ®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">1036831949</span> = <span class="number">0.1f</span>	= <span class="number">3</span>dcccccd</span><br><span class="line"><span class="number">1045220557</span> = <span class="number">0.2f</span> 	= <span class="number">3e4</span>ccccd</span><br><span class="line"><span class="number">1038174126</span> = <span class="number">0.11f</span>	= <span class="number">3</span>de147ae</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­ 0.1f å’Œ 0.2f ç›¸å·® 800000</p>
<p>0.1f å’Œ 0.11f ç›¸å·® 147ae1</p>
<p>emmmmâ€¦ æƒ³ä¸å‡ºæ¥, æˆ–è®¸æˆ‘è¯¥å†çœ‹çœ‹ä¹¦</p>
<p>å—¯ å¥½çš„, çœ‹å®Œäº† (ï¿£Ë‡ï¿£)</p>
<p>å¤§æ¦‚æ˜¯è¿™æ ·çš„, æ ¹æ®ä¸åŒçš„ä½æ•°å®‰æ’, è®¡ç®—çš„ç»“æœä¹Ÿæœ‰ç›¸åº”çš„ä¸åŒ</p>
<p>ä¸€ä¸ªæµ®ç‚¹æ•°, 1ä½ç¬¦å·ä½S, 8ä½é˜¶ç E, 23ä½å°æ•°ä½M  </p>
<p>å…¶ä¸­åˆåˆ†ä¸º4ç§æƒ…å†µ: è§„æ ¼, éè§„æ ¼, NaN(not a number?), æ— ç©·å¤§</p>
<p>(å…·ä½“çš„ç»†èŠ‚è¯·å‚è€ƒä¹¦ä¸­çš„ä»‹ç»)</p>
<p>æ€»ä¹‹, æˆ‘ä»¬ç”¨ä¹¦ä¸­çš„ç®—æ³•æ¥æ£€éªŒä¸€ä¸‹è¿™å‡ ä¸ªæ•°å­—</p>
<p>é¦–å…ˆ 0.1f, å®ƒçš„æ•°å­—æ˜¯ 3dcccccd, å®ƒæ˜¯ä¸€ä¸ªè§„æ ¼åŒ–æ•°å­—</p>
<p>E = 123 - 127 = -4 , M = 5033165 / 8388735 +ï¼‘</p>
<p>2çš„Eæ¬¡æ–¹ x M = 0.0999994337644472 </p>
<p>emmmâ€¦ æ²¡é”™, è¿™æ˜¯ä¸€ä¸ªéå¸¸æ¥è¿‘ 0.1 çš„æ•°å­—</p>
<p>(ä¹¦ä¸­è¯´åˆ°äº†å°æ•°çš„èˆå…¥, ç®€å•æ¥è¯´æ˜¯å››èˆäº”å…¥, åŒæ—¶å‘å¶æ•°èˆå…¥, æ¯”å¦‚ 1.245 å®ƒä¼šå‘ 1.24 èˆå…¥)</p>
<p>(å†æ¬¡å¾ˆå¥½å¥‡ä¸€äº›éœ€è¦æå…¶ç²¾ç¡®çš„å°æ•°è¿ç®—æ˜¯å¦‚ä½•åšåˆ°çš„ ï¼ˆãƒ¼_ãƒ¼ï¼Ÿï¼‰)</p>
<p>(åƒå­˜å‚¨é‡‘é¢è¿™æ ·çš„å°æ•°ç²¾åº¦, ç‰¹åˆ«æ˜¯é“¶è¡Œ, æŸå¤±ä¸€ä¸ªç²¾åº¦éƒ½å¾ˆä¸¥é‡å•Š)</p>
<p><strong>è§„æ ¼åŒ–ç”¨äºè¡¨ç¤ºä¸€äº›æ¯”è¾ƒå¤§çš„æ•°å­—, è€Œéè§„æ ¼åŒ–ç”¨äºè¡¨ç¤ºä¸€äº›ç›¸å¯¹è¾ƒå°çš„æ•°å­—</strong></p>
<p>è¿™é‡Œé¡ºä¾¿å†çœ‹ä¸€ä¸‹å¤±å»ç²¾åº¦çš„ç»“æœ, çœ‹çœ‹ä»–æ˜¯æ€ä¹ˆè®¡ç®—çš„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%f\n"</span>, <span class="number">255.1f</span>);</span><br></pre></td></tr></table></figure>

<p>å¥‡æ€ªçš„æ˜¯, å®ƒæœ‰ä¸¤ä¸ªæ•°å­—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">111 .LC0:</span><br><span class="line">112     .long   1073741824</span><br><span class="line">113     .long   1081074483</span><br></pre></td></tr></table></figure>

<p>å¯æƒœè®¡ç®—ä¸å‡ºæ¥, è¿™ç§æ ¼å¼æ˜¯æ— ç©·å¤§(ä¸å¤ªæ˜ç™½ (ëˆˆ_ëˆˆ))  </p>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>ç®€å•æ¥è¯´, å…¶å®ä¹Ÿæ²¡æœ‰åšç¬”è®°çš„å¿…è¦  â”‘(ï¿£Ğ” ï¿£)â”, ä¹¦ä¸Šå·²ç»ç»™äº†ä½ ç­”æ¡ˆ</p>
<p>ä¸è¿‡è¿˜å¥½, æ²‰æµ¸åœ¨æ€è€ƒçš„æµ·æ´‹ä¸­æŒºä¸é”™çš„(å…¶å®éƒ½å¿«è¢«æ·¹æ­»äº† (ëˆˆ_ëˆˆ))</p>
<p>æœ€å, <strong>è‹¥æ— å¿…è¦, æˆ–è€…éå¸¸ç¡®ä¿¡æµ®ç‚¹æ•°çš„èŒƒå›´, å¦åˆ™ä¸è¦ä½¿ç”¨å•ç²¾åº¦æµ®ç‚¹æ•°</strong></p>
<p>å¦‚ä½ æ‰€è§, å•ç²¾åº¦æµ®ç‚¹æ•°çš„èŒƒå›´å¾ˆå°, ä¸€ä¸å°å¿ƒè¿˜è¦å¤±å»ç²¾åº¦</p>
<p>(è¿™å¯èƒ½ä¹Ÿæ˜¯é»˜è®¤å°æ•°æ˜¯åŒç²¾åº¦çš„åŸå› )</p>
]]></content>
  </entry>
  <entry>
    <title>other/headFirstGoAssembly</title>
    <url>/2020/01/09/other/headFirstGoAssembly/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>ä¸‹ç­å¿˜æŠŠæ²¡è¯»å®Œçš„ inside the c++ object model å¸¦å›å»</p>
<p>è¿˜å¥½åŒ…é‡Œæœ‰æœ¬å¤‡ç”¨çš„ go, ç®€å•çœ‹äº†ä¸€ä¸‹å‰é¢åŸºç¡€éƒ¨åˆ†</p>
<p>æ„Ÿè§‰å°±æ˜¯, å¾ˆâ€æ–°é¢– + è½»å·§â€, æœ‰å¾ˆå¤šæ–°çš„æ¦‚å¿µå’Œå·¥å…·, æŠ›å¼ƒäº†ä¸€äº›æ²‰é‡çš„â€åŒ…è¢±â€</p>
<p>è¯•äº†ä¸€ä¸‹ç”¨ä¾‹, çœ‹äº†ä¸€ä¸‹æ±‡ç¼–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1 package main</span><br><span class="line">2 </span><br><span class="line">3 import &quot;fmt&quot;</span><br><span class="line">4     </span><br><span class="line">5 func main() &#123;</span><br><span class="line">6     fmt.Printf(&quot;hello, world\n&quot;)</span><br><span class="line">7 &#125;</span><br></pre></td></tr></table></figure>

<p>æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> 1 # command-line-arguments                                                                 </span><br><span class="line"> 2 &quot;&quot;.main STEXT size&#x3D;88 args&#x3D;0x0 locals&#x3D;0x48                                               </span><br><span class="line"> 3     0x0000 00000 (&#x2F;test&#x2F;go&#x2F;t.go:5)  TEXT    &quot;&quot;.main(SB), $72-0                           				&#x2F;&#x2F; éå¸¸å‹å¥½åœ°ç»™æˆ‘åŠ ä¸Šäº†å¯¹åº”çš„æºç ä¿¡æ¯</span><br><span class="line"> 4     0x0000 00000 (&#x2F;test&#x2F;go&#x2F;t.go:5)  MOVQ    (TLS), CX                                    </span><br><span class="line"> 5     0x0009 00009 (&#x2F;test&#x2F;go&#x2F;t.go:5)  CMPQ    SP, 16(CX)                                   </span><br><span class="line"> 6     0x000d 00013 (&#x2F;test&#x2F;go&#x2F;t.go:5)  JLS 81                                               </span><br><span class="line"> 7     0x000f 00015 (&#x2F;test&#x2F;go&#x2F;t.go:5)  SUBQ    $72, SP	&#x2F;&#x2F; è¿™é‡Œåº”è¯¥æ˜¯åœ¨å¼€è¾Ÿæ ˆå¸§                                     </span><br><span class="line"> 8     0x0013 00019 (&#x2F;test&#x2F;go&#x2F;t.go:5)  MOVQ    BP, 64(SP)	&#x2F;&#x2F; æ ˆé¡¶ä¿å­˜äº† bp æŒ‡é’ˆ                                   </span><br><span class="line"> 9     0x0018 00024 (&#x2F;test&#x2F;go&#x2F;t.go:5)  LEAQ    64(SP), BP  &#x2F;&#x2F; é‡ç½® bp                                 </span><br><span class="line">10     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:5)  FUNCDATA    $0, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)	&#x2F;&#x2F; gc ? garbage collection?</span><br><span class="line">11     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:5)  FUNCDATA    $1, gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb(SB)</span><br><span class="line">12     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:5)  FUNCDATA    $3, gclocalsÂ·9fb7f0986f647f17cb53dda1484e0f7a(SB)	&#x2F;&#x2F; çœ‹ä¸æ‡‚ &#x3D; &#x3D;</span><br><span class="line">13     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:6)  PCDATA  $2, $1                                       </span><br><span class="line">14     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:6)  PCDATA  $0, $0	&#x2F;&#x2F; è¿˜æ˜¯çœ‹ä¸æ‡‚ &#x3D; &#x3D;</span><br><span class="line">15     0x001d 00029 (&#x2F;test&#x2F;go&#x2F;t.go:6)  LEAQ    go.string.&quot;hello, world\n&quot;(SB), AX           						&#x2F;&#x2F; åŠ è½½å­—ç¬¦ä¸²æ–‡æœ¬, è€…å¾ˆæ–¹ä¾¿, æˆ‘ç›´æ¥å¯ä»¥çœ‹åˆ°å­—ç¬¦ä¸²</span><br><span class="line">16     0x0024 00036 (&#x2F;test&#x2F;go&#x2F;t.go:6)  PCDATA  $2, $0                                       </span><br><span class="line">17     0x0024 00036 (&#x2F;test&#x2F;go&#x2F;t.go:6)  MOVQ    AX, (SP)                                     </span><br><span class="line">18     0x0028 00040 (&#x2F;test&#x2F;go&#x2F;t.go:6)  MOVQ    $13, 8(SP)	&#x2F;&#x2F; åº”è¯¥æ˜¯æŒ‡å­—ç¬¦ä¸²é•¿åº¦</span><br><span class="line">19     0x0031 00049 (&#x2F;test&#x2F;go&#x2F;t.go:6)  MOVQ    $0, 16(SP)  &#x2F;&#x2F; åç»­å‚æ•°æ•°é‡?                                 </span><br><span class="line">20     0x003a 00058 (&#x2F;test&#x2F;go&#x2F;t.go:6)  XORPS   X0, X0	&#x2F;&#x2F; å•ç²¾åº¦å¼‚æˆ–?</span><br><span class="line">21     0x003d 00061 (&#x2F;test&#x2F;go&#x2F;t.go:6)  MOVUPS  X0, 24(SP)                                   						&#x2F;&#x2F; ä»£ç ä¸­æ²¡æœ‰ç”¨åˆ°å•ç²¾åº¦æµ®ç‚¹æ•°, ä¸ºä»€ä¹ˆä¼šæœ‰è¿™ä¸ªæŒ‡ä»¤?</span><br><span class="line">22     0x0042 00066 (&#x2F;test&#x2F;go&#x2F;t.go:6)  CALL    fmt.Printf(SB) &#x2F;&#x2F; è°ƒç”¨                              					&#x2F;&#x2F; è¿™æ ·çš„æ ¼å¼å¾ˆæ¸…æ™°</span><br><span class="line">23     0x0047 00071 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    64(SP), BP  &#x2F;&#x2F; è¿”è¿˜ bp                                 </span><br><span class="line">24     0x004c 00076 (&#x2F;test&#x2F;go&#x2F;t.go:7)  ADDQ    $72, SP	&#x2F;&#x2F; é‡ç½®æ ˆé¡¶</span><br><span class="line">25     0x0050 00080 (&#x2F;test&#x2F;go&#x2F;t.go:7)  RET	&#x2F;&#x2F; ç»“æŸ</span><br><span class="line">26     0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:7)  NOP</span><br><span class="line">27     0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:5)  PCDATA  $0, $-1                                      </span><br><span class="line">28     0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:5)  PCDATA  $2, $-1                                      </span><br><span class="line">29     0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:5)  CALL    runtime.morestack_noctxt(SB)                 								&#x2F;&#x2F; è¿è¡Œæ—¶çš„ä»€ä¹ˆ?</span><br><span class="line">30     0x0056 00086 (&#x2F;test&#x2F;go&#x2F;t.go:5)  JMP 0</span><br></pre></td></tr></table></figure>

<p>FUNCDATA æˆ‘æ€€ç–‘å’Œåƒåœ¾å›æ”¶æœ‰å…³, PCDATA æ„ä¹‰ä¸æ˜ (ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹, éƒ½å’Œåƒåœ¾å›æ”¶æœ‰å…³)</p>
<p>æˆ‘å°è¯•è¿‡æ·»åŠ ä¸€ä¸ªå‚æ•°, ä»¥ç”¨ä½œ fmt.Println(), ä½†æ˜¯æˆ‘å¹¶æœªåœ¨ä»£ç ä¸­æ‰¾åˆ°ä»»ä½•æœ‰å…³å‚æ•°çš„ä¿¡æ¯</p>
<p>ä»…ä»…åªæœ‰ä¸€å¥çœ‹èµ·æ¥å’Œé‚£ä¸ªå‚æ•°æœ‰å…³</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">LEAQ    &quot;&quot;..autotmp_0+64(SP), AX	&#x2F;&#x2F; å°±æ˜¯è¿™å¥è¯</span><br><span class="line">PCDATA  $2, $0                  </span><br><span class="line">MOVQ    AX, 16(SP)</span><br></pre></td></tr></table></figure>
<p>è€Œä¸”æˆ‘å·®ç‚¹å¿½ç•¥çš„ä¸€ç‚¹æ˜¯, è¿™é‡Œå‚æ•°çš„ä¼ é€’æ˜¯ç”¨æ ˆ</p>
<p>é¡ºä¾¿, æˆ‘åœ¨æ–‡ä»¶çš„æœ«å°¾æ‰¾åˆ°äº†è¿™äº›ä¿¡æ¯, çœ‹èµ·æ¥åƒæ˜¯æŸç§æ ‡è®°</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">213 gclocalsÂ·69c1753bd5f81501d95132d08af04464 SRODATA dupok size&#x3D;8        </span><br><span class="line">214     0x0000 02 00 00 00 00 00 00 00                          ........  </span><br><span class="line">215 gclocalsÂ·568470801006e5c0dc3947ea998fe279 SRODATA dupok size&#x3D;10       </span><br><span class="line">216     0x0000 02 00 00 00 02 00 00 00 00 02                    ..........</span><br><span class="line">217 gclocalsÂ·9fb7f0986f647f17cb53dda1484e0f7a SRODATA dupok size&#x3D;10       </span><br><span class="line">218     0x0000 02 00 00 00 01 00 00 00 00 01                    ..........</span><br><span class="line">219 gclocalsÂ·33cdeccccebe80329f1fdbee7f5874cb SRODATA dupok size&#x3D;8        </span><br><span class="line">220     0x0000 01 00 00 00 00 00 00 00                          ........</span><br></pre></td></tr></table></figure>

<p>æˆ‘å†æ¬¡ä½¿ç”¨äº†å˜é‡å­˜å‚¨å€¼çš„å½¢å¼, ç„¶åæˆ‘çš„æ•°å­—èƒ½å¤Ÿæ­£å¸¸çœ‹è§äº†:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">0x0034 00052 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    $100, 8(SP)	&#x2F;&#x2F; æˆ‘çš„æ•°å­—åœ¨è¿™é‡Œ</span><br><span class="line">0x003d 00061 (&#x2F;test&#x2F;go&#x2F;t.go:7)  CALL    runtime.convT2E64(SB)</span><br><span class="line">0x0042 00066 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    16(SP), AX</span><br><span class="line">0x0047 00071 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $2</span><br><span class="line">0x0047 00071 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    24(SP), CX</span><br><span class="line">0x004c 00076 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    AX, &quot;&quot;..autotmp_1+64(SP)</span><br><span class="line">0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $0</span><br><span class="line">0x0051 00081 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    CX, &quot;&quot;..autotmp_1+72(SP)</span><br><span class="line">0x0056 00086 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $1</span><br><span class="line">0x0056 00086 (&#x2F;test&#x2F;go&#x2F;t.go:7)  LEAQ    go.string.&quot;hello, world\n%d&quot;(SB), AX</span><br><span class="line">0x005d 00093 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $0</span><br><span class="line">0x005d 00093 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    AX, (SP)</span><br><span class="line">0x0061 00097 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    $15, 8(SP)</span><br><span class="line">0x006a 00106 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $1</span><br><span class="line">0x006a 00106 (&#x2F;test&#x2F;go&#x2F;t.go:7)  LEAQ    &quot;&quot;..autotmp_1+64(SP), AX</span><br><span class="line">0x006f 00111 (&#x2F;test&#x2F;go&#x2F;t.go:7)  PCDATA  $2, $0</span><br><span class="line">0x006f 00111 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    AX, 16(SP)</span><br><span class="line">0x0074 00116 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    $1, 24(SP)</span><br><span class="line">0x007d 00125 (&#x2F;test&#x2F;go&#x2F;t.go:7)  MOVQ    $1, 32(SP)</span><br><span class="line">0x0086 00134 (&#x2F;test&#x2F;go&#x2F;t.go:7)  CALL    fmt.Printf(SB)	</span><br><span class="line">						&#x2F;&#x2F; ä½†æ˜¯åœ¨è°ƒç”¨ä¹‹å‰, æˆ‘å¹¶æ²¡çœ‹åˆ°æˆ‘çš„æ•°å­—è¢«åŠ è½½äº†, ä¸ºä»€ä¹ˆ?</span><br><span class="line">						&#x2F;&#x2F; æˆ‘å”¯ä¸€æ¯”è¾ƒæ€€ç–‘çš„æ˜¯é‚£ä¸ª CALL runtime.convT2E64(SB)</span><br></pre></td></tr></table></figure>

<p>å¥½å§, æˆ‘çš„æ•°æ®å†åº¦ä¸¢å¤±äº†, æˆ‘ç”šè‡³ä¸çŸ¥é“å®ƒæ˜¯å¦‚ä½•è¢«ä¼ è¿‡å»çš„â€¦</p>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>goçš„æ±‡ç¼–åŸºäº plan 9(ä¸€ä¸ªæ–°çš„æ“ä½œç³»ç»Ÿ), æ„Ÿè§‰åˆ°äº†æ–°çš„æŠ€æœ¯å’Œè§‚ç‚¹</p>
<p>å¹¶ä¸”å®ƒä¹Ÿæ›´åŠ å‹å¥½, æˆ‘æ˜æ˜¾è§‰å¾—çœ‹å®ƒçš„æ±‡ç¼–ä¼šæ›´è½»æ¾ä¸€äº›</p>
<p>(é™¤äº†é‚£ä¸ª PCDATA, FUNCDATA, å’Œé‚£ä¸ªå·²ç»è¢«æˆ‘è·Ÿä¸¢çš„å˜é‡)</p>
<p>emmmâ€¦ å¾ˆä¸é”™, è§‰å¾—è‡ªå·±å¬äº†åˆ«äººçš„å»ºè®®, å»å­¦æ–°çš„è¯­è¨€</p>
<p>è€Œä¸å­¦ç°åœ¨çœ‹èµ·æ¥å¾ˆå¼ºå¤§, ä½†æ˜¯å·²ç»å¾ˆè€äº†çš„ java æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å†³å®š</p>
]]></content>
  </entry>
  <entry>
    <title>other/implementionThreadInUserAndKernelSpace</title>
    <url>/2020/01/09/other/implementionThreadInUserAndKernelSpace/</url>
    <content><![CDATA[<p>ä¹‹å‰å°±çœ‹è¿‡å…³äºåœ¨å†…æ ¸ä»¥åŠç”¨æˆ·ç©ºé—´å®ç°çº¿ç¨‹çš„æ–‡ç« , åˆ°ç°åœ¨è¿˜å¯¹äºå…¶ä¸­çš„ä¸€äº›ç‚¹ä¸€çŸ¥åŠè§£, æ¯”å¦‚: ä¸ºä»€ä¹ˆå®ç°åœ¨ç”¨æˆ·ç©ºé—´çš„çº¿ç¨‹æ¯”å®ç°åœ¨å†…æ ¸ç©ºé—´çš„å¿«?. ä»Šå¤©ç¢°å·§çœ‹åˆ°äº†è¿™ç¯‡æ–‡ç« , åŸæ–‡å‡ºè‡ª &lt;modern operating system, fourth edition&gt;</p>
<h2 id="threads-implementation-in-kernel-and-user-space"><a href="#threads-implementation-in-kernel-and-user-space" class="headerlink" title="threads implementation in kernel and user space"></a>threads implementation in kernel and user space</h2><h3 id="2-2-4-Implementing-Threads-in-User-Space"><a href="#2-2-4-Implementing-Threads-in-User-Space" class="headerlink" title="2.2.4 Implementing Threads in User Space"></a>2.2.4 Implementing Threads in User Space</h3><p>There are two main places to implement threads: user space and the kernel.<br>The choice is a bit controversial, and a hybrid implementation is also possible. We<br>will now describe these methods, along with their advantages and disadvantages.</p>
<p>æœ‰ä¸¤ç§ä¸»è¦çš„åœ°æ–¹ç”¨äºå®ç°çº¿ç¨‹: ç”¨æˆ·ç©ºé—´ä»¥åŠå†…æ ¸ç©ºé—´. å¦‚ä½•åœ¨å“ªé‡Œå®ç°å…·æœ‰ä¸€å®šäº‰è®®æ€§, åŒæ—¶, ä¸€ç§æ··åˆçš„å®ç°ä¹Ÿæ˜¯å¯èƒ½çš„. æˆ‘ä»¬å°†ä¼šæ¦‚è¿°è¿™äº›æ–¹æ³•, ä»¥åŠä»–ä»¬çš„ä¼˜ç‚¹å’Œç¼ºç‚¹.</p>
<p>The first method is to put the threads package entirely in user space. The kernel knows nothing about them. As far as the kernel is concerned, it is managing<br>ordinary, single-threaded processes. The first, and most obvious, advantage is that<br>a user-level threads package can be implemented on an operating system that does<br>not support threads. All operating systems used to fall into this category, and even<br>now some still do. With this approach, threads are implemented by a library.</p>
<p>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯å°†æ•´ä¸ªçº¿ç¨‹åŒ…æ”¾åˆ°ç”¨æˆ·ç©ºé—´. å†…æ ¸å¯¹æ­¤æ¯«æ— æ‰€çŸ¥. å°±å†…æ ¸è€Œè¨€, å®ƒä¾æ—§åƒå¯¹å¾…å•çº¿ç¨‹å¯¹è±¡ä¸€æ ·.</p>
<p>é¦–å…ˆ, æœ€æ˜æ˜¾çš„ä¼˜ç‚¹æ˜¯, ç”¨æˆ·çº§åˆ«çš„çº¿ç¨‹å¯ä»¥å®ç°åœ¨ä¸€ä¸ªä¸æ”¯æŒå¤šçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸Š.æ‰€æœ‰çš„æ“ä½œç³»ç»Ÿæ›¾ç»éƒ½æ˜¯è¿™ç§ç±»å‹, ç›´åˆ°ç°åœ¨è¿˜æœ‰éƒ¨åˆ†ä¿ç•™, åœ¨è¿™ç§æ–¹å¼ä¸‹, çº¿ç¨‹é€šè¿‡ä¸€ä¸ªåº“å®ç°.</p>
<p>All of these implementations have the same general structure, illustrated in<br>Fig. 2-16(a). The threads run on top of a run-time system, which is a collection of<br>procedures that manage threads. We have seen four of these already: pthread create, pthread exit, pthread join, and pthread yield, but usually there are more.</p>
<p>æ‰€æœ‰çš„å®ç°æœ‰åŒæ ·é€šç”¨çš„ç»“æ„, å¦‚å›¾2-16(a). çº¿ç¨‹è¿è¡Œäºè¿è¡Œæ—¶ç³»ç»Ÿä¸Š(ä¸€ç³»åˆ—ç®¡ç†çº¿ç¨‹çš„ç¨‹åº). æˆ‘ä»¬å·²ç»è§è¿‡å››ç§è¿™æ ·çš„ç¨‹åºäº†: çº¿ç¨‹åˆ›å»º, é€€å‡º, åŠ å…¥, æ”¾å¼ƒ(è¿™æ˜¯æœ¬ä¹¦å‰é¢éƒ¨åˆ†çš„å†…å®¹, ä½†ä¸ºä»€ä¹ˆæ˜¯ pthread å‘¢? éš¾é“æ˜¯åŸºäº posix æ ‡å‡†çš„çº¿ç¨‹å®ç°?)</p>
<p><img src="https://imgur.com/ljUry5a.png" alt=""></p>
<p>When threads are managed in user space, each process needs its own private<br>thread table to keep track of the threads in that process. This table is analogous to<br>the kernelâ€™s process table, except that it keeps track only of the per-thread proper-<br>ties, such as each threadâ€™s program counter, stack pointer, registers, state, and so<br>forth. The thread table is managed by the run-time system. When a thread is<br>moved to ready state or blocked state, the information needed to restart it is stored<br>in the thread table, exactly the same way as the kernel stores information about<br>processes in the process table.</p>
<p>å½“çº¿ç¨‹ç®¡ç†äºç”¨æˆ·ç©ºé—´æ—¶, æ¯ä¸ªè¿›ç¨‹éœ€è¦æ‹¥æœ‰ç‹¬æœ‰çš„çº¿ç¨‹è¡¨, ä»¥ç”¨äºæŒç»­è·Ÿè¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹. è¿™ä¸ªè¡¨ç±»ä¼¼ä¸å†…æ ¸çš„è¿›ç¨‹è¡¨, ä¸è¿‡å®ƒåªè·Ÿè¸ªæ¯ä¸ªçº¿ç¨‹çš„å±æ€§. æ¯”å¦‚æ¯ä¸ªçº¿ç¨‹çš„ç¨‹åºè®¡æ•°å™¨, æ ˆæŒ‡é’ˆ, å¯„å­˜å™¨, çŠ¶æ€, ä»¥åŠâ€¦ </p>
<p>çº¿ç¨‹è¡¨ç”±è¿è¡Œæ—¶ç³»ç»Ÿç®¡ç†, å½“çº¿ç¨‹è½¬å˜ä¸ºå°±ç»ª/é˜»å¡çŠ¶æ€æ—¶, ç”¨äºé‡å¯çš„ä¿¡æ¯å°±å­˜å‚¨åœ¨çº¿ç¨‹è¡¨ä¸­, å°±å’Œå†…æ ¸åœ¨è¿›ç¨‹è¡¨ä¸­å­˜å‚¨å…³äºè¿›ç¨‹çš„ä¿¡æ¯ä¸€æ ·.</p>
<p>When a thread does something that may cause it to become blocked locally, for<br>example, waiting for another thread in its process to complete some work, it calls a<br>run-time system procedure. This procedure checks to see if the thread must be put<br>into blocked state. If so, it stores the threadâ€™s registers (i.e., its own) in the thread<br>table, looks in the table for a ready thread to run, and reloads the machine registers<br>with the new threadâ€™s saved values. As soon as the stack pointer and program<br>counter have been switched, the new thread comes to life again automatically.</p>
<p>å¦‚æœçº¿ç¨‹åšäº†æŸäº›æ“ä½œå¯¼è‡´å®ƒæœ¬åœ°é˜»å¡æ—¶, æ¯”å¦‚: ç­‰å¾…è¿›ç¨‹ä¸­çš„å…¶ä»–çº¿ç¨‹å®ŒæˆæŸäº›å·¥ä½œ. å®ƒè°ƒç”¨ä¸€ä¸ªè¿è¡Œæ—¶ä½œä¸šè°ƒåº¦. </p>
<p>è¿™ä¸ªç¨‹åºæ£€æŸ¥çº¿ç¨‹æ˜¯å¦å¿…é¡»ç½®äºé˜»å¡æ€, å¦‚æœæ˜¯, å®ƒåœ¨çº¿ç¨‹è¡¨ä¸­å­˜å‚¨çº¿ç¨‹çš„å¯„å­˜å™¨(å®ƒè‡ªå·±çš„). åœ¨è¡¨ä¸­æŸ¥æ‰¾ä¸€ä¸ªå°±ç»ªæ€çº¿ç¨‹è¿è¡Œ, é‡æ–°åŠ è½½æ–°çº¿ç¨‹çš„å¯„å­˜å™¨. åŒæ—¶æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨ä¹Ÿä¼šåˆ‡æ¢, æ–°çº¿ç¨‹å†æ¬¡è‡ªåŠ¨è¿è¡Œ.</p>
<p> If the machine happens to have an instruction to store all the registers and another<br>one to load them all, the entire thread switch can be done in just a handful of in-<br>structions. Doing thread switching like this is at least an order of magnitudeâ€”<br>maybe moreâ€”faster than trapping to the kernel and is a strong argument in favor<br>of user-level threads packages.</p>
<p>å¦‚æœæœºå™¨å¼€å§‹æœ‰ä¸€ä¸ªæŒ‡ä»¤å¯ä»¥å­˜å‚¨æ‰€æœ‰çš„å¯„å­˜å™¨, åŒæ—¶å¦ä¸€ä¸ªæŒ‡ä»¤åŠ è½½ä»–ä»¬, é‚£ä¹ˆæ•´ä¸ªçº¿ç¨‹çš„åˆ‡æ¢å°±åªéœ€è¦å°‘é‡çš„æŒ‡ä»¤.</p>
<p>è¦å®Œæˆè¿™æ ·çš„çº¿ç¨‹åˆ‡æ¢æ¯”æ•è·å†…æ ¸è‡³å°‘å¿«ä¸€ä¸ªæ•°é‡çº§, æˆ–è®¸æ›´å¿«. è¿™æ˜¯ä¸€ä¸ªå¯¹ç”¨æˆ·çº§çº¿ç¨‹æ‹¥æŠ¤è€…å¼ºæœ‰åŠ›çš„è®ºç‚¹.</p>
<p>However, there is one key difference with processes. When a thread is finished<br>running for the moment, for example, when it calls thread yield, the code of<br>thread yield can save the threadâ€™s information in the thread table itself. Fur-<br>thermore, it can then call the thread scheduler to pick another thread to run. The<br>procedure that saves the threadâ€™s state and the scheduler are just local procedures,<br>so invoking them is much more efficient than making a kernel call. Among other<br>issues, no trap is needed, no context switch is needed, the memory cache need not<br>be flushed, and so on. This makes thread scheduling very fast.</p>
<p>ç„¶è€Œ, æœ‰ä¸€ä¸ªå…³äºè¿›ç¨‹çš„å…³é”®ä¸åŒ. å½“çº¿ç¨‹æš‚åœæ—¶, æ¯”å¦‚: è°ƒç”¨ yield, ä¿å­˜çº¿ç¨‹çš„ä¿¡æ¯åˆ°çº¿ç¨‹è¡¨ä¸­.</p>
<p>æ›´è¿›æ­¥ä¸€, è°ƒç”¨çº¿ç¨‹è°ƒåº¦, é€‰æ‹©å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ. ç¨‹åºä¿å­˜çº¿ç¨‹çŠ¶æ€, å› ä¸ºè°ƒåº¦åªæ˜¯æœ¬åœ°ç¨‹åº, æ‰€ä»¥è°ƒç”¨å…¶ä¼šæ¯”å†…æ ¸è°ƒç”¨æ›´åŠ é«˜æ•ˆ. å…¶ä»–æ–¹é¢, æ²¡æœ‰æ•è·, æ²¡æœ‰ç¯å¢ƒåˆ‡æ¢, å†…å­˜ç¼“å†²ä¹Ÿä¸éœ€è¦åˆ·æ–°, ç­‰ç­‰. è¿™ä½¿å¾—çº¿ç¨‹è°ƒåº¦éå¸¸å¿«.</p>
<p>User-level threads also have other advantages. They allow each process to have<br>its own customized scheduling algorithm. For some applications, for example,<br>those with a garbage-collector thread, not having to worry about a thread being<br>stopped at an inconvenient moment is a plus. They also scale better, since kernel<br>threads invariably require some table space and stack space in the kernel, which<br>can be a problem if there are a very large number of threads.</p>
<p>ç”¨æˆ·çº§çº¿ç¨‹è¿˜æœ‰å…¶ä»–ä¼˜ç‚¹. å®ƒä½¿æ¯ä¸ªè¿›ç¨‹éƒ½å¯ä»¥æœ‰è‡ªå·±çš„ç‰¹å®šè°ƒåº¦ç®—æ³•. å¯¹äºä¸€äº›åº”ç”¨, æ¯”å¦‚åƒåœ¾å›æ”¶çº¿ç¨‹, ä¸ç”¨æ‹…å¿ƒçº¿ç¨‹åœ¨ä¸é€‚å½“æ—¶å€™åœä¸‹æ¥, è¿™æ˜¯ä¸€ä¸ªä¼˜ç‚¹. ä»–ä»¬æ‹¥æœ‰æ›´å¥½çš„ä¼¸ç¼©æ€§, å› ä¸ºå†…æ ¸çº¿ç¨‹æ€»æ˜¯éœ€è¦ä¸€äº›è¡¨ç©ºé—´å’Œæ ˆç©ºé—´, å½“çº¿ç¨‹é€æ¸å¢åŠ æ—¶, ä¼šé€ æˆéº»çƒ¦.</p>
<p>Despite their better performance, user-level threads packages have some major<br>problems. First among these is the problem of how blocking system calls are im-<br>plemented. Suppose that a thread reads from the keyboard before any keys hav e<br>been hit. Letting the thread actually make the system call is unacceptable, since<br>this will stop all the threads. One of the main goals of having threads in the first<br>place was to allow each one to use blocking calls, but to prevent one blocked<br>thread from affecting the others. With blocking system calls, it is hard to see how<br>this goal can be achieved readily.</p>
<p>å³ä½¿å®ƒä»¬æ‹¥æœ‰æ›´å¥½çš„æ€§èƒ½, ç”¨æˆ·çº§çº¿ç¨‹åŒ…ä¹Ÿæœ‰ä¸€äº›å›ºæœ‰çš„é—®é¢˜. </p>
<p>é¦–å…ˆ, å¦‚ä½•å®ç°é˜»å¡çš„ç³»ç»Ÿè°ƒç”¨. å‡å¦‚çº¿ç¨‹ç­‰å¾…æ¥è‡ªé”®ç›˜çš„è¾“å…¥, è®©è¿™ä¸ªçº¿ç¨‹å‡†ç¡®æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æ˜¯ä¸å…è®¸çš„, å› ä¸ºè¿™ä¼šé˜»å¡æ‰€æœ‰çº¿ç¨‹, çº¿ç¨‹çš„é¦–è¦ç›®çš„ä¹‹ä¸€æ˜¯å…è®¸æ¯ä¸ªçº¿ç¨‹ä½¿ç”¨é˜»å¡è°ƒç”¨, ä½†æ˜¯ä¿è¯ä¸€ä¸ªé˜»å¡çº¿ç¨‹ä¸ä¼šå½±å“å…¶ä»–çº¿ç¨‹. å¯ä»¥çœ‹å‡ºè¿™å¾ˆéš¾å®ç°.</p>
<p>The system calls could all be changed to be nonblocking (e.g., a read on the<br>keyboard would just return 0 bytes if no characters were already buffered), but re-<br>quiring changes to the operating system is unattractive. Besides, one argument for<br>user-level threads was precisely that they could run with existing operating sys-<br>tems. In addition, changing the semantics of read will require changes to many<br>user programs.</p>
<p>ç³»ç»Ÿè°ƒç”¨å¿…é¡»éƒ½å˜ä¸ºéé˜»å¡çš„(æ¯”å¦‚, è¯»å–é”®ç›˜è¾“å…¥åº”è¯¥åœ¨æ²¡æœ‰ä»»ä½•å­—ç¬¦è¢«ç¼“å­˜æ—¶è¿”å›0), ä½†æ˜¯è¿™å¯¹äºæ“ä½œç³»ç»Ÿè€Œå·²ä¸å¤ªå‹å¥½. æ¬¡å¤–(æˆ‘çœŸä¸çŸ¥é“æ€ä¹ˆç¿»è¯‘è¿™å¥â€¦). å¦å¤–, æ”¹å˜è¯»å–çš„è¯­ä¹‰å°†ä¼šå½±å“åˆ°å¤§é‡ç”¨æˆ·ç¨‹åº.</p>
<p>Another alternative is available in the event that it is possible to tell in advance<br>if a call will block. In most versions of UNIX, a system call, select , exists, which<br>allows the caller to tell whether a prospective read will block. When this call is<br>present, the library procedure read can be replaced with a new one that first does a<br>select call and then does the read call only if it is safe (i.e., will not block). If the<br>read call will block, the call is not made. Instead, another thread is run. The next<br>time the run-time system gets control, it can check again to see if the read is now<br>safe. This approach requires rewriting parts of the system call library, and is inef-<br>ficient and inelegant, but there is little choice. The code placed around the system<br>call to do the checking is called a jacket or wrapper.</p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹è¿˜æœ‰å¦ä¸€ä¸ªæ–¹æ³•: æå‰å‘ŠçŸ¥ä¸€ä¸ªè°ƒç”¨å°†ä¼šè¢«é˜»å¡æ˜¯å¯è¡Œçš„(??? å•¥æ„æ€å•Š = =).</p>
<p>åœ¨å¤šä¸ª UNIX ç‰ˆæœ¬ä¸­, é€‰æ‹©æ€§åœ°å­˜åœ¨ç³»ç»Ÿè°ƒç”¨è¿è¡Œè°ƒç”¨è€…åˆ¤æ–­æœªæ¥çš„è¯»æ“ä½œå°†ä¼šé˜»å¡. å½“è¿™æ ·çš„è°ƒç”¨å­˜åœ¨æ—¶, åº“ç¨‹åºè¯»å–æ›¿æ¢æˆä¸€ä¸ªé¦–å…ˆåšåˆ¤æ–­, ç„¶åå½“ç¡®å®šæ˜¯å®‰å…¨çš„æ—¶å€™è¯»å–(æ¯”å¦‚, éé˜»å¡).ä¸ä¼šæ‰§è¡Œä¼šé˜»å¡çš„è¯»æ“ä½œ, å¦ä¸€ä¸ªçº¿ç¨‹å°†ä¼šè¿è¡Œ. </p>
<p>åœ¨ä¸‹æ¬¡è¿è¡Œæ—¶ç³»ç»Ÿè·å¾—æ§åˆ¶æ—¶, ä¼šå†æ¬¡æ£€æŸ¥è¯»æ“ä½œæ˜¯å¦æ˜¯å®‰å…¨çš„. è¿™ä¸ªæ–¹æ³•éœ€è¦é‡å†™éƒ¨åˆ†ç³»ç»Ÿè°ƒç”¨åº“. ä¸é‚£ä¹ˆé«˜æ•ˆå’Œä¼˜é›…. ä¸è¿‡è¿™æ˜¯ä¸€ä¸ªé€‰æ‹©, æ”¾ç½®åœ¨ç³»ç»Ÿå‡½æ•°å‘¨å›´çš„ä»£ç å»æ£€æŸ¥çš„è¿™ç§æ–¹æ³•è¢«ç§°ä¸º jacket æˆ– wrapper.</p>
<p>Somewhat analogous to the problem of blocking system calls is the problem of<br>page faults. We will study these in Chap. 3. For the moment, suffice it to say that<br>computers can be set up in such a way that not all of the program is in main memo-<br>ry at once. If the program calls or jumps to an instruction that is not in memory, a<br>page fault occurs and the operating system will go and get the missing instruction<br>(and its neighbors) from disk. This is called a page fault. The process is blocked<br>while the necessary instruction is being located and read in. If a thread causes a<br>page fault, the kernel, unaware of even the existence of threads, naturally blocks<br>the entire process until the disk I/O is complete, even though other threads might<br>be runnable.01</p>
<p>(ç®€å•æ¥è¯´, è¿™æ®µè¯´çš„æ˜¯é¡µé”™è¯¯, ä¸»å­˜å’Œç£ç›˜é—´è™šæ‹Ÿç©ºé—´å†…å®¹çš„äº¤æ¢.)</p>
<p>Another problem with user-level thread packages is that if a thread starts run-<br>ning, no other thread in that process will ever run unless the first thread voluntarily<br>gives up the CPU. Within a single process, there are no clock interrupts, making it<br>impossible to schedule processes round-robin fashion (taking turns). Unless a<br>thread enters the run-time system of its own free will, the scheduler will never get a<br>chance.</p>
<p>ç”¨æˆ·çº§çº¿ç¨‹å°†é¢ä¸´çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯: å½“çº¿ç¨‹å¼€å§‹æ‰§è¡Œæ—¶, é™¤éè‡ªæ„¿æ”¾å¼ƒ, ä¸ç„¶å…¶ä»–çº¿ç¨‹æ— æ³•æ‰§è¡Œ. </p>
<p>å•çº¿ç¨‹ç¨‹åº, ä¸ä¼šäº§ç”Ÿæ—¶é’Ÿç»ˆç«¯, ä½¿ç”¨ round-robin è°ƒåº¦å™¨ç®¡ç†è¿›ç¨‹æ˜¯ä¸å¯èƒ½çš„. é™¤éçº¿ç¨‹è‡ªæ„¿è¿›å…¥è¿è¡Œæ—¶ç³»ç»Ÿ. å¦åˆ™è°ƒåº¦å™¨å°†ä¸ä¼šç”Ÿæ•ˆ.</p>
<p>One possible solution to the problem of threads running forever is to have the<br>run-time system request a clock signal (interrupt) once a second to give it control,<br>but this, too, is crude and messy to program. Periodic clock interrupts at a higher<br>frequency are not always possible, and even if they are, the total overhead may be<br>substantial. Furthermore, a thread might also need a clock interrupt, interfering<br>with the run-time systemâ€™s use of the clock.</p>
<p>ä¸€ä¸ªå¯èƒ½çš„æ–¹æ³•æ˜¯: è®©è¿è¡Œæ—¶ç³»ç»Ÿæ¯ç§’è¯·æ±‚ä¸€ä¸ªæ—¶é’Ÿä¿¡å·æ¥æ§åˆ¶å®ƒ(æ€»è€Œè¨€ä¹‹è¿™æ˜¯ä¸€ä¸ªé¦Šä¸»æ„).</p>
<p>Another, and really the most devastating, argument against user-level threads is<br>that programmers generally want threads precisely in applications where the<br>threads block often, as, for example, in a multithreaded Web server. These threads<br>are constantly making system calls. Once a trap has occurred to the kernel to carry<br>out the system call, it is hardly any more work for the kernel to switch threads if<br>the old one has blocked, and having the kernel do this eliminates the need for con-<br>stantly making select system calls that check to see if read system calls are safe.<br>For applications that are essentially entirely CPU bound and rarely block, what is<br>the point of having threads at all? No one would seriously propose computing the<br>first n prime numbers or playing chess using threads because there is nothing to be<br>gained by doing it that way.</p>
<p>å¦ä¸€ä¸ªåå¯¹ç”¨æˆ·çº§çº¿ç¨‹çš„è®ºè¯(ä¹Ÿæ˜¯æœ€å…·ç ´åæ€§çš„)æ˜¯, ç¨‹åºå‘˜é€šå¸¸å¸Œæœ›çº¿ç¨‹åœ¨çº¿ç¨‹ç»å¸¸é˜»å¡çš„åº”ç”¨ä¸­ä½¿ç”¨, æ¯”å¦‚, åœ¨ä¸€ä¸ªå¤šçº¿ç¨‹ web æœåŠ¡å™¨ä¸­. çº¿ç¨‹ä¸é—´æ–­åœ°ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨, ä¸€æ—¦å†…æ ¸æ‰§è¡Œç³»ç»Ÿè°ƒç”¨, å¦‚æœæ—§çº¿ç¨‹å·²è¢«é˜»å¡, é‚£ä¹ˆåˆ‡æ¢çº¿ç¨‹å°±å‡ ä¹æ²¡æœ‰å…¶ä»–éœ€è¦åšçš„äº†. â€¦(åé¢æˆ‘ç¿»ä¸ä¸‹å»äº†, å¤§æ¦‚æ„æ€æ˜¯, è¿™æ ·çš„è¯, ç¨‹åºå°±æ²¡æœ‰å¿…è¦ä½¿ç”¨å¤šçº¿ç¨‹äº†)</p>
<p>(æ€»ç»“å½’çº³ä¸€ä¸‹: å¤§æ¦‚æ„æ€æ˜¯, ç”¨æˆ·çº§çº¿ç¨‹æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åœ¨äºå…¶åˆ‡æ¢èµ·æ¥å¾ˆå¿«, ä½†æ˜¯æˆ‘ä»¬é€šå¸¸å¸Œæœ›åœ¨é¢‘ç¹å‘ç”Ÿçº¿ç¨‹é˜»å¡çš„åº”ç”¨ä¸­ä½¿ç”¨çº¿ç¨‹, è€Œåœ¨è¿™ç§æƒ…å†µä¸‹, çº¿ç¨‹åˆ‡æ¢æ‰€éœ€çš„æ“ä½œå°±ä¼šå˜å°‘(å¦‚æœæ—§çº¿ç¨‹å·²ç»è¢«é˜»å¡äº†çš„è¯), é‚£ä¹ˆ ç”¨æˆ·çº§çº¿ç¨‹å­˜åœ¨çš„æ„ä¹‰å°±ä¸å¤§äº†)</p>
<h3 id="2-2-5-Implementing-Threads-in-the-Kernel"><a href="#2-2-5-Implementing-Threads-in-the-Kernel" class="headerlink" title="2.2.5 Implementing Threads in the Kernel"></a>2.2.5 Implementing Threads in the Kernel</h3><p>Now let us consider having the kernel know about and manage the threads. No<br>run-time system is needed in each, as shown in Fig. 2-16(b). Also, there is no<br>thread table in each process. Instead, the kernel has a thread table that keeps track<br>of all the threads in the system. When a thread wants to create a new thread or<br>destroy an existing thread, it makes a kernel call, which then does the creation or<br>destruction by updating the kernel thread table.</p>
<p>ç°åœ¨, è®©æˆ‘ä»¬è€ƒè™‘è®©å†…æ ¸çŸ¥é“å¦‚ä½•ç®¡ç†çº¿ç¨‹. å¦‚å›¾ 2-16(b) æ‰€ç¤º, åœ¨è¿›ç¨‹ä¸­æ²¡æœ‰è¿è¡Œæ—¶ç³»ç»Ÿ, ä¹Ÿæ²¡æœ‰çº¿ç¨‹è¡¨. å†…æ ¸æœ‰å¼ çº¿ç¨‹è¡¨, ç”¨äºè·Ÿè¸ªç³»ç»Ÿä¸­çš„æ‰€æœ‰çº¿ç¨‹. å½“çº¿ç¨‹æƒ³è¦åˆ›å»ºæˆ–åˆ é™¤ä¸€ä¸ªçº¿ç¨‹æ—¶, ä½¿ç”¨ä¸€ä¸ªå†…æ ¸è°ƒç”¨, ç„¶åé€šè¿‡æ›´æ–°å†…æ ¸çº¿ç¨‹è¡¨æ¥åˆ›å»ºæˆ–åˆ é™¤.</p>
<p>The kernelâ€™s thread table holds each threadâ€™s registers, state, and other infor-<br>mation. The information is the same as with user-level threads, but now kept in the<br>kernel instead of in user space (inside the run-time system). This information is a<br>subset of the information that traditional kernels maintain about their single-<br>threaded processes, that is, the process state. In addition, the kernel also maintains<br>the traditional process table to keep track of processes.</p>
<p>å†…æ ¸çš„çº¿ç¨‹è¡¨ä¿å­˜æ¯ä¸ªçº¿ç¨‹çš„å¯„å­˜å™¨, çŠ¶æ€, ä»¥åŠå…¶ä»–ä¿¡æ¯. ä¸ç”¨æˆ·çº§çº¿ç¨‹ä¿å­˜çš„ä¿¡æ¯ä¸€è‡´, åªæ˜¯ä¿å­˜åœ¨å†…æ ¸ä¸­. </p>
<p>è¿™äº›ä¿¡æ¯æ˜¯ä¼ ç»Ÿå†…æ ¸ç®¡ç†çš„å•çº¿ç¨‹è¿›ç¨‹ä¿¡æ¯çš„å­é›†. å†…æ ¸ä¹ŸåŒæ ·ç®¡ç†ä¼ ç»Ÿçš„è¿›ç¨‹è¡¨, ä»¥ç”¨äºè·Ÿè¸ªè¿›ç¨‹.</p>
<p>All calls that might block a thread are implemented as system calls, at consid-<br>erably greater cost than a call to a run-time system procedure. When a thread<br>blocks, the kernel, at its option, can run either another thread from the same proc-<br>ess (if one is ready) or a thread from a different process. With user-level threads,<br>the run-time system keeps running threads from its own process until the kernel<br>takes the CPU away from it (or there are no ready threads left to run).</p>
<p>æ‰€æœ‰å¯èƒ½é˜»å¡çº¿ç¨‹çš„è°ƒç”¨éƒ½è¢«å®ç°ä¸ºç³»ç»Ÿè°ƒç”¨, ç›¸å¯¹è¿è¡Œæ—¶ç³»ç»Ÿçš„è°ƒç”¨, æ˜æ˜¾æœ‰å¾ˆå¤§çš„é¢å¤–æ¶ˆè€—. å½“çº¿ç¨‹é˜»å¡æ—¶, å†…æ ¸å¯ä»¥é€‰æ‹©åŒè¿›ç¨‹ä¸‹çš„çº¿ç¨‹è¿è¡Œ, ä¹Ÿå¯ä»¥è¿è¡Œå¦ä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹. ä½†ç”¨æˆ·çº§çº¿ç¨‹åªä¼šè¿è¡Œæœ¬è¿›ç¨‹çš„çº¿ç¨‹, ç›´åˆ°å†…æ ¸ä¸è®©å…¶ä½¿ç”¨ CPU èµ„æº.</p>
<p>Due to the relatively greater cost of creating and destroying threads in the ker-<br>nel, some systems take an environmentally correct approach and recycle their<br>threads. When a thread is destroyed, it is marked as not runnable, but its kernel<br>data structures are not otherwise affected. Later, when a new thread must be creat-<br>ed, an old thread is reactivated, saving some overhead. Thread recycling is also<br>possible for user-level threads, but since the thread-management overhead is much<br>smaller, there is less incentive to do this.</p>
<p>å› ä¸ºåœ¨å†…æ ¸ä¸­åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹æ“ä½œç›¸å¯¹æ›´è´¹åŠ›, ä¸€äº›ç³»ç»Ÿä½¿ç”¨ä¸ç¯å¢ƒç›¸å…³çš„æ–¹æ³•, é‡åˆ©ç”¨å®ƒä»¬çš„çº¿ç¨‹. </p>
<p>å½“çº¿ç¨‹é”€æ¯æ—¶, å°†å…¶æ ‡è®°ä¸ºä¸å¯è¿è¡Œ, ä½†æ˜¯å…¶å†…æ ¸æ•°æ®ç»“æ„ä¸å—å½±å“, éšå, å½“æ–°çº¿ç¨‹éœ€è¦åˆ›å»ºæ—¶, é‡æ–°åˆ©ç”¨è¿™äº›èµ„æº.  ç”¨æˆ·çº§çº¿ç¨‹ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•, ä¸è¿‡å› ä¸ºçº¿ç¨‹ç®¡ç†çš„æ¶ˆè€—è¾ƒå°, å¹¶ä¸æ˜¯å¾ˆæœ‰å¿…è¦è¿™ä¹ˆåš</p>
<p>Kernel threads do not require any new, nonblocking system calls. In addition,<br>if one thread in a process causes a page fault, the kernel can easily check to see if<br>the process has any other runnable threads, and if so, run one of them while wait-<br>ing for the required page to be brought in from the disk. Their main disadvantage is<br>that the cost of a system call is substantial, so if thread operations (creation, termi-<br>nation, etc.) a common, much more overhead will be incurred.</p>
<p>å†…æ ¸çº¿ç¨‹ä¸éœ€è¦ä»»ä½•æ–°çš„, éé˜»å¡ç³»ç»Ÿè°ƒç”¨. å¦å¤–, å¦‚æœçº¿ç¨‹å¯¼è‡´äº†é¡µé”™è¯¯, å†…æ ¸å¯ä»¥è½»æ¾åœ°æ£€æŸ¥è¿›ç¨‹æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹å¯è¿è¡Œ, å¦‚æœæœ‰, åœ¨ç­‰å¾…æ‰€éœ€çš„é¡µåŠ è½½å…¥å†…å­˜ä¸­æ—¶, æ‰§è¡Œè¯¥çº¿ç¨‹. å®ƒä»¬æ½œåœ¨çš„é—®é¢˜æ˜¯: ç³»ç»Ÿè°ƒç”¨æ¯”è¾ƒè€—æ—¶, æ‰€ä»¥å¦‚æœçº¿ç¨‹æ“ä½œæ¯”è¾ƒå¸¸è§, åˆ™ä¼šæœ‰æ›´å¤šçš„è´Ÿè½½.</p>
<p>While kernel threads solve some problems, they do not solve all problems. For<br>example, what happens when a multithreaded process forks? Does the new proc-<br>ess have as many threads as the old one did, or does it have just one? In many<br>cases, the best choice depends on what the process is planning to do next. If it is<br>going to call exec to start a new program, probably one thread is the correct choice,<br>but if it continues to execute, reproducing all the threads is probably best.</p>
<p>å†…æ ¸çº¿ç¨‹ä¾æ—§æœ‰ä¸€äº›æœªèƒ½è§£å†³çš„é—®é¢˜, æ¯”å¦‚, å½“å¤šçº¿ç¨‹è¿›ç¨‹æ‰§è¡Œ fork çš„æ—¶å€™, ä¼šå‘ç”Ÿä»€ä¹ˆ? æ–°çš„è¿›ç¨‹æ˜¯å¦ä¼šåƒæ—§è¿›ç¨‹ä¸€æ ·æ‹¥æœ‰åŒæ ·å¤šçš„çº¿ç¨‹å‘¢? è¿˜æ˜¯åªæ‹¥æœ‰ä¸€ä¸ªå‘¢? åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹, å–å†³äºè¿›ç¨‹å°†è¦åšä»€ä¹ˆ, å¦‚æœå®ƒå°†ä¼šè°ƒç”¨ exec æ‰§è¡Œä¸€ä¸ªæ–°çš„ç¨‹åº, å½“ç„¶åªæœ‰ä¸€ä¸ªå¥½, ä½†æ˜¯å¦‚æœæ˜¯ç»§ç»­è¿è¡Œçš„è¯, åˆ™ä¿ç•™æ‰€æœ‰çš„çº¿ç¨‹åˆ™æ˜¯æœ€å¥½çš„.</p>
<p>(PS: åœ¨ linux posix çº¿ç¨‹ä¸‹, é»˜è®¤æ˜¯åŒæ ·å¤šçš„çº¿ç¨‹)</p>
<p>Another issue is signals. Remember that signals are sent to processes, not to<br>threads, at least in the classical model. When a signal comes in, which thread<br>should handle it? Possibly threads could register their interest in certain signals, so<br>when a signal came in it would be given to the thread that said it wants it. But what<br>happens if two or more threads register for the same signal? These are only two of<br>the problems threads introduce, and there are more.</p>
<p>å¦ä¸€ä¸ªé—®é¢˜æ˜¯ä¿¡å·. ä¿¡å·æ˜¯å‘ç»™è¿›ç¨‹çš„, è€Œå¹¶éçº¿ç¨‹(è‡³å°‘åœ¨ç»å…¸æ¨¡å‹ä¸‹). å½“ä¿¡å·åˆ°è¾¾æ—¶, é‚£ä¸ªçº¿ç¨‹æ¥å¤„ç†å®ƒå‘¢? å¯èƒ½çº¿ç¨‹ä¼šæ³¨å†Œè‡ªå·±æ„Ÿå…´è¶£çš„ä¿¡å·, æ‰€ä»¥, å½“ä¿¡å·åˆ°è¾¾, ä¼šäº¤ç”±é‚£ä¸ªæ³¨å†Œçº¿ç¨‹å¤„ç†. ä½†æ˜¯å¦‚æœå¤šä¸ªçº¿ç¨‹æ³¨å†Œäº†åŒæ ·çš„ä¿¡å·å‘¢? è¿™ä»…ä»…æ˜¯çº¿ç¨‹å¼•å…¥çš„å…¶ä¸­ä¸¤ä¸ªé—®é¢˜.</p>
<h3 id="2-2-6-Hybrid-Implementations"><a href="#2-2-6-Hybrid-Implementations" class="headerlink" title="2.2.6 Hybrid Implementations"></a>2.2.6 Hybrid Implementations</h3><p>Various ways have been investigated to try to combine the advantages of user-<br>level threads with kernel-level threads. One way is use kernel-level threads and<br>then multiplex user-level threads onto some or all of them, as shown in Fig. 2-17.<br>When this approach is used, the programmer can determine how many kernel<br>threads to use and how many user-level threads to multiplex on each one. This<br>model gives the ultimate in flexibility.</p>
<p>å·²ç»æœ‰å¤šç§æ–¹æ³•è¢«ç ”ç©¶å‡ºæ¥, ç”¨äºèåˆç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹. å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨å†…æ ¸çº§åˆ«çº¿ç¨‹, ç„¶åæ¯ä¸ªå†…æ ¸çº¿ç¨‹ä½¿ç”¨å¤šä¸ªç”¨æˆ·çº§åˆ«çº¿ç¨‹. å¦‚ 2-17. </p>
<p>ç¨‹åºèƒ½å¤ŸçŸ¥æ™“å¤šå°‘å†…æ ¸çº¿ç¨‹, å¤šå°‘ç”¨æˆ·çº¿ç¨‹è¢«ä½¿ç”¨. è¿™ç§æ¨¡å‹ç»™äºˆäº†å¾ˆå¤§çš„çµæ´»æ€§.</p>
<p><img src="https://imgur.com/Bcc4Uzh.png" alt=""></p>
<p>With this approach, the kernel is aware of only the kernel-level threads and<br>schedules those. Some of those threads may have multiple user-level threads multi-<br>plexed on top of them. These user-level threads are created, destroyed, and sched-<br>uled just like user-level threads in a process that runs on an operating system with-<br>out multithreading capability. In this model, each kernel-level thread has some set<br>of user-level threads that take turns using it.</p>
<p>åœ¨è¿™ç§æ–¹æ³•ä¸‹, å†…æ ¸åªè‡³å°‘å†…æ ¸çº¿ç¨‹, å¹¶è°ƒåº¦å®ƒä»¬. å…¶ä¸­ä¸€äº›å†…æ ¸çº¿ç¨‹ä¸Šå¯èƒ½å­˜åœ¨å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹. è¿™äº›ç”¨æˆ·çº¿ç¨‹å°†ä¼šåœ¨è¿›ç¨‹ä¸­ç®¡æ§. </p>
<p>å†…æ ¸çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹å„æœ‰å…¶ä¼˜åŠ¿, ç”¨æˆ·çº¿ç¨‹æ•ˆç‡æ›´é«˜, ä½†æ˜¯æ“ä½œç³»ç»Ÿä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹, ä¼šäº§ç”Ÿè®¸å¤šé€»è¾‘ä¸Šæ˜¯å¤šçº¿ç¨‹, ä½†ç‰©ç†ä¸Šä¾æ—§æ˜¯å•çº¿ç¨‹æ‰ä¼šäº§ç”Ÿçš„é”™è¯¯. æ¯”å¦‚ ä¿¡å·, ä¸­æ–­. è€Œå†…æ ¸çº¿ç¨‹è™½ç„¶ç›¸å¯¹æ•ˆç‡ä½, å¹¶ä¸”å ç”¨å†…æ ¸ç©ºé—´, ä½†æ˜¯æ“ä½œç³»ç»ŸçŸ¥æ™“æ˜¯å¤šçº¿ç¨‹, ä¸æ“ä½œç³»ç»Ÿé—´æœ‰æ›´å¤šåä½œçš„ç©ºé—´.</p>
]]></content>
  </entry>
  <entry>
    <title>other/install vim8</title>
    <url>/2020/01/09/other/install%20vim8/</url>
    <content><![CDATA[<p>åœ¨å’Œ master vim quickly çš„ä½œè€…é‚®ä»¶ä¸­ </p>
<p>å‘ç°äº†è‡ªå·±çš„vimç‰ˆæœ¬è¿˜å¯ä»¥å†æ›´æ–°, äºæ˜¯æœ‰äº†è¿™ç¯‡ç¬”è®°</p>
<p>å‚è€ƒæ•™ç¨‹:</p>
<p><a href="https://www.tecmint.com/vim-8-0-install-in-ubuntu-linux-systems/" target="_blank" rel="noopener">https://www.tecmint.com/vim-8-0-install-in-ubuntu-linux-systems/</a></p>
<p><a href="https://www.systutorials.com/241762/how-to-upgrade-vim-to-version-8-on-centos-7/" target="_blank" rel="noopener">https://www.systutorials.com/241762/how-to-upgrade-vim-to-version-8-on-centos-7/</a></p>
<p>vimçš„gitåœ°å€:</p>
<p><a href="https://github.com/vim/vim" target="_blank" rel="noopener">https://github.com/vim/vim</a></p>
<p>vim8å®‰è£…æŒ‡å—:</p>
<p><a href="https://github.com/vim/vim/blob/master/src/INSTALL" target="_blank" rel="noopener">https://github.com/vim/vim/blob/master/src/INSTALL</a></p>
<h3 id="å®‰è£…vim8"><a href="#å®‰è£…vim8" class="headerlink" title="å®‰è£…vim8"></a>å®‰è£…vim8</h3><ol>
<li><p>é¦–å…ˆéœ€è¦æºä»£ç </p>
<p>git clone <a href="https://github.com/vim/vim.git" target="_blank" rel="noopener">https://github.com/vim/vim.git</a></p>
</li>
<li><p>ç¼–è¯‘</p>
<p>cd &lt;vim repo è·¯å¾„&gt;/src</p>
<p>make</p>
<p>make install</p>
<p>ç°åœ¨åº”è¯¥å°±å·²ç»è·å¾—äº†æ–°çš„vimå¯æ‰§è¡Œæ–‡ä»¶, å°†ä»–è¦†ç›–åŸæ¥çš„vimå°±å¥½</p>
</li>
</ol>
<p>@btw: ä¸­é€”å¯èƒ½ä¼šé‡åˆ°ä¸€äº›é—®é¢˜</p>
<ul>
<li>å®‰è£…ç¼–è¯‘vimæ‰€éœ€çš„API<ul>
<li>yum  -y install  ncurses-devel</li>
</ul>
</li>
<li>è¦†ç›–æ—¶æç¤ºå‡ºé”™<ul>
<li>å› ä¸ºå¯èƒ½vimè¿˜åœ¨å…¶ä»–åœ°æ–¹è¢«è¿è¡Œ, ä½¿ç”¨ losf æŸ¥çœ‹è¿›ç¨‹, kill æ‰</li>
</ul>
</li>
</ul>
<p>å…·ä½“çš„å¯ä»¥å‚è€ƒä¸Šé¢çš„æ•™ç¨‹é“¾æ¥, è¿™é‡Œåªæ˜¯ç®€å•æ¦‚è¿°</p>
<p>é¡ºä¾¿ç»™ä¸€ä»½é€šå¸¸çš„vimè®¾ç½®</p>
<pre><code>&quot;General&quot;
set number    &quot;Show line numbers&quot;
set linebreak    &quot;Break lines at word (requires Wrap lines)&quot;
set showbreak=+++    &quot;Wrap-broken line prefix&quot;
set textwidth=100    &quot;Line wrap (number of cols)&quot;
set showmatch    &quot;Highlight matching brace&quot;
set visualbell    &quot;Use visual bell (no beeping)&quot;

set hlsearch    &quot;Highlight all search results&quot;
set smartcase    &quot;Enable smart-case search&quot;
set ignorecase    &quot;Always case-insensitive&quot;
set incsearch    &quot;Searches for strings incrementally&quot;

set autoindent    &quot;Auto-indent new lines&quot;
set shiftwidth=4    &quot;Number of auto-indent spaces&quot;
set smartindent    &quot;Enable smart-indent&quot;
set smarttab    &quot;Enable smart-tabs&quot;
set softtabstop=4    &quot;Number of spaces per Tab&quot;

&quot;Advanced&quot;
set ruler    &quot;Show row and column ruler information&quot;
â€‹    
set undolevels=1000    &quot;Number of undo levels&quot;
set backspace=indent,eol,start    &quot;Backspace behaviour&quot;</code></pre>]]></content>
  </entry>
  <entry>
    <title>other/linux</title>
    <url>/2020/01/09/other/linux/</url>
    <content><![CDATA[<pre><code>mkdir åˆ›å»ºæ–‡ä»¶å¤¹æŒ‡ä»¤  
su åˆ‡æ¢åˆ°ç®¡ç†å‘˜æ¨¡å¼  
sudo ä»¥ç®¡ç†å‘˜æ¨¡å¼æ‰§è¡Œå‘½ä»¤
sudo passwd ä»¥ç”¨æˆ·å¯†ç æ›´æ”¹ç®¡ç†å‘˜å¯†ç 
rm -f * åˆ é™¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶
clear æ¸…ç©ºç»ˆç«¯çª—å£(å®é™…è¿˜å­˜åœ¨, åªä¸è¿‡çœ‹ä¸è§äº†, å’Œcmdä¸€æ ·)

apt-get install [å·¥å…·å] å®‰è£…å·¥å…·  
CentOSä¸‹æ˜¯ä½¿ç”¨yum

æ›´æ”¹vimé…è‰²
1. ä¸‹è½½vimæ–‡ä»¶
2. æ”¾åˆ°~/.vim/colorsæ–‡ä»¶å¤¹ä¸‹(æ²¡æœ‰å°±åˆ›å»º)
3. æ›´æ”¹vimrcæ–‡ä»¶, è·¯å¾„: /etc/vim/vimrc, å¢åŠ æŒ‡ä»¤: colorscheme [é…è‰²æ–¹æ¡ˆå]
PS: é»˜è®¤çš„colorsæ–‡ä»¶å¤¹è·¯å¾„: /usr/share/vim/vim80/colors
ä¹‹åå‘ç°vimrcæ–‡ä»¶åœ¨/etcç›®å½•ä¸‹, è€Œvimæ–‡ä»¶æ”¾åœ¨äº†~/.vimç›®å½•ä¸‹
emmmmm, å·²ç»æƒ³ä¸èµ·å½“æ—¶æ€ä¹ˆå¼„çš„äº†... å°±è¿™æ ·å§, å¯èƒ½æ˜¯ç‰ˆæœ¬é—®é¢˜...

æ›´æ”¹tabé—´è·
åŒæ ·æ›´æ”¹vimrcæ–‡ä»¶, å¢åŠ å¦‚ä¸‹æŒ‡ä»¤: 
set ts=4 // è®¾ç½®tableé—´è·ä¸º4
set expandtab // ä¸æ¸…æ¥š - -</code></pre><p>ä»¥ä¸Šç¯å¢ƒä¸ºubuntu 18<br>PS: æƒ³èµ·ä¹‹å‰åˆšæ¥è§¦linux, å®‰è£…g++, gccå‚ç…§äº†é”™è¯¯çš„æ•™ç¨‹(é‚£æ²™é›•æ•™ç¨‹åˆæ˜¯è£…æ’ä»¶åˆæ˜¯ä¸‹å®‰è£…åŒ…)<br>å¥½ä¸å®¹æ˜“è£…å®Œä¹‹ååˆè¢«viçš„è¾“å…¥å’Œå‘½ä»¤è¡Œæ¨¡å¼, å˜Ÿå˜Ÿå˜Ÿå˜Ÿå˜Ÿ, æ°”å¾—åŠæ­»<br>ä¹‹ååˆå¥½ä¸å®¹æ˜“å†™å¥½ä¸€ä¸ªæµ‹è¯•ä»£ç , ctrl+sä¸€ä¿å­˜, ç›´æ¥TMDä¸å“åº”äº†<br>(äº‹åæ‰å¾—çŸ¥è¿™æ˜¯å…³é—­å‘ç»ˆç«¯è¾“å…¥çš„æ¥å£, åªéœ€è¦ctrl+qå°±å¯ä»¥é‡æ–°æ‰“å¼€è¾“å…¥, ç•™ä¸‹äº†å±äºæ— çŸ¥è€…çš„æ³ªæ°´â€¦)<br>ä¸€ç³»åˆ—æ“ä½œè®©æˆ‘ç›´æ¥åˆ é™¤ubuntuâ€¦ </p>
<p>vimæŸ¥è¯¢å­—ç¬¦ä¸² <code>/å­—ç¬¦ä¸²</code><br>PS: ä½†æ˜¯ä¹‹åè¢«æœç´¢çš„å­—ç¬¦ä¸²ä¼šæŒç»­é«˜äº®æ˜¾ç¤º, ä½¿è¾“å…¥<code>noh</code>å¯è¿˜åŸ  </p>
<p>vimæ³¨é‡Šå¤šè¡Œ<br>control + v<br>ä¸Šä¸‹é”®/(j/k) é”®é€‰ä¸­æ“ä½œçš„è¡Œ<br>shift + i<br>è¾“å…¥<code>//</code> (è§†è¯­è¨€è€Œå®š)<br>è¿ç»­ä¸¤æ¬¡ ESC</p>
<p>å–æ¶ˆå¤šè¡Œæ³¨é‡Š<br>control + v<br>ä¸Šä¸‹å·¦å³é”® é€‰ä¸­éœ€è¦æ³¨é‡Šçš„ç¬¦å·<br>d</p>
]]></content>
  </entry>
  <entry>
    <title>other/permission</title>
    <url>/2020/01/09/other/permission/</url>
    <content><![CDATA[<h3 id="permission-denied"><a href="#permission-denied" class="headerlink" title="permission denied"></a>permission denied</h3><blockquote>
<p>æœ‰äº›æ—¶å€™, linuxä¸‹æ‰§è¡Œ/è®¿é—®æ–‡ä»¶çš„æ—¶å€™, éƒ½ä¼šæŠ¥è¿™ä¸ªé”™</p>
<p>é”™è¯¯çš„åŸå› æ˜¯: æƒé™è¢«æ‹’ç», é‚£ä¹ˆlinuxçš„æƒé™æ˜¯æ€ä¹ˆè§„å®šçš„?</p>
</blockquote>
<h3 id="æ–‡ä»¶æƒé™"><a href="#æ–‡ä»¶æƒé™" class="headerlink" title="æ–‡ä»¶æƒé™"></a>æ–‡ä»¶æƒé™</h3><blockquote>
<p>æ‰§è¡Œllå, æ˜¾ç¤ºçš„ä¿¡æ¯:</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-rwxrwxr-x 1 wd wd  8419 Nov  8 10:47 a.out</span><br><span class="line">-rw-rw-r-- 1 wd wd 60579 Oct 25 21:11 t</span><br><span class="line">-rw-rw-r-- 1 wd wd   272 Oct 25 21:11 t.cpp</span><br><span class="line">-rw-rw-r-- 1 wd wd   369 Nov  8 10:47 time.cpp</span><br><span class="line">-rw-rw-r-- 1 wd wd 71784 Oct 29 11:53 t.o</span><br><span class="line">-rw-rw-r-- 1 wd wd  5815 Oct 29 11:57 t.s</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­ -rw-rw-râ€“ è¿™ä¸€ä¸²ä»£è¡¨çš„å°±æ˜¯linuxçš„æ–‡ä»¶æƒé™, ä¸€å…±æœ‰10ä¸ªå­—ç¬¦  </p>
<p>å…¶ä¸­æœ€å¼€å§‹çš„å­—ç¬¦ä»£è¡¨æ–‡ä»¶ç±»å‹, æ¯”å¦‚:  - ä»£è¡¨ä¸€èˆ¬æ–‡ä»¶, l ä»£è¡¨é“¾æ¥æ–‡ä»¶</p>
<p>åé¢9ä¸ªå­—ç¬¦åˆ†ä¸ºä¸‰éƒ¨åˆ†, åˆ†åˆ«ä»£è¡¨: user(ç”¨æˆ·), group(ç»„), other(å…¶ä»–)</p>
<p>æ¯ä¸ªéƒ¨åˆ†æœ‰3ä¸ªå­—ç¬¦, åˆ†åˆ«è¡¨ç¤º: r(read, å¯è¯»), w(write, å¯å†™), x(execute å¯æ‰§è¡Œ)</p>
<p>å¦‚æœæŸä¸€éƒ¨åˆ†æ²¡æœ‰è¿™ä¸ªæƒé™, åˆ™ç”¨ - å ä½</p>
<p>å› æ­¤å¯çŸ¥ -rw-rw-râ€“ æ„ä¸º:</p>
<p>ä¸€èˆ¬æ–‡ä»¶, æ‹¥æœ‰è€…å¯è¯»å†™, åŒç»„ç”¨æˆ·å¯è¯»å†™, å…¶ä»–ç”¨æˆ·å¯è¯»</p>
<h3 id="éšè—å±æ€§"><a href="#éšè—å±æ€§" class="headerlink" title="éšè—å±æ€§"></a>éšè—å±æ€§</h3><p>é™¤æ­¤ä¹‹å¤–, linuxçš„æ–‡ä»¶è¿˜æœ‰éšè—çš„å±æ€§</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">[...]$ lsattr .</span><br><span class="line">-------------e- ./t.o</span><br><span class="line">-------------e- ./a.out</span><br><span class="line">-------------e- ./t.s</span><br><span class="line">-------------e- ./time.cpp</span><br><span class="line">-------------e- ./t</span><br><span class="line">-------------e- ./t.cpp</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡lsattr(attribute), å¯ä»¥æŸ¥è¯¢æ–‡ä»¶çš„éšè—å±æ€§, å…¶ä¸­æ¯”è¾ƒé‡è¦çš„å±æ€§æœ‰:</p>
<p>a: append, åªèƒ½æ·»åŠ , ä¸èƒ½æ›´æ”¹å’Œåˆ é™¤</p>
<p>i: ä¸èƒ½åˆ é™¤. æ”¹å, è®¾ç½®é“¾æ¥, åŒæ—¶ä¹Ÿæ— æ³•å†™å…¥å’Œæ·»åŠ æ•°æ®</p>
<p>å±æ€§çš„å¢åŠ å’Œåˆ é™¤, å¯ä»¥é€šè¿‡chattr + - æ¥è®¾ç½®, å¦‚æœæƒ³ç›´æ¥èµ‹äºˆä¸€ä¸ªæ–°çš„å±æ€§, å¯ä»¥ä½¿ç”¨ = </p>
<h3 id="ç‰¹æ®Šæƒé™"><a href="#ç‰¹æ®Šæƒé™" class="headerlink" title="ç‰¹æ®Šæƒé™"></a>ç‰¹æ®Šæƒé™</h3><p>æ–‡ä»¶é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„æƒé™, SUID, SGID, SBIT</p>
<p>SUIDä½äºuseræƒé™ç»„: æ‹¥æœ‰è¿™ä¸ªå±æ€§çš„æ–‡ä»¶, æœ€åä¸€ä¸ªå­—ç¬¦ä½s, ä¾‹å¦‚: -rwsâ€”â€”</p>
<p>â€‹    SUIDä»…å¯¹äºŒè¿›åˆ¶ç¨‹åºæœ‰æ•ˆ</p>
<p>â€‹    SUIDæ„ä¸ºå¦‚æœæ‰§è¡Œè€…æ‹¥æœ‰xæƒé™, å½“æ‰§è¡Œæ–‡ä»¶æ—¶, æ‰§è¡Œè€…æš‚æ—¶æ‹¥æœ‰rootæƒé™</p>
<p>SGIDä½äºgroupæƒé™ç»„: æ‹¥æœ‰è¿™ä¸ªå±æ€§çš„æ–‡ä»¶, æœ€åä¸€ä¸ªå­—ç¬¦ä½s, ä¾‹å¦‚: â€”-rwsâ€”</p>
<p>â€‹    SGIDæ„ä¸ºå¦‚æœæ‰§è¡Œè€…æ‹¥æœ‰xæƒé™, å½“æ‰§è¡Œæ–‡ä»¶æ—¶, æ‰§è¡Œè€…æš‚æ—¶æ‹¥æœ‰ç”¨æˆ·ç»„æƒé™</p>
<p>SBITä½äºotheræƒé™ç»„:</p>
<p>â€‹    SBITä»…å¯¹ç›®å½•æ¸¸æ³³: æ‹¥æœ‰è¿™ä¸ªå±æ€§çš„æ–‡ä»¶, æœ€åä¸€ä¸ªå­—ç¬¦ä½t, ä¾‹å¦‚: â€”â€”-rwt</p>
<p>â€‹    SBITæ„ä¸º: å½“å‰é¢ç›®å½•ä¸‹, Aä»…ä»…åªèƒ½åˆ é™¤(åŒ…æ‹¬ç§»åŠ¨å’Œé‡å‘½å)Aæ‹¥æœ‰çš„æ–‡ä»¶(æ–‡ä»¶æŒæœ‰è€…æ˜¯A)</p>
<p>â€‹        ä¸èƒ½åˆ é™¤Bçš„æ–‡ä»¶</p>
<p>ä»¥ä¸Šæ¥è‡ªé¸Ÿå“¥ç§æˆ¿èœ, è¯¦ç»†å‚ç…§ç¬¬äºŒéƒ¨åˆ†</p>
]]></content>
  </entry>
  <entry>
    <title>other/pointAndRefrence</title>
    <url>/2020/01/09/other/pointAndRefrence/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æœ€è¿‘çœ‹äº†&lt;ç°ä»£æ“ä½œç³»ç»Ÿ&gt;, ä»å†…å­˜ç®¡ç†é‚£ä¸€ç« ä¸­è·å¾—äº†ä¸€äº›ä¸œè¥¿: åˆ†é¡µå’Œåˆ†æ®µ  </p>
<p>å…¶ä¸­åˆ†é¡µçš„æ¦‚å¿µè®©æˆ‘å¯¹å†…å­˜çš„ç®¡ç†æœ‰äº†æ›´åŠ æ¸…æ™°çš„è®¤çŸ¥</p>
<h3 id="ä»€ä¹ˆæ˜¯åˆ†é¡µ"><a href="#ä»€ä¹ˆæ˜¯åˆ†é¡µ" class="headerlink" title="ä»€ä¹ˆæ˜¯åˆ†é¡µ?"></a>ä»€ä¹ˆæ˜¯åˆ†é¡µ?</h3><p>å°±æ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€ä¸ªä¸ªå°çš„é¡µé¢(ä»¥4kä¸ºä¾‹). </p>
<p>åœ¨å°†ç£ç›˜æ•°æ®åŠ è½½è¿›å†…å­˜æ—¶, ä»¥é¡µä¸ºå•ä½, è€Œå°†å†…å­˜ä¸­çš„æ•°æ®æ¢å‡ºåˆ°ç£ç›˜ä¸­æ—¶, ä¹Ÿä»¥é¡µä¸ºå•ä½. </p>
<p>å¯¹æ­¤, ä¸€ä¸ªå…·ä½“çš„è™šæ‹Ÿåœ°å€å¯ä»¥åˆ†ä¸ºä¸¤éƒ¨åˆ†:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">é¡µå· + åœ°å€</span><br></pre></td></tr></table></figure>

<p>å…¶ä¸­, é¡µå·ä¼šè¢«æ›¿æ¢, è€Œåœ°å€ä¼šè¢«ä¿ç•™:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">çœŸå®çš„åœ°å€ + åœ°å€</span><br></pre></td></tr></table></figure>

<p>çœŸå®çš„åœ°å€å­˜æ”¾åˆ°è¿›ç¨‹è™šæ‹Ÿåœ°å€æ˜ å°„è¡¨ä¸­  </p>
<p>emmmâ€¦ ä¹Ÿå°±æ˜¯è¯´, <strong>è™šæ‹Ÿåœ°å€ä¸­, æœ‰éƒ¨åˆ†çš„åœ°å€æ˜¯çœŸå®çš„</strong></p>
<p>(å¦‚æœæˆ‘èƒ½çŸ¥é“é‚£éƒ¨åˆ†å‡çš„åœ°å€, æ˜¯å¦å°±æœ‰åŠæ³•æ“ä½œçœŸå®ç£ç›˜ä¸­çš„æ•°æ®å‘¢? æˆ‘çªç„¶æœ‰äº†ä¸å¤ªå¥½çš„æƒ³æ³• :) )</p>
<h3 id="æŒ‡é’ˆä¸­æ˜¯å¦ä¼šä¿ç•™åŸå§‹å˜é‡çš„åœ°å€"><a href="#æŒ‡é’ˆä¸­æ˜¯å¦ä¼šä¿ç•™åŸå§‹å˜é‡çš„åœ°å€" class="headerlink" title="æŒ‡é’ˆä¸­æ˜¯å¦ä¼šä¿ç•™åŸå§‹å˜é‡çš„åœ°å€?"></a>æŒ‡é’ˆä¸­æ˜¯å¦ä¼šä¿ç•™åŸå§‹å˜é‡çš„åœ°å€?</h3><p>æŒ‡é’ˆä¸­å­˜æ”¾äº†æ•°æ®, è€Œè¿™æ ·çš„æ•°æ®èƒ½å¤Ÿæ‰¾åˆ°æŒ‡é’ˆæ‰€æŒ‡å‘çš„å˜é‡  </p>
<p>é‚£ä¹ˆ, è¿™æ ·çš„æ•°æ®æ˜¯ä»€ä¹ˆå‘¢? æœ€ç›´æ¥çš„, é‚£ä¹ˆåº”è¯¥æ˜¯åœ°å€, è€ƒè™‘ä»¥ä¸‹ç¨‹åº:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">10</span> <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">11</span>     <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="number">12</span>     <span class="keyword">int</span> *p = &amp;i;</span><br><span class="line"><span class="number">13</span>     <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;i);</span><br><span class="line"><span class="number">14</span>     <span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;p);</span><br><span class="line"><span class="number">15</span>     <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *((<span class="keyword">int</span> *)&amp;p));</span><br><span class="line"><span class="number">16</span> </span><br><span class="line"><span class="number">17</span>     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">18</span> &#125;</span><br></pre></td></tr></table></figure>

<p>15æ‰“å°çš„æ˜¯æŒ‡é’ˆæœ¬èº«å†…å­˜ä¸­æ‰€æŒ‡å‘çš„ä¸œè¥¿, å°†å®ƒä¸å˜é‡içš„åœ°å€åšä»¥ä¸‹å¯¹æ¯”, ä¼šç›¸åŒä¹ˆ?  ä»¥ä¸‹æ˜¯è¾“å‡ºç»“æœ:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">0x7fff12ca4efc</span><br><span class="line">0x7fff12ca4ef0</span><br><span class="line">315248380</span><br></pre></td></tr></table></figure>

<p>içš„åœ°å€æ˜¯ 0x7fff12ca4efc, è€Œpä¸­ä¿å­˜çš„å€¼(æˆ‘å°†å®ƒè§£é‡Šä¸ºæ•´æ•°)æ˜¯: 315248380  </p>
<p>æ•´å‹æ•°å­—ä¸æ€ä¹ˆç›´è§‚, å°†å®ƒè½¬ä¸ºhexè¯•è¯•?  =&gt; 0x12ca4efc </p>
<p>æœ‰æ²¡æœ‰è§‰å¾—ç†Ÿæ‚‰?  0x7fff12ca4efc â€”â€“ 0x12ca4efc   </p>
<p>é™¤å‰é¢çš„ 0x7fff, åé¢çš„æ•°å­—æ˜¯ä¸€æ ·çš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è¯´æŒ‡é’ˆä¿å­˜äº†å˜é‡çš„åœ°å€, ä½†æ˜¯å¹¶ä¸å‡†ç¡®  </p>
<p>é‚£ä¹ˆ 0x7fff å°±æ˜¯é‚£ä¸ªé¡µå·ä¹ˆ? æŒ‡é’ˆä¸­åªä¼šå­˜æ”¾çœŸæ˜¯åœ°å€? å¥½åƒä¸é‚£ä¹ˆå¯¹â€¦</p>
<p>emmmâ€¦ å¥½åƒå¯ä»¥ç»§ç»­å°è¯•, å› ä¸ºå½“å‰ç¯å¢ƒæ˜¯32ä½çš„, è¿™ä¸ªåœ°å€æ•°å­—æ˜æ˜¾è¶…å‡ºäº†32ä½çš„è¡¨ç°èŒƒå›´</p>
<p>(æˆ‘å±…ç„¶å¿½ç•¥äº†è¿™ä¸€ç‚¹ = =â€¦)</p>
<p>æˆ–è®¸æˆ‘èƒ½è·å¾—æ›´å¤šçš„æ•°æ®? åœ¨ä»£ç ä¸­åŠ å…¥äº†ä¸‹é¢ä¸€è¡Œ:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">16</span>     <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ((<span class="keyword">int</span> *)&amp;p)[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>

<p>å¾—åˆ°äº†æ•°æ®: 32767 =&gt; 0x7fff  </p>
<p>æ‰€ä»¥æŒ‡é’ˆä¸­ç›´æ¥ä¿å­˜äº†å˜é‡çš„åœ°å€(æˆ‘ä»¬ä¹‹å‰å¹¶æ²¡æœ‰æ‹¿åˆ°å®Œå…¨çš„æ•°æ®, åœ°å€è¶…è¿‡äº†intçš„å¤§å°)  </p>
<p><strong>æŒ‡é’ˆå°±æ˜¯åœ°å€</strong></p>
<p>emmmâ€¦ å¥½åƒè¿™ä¸ªç¬”è®°ä¸æ˜¯é‚£ä¹ˆæœ‰æ„ä¹‰åšäº†â€¦</p>
<p>æˆ‘æ˜¯ä¸æ˜¯å¤ªæ…¢äº†? è¿™äº›ä¸œè¥¿åº”è¯¥æ˜¯åˆå­¦è€…å°±å¯ä»¥å»é’»ç ”çš„å†…å®¹</p>
<p>(@btw: ä¸ºä»€ä¹ˆæ˜¯[1] è€Œä¸æ˜¯ [-1])</p>
<h3 id="æ˜¯å¦æœ‰åŠæ³•çŸ¥é“å“ªäº›æ•°æ®æ˜¯ä¸é¡µå·æœ‰å…³çš„"><a href="#æ˜¯å¦æœ‰åŠæ³•çŸ¥é“å“ªäº›æ•°æ®æ˜¯ä¸é¡µå·æœ‰å…³çš„" class="headerlink" title="æ˜¯å¦æœ‰åŠæ³•çŸ¥é“å“ªäº›æ•°æ®æ˜¯ä¸é¡µå·æœ‰å…³çš„?"></a>æ˜¯å¦æœ‰åŠæ³•çŸ¥é“å“ªäº›æ•°æ®æ˜¯ä¸é¡µå·æœ‰å…³çš„?</h3><p>emmmâ€¦ é‚£äº›ä¸œè¥¿ä¸å†…æ ¸æœ‰å…³, æˆ‘ç°åœ¨æ²¡æœ‰åŠæ³•è·å¾—</p>
<h3 id="å…¶ä»–çš„è€¦åˆçŸ¥è¯†-volatile"><a href="#å…¶ä»–çš„è€¦åˆçŸ¥è¯†-volatile" class="headerlink" title="å…¶ä»–çš„è€¦åˆçŸ¥è¯†: volatile"></a>å…¶ä»–çš„è€¦åˆçŸ¥è¯†: volatile</h3><p>åœ¨ä¹¦ä¸­æˆ‘è¿˜è¯»åˆ°äº†ä¸€ä¸ªéå¸¸æœ‰è¶£çš„çŸ¥è¯†, é‚£å°±æ˜¯è¿›ç¨‹è¡¨é¡¹æœ‰ä¸€ä¸ª<strong>æ˜¯å¦ç¼“å­˜æ ‡å¿—ä½</strong></p>
<p>è¿™ä¸ªæ ‡å¿—ä½çš„æ„æ€æ˜¯, å¦‚æœè¯¥ä½æ˜¯1, è¡¨ç¤ºè¯¥é¡µä¸è¢«ç¼“å­˜  </p>
<p>æ„æ€æ˜¯ä»€ä¹ˆå‘¢? å¦‚æœè¦è®¿é—®çš„æ•°æ®æ˜¯åœ¨è¯¥é¡µä¸­çš„, é‚£ä¹ˆè®¿é—®æ—¶ä¼šå»è®¿é—®ç£ç›˜  </p>
<p>è€Œå†™å…¥çš„æ—¶å€™, ä¹Ÿä¼šç›´æ¥å¾€ç£ç›˜ä¸­å†™å…¥, å› ä¸ºå†…å­˜ä¸­ä¸ç¼“å­˜è¯¥é¡µçš„æ•°æ®</p>
<p>ä»”ç»†æƒ³æƒ³å’Œä»€ä¹ˆä¸œè¥¿æœ‰å…³? å—¯, c++çš„ volatile å…³é”®å­—</p>
<p>æˆ‘æ‰“èµŒ, volatileçš„å®ç°ä¸€å®šä¸è¿™ä¸œè¥¿æœ‰å…³(è‡³å°‘å®ç°ç±»ä¼¼) ä¸è¿‡æˆ‘ç°åœ¨çš„èƒ½åŠ›æš‚æ—¶æ— æ³•è¯å®</p>
<p>åŒæ—¶è¿˜æœ‰ä¸€ä¸ªç–‘é—®, volatile ä¿®é¥°ä¸€ä¸ªå˜é‡, è€Œä¸€ä¸ªé¡µæ˜¯4kçš„, å¦‚ä½•å°†è¿™ä¸¤ä¸ªä¸œè¥¿åˆ†å¼€å‘¢? </p>
<h3 id="ä¸ºä»€ä¹ˆæ˜¯-1-è€Œä¸æ˜¯-1"><a href="#ä¸ºä»€ä¹ˆæ˜¯-1-è€Œä¸æ˜¯-1" class="headerlink" title="ä¸ºä»€ä¹ˆæ˜¯[1] è€Œä¸æ˜¯ [-1]"></a>ä¸ºä»€ä¹ˆæ˜¯[1] è€Œä¸æ˜¯ [-1]</h3><p>ä¸Šé¢çš„ä¾‹å­ä¸­, æˆ‘ç»§ç»­è®¿é—®æ•°æ®, ä½¿ç”¨çš„æ˜¯ [1] è€Œä¸æ˜¯ [-1]</p>
<p>æˆ‘ä¸€å¼€å§‹æ˜¯ç”¨ [-1], å› ä¸ºæ ˆæ˜¯å¾€ä¸‹å¢é•¿çš„, ä¹‹åå‘ç° [1] æ˜¯æ­£ç¡®çš„, ä¸ºä»€ä¹ˆ?</p>
<p>çš„ç¡®å®é™…ä¸Šåº”è¯¥æ˜¯ [1], ä¸ç„¶å±€éƒ¨æ•°ç»„çš„è®¿é—®å°±è¦ä¹±å¥—äº† </p>
<p>ä½†æ˜¯æ ˆçš„ç¡®æ˜¯å‘ä¸‹å¢é•¿çš„, ä» fc å’Œ f0 ä¸­å¯ä»¥çœ‹å‡ºæ¥ </p>
<p>é‚£ä¹ˆåº•å±‚åˆ°åº•å¯¹æˆ‘çš„ä»£ç åšäº†ä»€ä¹ˆ? æˆ–è®¸å¯ä»¥ä»æ±‡ç¼–ä¸­å¾—åˆ°ç­”æ¡ˆ</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">12 main:</span><br><span class="line">13 .LFB1079:</span><br><span class="line">14     .cfi_startproc</span><br><span class="line">15     .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line">16     pushq   %rbp</span><br><span class="line">17     .cfi_def_cfa_offset 16</span><br><span class="line">18     .cfi_offset 6, -16</span><br><span class="line">19     movq    %rsp, %rbp		&#x2F;&#x2F; ä¿å­˜äº†æ ˆåº•æŒ‡é’ˆ</span><br><span class="line">20     .cfi_def_cfa_register 6</span><br><span class="line">21     subq    $16, %rsp		&#x2F;&#x2F; å¼€æ‹“æ ˆå¸§, 16ä¸ªå­—èŠ‚</span><br><span class="line">22     movl    $1, -4(%rbp)		&#x2F;&#x2F; å—¯, æˆ‘ä»¬çš„æ•°å­—1è¢«æ”¾å…¥å†…å­˜äº†</span><br><span class="line">23     leaq    -4(%rbp), %rax	&#x2F;&#x2F; å°†å˜é‡1çš„åœ°å€æ”¾å…¥rax</span><br><span class="line">24     movq    %rax, -16(%rbp)	&#x2F;&#x2F; å°†raxçš„å€¼æ”¾å…¥äº†æ ˆ... æ ˆé¡¶?(å› ä¸ºè¿™é‡Œæ˜¯-16)</span><br><span class="line">25     leaq    -4(%rbp), %rax	&#x2F;&#x2F; åˆå°†å˜é‡1çš„åœ°å€æ”¾å…¥rax</span><br><span class="line">26     movq    %rax, %rsi		</span><br><span class="line">27     movl    $.LC0, %edi		&#x2F;&#x2F; .LC0:.string &quot;%p\n&quot;</span><br><span class="line">28     movl    $0, %eax			</span><br><span class="line">29     call    printf			&#x2F;&#x2F; raxå­˜äº†å˜é‡1çš„åœ°å€, è¿™é‡Œåº”è¯¥å¯¹åº”: printf(&quot;%p\n&quot;, &amp;i);</span><br><span class="line">30     leaq    -16(%rbp), %rax	&#x2F;&#x2F; å°†æ ˆé¡¶çš„åœ°å€æ”¾å…¥äº†rax</span><br><span class="line">31     movq    %rax, %rsi		</span><br><span class="line">32     movl    $.LC0, %edi</span><br><span class="line">33     movl    $0, %eax</span><br><span class="line">34     call    printf			&#x2F;&#x2F; ç°åœ¨raxæ˜¯æ ˆé¡¶, æ‰€ä»¥å¯¹åº”è¿™ä¸€å¥: printf(&quot;%p\n&quot;, &amp;p);</span><br><span class="line">35     leaq    -16(%rbp), %rax	&#x2F;&#x2F; æŠŠpçš„åœ°å€æ”¾å…¥rax</span><br><span class="line">36     movl    (%rax), %eax		&#x2F;&#x2F; åˆç§»åŠ¨åˆ°eax</span><br><span class="line">37     movl    %eax, %esi		&#x2F;&#x2F; è¿˜ç§»åŠ¨ &#x3D; &#x3D;</span><br><span class="line">38     movl    $.LC1, %edi		&#x2F;&#x2F; .LC1:.string &quot;%d\n&quot;</span><br><span class="line">39     movl    $0, %eax</span><br><span class="line">40     call    printf			&#x2F;&#x2F; å¯¹åº”: printf(&quot;%d\n&quot;, ((int *)&amp;p)[0]);</span><br><span class="line">41     leaq    -16(%rbp), %rax	</span><br><span class="line">42     addq    $4, %rax			&#x2F;&#x2F; *å°†rax+4, ä¹Ÿå°±æ˜¯å¾€æ ˆé¡¶ç§»åŠ¨çš„</span><br><span class="line">43     movl    (%rax), %eax</span><br><span class="line">44     movl    %eax, %esi</span><br><span class="line">45     movl    $.LC1, %edi</span><br><span class="line">46     movl    $0, %eax</span><br><span class="line">47     call    printf			&#x2F;&#x2F; å¯¹åº”: printf(&quot;%d\n&quot;, ((int *)&amp;p)[1]);</span><br><span class="line">48     movl    $0, %eax</span><br><span class="line">49     leave</span><br><span class="line">50     .cfi_def_cfa 7, 8</span><br><span class="line">51     ret</span><br><span class="line">52     .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>é‚£ä¹ˆäº†è§£äº†, è™½ç„¶æ ˆæ˜¯å¾€ä¸‹ç§»åŠ¨çš„, åˆ†é…æ ˆå¸§æ—¶ä¹Ÿæ˜¯å¾€ä¸‹ç§»åŠ¨çš„  </p>
<p>ä½†æ˜¯ [1] è¿™ç§ä½ç§»æ—¶, æ˜¯å¾€ä¸Šç§»åŠ¨çš„, ä¹Ÿå°±æ˜¯å¾€é«˜åœ°å€ç§»åŠ¨çš„</p>
<p>å› ä¸ºå˜é‡æœ¬èº«çš„åœ°å€å¼€å§‹æ˜¯åœ¨æ ˆçš„ä½åœ°å€, æ˜¯å¾€ä¸Šç§»åŠ¨çš„  </p>
<p>æ²¡æœ‰é—®é¢˜, æ˜¯æ­£å¸¸çš„ :)</p>
<p>ä½†æ˜¯æˆ‘åˆå‘ç°ä¸€ä¸ªé—®é¢˜, è¿™é‡ŒæŒ‡é’ˆæ‰€å ç”¨çš„ç©ºé—´ä¸º8å­—èŠ‚!</p>
<p>ä¸è¿‡åˆæƒ³äº†ä¸€ä¸‹, è¿™å¥½åƒä¹Ÿæ­£å¸¸çš„, æ¯•ç«Ÿ64ä½å˜›â€¦</p>
<h3 id="å¼•ç”¨å‘¢-å¼•ç”¨åˆæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢"><a href="#å¼•ç”¨å‘¢-å¼•ç”¨åˆæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢" class="headerlink" title="å¼•ç”¨å‘¢? å¼•ç”¨åˆæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢?"></a>å¼•ç”¨å‘¢? å¼•ç”¨åˆæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢?</h3><p>æ—¶éš”å‡ å¤©, çªç„¶æƒ³åˆ°äº†è¿™ä¸ªä¸œè¥¿, å¼•ç”¨åˆæ˜¯ä»€ä¹ˆæ ·å­çš„å‘¢? å®ƒå’ŒæŒ‡é’ˆå®è´¨çš„åŒºåˆ«?</p>
<p>å‚è€ƒä»¥ä¸‹ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">100</span>;</span><br><span class="line"><span class="keyword">int</span> &amp;i2 = i;</span><br><span class="line"><span class="keyword">int</span> *pi = &amp;i;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;i);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;i2);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%p\n"</span>, &amp;pi);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, i);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, i2);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, *pi);</span><br></pre></td></tr></table></figure>

<p>emmmâ€¦ è¿™å¾ˆç®€å•, åˆ†åˆ«æ‰“å°åœ°å€å’Œå€¼</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB1084:</span><br><span class="line">    .cfi_startproc</span><br><span class="line">    .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    .cfi_def_cfa_offset 16</span><br><span class="line">    .cfi_offset 6, -16</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .cfi_def_cfa_register 6</span><br><span class="line">    subq    $32, %rsp			&#x2F;&#x2F; 32å­—èŠ‚çš„æ ˆå¸§</span><br><span class="line">    movl    $100, -12(%rbp)		&#x2F;&#x2F; i</span><br><span class="line">    leaq    -12(%rbp), %rax		&#x2F;&#x2F; i çš„åœ°å€æ”¾å…¥äº†rax</span><br><span class="line">    movq    %rax, -8(%rbp)		&#x2F;&#x2F; ç›´æ¥å°† rax çš„å€¼æ”¾å…¥äº† i2, ä¹Ÿå°±æ˜¯è¯´, å¼•ç”¨ä¹Ÿä¿å­˜äº†å˜é‡çš„åœ°å€</span><br><span class="line">    leaq    -12(%rbp), %rax		&#x2F;&#x2F; è¿™æ˜¯ä¸€ä¸ªå®Œå…¨å¯ä»¥ä¼˜åŒ–æ‰çš„æ“ä½œ</span><br><span class="line">    movq    %rax, -24(%rbp)		&#x2F;&#x2F; pi </span><br><span class="line">    leaq    -12(%rbp), %rax		&#x2F;&#x2F; ä½ å®¶ rax éƒ½æ²¡å˜è¿‡, ä½ æ€ä¹ˆè¿˜æ¥ (ëˆˆ_ëˆˆ)</span><br><span class="line">    movq    %rax, %rsi</span><br><span class="line">    movl    $.LC0, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; &amp;i</span><br><span class="line">    movq    -8(%rbp), %rax		&#x2F;&#x2F; è¿™é‡Œç›´æ¥å°†æ ˆä¸­çš„å€¼æ”¾è¿›å…¥äº†</span><br><span class="line">    movq    %rax, %rsi</span><br><span class="line">    movl    $.LC0, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; &amp;i2</span><br><span class="line">    leaq    -24(%rbp), %rax		&#x2F;&#x2F; æ³¨æ„, è¿™æ˜¯ lea</span><br><span class="line">    movq    %rax, %rsi</span><br><span class="line">    movl    $.LC0, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; &amp;pi</span><br><span class="line">    movl    -12(%rbp), %eax</span><br><span class="line">    movl    %eax, %esi</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; i</span><br><span class="line">    movq    -8(%rbp), %rax		&#x2F;&#x2F; ç›´æ¥å°†åœ°å€æ”¾å…¥ rax</span><br><span class="line">    movl    (%rax), %eax		&#x2F;&#x2F; å°†è¿™ä¸ªåœ°å€ä¸­çš„å€¼æ”¾å…¥äº†(å³ i çš„åœ°å€) eax</span><br><span class="line">    movl    %eax, %esi</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; i2</span><br><span class="line">    movq    -24(%rbp), %rax</span><br><span class="line">    movl    (%rax), %eax</span><br><span class="line">    movl    %eax, %esi</span><br><span class="line">    movl    $.LC1, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf				&#x2F;&#x2F; pi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    leave</span><br><span class="line">    .cfi_def_cfa 7, 8</span><br><span class="line">    ret</span><br><span class="line">    .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>å¼•ç”¨å’ŒæŒ‡é’ˆå¹¶æ— å…³é”®æ€§çš„åŒºåˆ«, å¼•ç”¨ä¹Ÿä¼šå ç”¨å†…å­˜(åºŸè¯ (ëˆˆ_ëˆˆ), ä¸è¿‡æˆ‘è®°å¾—åŸ¹è®­æ—¶æœ‰ä¸ªæ²™é›•è€å¸ˆè¯´ä¸å )</p>
<p>å½“ä½¿ç”¨å¼•ç”¨çš„å€¼æ—¶, å®ƒæ˜¯åƒæŒ‡é’ˆä¸€æ ·ä½¿ç”¨</p>
<p>è€Œå½“å¯¹å¼•ç”¨å–åœ°å€æ—¶, å®ƒæ˜¯ç›´æ¥æ‹¿å­˜å‚¨çš„æ•°æ®, è€Œå¹¶éç”¨å­˜å‚¨çš„æ•°æ®å»å¯»å€</p>
<p>(è¿™åº”å½“æ˜¯ç¼–è¯‘å™¨çš„è§„å®š, å®ƒè¿™ä¹ˆç¼–è¯‘äº†å¼•ç”¨)</p>
<p>å”¯ä¸€ä¸åŒæ˜¯, å¼•ç”¨å äº†8å­—èŠ‚, è¿™å¾ˆåˆç†, ä½†æ˜¯ä¸ºä»€ä¹ˆæŒ‡é’ˆæ˜¯12å­—èŠ‚</p>
<p>(è¿™æ˜¯ä¸€ä¸ªæˆ‘åœ¨ä¹‹å‰å¿½è§†äº†çš„ç‚¹, æˆ‘æ›¾çœ‹è¿‡é‚£4å­—èŠ‚ä¸­æ˜¯ä»€ä¹ˆ, ç»“æœæ˜¯ 0 </p>
<p>(ç”¨æŒ‡é’ˆçš„æ—¶å€™, ä¹Ÿç”¨çš„æ˜¯ movq, è¿™æ„å‘³ç€åªä½¿ç”¨äº† 64 ä½, å³ 8 å­—èŠ‚, ä¸ºä»€ä¹ˆä¸­ç©ºäº† 4 å­—èŠ‚?)</p>
<p>æˆ–è®¸æˆ‘å¯ä»¥å†è¯•è¯•èµ‹å€¼çš„æ—¶å€™, å¼•ç”¨å’ŒæŒ‡é’ˆçš„ä¸åŒä¹‹å¤„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">i2 = <span class="number">100</span>;</span><br><span class="line">*pi = <span class="number">111</span>;</span><br></pre></td></tr></table></figure>

<p>æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB1078:</span><br><span class="line">    .cfi_startproc</span><br><span class="line">    .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line">    pushq   %rbp			&#x2F;&#x2F; é€šè¿‡å‹æ ˆçš„æ–¹å¼ä¿å­˜bp</span><br><span class="line">    .cfi_def_cfa_offset 16</span><br><span class="line">    .cfi_offset 6, -16</span><br><span class="line">    movq    %rsp, %rbp		&#x2F;&#x2F; å®ƒæ²¡æœ‰æ˜¾ç¤ºè¯´æ˜æ ˆå¸§æœ‰å¤šå¤§, è®©æˆ‘æœ‰ç‚¹ä¸ä¹ æƒ¯ âˆ‘(ï¿£â–¡ï¿£;)</span><br><span class="line">    .cfi_def_cfa_register 6</span><br><span class="line">    movl    $2147483647, -20(%rbp)</span><br><span class="line">    leaq    -20(%rbp), %rax</span><br><span class="line">    movq    %rax, -16(%rbp)</span><br><span class="line">    leaq    -20(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)</span><br><span class="line">    movq    -16(%rbp), %rax</span><br><span class="line">    movl    $100, (%rax)	&#x2F;&#x2F; å®ƒæ˜¯ç”¨å¯„å­˜å™¨å¯»å€çš„æ–¹å¼æ¥èµ‹å€¼çš„</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movl    $111, (%rax)</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    leave</span><br><span class="line">    .cfi_def_cfa 7, 8</span><br><span class="line">    ret</span><br><span class="line">    .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>ä¹Ÿå°±æ˜¯è¯´, èµ‹å€¼æ˜¯ä¸€æ ·çš„, å—¯, å®Œå…¨ä¸€æ · </p>
<h3 id="æŒ‡é’ˆå’Œå¼•ç”¨çš„å®‰å…¨æ€§"><a href="#æŒ‡é’ˆå’Œå¼•ç”¨çš„å®‰å…¨æ€§" class="headerlink" title="æŒ‡é’ˆå’Œå¼•ç”¨çš„å®‰å…¨æ€§"></a>æŒ‡é’ˆå’Œå¼•ç”¨çš„å®‰å…¨æ€§</h3><p>è¿˜è®°å¾—ä¸ºä»€ä¹ˆå¼•ç”¨æ¯”æŒ‡é’ˆå®‰å…¨ä¹ˆ? å› ä¸ºå¯¹äºå¼•ç”¨æ˜¯åƒå€¼ä¸€æ ·å»ä½¿ç”¨å®ƒ, å®ƒä»…ä»…æ˜¯åˆ«å  </p>
<p>(å…¶å®ä¸æ˜¯åˆ«å, å¦‚ä½ æ‰€è§, æœ‰äº›æ—¶å€™è®¿é—®å¼•ç”¨å…¶å®è¿˜æ˜¯è®¿é—®çš„æ˜¯å¼•ç”¨æ‰€å çš„å†…å­˜)  </p>
<p>å®ƒä¸ä¼šå‡ºç°æ„å¤–çš„ delete, å› ä¸ºç®¡ç†äº†å®ƒæœ¬èº«æ•°æ®çš„è®¿é—®, ä¹Ÿä¸ä¼šå‡ºç°ä¸€äº›æŒ‡é’ˆåŸæœ‰çš„é”™è¯¯(ç©ºæŒ‡é’ˆ,  é‡æŒ‡é’ˆâ€¦)  </p>
<p>æˆ‘æ›´å€¾å‘äº: <strong>å¼•ç”¨æ˜¯ä¸€ä¸ªåŠ äº†é¡¶å±‚constçš„éç©º, ä¸å¯ç”¨äºdeleteçš„æŒ‡é’ˆ</strong></p>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>å¼•ç”¨å’ŒæŒ‡é’ˆçš„æœ¬è´¨éƒ½æ˜¯åœ°å€</p>
<h3 id="é¢˜å¤–è¯-å°è¯•ç¯¡æ”¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡"><a href="#é¢˜å¤–è¯-å°è¯•ç¯¡æ”¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡" class="headerlink" title="é¢˜å¤–è¯: å°è¯•ç¯¡æ”¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡"></a>é¢˜å¤–è¯: å°è¯•ç¯¡æ”¹å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</h3><p>ç­‰ç­‰, å¼•ç”¨çš„å†…å­˜ä¹Ÿæ˜¯åœ¨æ ˆä¸­çš„, è™½ç„¶ c++ ä¸è®©æˆ‘ç”¨å…‰æ˜æ­£å¤§çš„æ–¹å¼ä¿®æ”¹å®ƒ</p>
<p>ä½†æ˜¯, æ—¢ç„¶æ˜¯åœ¨æ ˆä¸­çš„æ•°æ®, é‚£ä¹ˆ, æˆ‘åº”è¯¥æ˜¯å¯ä»¥æ”¹çš„, é‚£ä¹ˆå°±æ¥è¯•ä¸€ä¸‹</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">int i &#x3D; 100;</span><br><span class="line">int i2 &#x3D; 200;</span><br><span class="line">int &amp;ref_i &#x3D; i;</span><br><span class="line"></span><br><span class="line">long long *desc &#x3D; (long long *)(&amp;i) + 1;&#x2F;&#x2F; ç»è¿‡è®¡ç®—, i çš„åœ°å€å¾€ä¸Š 8 ä¸ªå­—èŠ‚å°±æ˜¯å¼•ç”¨å¯¹è±¡çš„å†…å­˜</span><br><span class="line">char arr[64];	</span><br><span class="line">sprintf(arr, &quot;%ld&quot;, &amp;i2);	&#x2F;&#x2F; å°† &amp;i2 è§£é‡Šä¸ºldç±»å‹æ•°æ®, æ”¾å…¥æ•°ç»„ä¸­</span><br><span class="line">string s(arr);				&#x2F;&#x2F; æ„å»ºstringå¯¹è±¡, ä¸»è¦æ˜¯ä¸ºäº†èƒ½ä½¿ç”¨ stoll (ëˆˆ_ëˆˆ)</span><br><span class="line"></span><br><span class="line">printf(&quot;%d\n&quot;, ref_i);		&#x2F;&#x2F; 100</span><br><span class="line">*desc &#x3D; stoll(s);			&#x2F;&#x2F; ç°åœ¨, å®ƒé‡Œé¢å­˜å‚¨çš„æ•°æ®æ˜¯ i2 çš„åœ°å€äº†</span><br><span class="line">printf(&quot;%d\n&quot;, ref_i);		&#x2F;&#x2F; 200  æˆåŠŸäº†, å®ƒæŒ‡å‘äº† i2  (ï¿£Ë‡ï¿£)</span><br><span class="line">i2 &#x3D; 300;</span><br><span class="line">printf(&quot;%d\n&quot;, ref_i);		&#x2F;&#x2F; 300 å†æ¬¡éªŒè¯, æ²¡é”™, æˆ‘ä»¬æ›´æ”¹äº†å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡</span><br></pre></td></tr></table></figure>

<p>æ±‡ç¼–å°±ä¸ç”¨çœ‹äº†, å› ä¸ºè¿™ä¸ªç¨‹åºå°±æ˜¯æ ¹æ®è‡ªå·±è„‘è¡¥æ±‡ç¼–ä¸­çš„æ ·å­æ¥ç¼–å†™çš„</p>
<p>åŒç†, å¸¸é‡, å¸¸é‡æŒ‡é’ˆ, è¿™äº›ä¸œè¥¿åªè¦ç»•è¿‡ç¼–è¯‘å™¨è®¾çš„éšœç¢å°±å¯ä»¥ä¿®æ”¹ (çªç„¶æ„Ÿå—åˆ°äº†æŒ‡é’ˆçš„é­…åŠ›)</p>
<p>æ³¨: ç»æµ‹è¯•, ä»£ç åœ¨ 4.4 ç‰ˆæœ¬ä¸‹çš„ç¼–è¯‘å™¨å¯ä»¥, è€Œ 4.8 ç‰ˆæœ¬çš„å°±ä¸è¡Œ</p>
]]></content>
  </entry>
  <entry>
    <title>other/sed</title>
    <url>/2020/01/09/other/sed/</url>
    <content><![CDATA[<h1 id="sed"><a href="#sed" class="headerlink" title="sed"></a>sed</h1><p>sedå¸¸ç”¨äºå¤„ç†æ–‡ä»¶, å®ƒä¼šé€è¡Œæ‰§è¡Œ</p>
<h3 id="åŸºç¡€é€‰é¡¹"><a href="#åŸºç¡€é€‰é¡¹" class="headerlink" title="åŸºç¡€é€‰é¡¹"></a>åŸºç¡€é€‰é¡¹</h3><h4 id="æ›¿æ¢"><a href="#æ›¿æ¢" class="headerlink" title="æ›¿æ¢"></a>æ›¿æ¢</h4><p>sé€‰é¡¹ç”¨äºæ›¿æ¢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed 's/text/val/' f.txt</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¯­å¥ä¼šå°† f.txt æ–‡æœ¬ä¸­çš„ text æ›¿æ¢æˆ val</p>
<p>@note: ä½†å®é™…ä¸ä¼šæ›´æ”¹æ–‡ä»¶å†…å®¹, è€Œä»…ä»…æ˜¯æ›¿æ¢åæ‰“å°å‡ºæ¥</p>
<p>â€‹    å¦‚æœæƒ³ä½œç”¨äºæ–‡ä»¶, éœ€è¦ç»“åˆ -i å‚æ•°</p>
<h4 id="åˆ é™¤"><a href="#åˆ é™¤" class="headerlink" title="åˆ é™¤"></a>åˆ é™¤</h4><p>dé€‰é¡¹åˆ é™¤</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/text/d' f.txt</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¯­å¥ä¼šå°†f.txt æ–‡æœ¬ä¸­å‡ºç° text çš„è¡Œåˆ é™¤</p>
<p>@btw: ä¸ºä»€ä¹ˆè¿™é‡Œçš„ d åœ¨åé¢?</p>
<h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="headerlink" title="ä¿®æ”¹"></a>ä¿®æ”¹</h4><p>cé€‰é¡¹ç”¨äºä¿®æ”¹</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">sed <span class="string">'/text/c test2'</span> f.txt</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¯­å¥ä¼šå°†f.txt æ–‡æœ¬ä¸­å‡ºç° text çš„è¡Œä¿®æ”¹æˆ test2</p>
<p>@note: ä¿®æ”¹ä¼šä¿®æ”¹æ•´ä¸ªä¸€è¡Œ</p>
<p>@btw: </p>
<p>â€‹    ä»è¯­ä¹‰ä¸Šæ¥è®²çš„è¯, è²Œä¼¼ç†è§£æˆæ›¿æ¢è¦åˆç†ä¸€äº›. å› ä¸ºæ˜¯æ›¿æ¢æ‰äº†æ•´ä¸ªä¸€è¡Œ</p>
<p>â€‹    ä½†æ˜¯ c é€‰é¡¹çš„å®Œæ•´å•è¯æ˜¯ change(ä¿®æ”¹), è€Œ s é€‰é¡¹çš„å®Œæ•´å•è¯æ˜¯ substitute(æ›¿æ¢)</p>
<p>â€‹    æ‰€ä»¥, éµä»ç¼–å†™è€…çš„åŸæ„, è¿™é‡Œç†è§£ä¸ºä¿®æ”¹æ•´ä¸ªä¸€è¡Œ</p>
<h4 id="è½¬æ¢"><a href="#è½¬æ¢" class="headerlink" title="è½¬æ¢"></a>è½¬æ¢</h4><p>yé€‰é¡¹ç”¨äºå¤„ç†å•ä¸ªå­—ç¬¦çš„è½¬æ¢</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed 'y/10/22/' f.txt</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šè¯­å¥ä¼šå°†f.txt æ–‡æœ¬ä¸­å‡ºç°çš„ 1 è½¬æ¢æˆ2, åŒæ—¶ 0 ä¹Ÿä¼šè½¬æ¢æˆ 2 </p>
<p>@note: å¯ä»¥å°†å‘½ä»¤ç½®äºæ–‡ä»¶ä¸­, ç„¶åä½¿ç”¨ -f é€‰é¡¹æŒ‡å®šæ–‡ä»¶</p>
<p>@btw: æ›¿æ¢ç±»å‹çš„å‘½ä»¤éƒ½æ˜¯å°†é€‰é¡¹ç½®äºè¡Œé¦–, å…¶ä½™å‡æ˜¯ç½®äºè¡Œå°¾</p>
<h4 id="å–å"><a href="#å–å" class="headerlink" title="å–å"></a>å–å</h4><p>! é€‰é¡¹ç”¨äºå–å</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/text/!d' f.txt</span><br></pre></td></tr></table></figure>

<p>åˆ é™¤ä¸åŒ…å« text æ–‡æœ¬çš„è¡Œ</p>
<p>@btw: å¦‚æœSQLä¹Ÿèƒ½ç›´æ¥å–åç»“æœé›†å°±å¥½äº† = =</p>
<h3 id="è¿›é˜¶"><a href="#è¿›é˜¶" class="headerlink" title="è¿›é˜¶"></a>è¿›é˜¶</h3><h4 id="ç§»åŠ¨"><a href="#ç§»åŠ¨" class="headerlink" title="ç§»åŠ¨"></a>ç§»åŠ¨</h4><p>né€‰é¡¹ç”¨äºç§»åŠ¨åˆ°ä¸‹ä¸€è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/text val/&#123;n;d&#125;' f.txt</span><br></pre></td></tr></table></figure>

<p>å½“è¿™æ¡è¯­å¥åŒ¹é…åˆ° text val æ—¶, ä¼šè·³è½¬åˆ°ä¸‹ä¸€è¡Œ, ç„¶ååˆ é™¤è¡Œ(åˆ é™¤çš„æ˜¯åŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œ)</p>
<h4 id="åˆå¹¶ä¸¤è¡Œ"><a href="#åˆå¹¶ä¸¤è¡Œ" class="headerlink" title="åˆå¹¶ä¸¤è¡Œ"></a>åˆå¹¶ä¸¤è¡Œ</h4><p>Né€‰é¡¹ç”¨äºå°†ä¸¤è¡Œçš„æ•°æ®è§†ä¸ºä¸€è¡Œæ¥å¤„ç†</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/text val/&#123;N;d&#125;' f.txt</span><br></pre></td></tr></table></figure>

<p>è¿™æ¡è¯­å¥ä¼šå°†åŒ¹é…è¡Œ, åŠåŒ¹é…è¡Œçš„ä¸‹ä¸€è¡Œ, å½“åšä¸€è¡Œå¤„ç†(ä¸€èµ·åˆ æ‰)</p>
<p>@btw: åŒæ ·çš„æ ¼å¼è¿˜æœ‰</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed 'N; /text val/d' f.txt</span><br></pre></td></tr></table></figure>

<p>å®ƒä¼šå®Œæˆå’Œä¸Šä¸ªæŒ‡ä»¤ä¸€æ ·çš„æ“ä½œ</p>
<h4 id="é€‰æ‹©æ€§åˆ é™¤"><a href="#é€‰æ‹©æ€§åˆ é™¤" class="headerlink" title="é€‰æ‹©æ€§åˆ é™¤"></a>é€‰æ‹©æ€§åˆ é™¤</h4><p>Dé€‰é¡¹â€¦ æ€ä¹ˆè¯´å‘¢ = = , çœ‹å®ä¾‹å§</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/text val/&#123;N;/val text/D&#125;' f.txt</span><br></pre></td></tr></table></figure>

<p>å½“æŸä¸€è¡Œæœ‰ text val æ—¶, å¹¶ä¸”ä¸‹ä¸€è¡Œæœ‰ val text æ—¶</p>
<p>Dé€‰é¡¹ä¼šåˆ é™¤å‰ä¸€ä¸ªåŒ¹é…è¡Œ(ä¹Ÿå°±æ˜¯è¯´ text val æ‰€åœ¨çš„è¡Œä¼šè¢«åˆ é™¤)</p>
<h4 id="å¤šè¡Œæ‰“å°"><a href="#å¤šè¡Œæ‰“å°" class="headerlink" title="å¤šè¡Œæ‰“å°"></a>å¤šè¡Œæ‰“å°</h4><p>emmmm, ç•¥(å¹¶ä¸æ˜¯è¯´ä¸ä¼š, è€Œæ˜¯æ„Ÿè§‰æ²¡ä»€ä¹ˆç”¨)</p>
<p>(Nå’ŒDå…¶å®è¿ç”¨ä¸Šå·²ç»å¾ˆå°‘äº†, På°±æ›´å°‘äº†â€¦)</p>
<h3 id="ä¿æŒç©ºé—´"><a href="#ä¿æŒç©ºé—´" class="headerlink" title="ä¿æŒç©ºé—´"></a>ä¿æŒç©ºé—´</h3><p>emmmm, ç•¥</p>
<p>(å€’ä¸æ˜¯è¯´ä¿æŒç©ºé—´æ²¡ç”¨, ç›¸å, ä¿æŒç©ºé—´åœ¨æŸäº›ç‰¹å®šçš„åœºåˆ)</p>
<p>(å®ƒèƒ½èµ·åˆ°ç‹¬ä¸€æ— äºŒçš„ä½œç”¨, ä½†æ˜¯ç°åœ¨å¯¹äºæˆ‘æ¥è¯´, äº†è§£ä¸€ä¸‹å°±å¥½ = =)</p>
<h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><p>bé€‰é¡¹ç”¨äºè·³è¿‡ä¸€äº›åˆ†æ”¯(bå®Œæ•´çš„å•è¯æ˜¯ branch, ä½†æ˜¯æˆ‘è§‰å¾— break æ€ä¹ˆæ›´å¥½ = =)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '&#123;2, 3b; s/10/\\/&#125;' f.txt</span><br></pre></td></tr></table></figure>

<p>å‘½ä»¤ä¼šå°† 10 æ›¿æ¢æˆ \ , ä½†æ˜¯ä¼šè·³è¿‡ 2 - 3 è¡Œ</p>
<p>@btw: åˆ†æ”¯å¯ä»¥æŒ‡å®šæ ‡è¯†ç¬¦, å°±åƒgotoä¸€æ ·. è¿™é‡Œå°±ç›´æ¥ç»™ä¸€ä¸ªä¹¦ä¸Šçš„ä¾‹å­</p>
<p><img src="https://i.imgur.com/aKj1l7Q.png" alt=""></p>
<p>emmmm, å°†ç¬¬ä¸€è¡Œæ ‡è®°(å…¶å®ä¹Ÿåªæœ‰ç¬¬ä¸€è¡Œ)</p>
<p>æ¯æ¬¡å°†ä¸€ä¸ªé€—å·åˆ é™¤(å…¶å®æ˜¯æ›¿æ¢), å¾ªç¯æ›¿æ¢</p>
<p>@btw:</p>
<p>â€‹    çœ‹ä¼¼å¾ˆå‰å®³, å®åˆ™æ²¡å•¥ç”¨, å› ä¸ºå¯ä»¥ç”¨ g </p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">```shell</span><br><span class="line">'s/,//g'</span><br><span class="line">```</span><br></pre></td></tr></table></figure>

<p>â€‹    ä¸Šè¿°é€‰é¡¹å°†ä¼šåšå‡ºåŒæ ·çš„æ•ˆæœ</p>
<p>â€‹    emmm, æˆ‘æ˜¯ä¸æ˜¯å¿˜äº†è¯´ g ?</p>
<p>â€‹    g ä»£è¡¨ä¿®æ”¹ä¼šä½œç”¨äºä¸€æ•´è¡Œ, å½“ç„¶ ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°å­—æ¥æŒ‡å®š</p>
<h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><p>ç•¥</p>
<h3 id="æ¨¡å¼æ›¿ä»£"><a href="#æ¨¡å¼æ›¿ä»£" class="headerlink" title="æ¨¡å¼æ›¿ä»£"></a>æ¨¡å¼æ›¿ä»£</h3><h4 id="é€šé…ç¬¦-amp"><a href="#é€šé…ç¬¦-amp" class="headerlink" title="é€šé…ç¬¦ &amp;"></a>é€šé…ç¬¦ &amp;</h4><p>&amp; ç”¨äºåŒ¹é…æ¨¡å¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed 's/.0/"&amp;"/g' f.txt</span><br></pre></td></tr></table></figure>

<p>&amp; åŒ¹é…æ•´ä¸ªæ¨¡å¼, ä»¥ä¸Šè¯­å¥å°†ä¼šç”¨ â€œâ€ æŠŠæ‰€æœ‰ 0 åŠ 0å‰é¢ çš„æ”¯ä»˜æ‹¬èµ·æ¥</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨å•ä¸ªæ¨¡å¼</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed 's/\(.\)\(0\)/\1 32/g' f.txt</span><br></pre></td></tr></table></figure>

<p>() æ‹¬èµ·æ¥çš„éƒ¨åˆ†è§†ä¸ºä¸€ä¸ªæ¨¡å¼, \1 å¼•ç”¨ä¸€ä¸ªæ¨¡å¼</p>
<p>ä¸Šè¿°è¯­å¥å°†ä¼šæŠŠæ‰€æœ‰ä»¥ .0 çš„è¯­å¥æ›¿æ¢ä¸º . 32 </p>
<p>@note: </p>
<p>â€‹    è¿™ä¸ªä¾‹å­å°†ä¼šåªä¿ç•™ . åŒ¹é…çš„å†…å®¹, è€Œ &amp; å°†ä¼šä¿ç•™æ‰€æœ‰å†…å®¹</p>
<p>â€‹    &amp; æ¨¡å¼åŒ¹é…æ˜¯æˆ‘åœ¨è¿›é˜¶ç« é‡Œé¢çœ‹åˆ°çš„æœ€æœ‰ç”¨çš„ä¸œè¥¿</p>
<p>emmm, å…³äº sed çš„å†…å®¹è¿˜æœ‰ä¸€äº›, ä¸è¿‡ç°åœ¨å°±å…ˆåˆ°è¿™é‡Œå§ = =</p>
<p>@supplement</p>
<p>â€‹    æ¨¡å¼åŒ¹é…: å¢/åˆ /æ”¹ä¸­å¯ä»¥è¿ç”¨æ¨¡å¼åŒ¹é…</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sed '/test/i\this is a test' t.txt</span><br></pre></td></tr></table></figure>

<p>â€‹    è¿™æ¡è¯­å¥å°†ä¼šåœ¨æœ‰ test å­—ç¬¦ä¸²çš„é‚£ä¸€è¡Œ, æ‰§è¡Œæ’å…¥æ“ä½œ</p>
]]></content>
  </entry>
  <entry>
    <title>other/some useful define</title>
    <url>/2020/01/09/other/some%20useful%20define/</url>
    <content><![CDATA[<h2 id="ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼"><a href="#ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼" class="headerlink" title="ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼"></a>ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼</h2><pre><code>// CE: condition expression, RETAIN: ä¿æŒ
#define CE_RETAIN1(a, b) ((a) ? (a) : (b))</code></pre><p>è€ƒè™‘ä¸€ä¸ªæƒ…å†µ, å½“ä¸€ä¸ªå€¼æœ‰æ•ˆæ—¶, ä½¿ç”¨å®ƒ, å¦åˆ™ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ•°<br>å¦‚æœç›´æ¥å†™çš„è¯, ä¸å¤ªå®¹æ˜“ç†è§£  </p>
<pre><code>(exp) ? (exp) : -1;</code></pre><p>å½“expéå¸¸é•¿çš„æ—¶å€™(æˆ–è®¸å¯ä»¥ä¿å­˜æˆå˜é‡, ä½†æ˜¯æŸäº›æƒ…å†µä¸‹, ä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆåå­—<br>è€Œè‡ªå·±æ¯”è¾ƒå¸¸ç”¨å˜é‡åå·®ä¸å¤šç”¨å…‰äº†, æˆ–è€…è¿™åªæ˜¯ä¸ªåªç”¨ä¸€æ¬¡çš„å€¼), å¦‚  </p>
<pre><code>val = func(a) * i + 10 ? func(a) * i + 10 : -1;</code></pre><p>è€Œå¦‚æœç”¨å®å®šä¹‰çš„è¯å°±æ¯”è¾ƒæ¸…æ™°äº†</p>
<pre><code>val = CE_RETAIN1(func(a) * i + 10, -1);</code></pre><p>PS: ä½†æ˜¯å¦‚æœçš„ç¡®å‡ºç°è¡¨è¾¾å¼è¿‡é•¿çš„æƒ…å†µ, å¯èƒ½è€ƒè™‘ä¼˜åŒ–ä»£ç æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 id="ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°"><a href="#ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°" class="headerlink" title="ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°"></a>ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°</h2><pre><code>void show() { setvisible(true); }    
void hide() { setvisible(false); }</code></pre><p>ä½¿ç”¨show(), hide()çš„æƒ…å†µä¸‹, ä¸€ç›®äº†ç„¶, è€Œé€šè¿‡å‚æ•°çš„è¯, ç†è§£ä¼šç¨éº»çƒ¦ä¸€äº›</p>
<h2 id="getInstance"><a href="#getInstance" class="headerlink" title="getInstance"></a>getInstance</h2><p>getInstanceå¤šæ•°æƒ…å†µä¸‹ä½œä¸ºä¸€ä¸ªç±»çš„å…¬æœ‰æ¥å£, ç”¨äºè·å¾—ä¸€ä¸ªå®ä¾‹<br>æ™®é€šçš„ä¹¦å†™æ–¹æ¡ˆå¦‚ä¸‹        </p>
<pre><code>class A{
    int i; // ä¸ä»…ä»…æ˜¯æ•°æ®, ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç±»
public:
    int&amp; getInstance() { return i; }
};</code></pre><p>ä½¿ç”¨è¿™ç§æ–¹å¼çš„æƒ…å†µä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜  </p>
<ol>
<li>å³ä½¿æˆ‘ä»ä¸ä½¿ç”¨i, ä¹Ÿä»æœªæ‰ç”¨è¿‡getInstanceè¿™ä¸ªå‡½æ•°, ä½†ä¾æ—§ç»™iåˆ†é…äº†ç©ºé—´  </li>
<li>iä¾æ—§èƒ½åœ¨å…¶ä»–æ¥å£ä¸­è¢«è®¿é—®  </li>
</ol>
<p>ä¸Šè¿°ä¸¤ç§æƒ…å†µå¹¶ä¸ä¸€å®šä¼šé€ æˆå½±å“, ä½†å¯ä»¥è€ƒè™‘æ’é™¤è¿™ç§éšè—é—®é¢˜  </p>
<pre><code>int&amp; getInstance() {
    static int i;

    return i;
}</code></pre><p>é™æ€å˜é‡åœ¨æœªè¢«è®¿é—®è¿‡çš„æƒ…å†µä¸‹, ä¸ä¼šåˆ†é…ç©ºé—´<br>å¹¶ä¸”åªå­˜åœ¨äºå½“å‰ä½œç”¨åŸŸ, æœ‰è‰¯å¥½çš„å®‰å…¨æ€§</p>
]]></content>
  </entry>
  <entry>
    <title>other/some useful skill</title>
    <url>/2020/01/09/other/some%20useful%20skill/</url>
    <content><![CDATA[<h2 id="ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼"><a href="#ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼" class="headerlink" title="ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼"></a>ä¿ç•™æ¡ä»¶è¡¨è¾¾å¼çš„ç¬¬ä¸€ä¸ªå€¼</h2><pre><code>// CE: condition expression, RETAIN: ä¿æŒ
#define CE_RETAIN1(a, b) ((a) ? (a) : (b))</code></pre><p>è€ƒè™‘ä¸€ä¸ªæƒ…å†µ, å½“ä¸€ä¸ªå€¼æœ‰æ•ˆæ—¶, ä½¿ç”¨å®ƒ, å¦åˆ™ä½¿ç”¨å¦å¤–ä¸€ä¸ªæ•°<br>å¦‚æœç›´æ¥å†™çš„è¯, ä¸å¤ªå®¹æ˜“ç†è§£  </p>
<pre><code>(exp) ? (exp) : -1;</code></pre><p>å½“expéå¸¸é•¿çš„æ—¶å€™(æˆ–è®¸å¯ä»¥ä¿å­˜æˆå˜é‡, ä½†æ˜¯æŸäº›æƒ…å†µä¸‹, ä¸çŸ¥é“è¯¥ç”¨ä»€ä¹ˆåå­—<br>è€Œè‡ªå·±æ¯”è¾ƒå¸¸ç”¨å˜é‡åå·®ä¸å¤šç”¨å…‰äº†, æˆ–è€…è¿™åªæ˜¯ä¸ªåªç”¨ä¸€æ¬¡çš„å€¼), å¦‚  </p>
<pre><code>val = func(a) * i + 10 ? func(a) * i + 10 : -1;</code></pre><p>è€Œå¦‚æœç”¨å®å®šä¹‰çš„è¯å°±æ¯”è¾ƒæ¸…æ™°äº†</p>
<pre><code>val = CE_RETAIN1(func(a) * i + 10, -1);</code></pre><p>PS: ä½†æ˜¯å¦‚æœçš„ç¡®å‡ºç°è¡¨è¾¾å¼è¿‡é•¿çš„æƒ…å†µ, å¯èƒ½è€ƒè™‘ä¼˜åŒ–ä»£ç æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ¡ˆ</p>
<h2 id="ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°"><a href="#ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°" class="headerlink" title="ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°"></a>ç›´æ¥é¢å‘ç»“æœçš„å‡½æ•°</h2><pre><code>void show() { setvisible(true); }    
void hide() { setvisible(false); }</code></pre><p>ä½¿ç”¨show(), hide()çš„æƒ…å†µä¸‹, ä¸€ç›®äº†ç„¶, è€Œé€šè¿‡å‚æ•°çš„è¯, ç†è§£ä¼šç¨éº»çƒ¦ä¸€äº›</p>
<h2 id="getInstance"><a href="#getInstance" class="headerlink" title="getInstance"></a>getInstance</h2><p>getInstanceå¤šæ•°æƒ…å†µä¸‹ä½œä¸ºä¸€ä¸ªç±»çš„å…¬æœ‰æ¥å£, ç”¨äºè·å¾—ä¸€ä¸ªå®ä¾‹<br>æ™®é€šçš„ä¹¦å†™æ–¹æ¡ˆå¦‚ä¸‹        </p>
<pre><code>class A{
    int i; // ä¸ä»…ä»…æ˜¯æ•°æ®, ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªç±»
public:
    int&amp; getInstance() { return i; }
};</code></pre><p>ä½¿ç”¨è¿™ç§æ–¹å¼çš„æƒ…å†µä¼šå­˜åœ¨ä¸¤ä¸ªé—®é¢˜  </p>
<ol>
<li>å³ä½¿æˆ‘ä»ä¸ä½¿ç”¨i, ä¹Ÿä»æœªæ‰ç”¨è¿‡getInstanceè¿™ä¸ªå‡½æ•°, ä½†ä¾æ—§ç»™iåˆ†é…äº†ç©ºé—´  </li>
<li>iä¾æ—§èƒ½åœ¨å…¶ä»–æ¥å£ä¸­è¢«è®¿é—®  </li>
</ol>
<p>ä¸Šè¿°ä¸¤ç§æƒ…å†µå¹¶ä¸ä¸€å®šä¼šé€ æˆå½±å“, ä½†å¯ä»¥è€ƒè™‘æ’é™¤è¿™ç§éšè—é—®é¢˜  </p>
<pre><code>int&amp; getInstance() {
    static int i;

    return i;
}</code></pre><p>é™æ€å˜é‡åœ¨æœªè¢«è®¿é—®è¿‡çš„æƒ…å†µä¸‹, ä¸ä¼šåˆ†é…ç©ºé—´<br>å¹¶ä¸”åªå­˜åœ¨äºå½“å‰ä½œç”¨åŸŸ, æœ‰è‰¯å¥½çš„å®‰å…¨æ€§</p>
<h2 id="ä¿å­˜å˜é‡"><a href="#ä¿å­˜å˜é‡" class="headerlink" title="ä¿å­˜å˜é‡"></a>ä¿å­˜å˜é‡</h2><p>å±€éƒ¨å˜é‡é€Ÿåº¦ä¼˜äºå‡½æ•°è°ƒç”¨, ç±»ä¼¼å¦‚æœé¢‘ç¹ç”¨åˆ°æ•°ç»„çš„é•¿åº¦, å¯ä»¥ä½¿ç”¨å˜é‡ä¿å­˜.size()çš„å€¼</p>
]]></content>
  </entry>
  <entry>
    <title>other/sort</title>
    <url>/2020/01/09/other/sort/</url>
    <content><![CDATA[<p><a href="https://www.hackerearth.com/zh/practice/algorithms/sorting/bubble-sort/tutorial/" target="_blank" rel="noopener">source link</a></p>
<h2 id="Sort"><a href="#Sort" class="headerlink" title="Sort"></a>Sort</h2><h3 id="Bubble-Sort"><a href="#Bubble-Sort" class="headerlink" title="Bubble Sort"></a>Bubble Sort</h3><p>Bubble is the most common algorithm to sort an array. It based on the idea of repeatedly comparing adjacent element and then swapping their  value if exist in the wrong order </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bubbleSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; nums.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[j])</span><br><span class="line">                swap(nums[i], nums[j]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Selection-sort"><a href="#Selection-sort" class="headerlink" title="Selection sort"></a>Selection sort</h3><p>The selection sort is based on finding the minimum or maximum in an unsorted array and putting it to a sorted array</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">selectionSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">min</span> = i;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>; j &lt; nums.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[<span class="built_in">min</span>] &gt; nums[j])</span><br><span class="line">                <span class="built_in">min</span> = j;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums[i], nums[<span class="built_in">min</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Insertion-sort"><a href="#Insertion-sort" class="headerlink" title="Insertion sort"></a>Insertion sort</h3><p>From left to right, find each elementâ€™s correct position</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insertSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; nums.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> v = nums[i];</span><br><span class="line">        <span class="keyword">int</span> j = i;</span><br><span class="line">        <span class="keyword">while</span>(j &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            nums[j] = nums[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (nums[j] &lt;= v)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            --j;                            </span><br><span class="line">        &#125;</span><br><span class="line">        nums[j] = v;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Merge-sort"><a href="#Merge-sort" class="headerlink" title="Merge sort"></a>Merge sort</h3><p>Merge sort is a divide-and-conquer algorithm based on repeatedly breaking down an array to two sub-array and then merge them</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> q = m + <span class="number">1</span>, p = b;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt;= e; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p &gt; m)</span><br><span class="line">            v.push_back(nums[q++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (q &gt; e)</span><br><span class="line">            v.push_back(nums[p++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[q] &gt; nums[p])</span><br><span class="line">            v.push_back(nums[p++]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            v.push_back(nums[q++]);              </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> val : v)</span><br><span class="line">        nums[b++] = val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">mergeSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    mergeSort(nums, b, (e + b) / <span class="number">2</span>);</span><br><span class="line">    mergeSort(nums, (e + b) / <span class="number">2</span> + <span class="number">1</span>, e);</span><br><span class="line">    merge(nums, b, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Quick-sort"><a href="#Quick-sort" class="headerlink" title="Quick sort"></a>Quick sort</h3><p>Quick sort is also a divide-and-conquer algorithm. But it reduces the space complexity and removes the use of auxiliary array that is used in merger sort<br>One of the most important factors to influence performance is the pivot.<br>I chose the pivot from the middle, front, and back of the array. Sometimes will improve performance</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">partion</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> p = e;</span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[m])</span><br><span class="line">        swap(nums[b], nums[m]);</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[e])</span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    <span class="keyword">if</span> (nums[m] &gt; nums[e])</span><br><span class="line">        swap(nums[m], nums[e]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> piv = nums[m];</span><br><span class="line">    swap(nums[e--], nums[m]);</span><br><span class="line">    <span class="keyword">while</span> (b &lt; e) &#123;</span><br><span class="line">        <span class="keyword">while</span> (b &lt; e &amp;&amp; nums[b] &lt; piv)</span><br><span class="line">            ++b;</span><br><span class="line">        <span class="keyword">while</span> (b &lt; e &amp;&amp; nums[e] &gt;= piv)</span><br><span class="line">            --e;</span><br><span class="line">        <span class="keyword">if</span> (b &gt;= e) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    &#125;</span><br><span class="line">    swap(nums[p], nums[b]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> p = partion(nums, b, e);</span><br><span class="line">    quickSort(nums, b, p - <span class="number">1</span>);</span><br><span class="line">    quickSort(nums, p + <span class="number">1</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Heap-sort"><a href="#Heap-sort" class="headerlink" title="Heap sort"></a>Heap sort</h3><p>Heap sort uses a structure called heap to sort the array. Heap is a complete binary tree.<br>left sub-tree index = 2 * root index + 1<br>right sub-tree index = 2 * root index + 2</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapify</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> n, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> largest = i;</span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">2</span> * i + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> r = l + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (l &lt; n &amp;&amp; nums[l] &gt; nums[largest])</span><br><span class="line">        largest = l;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (r &lt; n &amp;&amp; nums[r] &gt; nums[largest])</span><br><span class="line">        largest = r;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (largest != i) &#123;</span><br><span class="line">        swap(nums[i], nums[largest]);</span><br><span class="line">        heapify(nums, n, largest);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">heapSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums)</span> </span>&#123;                </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.<span class="built_in">size</span>() / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i)</span><br><span class="line">        heapify(nums, nums.<span class="built_in">size</span>(), i);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.<span class="built_in">size</span>() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">        swap(nums[<span class="number">0</span>], nums[i]);</span><br><span class="line">        heapify(nums, i, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>other/sort2</title>
    <url>/2020/01/09/other/sort2/</url>
    <content><![CDATA[<p>this is a follow-up to <a href="http://49.235.55.145/html_note/sort.html" target="_blank" rel="noopener">sort</a></p>
<p>these sort algorithms based on &lt;Algorithms, 4th&gt;</p>
<h2 id="shell-sort"><a href="#shell-sort" class="headerlink" title="shell sort"></a>shell sort</h2><p>shell sort is a better version sort algorithm based on insert sort.</p>
<p>when a[0] is the biggest number but head of array, for move the number to the end of the array, need swap length(a) elements. </p>
<p>shell sort æ˜¯åŸºäºæ’å…¥æ’åºçš„æ”¹è‰¯ç‰ˆæœ¬</p>
<p>å½“ a[0] æ˜¯æ•´ä¸ªæ•°ç»„æœ€å¤§çš„å…ƒç´ æ—¶, ä¸ºäº†ç§»åŠ¨è¿™ä¸ªå…ƒç´ åˆ°æ•°ç»„çš„å°¾ç«¯, éœ€è¦äº¤æ¢ length(a) æ¬¡å…ƒç´ . </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">shellSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &lt; v.<span class="built_in">size</span>() / <span class="number">3</span>) h = h * <span class="number">3</span> + <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (h &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = h; j &lt; v.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = j; i &gt;= h &amp;&amp; v[i] &lt; v[i - h]; i -= h)</span><br><span class="line">                swap(v[i], v[i - h]);                         </span><br><span class="line">        &#125;</span><br><span class="line">        h /= <span class="number">3</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="bottom-up-sort"><a href="#bottom-up-sort" class="headerlink" title="bottom-up sort"></a>bottom-up sort</h2><p>bottom-up sort is a down-top method based on merge sort.</p>
<p>bottom-up sort åŸºäºåˆå¹¶æ’åº, æ˜¯ä¸€ç§ä»åº•è‡³ä¸Šçš„æ–¹æ³•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v, <span class="keyword">int</span> b, <span class="keyword">int</span> m, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v2 = v;</span><br><span class="line">    <span class="keyword">int</span> mid = m++;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = b; i &lt;= e; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (b &gt; mid)</span><br><span class="line">            v[i] = v2[m++];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (m &gt; e)</span><br><span class="line">            v[i] = v2[b++];</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (v2[b] &lt; v2[m])</span><br><span class="line">            v[i] = v2[b++];</span><br><span class="line">        <span class="keyword">else</span>Â·</span><br><span class="line">            v[i] = v2[m++];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">bottomupSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; v.<span class="built_in">size</span>(); i *= <span class="number">2</span>)&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; v.<span class="built_in">size</span>() - i; j = j + <span class="number">2</span> * i)</span><br><span class="line">			merge(v, j, j + i <span class="number">-1</span>, <span class="built_in">min</span>(<span class="keyword">int</span>(v.<span class="built_in">size</span>() - <span class="number">1</span>, j + <span class="number">2</span> * i - <span class="number">1</span>)));</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="a-better-version-of-quick-sort"><a href="#a-better-version-of-quick-sort" class="headerlink" title="a better version of quick sort"></a>a better version of quick sort</h2><p>if an array with some duplicate numbers,  skip these numbers will be more effective</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> QS_MIN_LENGTH 7</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">quickSort</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;nums, <span class="keyword">int</span> b, <span class="keyword">int</span> e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (b &gt;= e) <span class="keyword">return</span>;                          </span><br><span class="line"></span><br><span class="line">    <span class="comment">// if element too little, insertSort more effective than quickSort</span></span><br><span class="line">    <span class="keyword">if</span> (e - b &lt; QS_MIN_LENGTH)</span><br><span class="line">        insertSort(nums, b, e);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// meduim of three can get more effetive pivot</span></span><br><span class="line">    <span class="keyword">int</span> m = (b + e) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[m])</span><br><span class="line">        swap(nums[b], nums[m]);</span><br><span class="line">    <span class="keyword">if</span> (nums[b] &gt; nums[e])</span><br><span class="line">        swap(nums[b], nums[e]);</span><br><span class="line">    <span class="keyword">if</span> (nums[m] &gt; nums[e])</span><br><span class="line">        swap(nums[m], nums[e]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> pivot = nums[m];</span><br><span class="line">    <span class="comment">// skip elements equal pivot</span></span><br><span class="line">    <span class="keyword">int</span> lt = b + <span class="number">1</span>, eq = lt, gt = e - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (eq &lt;= gt) &#123; </span><br><span class="line">        <span class="keyword">if</span> (nums[eq] &lt; pivot)</span><br><span class="line">            swap(nums[lt++], nums[eq++]);</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (nums[eq] &gt; pivot)</span><br><span class="line">            swap(nums[eq], nums[gt--]);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            eq++;</span><br><span class="line">    &#125;       </span><br><span class="line"></span><br><span class="line">    quickSort(nums, b, lt - <span class="number">1</span>);</span><br><span class="line">    quickSort(nums, gt + <span class="number">1</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="a-sort-algorithm-without-compare"><a href="#a-sort-algorithm-without-compare" class="headerlink" title="a sort algorithm without compare"></a>a sort algorithm without compare</h3><p>I saw a string sort algorithm without compare in &lt;algorithm 4th&gt;. so take some notes</p>
<p>Iâ€™m to lazy to write this code, please check the bookâ€¦</p>
]]></content>
  </entry>
  <entry>
    <title>other/useful skill</title>
    <url>/2020/01/09/other/useful%20skill/</url>
    <content><![CDATA[<h4 id="vimä¸­æ‰§è¡Œcmd"><a href="#vimä¸­æ‰§è¡Œcmd" class="headerlink" title="vimä¸­æ‰§è¡Œcmd"></a>vimä¸­æ‰§è¡Œcmd</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">!cmd</span><br></pre></td></tr></table></figure>



<h4 id="vimä¸­ç¼–å†™é¢å¤–çš„æ–‡ä»¶"><a href="#vimä¸­ç¼–å†™é¢å¤–çš„æ–‡ä»¶" class="headerlink" title="vimä¸­ç¼–å†™é¢å¤–çš„æ–‡ä»¶"></a>vimä¸­ç¼–å†™é¢å¤–çš„æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">args filename</span><br></pre></td></tr></table></figure>



<h4 id="sedå¤„ç†æ–‡ä»¶"><a href="#sedå¤„ç†æ–‡ä»¶" class="headerlink" title="sedå¤„ç†æ–‡ä»¶"></a>sedå¤„ç†æ–‡ä»¶</h4><h4 id="atå’Œcrontabå®šæ—¶"><a href="#atå’Œcrontabå®šæ—¶" class="headerlink" title="atå’Œcrontabå®šæ—¶"></a>atå’Œcrontabå®šæ—¶</h4><h4 id="æµé‡å®šå‘"><a href="#æµé‡å®šå‘" class="headerlink" title="æµé‡å®šå‘"></a>æµé‡å®šå‘</h4><p>â€œ&gt;â€:  è¾“å‡ºé‡å®šå‘, è¿™ä¸ªæ“ä½œç¬¦ä¼šè¦†ç›–å·²æœ‰æ–‡ä»¶çš„å†…å®¹, è‹¥æ–‡ä»¶ä¸å­˜åœ¨, åˆ™åˆ›å»º</p>
<p>â€œ&gt;&gt;â€: åŒæ ·ä¹Ÿæ˜¯è¾“å‡ºé‡å®šå‘, è¿™ä¸ªæ“ä½œç¬¦ä¼šå°†å†…å®¹æ·»åŠ åˆ°æ–‡ä»¶å°¾éƒ¨, åŒæ ·çš„, è‹¥æ–‡ä»¶ä¸å­˜åœ¨, åˆ™åˆ›å»ºæ–‡ä»¶</p>
<p>@note:</p>
<p>â€‹    æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯å†…è”è¾“å…¥é‡å®šå‘: â€œ&lt;&lt;â€, æˆ‘ç°åœ¨ä¹Ÿä¸å¤ªæ˜ç™½è¿™ä¸œè¥¿çš„å®è´¨ç”¨æ³•å’Œå«ä¹‰</p>
<p>â€‹    åªçŸ¥é“å®ƒçš„è¡Œä¸º: å®ƒå¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œçš„å†…å®¹ä½œä¸ºè¾“å…¥æµ, å¹¶ä¸”å¯ä»¥æŒ‡å®šä¸€ä¸ªâ€æ ‡è¯†â€æ¥è¡¨ç¤ºç»“æŸ</p>
<h4 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h4><p>@brief: </p>
<p>â€‹    å°†ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥. ä¾‹å¦‚:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat file | less</span><br></pre></td></tr></table></figure>

<p>catä»…ä»…åªæ˜¯æŸ¥çœ‹æ–‡ä»¶, ä½†å¹¶ä¸ä¼šå¢åŠ ä¸€äº›æ§åˆ¶åŠŸèƒ½(å¦‚ç¿»é¡µ, æœç´¢â€¦)  </p>
<p>lessåˆ™æä¾›äº†ç›¸å…³çš„æ›´é«˜çº§çš„åŠŸèƒ½, å°†catçš„è¾“å…¥(æ–‡ä»¶å†…å®¹)ä½œä¸ºlessçš„è¾“å…¥</p>
<p>@note: </p>
<p>â€‹    å…¶å®è¿™ä¸ªä¾‹å­å¾ˆæ²¡æœ‰å¿…è¦, ç°å®ä¸­è¿™ä¹ˆå†™, å¯èƒ½ä¼šè¢«dissåˆ°æ­». å› ä¸ºå¯ä»¥ç›´æ¥ä½¿ç”¨ less file</p>
<h4 id="åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶"><a href="#åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶" class="headerlink" title="åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶"></a>åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch file</span><br></pre></td></tr></table></figure>



<h4 id="ç½®ç©ºæ–‡ä»¶å†…å®¹"><a href="#ç½®ç©ºæ–‡ä»¶å†…å®¹" class="headerlink" title="ç½®ç©ºæ–‡ä»¶å†…å®¹"></a>ç½®ç©ºæ–‡ä»¶å†…å®¹</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat /dev/null &gt; file</span><br></pre></td></tr></table></figure>

<p>@note: </p>
<p>â€‹    æ›´åŠ ç®€ä¾¿çš„æ–¹å¼æ˜¯ &gt; file</p>
<h4 id="å•å¼•å·å’ŒåŒå¼•å·"><a href="#å•å¼•å·å’ŒåŒå¼•å·" class="headerlink" title="å•å¼•å·å’ŒåŒå¼•å·"></a>å•å¼•å·å’ŒåŒå¼•å·</h4><p>éœ€è¦æ³¨æ„çš„æ˜¯, å•å¼•å·ä¸­, åŒå¼•å·ä¸éœ€è¦è½¬ä¹‰.</p>
<p>åŒæ ·çš„, åŒå¼•å·ä¸­, å•å¼•å·ä¸éœ€è¦è½¬ä¹‰</p>
<p>è¿™ä¼šåœ¨æŸäº›åœºåˆä¸‹, è®©ä½ çš„å­—ç¬¦ä¸²æ›´åŠ ç®€æ´æ˜“æ‡‚, åŒæ—¶è¿˜æ›´å¥½æ”¹, æ›´ä¸å®¹æ˜“å†™é”™</p>
<p>@ps:</p>
<p>â€‹    æˆ‘æ›¾åœ¨ä¸€æ¬¡ crontab ä»»åŠ¡ä¸­é‡åˆ°è¿™ç§åœºåˆ, æˆ‘ä½¿ç”¨äº† crontab file çš„å½¢å¼æ¥æ·»åŠ ä»»åŠ¡</p>
<p>â€‹    åŒæ—¶ä½¿ç”¨ echo + é‡å®šå‘ çš„å½¢å¼å¾€æ–‡ä»¶ä¸­æ·»åŠ å†…å®¹, è€Œè¦æ‰§è¡Œçš„å‘½ä»¤ä¸­å°±åŒ…å«äº›è®¸å•å¼•å·å’ŒåŒå¼•å·</p>
<p>â€‹    (ä¸è¿‡æˆ‘å€’æ˜¯æ²¡æœ‰åœ¨è¿™é‡Œé¢ç”¨åˆ°è¿™ä¸ªæŠ€å·§, å› ä¸ºæˆ‘ç¬¬ä¸€æ¬¡å°±å†™å¯¹äº† :) )</p>
<h4 id="md5åŠ å¯†"><a href="#md5åŠ å¯†" class="headerlink" title="md5åŠ å¯†"></a>md5åŠ å¯†</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo "test" | md5sum</span><br></pre></td></tr></table></figure>



<h4 id="æŸ¥çœ‹è‡ªå·±çš„å…¬ç½‘ä¿¡æ¯"><a href="#æŸ¥çœ‹è‡ªå·±çš„å…¬ç½‘ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è‡ªå·±çš„å…¬ç½‘ä¿¡æ¯"></a>æŸ¥çœ‹è‡ªå·±çš„å…¬ç½‘ä¿¡æ¯</h4><pre><code>curl cip.cc</code></pre><p>ç®€æ: curl ä¸ºä¸€ä¸ªåœ¨æœåŠ¡å™¨ä¸­ä¼ é€’æ•°æ®çš„æ”»å‡», è€Œ cip.cc ä¸ºä¸€ä¸ªæŸ¥è¯¢ç½‘ç»œä¿¡æ¯çš„ç½‘ç«™  </p>
<p>å½“ä½ ç™»å½• cip.cc æ—¶, å®ƒåº”å½“ä¼šæ ¹æ®ä½ è®¿é—®ç½‘ç«™æ—¶çš„ä¿¡æ¯, æŸ¥è¯¢ä½  IP çš„ç›¸å…³ä¿¡æ¯, å¹¶è¿”è¿˜ç»™ä½ </p>
<h4 id="ä¼ é€’å¤§é‡æ–‡ä»¶-è¿œç«¯å’Œæœ¬åœ°"><a href="#ä¼ é€’å¤§é‡æ–‡ä»¶-è¿œç«¯å’Œæœ¬åœ°" class="headerlink" title="ä¼ é€’å¤§é‡æ–‡ä»¶(è¿œç«¯å’Œæœ¬åœ°)"></a>ä¼ é€’å¤§é‡æ–‡ä»¶(è¿œç«¯å’Œæœ¬åœ°)</h4><pre><code>rsync</code></pre><p>å…·ä½“ç”¨æ³•å‚ç…§ man æ‰‹å†Œ</p>
<h4 id="æŸ¥çœ‹æœ¬åœ°IPç«¯å£ä¿¡æ¯"><a href="#æŸ¥çœ‹æœ¬åœ°IPç«¯å£ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æœ¬åœ°IPç«¯å£ä¿¡æ¯"></a>æŸ¥çœ‹æœ¬åœ°IPç«¯å£ä¿¡æ¯</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">netstat -tunlp</span><br></pre></td></tr></table></figure>

<p>t : TCP</p>
<p>u : UDP</p>
<p>n : ä¸ç»è¿‡åŸŸåæœåŠ¡å™¨</p>
<p>l : æ˜¾ç¤ºç›‘æ§ä¸­æœåŠ¡å™¨çš„socket</p>
<p>p : æ˜¾ç¤ºç›‘æ§ä¸­çš„ç¨‹åºè¯†åˆ«ç å’Œåç§°    </p>
<p>@btw: å¯ä»¥åŠ å…¥ -a é€‰é¡¹, è¿™ä¼šå°†æ‰€æœ‰(åŒ…æ‹¬å½“å‰æœªç›‘å¬)çš„ç«¯å£ä¿¡æ¯éƒ½åˆ—å‡ºæ¥</p>
<p>â€‹    ä¸ä¹‹ç›¸å…³çš„å‘½ä»¤è¿˜æœ‰ nmap, nc</p>
<h4 id="æŸ¥çœ‹æœ¬æœºæœåŠ¡"><a href="#æŸ¥çœ‹æœ¬æœºæœåŠ¡" class="headerlink" title="æŸ¥çœ‹æœ¬æœºæœåŠ¡"></a>æŸ¥çœ‹æœ¬æœºæœåŠ¡</h4><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service --status-all | grep running</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹æœ¬æœºç°åœ¨è¿è¡Œçš„æ‰€æœ‰æœåŠ¡</p>
<p>@note: â€“status-all ä¹‹é—´ä¸èƒ½ç©ºæ ¼.  â€œâ€“status -allâ€ è¿™æ˜¯é”™è¯¯çš„å†™æ³•</p>
]]></content>
  </entry>
  <entry>
    <title>other/virtualFunction</title>
    <url>/2020/01/09/other/virtualFunction/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æƒ³æ·±å…¥äº†è§£ä¸€ä¸‹(æˆ–è€…è¯´éªŒè¯)å¯¹è±¡åº•å±‚æ˜¯å¦‚ä½•å·¥ä½œçš„</p>
<p>é‡ç‚¹æ˜¯è™šå‡½æ•°çš„è°ƒç”¨, è™šæŒ‡é’ˆçš„ç”Ÿæˆ, è™šè¡¨ä¸­çš„æ•°æ®</p>
<p>ä»¥åŠè¿™äº›æ•°æ®åœ¨å¤šé‡ç»§æ‰¿, è™šç»§æ‰¿, å¤šé‡è™šç»§æ‰¿ç¯å¢ƒä¸‹çš„è¡¨ç°</p>
<h3 id="è™šæŒ‡é’ˆ-virtual-point"><a href="#è™šæŒ‡é’ˆ-virtual-point" class="headerlink" title="è™šæŒ‡é’ˆ(virtual point)"></a>è™šæŒ‡é’ˆ(virtual point)</h3><p>è€ƒè™‘ä»¥ä¸‹ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"A %d\n"</span>, _i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"A2 %d\n"</span>, _i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">10</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="keyword">void</span> <span class="title">func</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"B %d\n"</span>, _i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">20</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    B b;</span><br><span class="line">    A *pa = &amp;b;</span><br><span class="line">    </span><br><span class="line">    pa-&gt;func();		<span class="comment">// B 20</span></span><br><span class="line">    pa-&gt;func2();	<span class="comment">// A2 10</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¾“å‡ºå’Œé¢„æœŸä¸€è‡´, å…¶ä¸­ func æ˜¯è¢« B è¦†ç›–è¿‡çš„è™šå‡½æ•°, è€Œ func2 åˆ™æœªè¢«è¦†ç›–</p>
<p>ä»¥ä¸‹æ˜¯ç”Ÿæˆçš„æ±‡ç¼–ä»£ç :</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB1199:</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    subq    $32, %rsp</span><br><span class="line">    movq    $_ZTV1B+16, -32(%rbp)	&#x2F;&#x2F; åˆæ˜¯è¿™ä¸ªä¸œè¥¿, ç°åœ¨æˆ‘æ€€ç–‘å®ƒæ˜¯ lippman è¯´çš„ thunk</span><br><span class="line">    							&#x2F;&#x2F; åé¢çŸ¥é“äº†, **å…¶å®è¿™å°±æ˜¯è™šæŒ‡é’ˆ, å®ƒè¢«æ”¾åˆ°äº†å¤´éƒ¨**</span><br><span class="line">    							&#x2F;&#x2F; ç¼–è¯‘å™¨éå¸¸èªæ˜, åœ¨å³ä½¿æœ‰ vptr, nontrivial çš„æƒ…å†µä¸‹</span><br><span class="line">    							&#x2F;&#x2F; ä¹Ÿå¹¶æœªç”Ÿæˆæ„é€ å‡½æ•°</span><br><span class="line">    movl    $10, -24(%rbp)	</span><br><span class="line">    movl    $20, -20(%rbp)</span><br><span class="line">    leaq    -32(%rbp), %rax</span><br><span class="line">    movq    %rax, -8(%rbp)</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movq    (%rax), %rax	&#x2F;&#x2F; rax &#x3D; vptr	æ‹¿åˆ°è™šæŒ‡é’ˆåœ°å€</span><br><span class="line">    movq    (%rax), %rax	&#x2F;&#x2F; rax &#x3D; *vptr	è·å¾—è™šæŒ‡é’ˆä¸­çš„åœ°å€(æ§½ 0)</span><br><span class="line">    movq    -8(%rbp), %rdx	&#x2F;&#x2F; member data æ˜¯ç›´æ¥ä½ç§»å¾—åˆ°çš„</span><br><span class="line">    movq    %rdx, %rdi</span><br><span class="line">    call    *%rax		&#x2F;&#x2F; è°ƒç”¨slot0</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movq    (%rax), %rax</span><br><span class="line">    addq    $8, %rax	&#x2F;&#x2F; è™šæŒ‡é’ˆåœ°å€ +8 ä½ç§»(ä¹Ÿå°±æ˜¯ä¸‹ä¸€ä¸ªæ§½)</span><br><span class="line">    movq    (%rax), %rax	&#x2F;&#x2F; è·å¾— slot1 çš„åœ°å€</span><br><span class="line">    movq    -8(%rbp), %rdx</span><br><span class="line">    movq    %rdx, %rdi</span><br><span class="line">    call    *%rax	&#x2F;&#x2F; è°ƒç”¨slot1</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>

<p>æ‰€ä»¥è°ƒç”¨æ–¹å¼å’Œä¹¦ä¸­ä¸€è‡´, ä» vptr ç´¢å¼•è™šè¡¨, è·å¾—ç›¸åº”çš„ slot</p>
<p>è¿™äº›ä¿¡æ¯å…¨éƒ¨éƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™ç”±ç¼–è¯‘å™¨ç”Ÿæˆ</p>
<p>æœ‰ä¸€ä¸ªç‚¹æˆ‘å¿½ç•¥äº†: <strong>å•ä¸€ç»§æ‰¿å¯¹è±¡åªæœ‰ä¸€ä¸ªè™šè¡¨</strong></p>
<p>åç»­æˆ‘åŠ ä¸Š C å¯¹è±¡å( C ç»§æ‰¿è‡ª A ), è®© B ç»§æ‰¿ A, è¿™æ ·Aä¸­å°±æœ‰ B C</p>
<p>ä½†æ˜¯ä¾æ—§åªæœ‰ä¸€ä¸ªè™šè¡¨, ä»…å½“æˆ‘è®©Aå†ç»§æ‰¿ä¸€ä¸ªå¯¹è±¡æ—¶, è¿™æ—¶äº§ç”Ÿäº† 2 ä¸ªè™šè¡¨</p>
<p>å¯èƒ½ä¼šé—®, é‚£ä¹ˆCå¯¹è±¡æ˜¯å¦‚ä½•é€šè¿‡ pc-&gt;A::func() è¿™æ ·çš„å½¢å¼æ¥è°ƒç”¨ A ä½œç”¨åŸŸçš„å‡½æ•°çš„å‘¢?</p>
<p>ç­”æ¡ˆæ˜¯, è¿™ä¼šæ˜¯ä¸€ä¸ªå•çº¯çš„å‡½æ•°è°ƒç”¨, å¹¶ä¸ä¼šé€šè¿‡è™šè¡¨æˆ–è™šæŒ‡é’ˆ, ä¹Ÿæ²¡æœ‰ä»»ä½•çš„åç§»</p>
<p>(emmmâ€¦ ä¹Ÿå°±æ˜¯è¯´æ™®é€šæˆå‘˜å‡½æ•°å¯¹äºç±»æ¥è¯´, å¯èƒ½æ›´åƒæ˜¯ä¸ªé™Œç”Ÿäºº, å³ä½¿å®ƒæ˜¯æˆå‘˜)</p>
<p>(è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹åŸºç±»éœ€è¦ virtual destruct çš„åŸå› )</p>
<h3 id="è™šææ„æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„"><a href="#è™šææ„æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„" class="headerlink" title="è™šææ„æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„"></a>è™šææ„æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„</h3><p>åœ¨å†™æ ‡é¢˜çš„æ—¶å€™å¤§æ¦‚çŒœåˆ°äº†, å…¶å®è™šææ„å°±æ˜¯ä¸€ä¸ªåœ¨å­ç±»ä¸­å äº†ä¸€ä¸ªä¸èƒ½è¢«é‡å†™çš„è™šè¡¨æ§½</p>
<p>åº”è¯¥å°±æ˜¯é€šè¿‡ç®€å•çš„åç§»æ¥è°ƒç”¨çš„, æ¥è¯•ä¸€ä¸‹</p>
<p>(é‡ç‚¹åœ¨äºè™šææ„æ˜¯ä¸å¯èƒ½è¢«è¦†ç›–çš„, å› ä¸ºå­ç±»ä¸­ä¸å¯èƒ½å­˜åœ¨åŒåçš„å‡½æ•°)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"> <span class="number">5</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"> <span class="number">6</span> <span class="keyword">public</span>:</span><br><span class="line"> <span class="number">7</span>     <span class="keyword">virtual</span> ~A() &#123;</span><br><span class="line"> <span class="number">8</span>         <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, <span class="string">"A destruct"</span>);</span><br><span class="line"> <span class="number">9</span>     &#125;</span><br><span class="line"><span class="number">10</span> &#125;;</span><br><span class="line"><span class="number">11</span> </span><br><span class="line"><span class="number">12</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="number">13</span> <span class="keyword">public</span>:</span><br><span class="line"><span class="number">14</span>     <span class="keyword">virtual</span> ~B() &#123;</span><br><span class="line"><span class="number">15</span>         <span class="built_in">printf</span>(<span class="string">"%s\n"</span>, <span class="string">"B destruct"</span>);</span><br><span class="line"><span class="number">16</span>     &#125;</span><br><span class="line"><span class="number">17</span> &#125;;</span><br><span class="line"><span class="number">18</span> </span><br><span class="line"><span class="number">19</span> <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="number">20</span>     B a;</span><br><span class="line"><span class="number">21</span> </span><br><span class="line"><span class="number">22</span>     <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">23</span> &#125;</span><br></pre></td></tr></table></figure>

<p>æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">161 main:</span><br><span class="line">162 .LFB1204:</span><br><span class="line">163     .cfi_startproc</span><br><span class="line">164     pushq   %rbp</span><br><span class="line">165     .cfi_def_cfa_offset 16</span><br><span class="line">166     .cfi_offset 6, -16</span><br><span class="line">167     movq    %rsp, %rbp</span><br><span class="line">168     .cfi_def_cfa_register 6</span><br><span class="line">169     pushq   %rbx</span><br><span class="line">170     subq    $24, %rsp</span><br><span class="line">171     .cfi_offset 3, -24</span><br><span class="line">172     movq    $_ZTV1B+16, -32(%rbp)</span><br><span class="line">173     movl    $0, %ebx</span><br><span class="line">174     leaq    -32(%rbp), %rax</span><br><span class="line">175     movq    %rax, %rdi</span><br><span class="line">176     call    _ZN1BD1Ev	&#x2F;&#x2F; å°±æ˜¯è¿™é‡Œè°ƒç”¨äº†ææ„å‡½æ•°</span><br><span class="line">177     movl    %ebx, %eax</span><br><span class="line">178     addq    $24, %rsp</span><br><span class="line">179     popq    %rbx</span><br><span class="line">180     popq    %rbp</span><br><span class="line">181     .cfi_def_cfa 7, 8</span><br><span class="line">182     ret</span><br><span class="line">183     .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>Bçš„ææ„:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"> 89 _ZN1BD2Ev:	&#x2F;&#x2F; å¦‚æœè¶³å¤Ÿç»†å¿ƒ, é‚£ä¹ˆæ³¨æ„åˆ°äº†è¿™é‡Œæ˜¯ _ZN1BD2Ev è€Œå¹¶é _ZN1BD1Ev</span><br><span class="line"> 				&#x2F;&#x2F; å¯¹æ­¤, æˆ‘å‘ç°ç¼–è¯‘å™¨ç±»ä¼¼æœ‰ä¸ªä¸­é—´å±‚ä¸€æ ·çš„ä¸œè¥¿(æˆ–è€…è¯´ä¼šç¬¦å·æ›¿æ¢?)</span><br><span class="line"> 				&#x2F;&#x2F; ç„¶åå…¶å®ä¼šè·³è½¬åˆ°è¿™é‡Œæ¥, æ±‡ç¼–ä¸­å°†è¿™ä¸¤ä¸ªä¸œè¥¿ç›¸å…³è”</span><br><span class="line"> 90 .LFB1201:</span><br><span class="line"> 91     .cfi_startproc</span><br><span class="line"> 92     .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line"> 93     .cfi_lsda 0x3,.LLSDA1201</span><br><span class="line"> 94     pushq   %rbp</span><br><span class="line"> 95     .cfi_def_cfa_offset 16</span><br><span class="line"> 96     .cfi_offset 6, -16</span><br><span class="line"> 97     movq    %rsp, %rbp</span><br><span class="line"> 98     .cfi_def_cfa_register 6</span><br><span class="line"> 99     subq    $16, %rsp</span><br><span class="line">100     movq    %rdi, -8(%rbp)</span><br><span class="line">101     movq    -8(%rbp), %rax</span><br><span class="line">102     movq    $_ZTV1B+16, (%rax)</span><br><span class="line">103     movl    $.LC1, %edi</span><br><span class="line">104     call    puts	&#x2F;&#x2F; ç¼–è¯‘å™¨çŸ¥é“åªæ˜¯æ‰“å°ä¸€ä¸ªå­—ç¬¦ä¸², æ‰€ä»¥è°ƒç”¨çš„æ˜¯ puts</span><br><span class="line">105     movq    -8(%rbp), %rax</span><br><span class="line">106     movq    %rax, %rdi</span><br><span class="line">107     call    _ZN1AD2Ev	&#x2F;&#x2F; å’Œæˆ‘æƒ³çš„ä¸ä¸€æ ·, åˆä¸€æ ·...</span><br><span class="line">108     movl    $0, %eax</span><br><span class="line">109     testl   %eax, %eax</span><br><span class="line">110     je  .L6	&#x2F;&#x2F; è¿™é‡Œæˆ‘ä¹Ÿä¸å¤ªæ‡‚, è¿™ä¸ªä¸æ˜¯å¿…è·³ä¹ˆ?</span><br><span class="line">111     movq    -8(%rbp), %rax</span><br><span class="line">112     movq    %rax, %rdi</span><br><span class="line">113     call    _ZdlPv	&#x2F;&#x2F; è¿™ä¸ªä¸œè¥¿æ²¡æœ‰æ‰¾åˆ°</span><br></pre></td></tr></table></figure>

<p>å’Œé¢„æ–™ä¸­ä¸åŒçš„æ˜¯, A çš„ææ„å‡½æ•°æ˜¯ç›´æ¥è°ƒç”¨çš„, è€Œå¹¶éåç§»  </p>
<p>æƒ³äº†æƒ³è¿™åœ¨æ„æ–™ä¹‹ä¸­, å› ä¸ºç¼–è¯‘å™¨å°†å®ƒä¼˜åŒ–æˆäº†æ™®é€šå‡½æ•°</p>
<p>è‡³äº _ZdlPv, æ²¡æœ‰åœ¨æ±‡ç¼–ä¸­æ‰¾åˆ°è¿™ä¸ªç¬¦å· â€¦ </p>
<p>(æˆ‘è¯•äº†ä¸€ä¸‹, æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹å¼è®©å®ƒåƒè¢«è™šå‡½æ•°ä¸€æ ·è°ƒç”¨, å¾ˆå¯æƒœâ€¦)</p>
<h3 id="è™šç»§æ‰¿çš„ææ„å‡½æ•°è°ƒç”¨"><a href="#è™šç»§æ‰¿çš„ææ„å‡½æ•°è°ƒç”¨" class="headerlink" title="è™šç»§æ‰¿çš„ææ„å‡½æ•°è°ƒç”¨"></a>è™šç»§æ‰¿çš„ææ„å‡½æ•°è°ƒç”¨</h3><p>æ„Ÿè§‰éå¸¸å¥‡æ€ª, æ‰€ä»¥æœ¬æ¥æ˜¯æ‰“ç®—çœ‹çœ‹å°±å¥½çš„, å› ä¸ºä¹‹å‰èŠ±åŠŸå¤«å»çœ‹äº†çœ‹è™šç»§æ‰¿çš„å†…å­˜å¸ƒå±€</p>
<p>ä¸è¿‡å®åœ¨å¤ªå¥‡æ€ªäº†, æ‰€ä»¥æ‰“ç®—å¥½å¥½åˆ†æä¸€ä¸‹, é¡ºä¾¿æˆ‘åœ¨ä¹‹å‰åˆ†æçš„æ—¶å€™å¥½åƒå¿˜äº†çœ‹è™šç»§æ‰¿çš„è™šå‡½æ•°è°ƒç”¨äº†</p>
<p>å› ä¸ºé‚£æ—¶å€™å¥½åƒå·²ç»æ™•äº†â€¦ </p>
<p>å®ƒä¼šæ€ä¹ˆè¢«è°ƒç”¨å‘¢? æœ€æ— è¶£çš„æƒ…å†µå°±æ˜¯åƒä¸Šé¢é‚£æ ·ç¡¬ç¼–ç </p>
<p>ä¸è¿‡åœ¨è™šç»§æ‰¿è¿™ç§æ¯”è¾ƒå¤æ‚çš„ç¯å¢ƒä¸‹, ç¼–è¯‘å™¨å¯èƒ½ä¼šåšå‡ºå…¶ä»–ååº”ä¹Ÿè¯´ä¸å®š?</p>
<p>æºç å°±å•çº¯çš„Eè¢«CDè™šç»§æ‰¿, Bç»§æ‰¿CD, è¿™é‡Œç›´æ¥æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB1212:</span><br><span class="line">    .cfi_startproc</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    .cfi_def_cfa_offset 16</span><br><span class="line">    .cfi_offset 6, -16</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    .cfi_def_cfa_register 6</span><br><span class="line">    pushq   %rbx	&#x2F;&#x2F; è¿™é‡Œ, ä¸å‰é¢çš„ pushq æ— å…³</span><br><span class="line">    subq    $56, %rsp</span><br><span class="line">    .cfi_offset 3, -24</span><br><span class="line">    leaq    -64(%rbp), %rax	&#x2F;&#x2F; å‰é¢æœ‰ pushq, æ‰€ä»¥è¿™é‡Œæ˜¯ -64</span><br><span class="line">    movq    %rax, %rdi</span><br><span class="line">    call    _ZN1BC1Ev	&#x2F;&#x2F; æ„é€ </span><br><span class="line">    movl    $0, %ebx</span><br><span class="line">    leaq    -64(%rbp), %rax</span><br><span class="line">    movq    %rax, %rdi</span><br><span class="line">    call    _ZN1BD1Ev	&#x2F;&#x2F; ææ„</span><br><span class="line">    movl    %ebx, %eax</span><br><span class="line">    addq    $56, %rsp</span><br><span class="line">    popq    %rbx</span><br><span class="line">    popq    %rbp</span><br><span class="line">    .cfi_def_cfa 7, 8</span><br><span class="line">    ret</span><br><span class="line">    .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>Bçš„ææ„å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">457 _ZN1BD1Ev:</span><br><span class="line">458 .LFB1210:</span><br><span class="line">459     .cfi_startproc</span><br><span class="line">460     .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line">461     .cfi_lsda 0x3,.LLSDA1210</span><br><span class="line">462     pushq   %rbp</span><br><span class="line">463     .cfi_def_cfa_offset 16</span><br><span class="line">464     .cfi_offset 6, -16</span><br><span class="line">465     movq    %rsp, %rbp</span><br><span class="line">466     .cfi_def_cfa_register 6</span><br><span class="line">467     subq    $16, %rsp</span><br><span class="line">468     movq    %rdi, -8(%rbp)</span><br><span class="line">469     movl    $_ZTV1B+24, %edx</span><br><span class="line">470     movq    -8(%rbp), %rax</span><br><span class="line">471     movq    %rdx, (%rax)	&#x2F;&#x2F; æ ˆé¡¶åŠ å…¥äº†è™šæŒ‡é’ˆ +24</span><br><span class="line">472     movl    $32, %edx</span><br><span class="line">473     movq    -8(%rbp), %rax</span><br><span class="line">474     addq    %rax, %rdx</span><br><span class="line">475     movl    $_ZTV1B+104, %eax</span><br><span class="line">476     movq    %rax, (%rdx)	&#x2F;&#x2F; æ ˆé¡¶ -32 å¤„åŠ å…¥äº†è™šæŒ‡é’ˆ +104</span><br><span class="line">477     movl    $_ZTV1B+64, %edx</span><br><span class="line">478     movq    -8(%rbp), %rax</span><br><span class="line">479     movq    %rdx, 16(%rax)	&#x2F;&#x2F; æ ˆé¡¶ -16 å¤„åŠ å…¥äº†è™šæŒ‡é’ˆ +64</span><br><span class="line">480     movq    -8(%rbp), %rax</span><br><span class="line">481     movl    28(%rax), %eax</span><br><span class="line">482     movl    %eax, %esi</span><br><span class="line">483     movl    $.LC3, %edi	&#x2F;&#x2F; .string &quot;B destruct: %d\n&quot;</span><br><span class="line">484     movl    $0, %eax</span><br><span class="line">485     call    printf</span><br><span class="line">486     movl    $_ZTT1B+24, %eax</span><br><span class="line">487     movq    -8(%rbp), %rdx</span><br><span class="line">488     addq    $16, %rdx</span><br><span class="line">489     movq    %rax, %rsi</span><br><span class="line">490     movq    %rdx, %rdi</span><br><span class="line">491     call    _ZN1CD2Ev	&#x2F;&#x2F; ç¡¬ç¼–ç ...</span><br><span class="line">492     movl    $_ZTT1B+8, %edx</span><br><span class="line">493     movq    -8(%rbp), %rax</span><br><span class="line">494     movq    %rdx, %rsi</span><br><span class="line">495     movq    %rax, %rdi</span><br><span class="line">496     call    _ZN1AD2Ev</span><br><span class="line">497     movl    $2, %eax</span><br><span class="line">498     testl   %eax, %eax</span><br><span class="line">499     je  .L23</span><br><span class="line">500     movq    -8(%rbp), %rax</span><br><span class="line">501     addq    $32, %rax</span><br><span class="line">502     movq    %rax, %rdi</span><br><span class="line">503     call    _ZN1ED2Ev</span><br><span class="line">504     nop</span><br></pre></td></tr></table></figure>

<p>è™šå‡½æ•°æ˜¯é€šè¿‡ç¡¬ç¼–ç æ¥è°ƒç”¨çš„  </p>
<p>ä¸è¿‡æœ‰ä¸ªéå¸¸ä¸é”™çš„å‘ç°, æˆ‘åœ¨ _ZTT1B ä¸­å‘ç°äº† LTHUNK çš„å½±å­</p>
<p>åœ¨ _ZTT1B  ä¸­æœ‰ LTHUNK  ç›¸å…³çš„ä»£ç , ä¸è¿‡å¾ˆå¯æƒœ, è¿™äº›çŒœæµ‹æ— ä»è¯æ˜â€¦</p>
<p>æ¥çœ‹çœ‹è™šå‡½æ•°çš„è°ƒç”¨å§:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">911 main:</span><br><span class="line">912 .LFB1216:</span><br><span class="line">913     .cfi_startproc</span><br><span class="line">914     .cfi_personality 0x3,__gxx_personality_v0</span><br><span class="line">915     .cfi_lsda 0x3,.LLSDA1216</span><br><span class="line">916     pushq   %rbp</span><br><span class="line">917     .cfi_def_cfa_offset 16</span><br><span class="line">918     .cfi_offset 6, -16</span><br><span class="line">919     movq    %rsp, %rbp</span><br><span class="line">920     .cfi_def_cfa_register 6</span><br><span class="line">921     pushq   %rbx</span><br><span class="line">922     subq    $88, %rsp</span><br><span class="line">923     .cfi_offset 3, -24</span><br><span class="line">924     leaq    -96(%rbp), %rax</span><br><span class="line">925     movq    %rax, %rdi</span><br><span class="line">926     call    _ZN1BC1Ev</span><br><span class="line">927     leaq    -96(%rbp), %rax</span><br><span class="line">928     movq    %rax, -24(%rbp)</span><br><span class="line">929     movq    -24(%rbp), %rax</span><br><span class="line">930     movq    (%rax), %rax	&#x2F;&#x2F; è§£å¼•ç”¨</span><br><span class="line">931     addq    $16, %rax		&#x2F;&#x2F; +16</span><br><span class="line">932     movq    (%rax), %rax	&#x2F;&#x2F; å–è¿™ä¸ªæ§½ä¸­çš„åœ°å€</span><br><span class="line">933     movq    -24(%rbp), %rdx</span><br><span class="line">934     movq    %rdx, %rdi</span><br><span class="line">935 .LEHB0:</span><br><span class="line">936     call    *%rax</span><br><span class="line">937     leaq    -96(%rbp), %rax</span><br><span class="line">938     movq    %rax, -32(%rbp)</span><br><span class="line">939     movq    -32(%rbp), %rax</span><br><span class="line">940     movq    (%rax), %rax</span><br><span class="line">941     addq    $16, %rax		&#x2F;&#x2F; +16</span><br><span class="line">942     movq    (%rax), %rax</span><br><span class="line">943     movq    -32(%rbp), %rdx</span><br><span class="line">944     movq    %rdx, %rdi</span><br><span class="line">945     call    *%rax			&#x2F;&#x2F; A, Bä½¿ç”¨äº†ä¸€æ ·çš„è™šè¡¨å’Œæ§½, ä»…ä»…æ˜¯thisæŒ‡é’ˆä¸åŒ</span><br><span class="line">946     leaq    -96(%rbp), %rax</span><br><span class="line">947     addq    $16, %rax		&#x2F;&#x2F; +16</span><br><span class="line">948     movq    %rax, -40(%rbp)</span><br><span class="line">949     movq    -40(%rbp), %rax</span><br><span class="line">950     movq    (%rax), %rax	</span><br><span class="line">951     addq    $16, %rax		&#x2F;&#x2F; +16</span><br><span class="line">952     movq    (%rax), %rax</span><br><span class="line">953     movq    -40(%rbp), %rdx</span><br><span class="line">954     movq    %rdx, %rdi</span><br><span class="line">955     call    *%rax			&#x2F;&#x2F; C å…ˆæ˜¯ +16 å–åˆ°è‡ªå·±çš„è™šè¡¨, ç„¶ååŒæ ·ä½¿ç”¨æ§½ 1</span><br><span class="line">956 .LEHE0:</span><br><span class="line">957     movl    $0, %ebx</span><br><span class="line">958     leaq    -96(%rbp), %rax</span><br><span class="line">959     movq    %rax, %rdi</span><br><span class="line"> 960     call    _ZN1BD1Ev</span><br><span class="line">961     movl    %ebx, %eax</span><br><span class="line">962     jmp .L39</span><br><span class="line">963 .L38:</span><br><span class="line">964     movq    %rax, %rbx</span><br><span class="line">965     leaq    -96(%rbp), %rax</span><br><span class="line">966     movq    %rax, %rdi</span><br><span class="line">967     call    _ZN1BD1Ev</span><br><span class="line">968     movq    %rbx, %rax</span><br><span class="line">969     movq    %rax, %rdi</span><br><span class="line">970 .LEHB1:</span><br><span class="line">971     call    _Unwind_Resume</span><br><span class="line">972 .LEHE1:</span><br><span class="line">973 .L39:</span><br><span class="line">974     addq    $88, %rsp</span><br><span class="line">975     popq    %rbx</span><br><span class="line">976     popq    %rbp</span><br><span class="line">977     .cfi_def_cfa 7, 8</span><br><span class="line">978     ret</span><br><span class="line">979     .cfi_endproc</span><br></pre></td></tr></table></figure>

<p>æ™®é€šè™šå‡½æ•°çš„è°ƒç”¨å°±æ˜¯æ‰¾åˆ°è‡ªå·±çš„è™šè¡¨, è°ƒç”¨å¯¹åº”çš„æ§½</p>
<p>è¿™ä¸ªè™šç»§æ‰¿æ¥çš„è™šå‡½æ•°è°ƒç”¨å’Œæ™®é€šç»§æ‰¿çš„è™šå‡½æ•°è°ƒç”¨æ–¹å¼åŸºæœ¬ä¸€è‡´</p>
<p>å¤šæ€æ˜¯å¦‚ä½•å®ç°çš„å‘¢?</p>
<p>æ¯ä¸ªæ„é€ å‡½æ•°, éƒ½ä¼šè¦†å†™å®ƒçš„æ‰€æœ‰è™šæŒ‡é’ˆ, ä½¿ä»–æŒ‡å‘ä¸åŒçš„åœ°å€(ä½†æ˜¯è¿™äº›åœ°å€éƒ½ä¸ç›¸åŒ!!!)</p>
<p>å¦‚ä½ æ‰€è§, å½“CæŒ‡é’ˆå»è°ƒç”¨æ—¶, å‘ç”Ÿäº†åç§», è™½ç„¶å–åˆ°äº†åŒæ ·çš„ slot, ä½†å´ä¸æ˜¯åŒä¸€å¼ è™šè¡¨</p>
<p>é‚£ä¹ˆæˆ‘èƒ½æƒ³åˆ°çš„å°±æ˜¯æœ‰å¤šå¼ ç›¸åŒçš„è™šè¡¨</p>
<p>(æˆ‘åªèƒ½å¦‚æ­¤çŒœæµ‹, æˆ‘æƒ³ä¸åˆ°ä¸ºä»€ä¹ˆè¿™æ ·çš„æƒ…å†µä¸‹è¿˜èƒ½è°ƒç”¨åŒä¸€ä¸ªå‡½æ•°)</p>
<p>(ä½†æ˜¯ä¸ºä»€ä¹ˆè¦æœ‰ç›¸åŒçš„å‘¢? è¿™åˆæ˜¯ä¸€ä¸ªé—®é¢˜)</p>
<p>æˆ‘å°è¯•äº†çœ‹çœ‹è¿™äº›è™šè¡¨ä¸­æ˜¯ä»€ä¹ˆæ•°æ®, å¯æƒœå¤±è´¥äº†, æˆ–è€…è¯´çœ‹ä¸æ‡‚</p>
<p>ä½†æ˜¯åŒä¸€ä¸ªç±»çš„è™šè¡¨æ˜¯å®Œå…¨ç›¸åŒçš„, è¿™å¯ä»¥è‚¯å®š</p>
<p>ä¸åŒçš„æƒ…å†µä»…åœ¨äºAç±»ä¸­Cç±»å’Œå•ç‹¬çš„Cç±», è¿™ä¸¤ä¸ªCç±»çš„è™šè¡¨æ˜¯ä¸ä¸€æ ·çš„</p>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p>è™šå‡½æ•°æœºåˆ¶å’Œä¹¦ä¸­æ‰€è¯´åŸºæœ¬ä¸€è‡´</p>
<ol>
<li>æ‰¾åˆ°å¯¹åº”çš„è™šè¡¨</li>
<li>è°ƒç”¨æ§½ä¸­çš„å‡½æ•°</li>
</ol>
<h3 id="review"><a href="#review" class="headerlink" title="review"></a>review</h3><p>æˆ‘åœ¨ objdump çš„è¾“å‡ºä¸­å‘ç°, è¯¸å¦‚ _ZTI1C è¿™æ ·çš„ä¸œè¥¿åœ¨é“¾æ¥çš„æ—¶å€™ä¼šè½¬åŒ–æˆä¸€ä¸ªæ•°å­—å¸¸é‡</p>
<p>æœ‰äº›å¯èƒ½ä¼šæ˜¯åŸºäºæŸä¸ªä½ç½®çš„åç§»(æ¯”å¦‚ %rip)</p>
<p>ç¼–è¯‘å™¨ä¼šåˆ©ç”¨å®ƒè¿›è¡Œç›´æ¥å¯»å€, æœ‰äº›ä¼šåˆ©ç”¨å®ƒè¿›è¡Œé—´æ¥å¯»å€</p>
]]></content>
  </entry>
  <entry>
    <title>other/virtualInherit</title>
    <url>/2020/01/09/other/virtualInherit/</url>
    <content><![CDATA[<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>æƒ³è¦äº†è§£ä¸€ä¸‹è™šç»§æ‰¿çš„å†…éƒ¨æ•°æ®ç»“æ„</p>
<p>(è¯­è¨€: c++, ç¼–è¯‘å™¨: g++(4.8.5))</p>
<h3 id="å†…å­˜å¸ƒå±€"><a href="#å†…å­˜å¸ƒå±€" class="headerlink" title="å†…å­˜å¸ƒå±€"></a>å†…å­˜å¸ƒå±€</h3><p>è€ƒè™‘ä»¥ä¸‹ä»£ç </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">1</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span> :</span> <span class="keyword">virtual</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">2</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> :</span> <span class="keyword">virtual</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">3</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> :</span> <span class="keyword">public</span> B, <span class="keyword">public</span> C&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">4</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>å•çº¯çš„è™šæ‹Ÿç»§æ‰¿è€Œå·², æˆ‘ä½¿ç”¨äº†è¿™ç§æ–¹å¼æ‰“å°å®ƒä»¬çš„å†…éƒ¨æ•°æ®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">D a;</span><br><span class="line"><span class="keyword">void</span> *p = &amp;a;</span><br><span class="line"><span class="keyword">int</span> *pi = (<span class="keyword">int</span> *)p;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">sizeof</span>(a) / <span class="number">4</span>; ++i)</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pi[i]);</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"val:%d\n"</span>, a._i);</span><br></pre></td></tr></table></figure>

<p>ç„¶åå®ƒä»¬A, B, C, Då†…éƒ¨æ•°æ®æƒ…å†µå¦‚ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">A: 	<span class="number">1</span></span><br><span class="line">B: 	<span class="number">4196632</span></span><br><span class="line">    <span class="number">0</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">1</span></span><br><span class="line">C: 	<span class="number">4196632</span></span><br><span class="line">    <span class="number">0</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    <span class="number">1</span></span><br><span class="line">D:	<span class="number">4196760</span></span><br><span class="line">    <span class="number">0</span></span><br><span class="line">    <span class="number">2</span></span><br><span class="line">    <span class="number">0</span></span><br><span class="line">    <span class="number">4196784</span></span><br><span class="line">    <span class="number">0</span></span><br><span class="line">    <span class="number">3</span></span><br><span class="line">    <span class="number">4</span></span><br><span class="line">    <span class="number">1</span></span><br><span class="line">    <span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>emmmâ€¦ </p>
<p>OK, æˆ‘å¯ä»¥æŠŠå‰ä¸¤ä¸ª 4 å­—èŠ‚è®¤ä¸ºæ˜¯è™šæŒ‡é’ˆ(Aæ²¡æœ‰) </p>
<p>é‚£ä¹ˆA, B, Cçš„å†…å­˜åˆ†å¸ƒå°±ä¸ç”¨çœ‹äº†, å”¯ä¸€æ¯”è¾ƒç‰¹æ®Šçš„æ˜¯<strong>è™šåŸºç±»åœ¨å†…å­˜çš„é«˜åœ°å€</strong></p>
<p>ç„¶åDçš„å†…éƒ¨åˆ†å¸ƒâ€¦ è¿™â€¦ emmmâ€¦ ä»”ç»†ä¸€æƒ³, è¿˜å¥½, é‡è¦çš„æ˜¯(Q1: ä¸ºä»€ä¹ˆæœ€åè¡¥äº†ä¸€ä¸ª0 ??)</p>
<h3 id="å­˜å–æ–¹å¼"><a href="#å­˜å–æ–¹å¼" class="headerlink" title="å­˜å–æ–¹å¼"></a>å­˜å–æ–¹å¼</h3><p>æˆ‘è¯•ç€è®¿é—®äº†ä¸€ä¸‹æ•°æ®</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">D a;</span><br><span class="line">A *pa = &amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pa-&gt;_i);</span><br><span class="line">B *pb = &amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pb-&gt;_i);</span><br><span class="line">C *pc = &amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pc-&gt;_i);</span><br><span class="line">D *pd = &amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pd-&gt;_i);</span><br></pre></td></tr></table></figure>

<p>æ¥çœ‹ä¸€çœ‹æ±‡ç¼–</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pushq   %rbp</span><br><span class="line">.cfi_def_cfa_offset 16</span><br><span class="line">.cfi_offset 6, -16</span><br><span class="line">movq    %rsp, %rbp</span><br><span class="line">.cfi_def_cfa_register 6</span><br><span class="line">subq    $80, %rsp		&#x2F;&#x2F; 80 æ ˆå¸§</span><br><span class="line">leaq    -80(%rbp), %rax	</span><br><span class="line">movq    %rax, %rdi	</span><br><span class="line">call    _ZN1DC1Ev		&#x2F;&#x2F; è¿™é‡Œæ˜¯æ„é€ å‡½æ•°, ç¨åå¯èƒ½éœ€è¦çœ‹çœ‹å®ƒçš„æ„é€ </span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">addq    $32, %rax		&#x2F;&#x2F; +32, OK, å‘ä¸Š 32 å­—èŠ‚çš„ç¡®æ˜¯ 1</span><br><span class="line">movq    %rax, -8(%rbp)	</span><br><span class="line">movq    -8(%rbp), %rax</span><br><span class="line">movl    (%rax), %eax</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf			&#x2F;&#x2F; 1 ç¬¬ä¸€æ¬¡printf</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">movq    %rax, -16(%rbp)</span><br><span class="line">movq    -16(%rbp), %rax	&#x2F;&#x2F; B ç±»å‹æŒ‡é’ˆå¹¶æ²¡æœ‰ç»è¿‡åç§», è¿™å’Œé¢„æ–™çš„ä¸€æ ·</span><br><span class="line">movl    8(%rax), %eax	&#x2F;&#x2F; è¿™é‡Œ+8, è·³è¿‡äº†è™šæŒ‡é’ˆ</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf			&#x2F;&#x2F; 2 ç¬¬äºŒæ¬¡printf</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">addq    $16, %rax		&#x2F;&#x2F; +16 Cç±»å‹æŒ‡é’ˆè·³è¿‡äº† Bçš„å†…å­˜, è¿™ä¹Ÿæ²¡ä»€ä¹ˆä¸å¯¹</span><br><span class="line">movq    %rax, -24(%rbp)</span><br><span class="line">movq    -24(%rbp), %rax	</span><br><span class="line">movl    8(%rax), %eax	&#x2F;&#x2F; åŒç†</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf			&#x2F;&#x2F; 3 ç¬¬ä¸‰æ¬¡printf</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">movq    %rax, -32(%rbp)</span><br><span class="line">movq    -32(%rbp), %rax</span><br><span class="line">movl    28(%rax), %eax	&#x2F;&#x2F; +28 OK~</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf			&#x2F;&#x2F; 4 ç¬¬å››æ¬¡printf</span><br><span class="line">movl    $0, %eax</span><br><span class="line">leave</span><br></pre></td></tr></table></figure>

<p>æ•°æ®çš„è®¿é—®åœ¨ç¼–è¯‘æ—¶å°±å·²ç»å®šå¥½çš„, ä¸å­˜åœ¨é¢å¤–æ•ˆç‡å½±å“</p>
<p>AæŒ‡é’ˆ    åç§»äº† +32 å­—èŠ‚     ç›´æ¥è®¿é—®æ•°æ®</p>
<p>BæŒ‡é’ˆ    æœªåç§»             è®¿é—®æ•°æ®æ—¶è·³è¿‡äº†è™šæŒ‡é’ˆ(8å­—èŠ‚)</p>
<p>CæŒ‡é’ˆ    åç§» +16 å­—èŠ‚     è®¿é—®æ•°æ®æ—¶è·³è¿‡äº†è™šæŒ‡é’ˆ(8å­—èŠ‚)</p>
<p>DæŒ‡é’ˆ    æœªåç§»             è®¿é—®æ•°æ®æ—¶è·³è¿‡äº†è™šæŒ‡é’ˆ + B, Cç±»æ•°æ®(å…±28å­—èŠ‚)</p>
<p>æˆ–è®¸çœ‹ä¸€ä¸‹è®¿é—®è™šåŸºç±»çš„æ•°æ®ä¼šæœ‰æ‰€äº†è§£? </p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pushq   %rbp</span><br><span class="line">.cfi_def_cfa_offset 16</span><br><span class="line">.cfi_offset 6, -16</span><br><span class="line">movq    %rsp, %rbp</span><br><span class="line">.cfi_def_cfa_register 6</span><br><span class="line">subq    $80, %rsp</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">movq    %rax, %rdi</span><br><span class="line">call    _ZN1DC1Ev</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">addq    $32, %rax</span><br><span class="line">movq    %rax, -8(%rbp)</span><br><span class="line">movq    -8(%rbp), %rax</span><br><span class="line">movl    (%rax), %eax</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf			&#x2F;&#x2F; åŸºç±»è®¿é—®æ–¹å¼å’Œä¸Šé¢çš„æ±‡ç¼–å¹¶æ²¡æœ‰ä¸åŒ</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">movq    %rax, -16(%rbp)</span><br><span class="line">movq    -16(%rbp), %rax</span><br><span class="line">movq    (%rax), %rax	&#x2F;&#x2F; å–æŒ‡é’ˆæŒ‡å‘çš„å€¼, ä¹Ÿå°±æ˜¯Dçš„åœ°å€</span><br><span class="line">subq    $24, %rax		&#x2F;&#x2F; Dåœ°å€å‡å»24å­—èŠ‚ ä¹Ÿå°±æ˜¯è¯´, å®ƒå‰é¢è¿˜æœ‰ä¸œè¥¿</span><br><span class="line">movq    (%rax), %rax	&#x2F;&#x2F; è·å¾—é‚£ä¸ªåœ°å€ä¸­çš„å€¼</span><br><span class="line">movq    %rax, %rdx</span><br><span class="line">movq    -16(%rbp), %rax</span><br><span class="line">addq    %rdx, %rax		&#x2F;&#x2F; å¢åŠ äº† rdx å¤§å°, </span><br><span class="line">movl    (%rax), %eax</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">addq    $16, %rax</span><br><span class="line">movq    %rax, -24(%rbp)</span><br><span class="line">movq    -24(%rbp), %rax</span><br><span class="line">movq    (%rax), %rax</span><br><span class="line">subq    $24, %rax</span><br><span class="line">movq    (%rax), %rax</span><br><span class="line">movq    %rax, %rdx</span><br><span class="line">movq    -24(%rbp), %rax</span><br><span class="line">addq    %rdx, %rax</span><br><span class="line">movl    (%rax), %eax</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf</span><br><span class="line">leaq    -80(%rbp), %rax</span><br><span class="line">movq    %rax, -32(%rbp)</span><br><span class="line">movq    -32(%rbp), %rax</span><br><span class="line">movq    (%rax), %rax</span><br><span class="line">subq    $24, %rax</span><br><span class="line">movq    (%rax), %rax</span><br><span class="line">movq    %rax, %rdx</span><br><span class="line">movq    -32(%rbp), %rax</span><br><span class="line">addq    %rdx, %rax</span><br><span class="line">movl    (%rax), %eax</span><br><span class="line">movl    %eax, %esi</span><br><span class="line">movl    $.LC0, %edi</span><br><span class="line">movl    $0, %eax</span><br><span class="line">call    printf</span><br><span class="line">movl    $0, %eax</span><br><span class="line">leave</span><br></pre></td></tr></table></figure>

<p>emmmâ€¦ æœ‰ä¸€ä¸ªé‡å¤§çš„å‘ç°å°±æ˜¯, <strong>åŸºç±»å¯¹è±¡å‰é¢æœ‰æ•°æ®</strong></p>
<p>è¿™äº›æ•°æ®åº”è¯¥æ˜¯åç§», è¿™äº›åç§»é…åˆ + æŒ‡é’ˆæœ¬èº«çš„åœ°å€èƒ½å¤Ÿè®¿é—®åˆ°æ­£ç¡®çš„è™šåŸºç±»æ•°æ®</p>
<p>ä¹Ÿå°±æ˜¯è¯´, è¿™æ˜¯ æ·±å…¥æ¢ç´¢å¯¹è±¡ ä¸­, å¯¹äºè™šåŸºç±»çš„ä¸¤ç§å®ç°æ–¹å¼ä¸­çš„ç¬¬ä¸€ç§</p>
<p>å³: åœ¨æ¯ä¸ªåŸºç±»ä¸­æ·»åŠ è™šåŸºç±»çš„åç§», ä½†æ˜¯åˆä¸å…¨å¯¹â€¦</p>
<p>è¶Šæ¥è¶Šç³Šæ¶‚äº† (ëˆˆ_ëˆˆ), æ·±å¸ä¸€å£æ°”, æƒ³æƒ³è‡ªå·±è¦å¹²å˜›â€¦ emmmmâ€¦.</p>
<p>è¿™æ ·å§, å®Œæ•´åœ°çœ‹ä¸€éæ„é€ çš„è¿‡ç¨‹, è¿™æ ·åº”è¯¥å°±æ˜ç™½äº†</p>
<p>(å¦‚æœè¿˜æ˜¯æ™•, é‚£ä¹ˆå°±å¸Œæœ›ä¸‹æ¬¡é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™èƒ½å¤Ÿæ›´ä»å®¹ä¸€äº›)</p>
<p>(æˆ‘å·²ç»å†è¿™ä¸ªé—®é¢˜ä¸ŠèŠ±å¤ªå¤šæ—¶é—´, å†è¿™æ ·ä¸‹å»åè€Œä¸å¥½, è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¾ˆé‡è¦/å¸¸ç”¨çš„çŸ¥è¯†)</p>
<h3 id="å®Œæ•´çš„æ„é€ è¿‡ç¨‹"><a href="#å®Œæ•´çš„æ„é€ è¿‡ç¨‹" class="headerlink" title="å®Œæ•´çš„æ„é€ è¿‡ç¨‹"></a>å®Œæ•´çš„æ„é€ è¿‡ç¨‹</h3><p>é¦–å…ˆæ˜¯ main åŒºå—</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">main:</span><br><span class="line">.LFB1196:</span><br><span class="line">    pushq	%rbp</span><br><span class="line">    movq	%rsp, %rbp</span><br><span class="line">    subq	$48, %rsp	&#x2F;&#x2F; 48 å­—èŠ‚æ ˆå¸§, ä¸ºä»€ä¹ˆæ˜¯ 48 å‘¢?</span><br><span class="line">    leaq	-48(%rbp), %rax</span><br><span class="line">    movq	%rax, %rdi</span><br><span class="line">    call	_ZN1DC1Ev	&#x2F;&#x2F; è°ƒç”¨æ„é€ å‡½æ•°</span><br><span class="line">    movl	$0, %eax</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>
<p>ç„¶åæ˜¯Dçš„æ„é€ å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZN1DC1Ev:</span><br><span class="line">.LFB1208:</span><br><span class="line">    pushq	%rbp</span><br><span class="line">    movq	%rsp, %rbp</span><br><span class="line">    subq	$16, %rsp		&#x2F;&#x2F; å®ƒå†æ¬¡å¼€è¾Ÿäº† 16 å­—èŠ‚çš„æ ˆå¸§</span><br><span class="line">    movq	%rdi, -8(%rbp)	&#x2F;&#x2F; æŠŠåŸæ ˆé¡¶æŒ‡é’ˆæ”¾å…¥äº†æ ˆä¸­</span><br><span class="line">    movq	-8(%rbp), %rax	</span><br><span class="line">    addq	$32, %rax		&#x2F;&#x2F; åŸæ ˆé¡¶æŒ‡é’ˆ +32 åç§», è·æ ˆåº•è¿˜æœ‰ 16 å­—èŠ‚</span><br><span class="line">    movq	%rax, %rdi</span><br><span class="line">    call	_ZN1AC2Ev		&#x2F;&#x2F; è¿™é‡Œç•™äº† 16 å­—èŠ‚ç”¨äº A çš„æ„é€ </span><br><span class="line">    movl	$_ZTT1D+8, %edx	&#x2F;&#x2F; æˆ‘å¾ˆå¥½å¥‡åœ°æŸ¥äº† $_ZTT1D è¿™ä¸œè¥¿æ˜¯å¤šå°‘, ç„¶è€Œäº‹å®è®©æˆ‘ç»æœ›...</span><br><span class="line">    						&#x2F;&#x2F; å®ƒæœ‰éå¸¸å¤šçš„è€¦åˆ, çŸ­æ—¶é—´å†…æˆ‘æ ¹æœ¬æ— æ³•è®¡ç®—å‡ºè¿™ä¸œè¥¿æ˜¯å¤šå°‘!!!</span><br><span class="line">    						&#x2F;&#x2F; è€Œä¸”é‡Œé¢çš„ä»£ç æ˜¯ä»¥.å¼€å¤´çš„, è¿™æ„å‘³ç€æ˜¯ä¼ªæŒ‡ä»¤... (;Â´à¼àº¶Ğ”à¼àº¶&#96;)</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movq	%rdx, %rsi		&#x2F;&#x2F; rdx ä»æœªè¢«èµ‹å€¼è¿‡, æˆ‘å¾ˆå¥½å¥‡å®ƒå°†ä»€ä¹ˆå€¼ç»™äº† rsi</span><br><span class="line">    						&#x2F;&#x2F; å¯¹äº†, åœ¨ä¸Šé¢ä¸€å¥ç”¨åˆ°äº† edx, è¿™å’Œ rdx æœ‰å…³</span><br><span class="line">    						&#x2F;&#x2F; æš‚ä¸”æŠŠå®ƒè®¤ä¸ºæ˜¯ä¸€ä¸ª, ç¼–è¯‘å™¨æ–½åŠ çš„é­”æ³•: magic</span><br><span class="line">    movq	%rax, %rdi		&#x2F;&#x2F; åŸæ ˆé¡¶æŒ‡é’ˆ</span><br><span class="line">    call	_ZN1BC2Ev		&#x2F;&#x2F; è°ƒç”¨ B æ„é€ å‡½æ•°</span><br><span class="line">    movl	$_ZTT1D+16, %eax</span><br><span class="line">    movq	-8(%rbp), %rdx	&#x2F;&#x2F; æ‹¿å‡ºåŸæ ˆé¡¶æŒ‡é’ˆ</span><br><span class="line">    addq	$16, %rdx		&#x2F;&#x2F; +16 åç§»</span><br><span class="line">    movq	%rax, %rsi</span><br><span class="line">    movq	%rdx, %rdi</span><br><span class="line">    call	_ZN1CC2Ev		&#x2F;&#x2F; è°ƒç”¨ C æ„é€ å‡½æ•°</span><br><span class="line">    movl	$_ZTV1D+24, %edxl</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movq	%rdx, (%rax)	&#x2F;&#x2F; è¿™é‡Œä¸è°ƒç”¨ B æ—¶çš„æ­¥éª¤é‡å¤äº† :), è¦†å†™</span><br><span class="line">    movl	$_ZTV1D+48, %edx</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movq	%rdx, 16(%rax)	&#x2F;&#x2F; è¿™é‡Œä¸è°ƒç”¨ C æ—¶çš„æ­¥éª¤é‡å¤äº† :), è¦†å†™</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movl	$444, 28(%rax)	&#x2F;&#x2F; å†™å…¥å€¼</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>
<p>Açš„æ„é€ å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZN1AC2Ev:</span><br><span class="line">.LFB1199:</span><br><span class="line">    pushq	%rbp</span><br><span class="line">    movq	%rsp, %rbp</span><br><span class="line">    movq	%rdi, -8(%rbp)</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movl	$111, (%rax)	&#x2F;&#x2F; å°† $111 æ”¾å…¥äº†å‚æ•° rdi æŒ‡å‘çš„å†…å­˜ä¸­ movl: 4å­—èŠ‚</span><br><span class="line">    popq	%rbp</span><br><span class="line">    ret		&#x2F;&#x2F; å—¯, æ²¡äº†, æ‰€ä»¥ç¼–è¯‘å™¨ä»…ä»…å¯¹è¿™ 4 å­—èŠ‚èµ‹å€¼</span><br><span class="line">    		&#x2F;&#x2F; å‰©ä¸‹çš„ 12 å­—èŠ‚å‘¢?</span><br><span class="line">    		&#x2F;&#x2F; å…¶ä¸­8å­—èŠ‚æ²¡ç”¨è¿‡, æˆ–è€…ä¸åœ¨ D çš„å†…å­˜ä¸­, å› ä¸º sizeof d æ˜¯40, è€Œé48</span><br></pre></td></tr></table></figure>
<p>Bçš„æ„é€ å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZN1BC2Ev:</span><br><span class="line">.LFB1202:</span><br><span class="line">    pushq	%rbp</span><br><span class="line">    movq	%rsp, %rbp</span><br><span class="line">    movq	%rdi, -8(%rbp)	&#x2F;&#x2F; åŸæ ˆé¡¶æŒ‡é’ˆ</span><br><span class="line">    movq	%rsi, -16(%rbp)	&#x2F;&#x2F; æœªçŸ¥çš„åŸ rdx(magic)</span><br><span class="line">    movq	-16(%rbp), %rax</span><br><span class="line">    movq	(%rax), %rdx	&#x2F;&#x2F; magicçš„åœ°å€ -16 ä¸­çš„å€¼æ”¾å…¥ rdx</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movq	%rdx, (%rax)	&#x2F;&#x2F; å°† rdx ä¸­çš„å€¼æ”¾å…¥äº†æ ˆé¡¶, è¿™é‡Œæ˜¯q, å äº† 8 å­—èŠ‚</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movl	$222, 8(%rax)	&#x2F;&#x2F; æ ˆé¡¶ +8 åç§»ä¸­, æ”¾å…¥äº† $222</span><br><span class="line">    popq	%rbp</span><br><span class="line">    ret				&#x2F;&#x2F; å…±å†™å…¥äº† 12 å­—èŠ‚</span><br></pre></td></tr></table></figure>
<p>Cçš„æ„é€ å‡½æ•°:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">_ZN1CC2Ev:</span><br><span class="line">.LFB1205:</span><br><span class="line">    pushq	%rbp</span><br><span class="line">    movq	%rsp, %rbp</span><br><span class="line">    movq	%rdi, -8(%rbp)</span><br><span class="line">    movq	%rsi, -16(%rbp)</span><br><span class="line">    movq	-16(%rbp), %rax</span><br><span class="line">    movq	(%rax), %rdx</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movq	%rdx, (%rax)</span><br><span class="line">    movq	-8(%rbp), %rax</span><br><span class="line">    movl	$333, 8(%rax)</span><br><span class="line">    popq	%rbp		&#x2F;&#x2F; æ­¥éª¤ä¸ B åŸºæœ¬ç›¸åŒ</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>
<p>ä¹Ÿå°±æ˜¯è¯´, åœ¨Dçš„æ„é€ ä¸­, ABCçš„æ„é€ éƒ½è¢«è°ƒç”¨äº†</p>
<p>è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯, BCéƒ½æœªè°ƒç”¨Açš„æ„é€ , Açš„æ„é€ ä»…åœ¨Dä¸­è°ƒç”¨äº†ä¸€æ¬¡</p>
<p>åŒæ—¶è¦æ³¨æ„çš„æ˜¯, BCä¼šç”¨é‚£ä¸ªç¼–è¯‘å™¨ç»™çš„æ•°å­—å¾€è‡ªèº«çš„å†…å­˜å¸ƒå±€ä¸­å†™å€¼</p>
<p>ä½†æ˜¯å¦‚æœå…¶ä¸Šæœ‰D, Dä¼šå°†é‚£ä¸ªå€¼è¦†å†™ä¸€æ¬¡, å‡è®¾å…¶å€¼æ’å®šä¸å˜, ä½ç§»åˆ†åˆ«ä¸º:</p>
<p>8 16 24 48</p>
<p>è¿™æ˜¯ä¸€ç»„æœ‰è§„å¾‹çš„æ•°å­—, ä»¥ 8 ä¸ºå¼€å§‹, æ¯ä¸ªæ•°å­—æ˜¯å‰é¢æ•°å­—ä¹‹å’Œ(è¿™ä¸ªå°±æ˜¯åç§»)</p>
<p>å‰©ä¸‹æ¥æœ€é‡è¦çš„æ˜¯, Dè¦†å†™äº†ä»€ä¹ˆ?</p>
<p>å†æ¬¡æ¥çœ‹çœ‹æ˜¯å¦‚ä½•è®¿é—®è™šåŸºç±»æ•°æ®çš„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">D a;</span><br><span class="line">C *pd = &amp;a;</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%d\n"</span>, pd-&gt;A::_i);</span><br></pre></td></tr></table></figure>


<p>æ±‡ç¼–:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">.LFB1196:</span><br><span class="line">    pushq   %rbp</span><br><span class="line">    movq    %rsp, %rbp</span><br><span class="line">    subq    $48, %rsp</span><br><span class="line">    leaq    -48(%rbp), %rax</span><br><span class="line">    movq    %rax, %rdi</span><br><span class="line">    call    _ZN1DC1Ev</span><br><span class="line">    leaq    -48(%rbp), %rax</span><br><span class="line">    addq    $16, %rax		&#x2F;&#x2F; å› ä¸ºæ˜¯ C ç±»å‹æŒ‡é’ˆ, æ‰€ä»¥åšäº† +16 åç§»</span><br><span class="line">    movq    %rax, -8(%rbp)	&#x2F;&#x2F; C *pd &#x3D; &amp;a;</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    movq    (%rax), %rax	&#x2F;&#x2F; è·å¾—äº†æŒ‡é’ˆä¸­çš„å€¼</span><br><span class="line">    subq    $24, %rax		&#x2F;&#x2F; è¯¥å€¼å‡å» 24 </span><br><span class="line">    movq    (%rax), %rax	&#x2F;&#x2F; å†ä»¥è¯¥å€¼é—´æ¥å¯»å€</span><br><span class="line">    movq    %rax, %rdx</span><br><span class="line">    movq    -8(%rbp), %rax</span><br><span class="line">    addq    %rdx, %rax		&#x2F;&#x2F; rdx æœ¬èº«çš„å€¼ + æŒ‡é’ˆçš„å€¼</span><br><span class="line">    movl    (%rax), %eax	&#x2F;&#x2F; é—´æ¥å¯»å€å¾—åˆ°çš„å€¼å°±æ˜¯è™šåŸºç±»çš„å€¼</span><br><span class="line">    movl    %eax, %esi</span><br><span class="line">    movl    $.LC0, %edi</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    call    printf</span><br><span class="line">    movl    $0, %eax</span><br><span class="line">    leave</span><br><span class="line">    ret</span><br></pre></td></tr></table></figure>

<p>è¿™æ¬¡è¦æ¸…æ™°å¾—å¤šäº†, æˆ‘ä»¬ä»¥ä¸Šé¢Dçš„å†…å­˜å¸ƒå±€ä¸ºä¾‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">4196760</span>	<span class="comment">// 2. å®ƒå‡å» 24 åˆ°äº†è¿™é‡Œ </span></span><br><span class="line">    	<span class="comment">// 3. ç”¨è¿™é‡Œçš„å€¼å¯»å€å¾—åˆ°äº†æŸä¸ªæ•° x </span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">4196784</span>	<span class="comment">// 1. è¿™æ˜¯ä¸€å¼€å§‹ C æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜</span></span><br><span class="line">    	<span class="comment">// 4. ç”¨è¿™ä¸ªæŒ‡é’ˆ + x å¾—åˆ°äº†è™šåŸºç±»æ•°æ®çš„åœ°å€</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">3</span></span><br><span class="line"><span class="number">4</span></span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>é‚£ä¹ˆåœ¨ä»£ç ä¸­è¯•ä¸€ä¸‹, å¦‚æœæ²¡æœ‰é”™è¯¯çš„è¯, é‚£ä¸ª x åº”è¯¥æ˜¯ 4</p>
<p>(è¿™ä¸ªåœ°å€æ˜æ˜¾éå¸¸ä½, å®ƒç”šè‡³æ²¡è¾¾åˆ° 8 å­—èŠ‚, è¿™åº”è¯¥æ˜¯ç¼–è¯‘çš„æ—¶å€™å‡†å¤‡å¥½çš„æ•°æ®)</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line">D a;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> *pl = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;a;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> *pl2 = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;pl;</span><br><span class="line">*pl2 = *pl;</span><br><span class="line"></span><br><span class="line"><span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, *pl);	<span class="comment">// 16</span></span><br></pre></td></tr></table></figure>


<p>å–å‡ºæ¥äº† 16, emmmâ€¦ å—¯, æ²¡é”™, 4 ä¸ª 4å­—èŠ‚ 4 x 4 = 16 !!!!!!! </p>
<p>PS: æœ‰æ²¡æœ‰æ€è€ƒè¿‡ä¸ºä»€ä¹ˆé€šè¿‡åŒé—´æ¥æ‰èƒ½å»åˆ°è™šåŸºç±»å‘¢?</p>
<p>è¿™é‡Œæ˜æ˜¾çš„ä¸€ä¸ªé—®é¢˜æ˜¯, è™šåŸºç±»çš„æ•°æ®æ˜¯é€šè¿‡ C çš„æŸä¸ªåœ°å€ç´¢å¼•åˆ° D çš„æŸä¸ªåœ°å€</p>
<p>ç„¶åå†ç”¨ C çš„åœ°å€ç´¢å¼•åˆ°è™šåŸºç±»æ•°æ®, æœ‰ä¸¤æ¬¡çš„è·³è½¬ </p>
<p>æˆ‘å†æ¬¡è¯•äº†ä¸€ä¸‹æœ‰ç»§æ‰¿ä¸‰ä¸ªè™šåŸºç±»çš„æƒ…å†µ(å°±æ˜¯Då†ç»§æ‰¿äº†ä¸€ä¸ªç±»ä¼¼ BCçš„ç±»)</p>
<p>å‘ç°å®ƒçš„è®¿é—®æ–¹å¼æ˜¯ä¸€æ ·çš„, ä¹Ÿå°±æ˜¯è¯´, æ¯ä¸€ä¸ªè‡ªèº«éƒ½ä¼šå¾€å‰å¯»æ‰¾å›ºå®šçš„å­—èŠ‚(ç¼–è¯‘åå›ºå®š)</p>
<p>ç„¶åç”¨é‚£ä¸ªåœ°å€çš„æ•°æ® + æŒ‡é’ˆæœ¬èº«çš„åœ°å€(æˆ‘ä¸çŸ¥é“æˆ‘åˆæ²¡æœ‰è¡¨è¾¾æ¸…æ¥š, ä¸è¿‡æˆ‘æ„Ÿè§‰æˆ‘æ²¡æœ‰ :) )</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">E</span> :</span> <span class="keyword">virtual</span> <span class="keyword">public</span> A&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">555</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">D</span> :</span> <span class="keyword">public</span> B, <span class="keyword">public</span> C, <span class="keyword">public</span> E&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">int</span> _i = <span class="number">444</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    D a;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> *pl = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;a;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> *pl2 = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;pl;</span><br><span class="line">    *pl2 = *pl;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, *pl);   <span class="comment">// 32</span></span><br><span class="line"></span><br><span class="line">    pl = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;a + <span class="number">2</span>;</span><br><span class="line">    pl2 = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;pl;</span><br><span class="line">    *pl2 = *pl;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, *pl);   <span class="comment">// 16</span></span><br><span class="line"></span><br><span class="line">    pl = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;a + <span class="number">4</span>;</span><br><span class="line">    pl2 = (<span class="keyword">long</span> <span class="keyword">long</span> *)&amp;pl;</span><br><span class="line">    *pl2 = *pl;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%ld\n"</span>, *pl);   <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>

<p>å†…å­˜å¸ƒå±€:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="number">4196856</span>	(<span class="number">32</span>)<span class="comment">// 2. é€šè¿‡è¿™ä¸ªåœ°å€æ‹¿åˆ°åç§»</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">222</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">4196880</span>	(<span class="number">16</span>)<span class="comment">// 1. Cå¯¹è±¡, å½“æˆ‘è¦æ‰¾è™šåŸºç±»å¯¹è±¡æ—¶, æˆ‘å…ˆå¾€ä¸Šç§»åŠ¨å›ºå®šå­—èŠ‚</span></span><br><span class="line">    		<span class="comment">// è¿™äº›ç§»åŠ¨çš„å¤§å°éƒ½æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å†™æ­»äº†çš„å¸¸é‡(ç¼–è¯‘å™¨è‡ªåŠ¨è®¡ç®—)</span></span><br><span class="line">    		<span class="comment">// å¾€ä¸Šç§»åŠ¨çš„å­—èŠ‚ä¼šéšç€æ•°æ®å¤§å°è€Œæ”¹å˜, ä½†æ˜¯æ•°æ®ä¸­çš„åœ°å€æ˜¯ä¸å˜çš„</span></span><br><span class="line">    		<span class="comment">// æ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯4196880, é‚£ä¹ˆæ— è®ºå¾€ä¸Šç§»åŠ¨å¤šå°‘</span></span><br><span class="line">    		<span class="comment">// ä¸Šä¸€ä¸ªåœ°å€ä¸­å­˜çš„å€¼æ’å®šä¸º å½“å‰å€¼ - 24 (4196856)</span></span><br><span class="line">    	<span class="comment">// 3. æ ¹æ®æ‹¿åˆ°çš„åç§» + åœ°å€è·å–è™šåŸºç±»æ•°æ®</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">333</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">4196904</span> (<span class="number">0</span>)<span class="comment">// Eå¯¹è±¡, å®ƒå¦‚æœæƒ³æ‹¿åˆ°è™šåŸºç±»æ•°æ®, æ‰§è¡Œå’Œ C å¯¹è±¡ä¸€æ ·çš„æ“ä½œå°±å¥½</span></span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="number">555</span></span><br><span class="line"><span class="number">444</span></span><br><span class="line"><span class="number">111</span></span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>è¿™æ ·çš„å†…å­˜å¸ƒå±€åœ¨å…¶ä»–æ–¹é¢å¯èƒ½è¿˜ä¼šæœ‰ç”¨</p>
<p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¼šæœ‰ 0 å‘¢? æˆ‘ä¼°è®¡æ˜¯å› ä¸ºè¦å®ç°è¿™ç§å†…å­˜å¸ƒå±€, æˆ–è€…è¯´ä»€ä¹ˆå…¶ä»–åŸå› </p>
<h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><p> æˆ‘å¾ˆæ€€ç–‘ä¸‹æ¬¡æˆ‘çœ‹ç¬”è®°æ—¶, æˆ‘è‡ªå·±çœ‹ä¸çœ‹å¾—æ‡‚æˆ‘åœ¨è¯´ä»€ä¹ˆâ€¦</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/160IntersectionofTwoLinkedList</title>
    <url>/2020/01/09/leetcode/160IntersectionofTwoLinkedList/</url>
    <content><![CDATA[<h2 id="Intersection-of-two-linked-list"><a href="#Intersection-of-two-linked-list" class="headerlink" title="Intersection of two linked list"></a>Intersection of two linked list</h2><p><img src="https://imgur.com/nhmAc0h.png" alt=""></p>
<p>è·å¾—ä¸¤æ¡é“¾è¡¨çš„è¿æ¥ç‚¹</p>
<h3 id="my-solution-36ms-100"><a href="#my-solution-36ms-100" class="headerlink" title="my solution (36ms, 100%)"></a>my solution (36ms, 100%)</h3><p>(è™½ç„¶æ•ˆç‡çœ‹èµ·æ¥æ˜¯æœ€å¥½çš„, ä½†æ˜¯å…¶å®æ¯”èµ·æœ€å¥½çš„ç®—æ³•è¦å·®ä¸å°‘)</p>
<p>æ ¸å¿ƒéš¾ç‚¹åœ¨äºä¸¤æ¡é“¾è¡¨çš„é•¿åº¦ä¸ä¸€å®šç›¸ç­‰, è¿™æ ·å°±ä¸èƒ½éå†èŠ‚ç‚¹ç”¨ç­‰äºçš„å½¢å¼æ¥åˆ¤æ–­  </p>
<p>é‚£ä¹ˆæ‹¿åˆ°ä¸¤æ¡é“¾è¡¨çš„é•¿åº¦, è®©è¾ƒé•¿çš„é“¾è¡¨å‰è¿›è‹¥å¹²æ¬¡, ä»¥è¾¾åˆ°é•¿åº¦ç›¸ç­‰çš„æƒ…å½¢, é‚£ä¹ˆå°±å¯ä»¥éå†äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode *<span class="title">getIntersectionNode</span><span class="params">(ListNode *headA, ListNode *headB)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> deep_A = <span class="number">0</span>, deep_B = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        ListNode *temp_head = headA;</span><br><span class="line">        <span class="keyword">while</span> (temp_head) &#123;</span><br><span class="line">            temp_head = temp_head-&gt;next;</span><br><span class="line">            ++deep_A;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        temp_head = headB;</span><br><span class="line">        <span class="keyword">while</span> (temp_head) &#123;</span><br><span class="line">            temp_head = temp_head-&gt;next;</span><br><span class="line">            ++deep_B;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> distance = <span class="built_in">abs</span>(deep_A - deep_B);</span><br><span class="line">        <span class="keyword">if</span> (deep_A &gt; deep_B) &#123;</span><br><span class="line">            <span class="keyword">while</span> (distance) &#123;</span><br><span class="line">                headA = headA-&gt;next;</span><br><span class="line">                --distance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (distance) &#123;</span><br><span class="line">                headB = headB-&gt;next;</span><br><span class="line">                --distance;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (headA &amp;&amp; headB &amp;&amp; headA != headB) &#123;</span><br><span class="line">            headA = headA-&gt;next;</span><br><span class="line">            headB = headB-&gt;next;    </span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> headA;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»£ç å¦‚ä¸‹, ä¼šäº§ç”Ÿ 3 æ¬¡éå†, ä¸¤æ¬¡å®Œæ•´çš„éå† O(3n) =&gt; O(n)</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode *<span class="title">getIntersectionNode</span><span class="params">(ListNode *headA, ListNode *headB)</span> </span>&#123;</span><br><span class="line">        ListNode *p = headA;</span><br><span class="line">        ListNode *q = headB;</span><br><span class="line">        <span class="keyword">while</span> (p != q) &#123;</span><br><span class="line">            p = (p ? p-&gt;next: headB);</span><br><span class="line">            q = (q ? q-&gt;next: headA);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>åŸæ¥è¿˜å¯ä»¥è¿™ä¹ˆåš!!!</p>
<p>ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³åœ¨äº, A + B = B + A</p>
<p>å‡è®¾æœ‰ä¸¤æ¡é“¾è¡¨, é•¿åº¦ä¸ç­‰</p>
<pre><code>0 0 0 2 1 1    // A
0 0 2 1 1    // B</code></pre><p>å…¶ä¸­å°†ä»–ä»¬çš„é“¾æ¥ç‚¹æ ‡ä¸º 2</p>
<p>é‚£ä¹ˆæœ‰ä»¥ä¸‹ç»„åˆé“¾è¡¨</p>
<pre><code>0 0 0 2 1 1 0 0 2 1 1    // A + B
0 0 2 1 1 0 0 0 2 1 1    // B + A</code></pre><p>ä»–ä»¬å¦‚æœæœ‰é“¾æ¥ç‚¹, é‚£ä¹ˆåœ¨ç¬¬äºŒæ¬¡å¾ªç¯æ—¶å¿…ç„¶ç›¸ç­‰  </p>
<p>æˆ‘æ˜¯ç”¨æ±‚æ·±åº¦å·®æ¥è§£å†³è¿™ä¸ªé—®é¢˜, è¿™ä¸ªç®—æ³•æ›´åŠ å·§å¦™åœ°ç”¨ç»„åˆé“¾è¡¨çš„å½¢å¼è§„é¿äº†è¿™ä¸ªæ·±åº¦å·®</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/152MaximumProductSubarray</title>
    <url>/2020/01/09/leetcode/152MaximumProductSubarray/</url>
    <content><![CDATA[<h2 id="152-Maximum-Product-Subarray"><a href="#152-Maximum-Product-Subarray" class="headerlink" title="152 Maximum Product Subarray"></a>152 Maximum Product Subarray</h2><p><img src="https://imgur.com/soCfHk6.png" alt=""></p>
<p>æ‰¾åˆ°æ•°ç»„ä¸­æœ€å¤§çš„è¿ç»­ä¹˜ç§¯</p>
<h3 id="my-solution-8ms-100"><a href="#my-solution-8ms-100" class="headerlink" title="my solution (8ms, 100%)"></a>my solution (8ms, 100%)</h3><p>å…ˆå°†ä¹˜ç§¯ä»¥ 0 ä¸ºåˆ†ç•Œçº¿åˆ†å¼€, è¿™æ ·å¾—åˆ°çš„å°±æ˜¯ä¸€æ®µæ®µæœ€å¤§çš„ä¹˜ç§¯(æš‚æ—¶æ— è§†æ­£è´Ÿ)</p>
<p>è€Œå¦‚æœå¾—åˆ°çš„æ•°æ˜¯è´Ÿæ•°, é‚£ä¹ˆåˆ†ä¸º 4 ç§æƒ…å†µ </p>
<ol>
<li>ä»å·¦åˆ°å³, æ‰¾åˆ°ç¬¬ä¸€ä¸ªè´Ÿæ•°, ç”¨å½“å‰ä¹˜ç§¯é™¤ä»¥å®ƒ</li>
<li>ä»å·¦åˆ°å³, æ‰¾åˆ°ç¬¬ä¸€ä¸ªè´Ÿæ•°, ä»¥è¯¥è´Ÿæ•°ä¸ºç•Œé™, è·å–å·¦è¾¹çš„ä¹˜ç§¯</li>
<li>ä»å³åˆ°å·¦, æ‰¾åˆ°ç¬¬ä¸€ä¸ªè´Ÿæ•°, ç”¨å½“å‰ä¹˜ç§¯é™¤ä»¥å®ƒ</li>
<li>ä»å³åˆ°å·¦,, æ‰¾åˆ°ç¬¬ä¸€ä¸ªè´Ÿæ•°, ä»¥è¯¥è´Ÿæ•°ä¸ºç•Œé™, è·å–å³è¾¹çš„ä¹˜ç§¯</li>
</ol>
<p>è¿™å››ç§æƒ…å†µæœ€å¤§è€…, è§†ä¸ºè¿™ä¸€æ®µçš„æœ€å¤§å€¼, è€Œæ‰€æœ‰è¿™äº›æ®µå†åšæ¯”è¾ƒ, å°±å¾—åˆ°äº†æ•´ä¸ªæ•°ç»„è¿ç»­ä¹˜ç§¯çš„æœ€å¤§å€¼</p>
<p>ä»£ç å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = [] () &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; ();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProduct</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> ( !<span class="built_in">size</span> ) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> b = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> e = <span class="built_in">size</span>;</span><br><span class="line">        <span class="keyword">int</span> ret = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">while</span> (b &lt; e) &#123;</span><br><span class="line">            <span class="keyword">int</span> tb = b;</span><br><span class="line">            <span class="keyword">while</span> (b &lt; e &amp;&amp; nums[b] != <span class="number">0</span>) ++b;</span><br><span class="line">            <span class="keyword">if</span> (b - tb &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">                ret = <span class="built_in">max</span>(ret, nums[tb]);</span><br><span class="line">                <span class="keyword">if</span> (b &lt; e)</span><br><span class="line">                    ret = <span class="built_in">max</span>(ret, nums[b]);</span><br><span class="line">                b += <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> sum = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">int</span> tb2 = tb;</span><br><span class="line">            <span class="keyword">while</span> (tb2 &lt; b) sum *= nums[tb2++];</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (sum &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> sumneg1 = <span class="number">1</span>;</span><br><span class="line">                tb2 = tb;</span><br><span class="line">                <span class="keyword">while</span> (tb2 &lt; b) &#123; </span><br><span class="line">                    sumneg1 *= nums[tb2];</span><br><span class="line">                    <span class="keyword">if</span> (nums[tb2] &lt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                    ++tb2;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> sum1 = sumneg1 / nums[tb2] == <span class="number">1</span> ? sumneg1 : </span><br><span class="line">                    sumneg1 / nums[tb2];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">int</span> sumneg2 = <span class="number">1</span>;</span><br><span class="line">                tb2 = b - <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">while</span> (tb2 &gt;= tb) &#123;</span><br><span class="line">                    sumneg2 *= nums[tb2];</span><br><span class="line">                    <span class="keyword">if</span> (nums[tb2] &lt; <span class="number">0</span>) <span class="keyword">break</span>;</span><br><span class="line">                    --tb2;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">int</span> sum2 = sumneg2 / nums[tb2] == <span class="number">1</span> ? sumneg2 : </span><br><span class="line">                    sumneg2 / nums[tb2];</span><br><span class="line"></span><br><span class="line">                sum /= <span class="built_in">max</span>(sumneg1, sumneg2);</span><br><span class="line">                sum = <span class="built_in">max</span>(sum, sum1);</span><br><span class="line">                sum = <span class="built_in">max</span>(sum, sum2);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ret = <span class="built_in">max</span>(ret, sum);</span><br><span class="line">            b += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸å¤ªæ»¡æ„, ä»£ç æœ‰ç‚¹è¿‡é•¿äº†â€¦</p>
<p><img src="https://imgur.com/KGRgySn.png" alt=""></p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProduct</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> len = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">int</span> max_num[len] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> min_num[len] = &#123;<span class="number">0</span>&#125;;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">max</span> = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">min</span> = nums[<span class="number">0</span>];</span><br><span class="line">        max_num[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        min_num[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; len; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> tmp1 = max_num[i<span class="number">-1</span>] * nums[i];</span><br><span class="line">            <span class="keyword">int</span> tmp2 = min_num[i<span class="number">-1</span>] * nums[i];</span><br><span class="line">            <span class="keyword">int</span> cur_max_num = tmp1 &gt; tmp2 ? tmp1 : tmp2;</span><br><span class="line">            <span class="keyword">int</span> cur_min_num = tmp1 &lt; tmp2 ? tmp1 : tmp2;</span><br><span class="line">            max_num[i] = cur_max_num &gt;= nums[i] ? cur_max_num : nums[i];</span><br><span class="line">            min_num[i] = cur_min_num &lt;= nums[i] ? cur_min_num : nums[i];</span><br><span class="line">            <span class="built_in">max</span> = <span class="built_in">max</span> &gt; max_num[i] ? <span class="built_in">max</span> : max_num[i];</span><br><span class="line">            <span class="built_in">min</span> = <span class="built_in">min</span> &lt; min_num[i] ? <span class="built_in">min</span> : min_num[i];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å•Š. ç®€æ´çš„å°ä¸œè¥¿</p>
<p>ä¸è¿‡, æˆ‘ä¸æ˜¯å¤ªæ‡‚è¿™ä¸ªä»£ç çš„å«ä¹‰â€¦  </p>
<p>ä¸è¿‡æˆ‘è§‰å¾—æˆ‘çš„æƒ³æ³•ä¼šå¥½ç‚¹, è™½ç„¶ä»£ç å®ç°èµ·æ¥æœ‰ç‚¹å›°éš¾  </p>
<p>ä½†æ˜¯å®ƒèƒ½ä¸€æ¬¡æ€§è·³è¿‡å¾ˆå¤§ä¸€ç‰‡åŒºåŸŸ, å¯¹äºè¿ç»­æ•´æ•°å¾ˆå¤šçš„æƒ…å†µ, èƒ½å¤Ÿå¾ˆå¿«åœ°è®¡ç®—å‡ºæ¥  </p>
<p>è€Œè¿™ç§çš„è¯ä¼šå®Œå®Œæ•´æ•´çš„éå†ä¸€æ¬¡</p>
<p>emmm. æ˜¯çš„, æˆ‘è§‰å¾—æˆ‘çš„æƒ³æ³•ä¼šå¥½ä¸€ç‚¹ :)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/135Candy</title>
    <url>/2020/01/09/leetcode/135Candy/</url>
    <content><![CDATA[<h2 id="Candy"><a href="#Candy" class="headerlink" title="Candy"></a>Candy</h2><p><img src="https://imgur.com/x5xFxEL.png" alt=""></p>
<p>æŒ‰ç…§è§„åˆ™ç»™æ¯ä¸ªå°å­©å‘ç³–æœ</p>
<ol>
<li>æ¯ä¸ªå°å­©çš„ç³–æœæ•°è‡³å°‘ä¸º 1</li>
<li>æ¯ä¸ªå°å­©è·å¾—çš„ç³–æœæ•°æ¯”ä»–ä¸´è¿‘çš„, å¹¶ä¸”æƒé‡æ¯”ä»–å°çš„å°å­©è·å¾—çš„è¦å¤š</li>
</ol>
<h3 id="my-solution-12ms-100-00"><a href="#my-solution-12ms-100-00" class="headerlink" title="my solution(12ms, 100.00%)"></a>my solution(12ms, 100.00%)</h3><p>è™½ç„¶åšå‡ºæ¥äº†, ä½†æ˜¯å¹¶ä¸é«˜å…´ = =, å› ä¸ºä»£ç å¤ªè¿‡å¤æ‚</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> _ = [] () &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; ();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">candy</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; ratings)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = ratings.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">size</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; candys(<span class="built_in">size</span>, <span class="number">0</span>);  </span><br><span class="line"></span><br><span class="line">		<span class="comment">// å¡«å……æ‰€æœ‰å¯ä»¥ç›´æ¥ç¡®å®šçš„æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="number">0</span>] &lt;= ratings[<span class="number">1</span>]) </span><br><span class="line">            candys[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="built_in">size</span> - <span class="number">1</span>] &lt;= ratings[<span class="built_in">size</span> - <span class="number">2</span>]) </span><br><span class="line">            candys[<span class="built_in">size</span> - <span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i + <span class="number">1</span> &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> minn = <span class="built_in">min</span>(ratings[i], ratings[i - <span class="number">1</span>]);</span><br><span class="line">            minn = <span class="built_in">min</span>(minn, ratings[i + <span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (ratings[i] == minn)</span><br><span class="line">                candys[i] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// æ­£å‘éå†</span></span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="number">0</span>] &gt; ratings[<span class="number">1</span>] &amp;&amp; candys[<span class="number">1</span>]) </span><br><span class="line">            candys[<span class="number">0</span>] = candys[<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="built_in">size</span> - <span class="number">1</span>] &gt; ratings[<span class="built_in">size</span> - <span class="number">2</span>] &amp;&amp; candys[<span class="built_in">size</span> - <span class="number">2</span>]) </span><br><span class="line">            candys[<span class="built_in">size</span> - <span class="number">1</span>] = candys[<span class="built_in">size</span> - <span class="number">2</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i + <span class="number">1</span> &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (candys[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> minn, maxn;</span><br><span class="line">                <span class="comment">// å½“ä»–æ˜¯ä¸´è¿‘çš„äººä¸­æƒé‡æœ€å¤§çš„äººæ—¶, ä»–çš„ç³–æœæ•°æ˜¯</span></span><br><span class="line">         		<span class="comment">// max(left, right) + 1</span></span><br><span class="line">                <span class="keyword">if</span> (ratings[i + <span class="number">1</span>] == ratings[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (candys[i + <span class="number">1</span>] &amp;&amp; candys[i - <span class="number">1</span>])</span><br><span class="line">                        candys[i] = <span class="built_in">max</span>(candys[i + <span class="number">1</span>], candys[i - <span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (ratings[i + <span class="number">1</span>] &gt; ratings[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    minn = i - <span class="number">1</span>;</span><br><span class="line">                    maxn = i + <span class="number">1</span>;</span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    minn = i + <span class="number">1</span>;</span><br><span class="line">                    maxn = i - <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">				</span><br><span class="line">				<span class="comment">// å½“ä»–åªæ¯”å…¶ä¸­ä¸€ä¸ªå¤§æ—¶, ä»–çš„ç³–æœæ•°æ˜¯ min + 1</span></span><br><span class="line">                <span class="keyword">if</span> (ratings[i] &lt;= ratings[maxn] &amp;&amp; candys[minn])</span><br><span class="line">                    candys[i] = candys[minn] + <span class="number">1</span>;</span><br><span class="line">                <span class="comment">// è¿™é‡Œå’Œç¬¬ä¸€å¤„çš„åˆ¤æ–­æ˜¯ç›¸åŒçš„, ç¬¬ä¸€å¤„åªæ˜¯ä¸ºäº†å‡å°‘ä¸€äº›æ“ä½œ</span></span><br><span class="line">                <span class="keyword">if</span> (ratings[i] &gt; ratings[maxn] &amp;&amp; candys[maxn] &amp;&amp; candys[minn])</span><br><span class="line">                    candys[i] = <span class="built_in">max</span>(candys[maxn], candys[minn]) + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">		<span class="comment">// åå‘éå†, é€»è¾‘ç›¸åŒ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">size</span> - <span class="number">2</span>; i &gt;= <span class="number">1</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (candys[i] == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">int</span> minn, maxn;</span><br><span class="line">                <span class="keyword">if</span> (ratings[i + <span class="number">1</span>] == ratings[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (candys[i + <span class="number">1</span>] &amp;&amp; candys[i - <span class="number">1</span>])</span><br><span class="line">                        candys[i] = <span class="built_in">max</span>(candys[i + <span class="number">1</span>], candys[i - <span class="number">1</span>]) + <span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (ratings[i + <span class="number">1</span>] &gt; ratings[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                    minn = i - <span class="number">1</span>;</span><br><span class="line">                    maxn = i + <span class="number">1</span>;</span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    minn = i + <span class="number">1</span>;</span><br><span class="line">                    maxn = i - <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (ratings[i] &lt;= ratings[maxn] &amp;&amp; candys[minn])</span><br><span class="line">                    candys[i] = candys[minn] + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span> (ratings[i] &gt; ratings[maxn] &amp;&amp; candys[maxn] &amp;&amp; candys[minn])</span><br><span class="line">                    candys[i] = <span class="built_in">max</span>(candys[maxn], candys[minn]) + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="number">0</span>] &gt; ratings[<span class="number">1</span>] &amp;&amp; candys[<span class="number">1</span>]) </span><br><span class="line">            candys[<span class="number">0</span>] = candys[<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (ratings[<span class="built_in">size</span> - <span class="number">1</span>] &gt; ratings[<span class="built_in">size</span> - <span class="number">2</span>] &amp;&amp; candys[<span class="built_in">size</span> - <span class="number">2</span>]) </span><br><span class="line">            candys[<span class="built_in">size</span> - <span class="number">1</span>] = candys[<span class="built_in">size</span> - <span class="number">2</span>] + <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i)</span><br><span class="line">            ret += candys[i];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æ•´ä½“ä»£ç ä¼šæœ‰ 3 æ¬¡éå†, ä½†æ˜¯ä»£ç å¤ªå¤š, å¤ªå¤æ‚äº†â€¦</p>
<p><img src="https://imgur.com/BFwX292.png" alt=""></p>
<p>å¦‚æœæ²¡æœ‰çœ‹åˆ°æœ€å¥½ç®—æ³•çš„ç®€æ´ç¨‹åº¦, æˆ‘å¯èƒ½è¿˜èƒ½å†é«˜å…´ä¸€ä¸‹â€¦</p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"> <span class="keyword">public</span>:</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">candy</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; ratings)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; num(ratings.<span class="built_in">size</span>(), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; ratings.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ratings[i] &gt; ratings[i<span class="number">-1</span>]) &#123;</span><br><span class="line">        num[i] = num[i<span class="number">-1</span>] + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = ratings.<span class="built_in">size</span>() - <span class="number">2</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">      <span class="keyword">if</span> (ratings[i] &gt; ratings[i+<span class="number">1</span>] &amp;&amp; num[i] &lt;= num[i+<span class="number">1</span>]) &#123;</span><br><span class="line">        num[i] = num[i+<span class="number">1</span>] + <span class="number">1</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; num.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">      sum += num[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> x = []() &#123;</span><br><span class="line">  ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">  <span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line">  <span class="built_in">cout</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>
<p>(åšå®Œé¢˜çš„å–œæ‚¦è¢«å†²åˆ·å¾—å¹²å¹²å‡€å‡€â€¦, å•Šâ€¦ çœŸçš„æ˜¯ç¾æ„§éš¾å½“å•Šâ€¦)</p>
<p>(æˆ‘ä¸ºä»€ä¹ˆæ€»æ˜¯æŠŠé—®é¢˜å¤æ‚åŒ–äº†å‘¢â€¦)</p>
<p>é€»è¾‘ä¸Šå¤§è‡´ç›¸åŒ, åªä¸è¿‡ä»–åªéœ€è¦ä¸€æ¬¡ åå‘éå†, ä¸€æ¬¡ æ­£å‘éå†</p>
<p>å…¶ä¸­æ¯æ¬¡éå†æ‰€éœ€è¦åˆ¤æ–­çš„æ¡ä»¶éƒ½ååˆ†ç®€å•å¹¶ä¸”æ¸…æ™°</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/16Z3Sum_Closest</title>
    <url>/2020/01/09/leetcode/16Z3Sum_Closest/</url>
    <content><![CDATA[<h2 id="3Sum-Closest"><a href="#3Sum-Closest" class="headerlink" title="3Sum Closest"></a>3Sum Closest</h2><p><img src="https://i.imgur.com/7Q0hVY2.png" alt=""></p>
<p>ç»™ä¸€ä¸ªåŒ…å«å¤šä¸ªæ•´æ•°çš„æ•°ç»„ nums, ä»¥åŠä¸€ä¸ªæ•´æ•° target, åœ¨ nums ä¸­æ‰¾ä¸€ä¸ªä¸‰æ•´æ•°, æ»¡è¶³å’Œæœ€æ¥è¿‘ target</p>
<p>è¿”å›è¿™ä¸ªå’Œ, ä½ å¯ä»¥å‡å®šæ¯ä¸€ä¸ªè¾“å…¥éƒ½åªæœ‰ä¸€ä¸ªè§£æ³•</p>
<h3 id="my-code"><a href="#my-code" class="headerlink" title="my code"></a>my code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">threeSumClosest</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// nums.size() return value is size_t !!!!</span></span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">size</span>() &lt; <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (nums.<span class="built_in">size</span>() == <span class="number">3</span>) <span class="keyword">return</span> nums[<span class="number">0</span>] + nums[<span class="number">1</span>] + nums[<span class="number">2</span>];</span><br><span class="line">        cut(nums);</span><br><span class="line">        <span class="keyword">int</span> length = nums.<span class="built_in">size</span>() - <span class="number">1</span>;</span><br><span class="line">        minn = nums[<span class="number">0</span>] + nums[<span class="number">1</span>] + nums[<span class="number">2</span>];</span><br><span class="line">        targetp = target;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= length; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i2 = <span class="number">0</span>; i2 &lt;= length; ++i2) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i2 != i) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i3 = <span class="number">0</span>; i3 &lt;= length; ++i3) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (i3 != i2 &amp;&amp; i3 != i) &#123;</span><br><span class="line">                            <span class="keyword">if</span> ( !isMin(nums[i] + nums[i2] + nums[i3]) )</span><br><span class="line">                                <span class="keyword">break</span>;</span><br><span class="line">                        &#125; <span class="comment">// 3 if</span></span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">                    &#125; <span class="comment">// 3</span></span><br><span class="line">                &#125; <span class="comment">// 2 if</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">            &#125; <span class="comment">// 2</span></span><br><span class="line">        &#125; <span class="comment">// 1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> minn;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        sort(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isMin</span><span class="params">(<span class="keyword">int</span> newn)</span> </span>&#123;</span><br><span class="line">        minn = <span class="built_in">abs</span>(newn - targetp) &gt; <span class="built_in">abs</span>(targetp - minn) ? minn : newn;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> newn &lt; targetp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> minn;</span><br><span class="line">    <span class="keyword">int</span> targetp;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>éå¸¸æ„šè ¢åœ°é€‰æ‹©äº†ä¸‘é™‹çš„forforforâ€¦</p>
<p>æ¯”è¾ƒä¸»è¦çš„æ˜¯é‡æ–°æ’åºäº†é›†åˆ, è¿™æ ·åœ¨å¾ªç¯ä¸­çš„å€¼å°±ä¼šè¶Šæ¥è¶Šå¤§, </p>
<p>é‚£ä¹ˆå½“è¶…è¿‡ä¸€å®šæ•°å€¼çš„æ—¶å€™, å°±å¯ä»¥breakå‡ºå», å‡å°‘æ›´å¤šçš„æ— ç”¨è®¡ç®—</p>
<p>ä¸è¿‡ä¾æ—§å·®ä¸å¤šæ˜¯ o3 çš„å¤æ‚åº¦</p>
<h4 id="memery-and-speed"><a href="#memery-and-speed" class="headerlink" title="memery and speed"></a>memery and speed</h4><p><img src="https://imgur.com/BFPPahz.png" alt=""></p>
<p>é€Ÿåº¦åœ¨ç»Ÿè®¡å›¾ä¹‹å¤–, å†…å­˜ä½¿ç”¨å€’æ˜¯æŒºå°‘çš„ (ç®—æ³•å°±æ˜¯è¦ç©ºé—´æ¢æ—¶é—´å•Š, MUå°‘æœ‰ä»€ä¹ˆç”¨ = =)</p>
<h3 id="dalaoâ€˜s-code"><a href="#dalaoâ€˜s-code" class="headerlink" title="dalaoâ€˜s code"></a>dalaoâ€˜s code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">threeSumClosest</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (n &lt; <span class="number">3</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> rnum = nums[<span class="number">0</span>] + nums[<span class="number">1</span>] + nums[<span class="number">2</span>];</span><br><span class="line">        sort(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (n - <span class="number">2</span>); ++i) &#123;</span><br><span class="line">            <span class="keyword">int</span> lb = i + <span class="number">1</span>, ub = n - <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (lb &lt; ub) &#123;</span><br><span class="line">                <span class="keyword">int</span> tmpsum = nums[i] + nums[lb] + nums[ub];</span><br><span class="line">                <span class="keyword">if</span> (tmpsum == target) <span class="keyword">return</span> target;</span><br><span class="line">                <span class="keyword">if</span> (tmpsum &gt; target) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((tmpsum - target) &lt; <span class="built_in">abs</span>(rnum - target)) rnum = tmpsum;</span><br><span class="line">                    --ub;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((target - tmpsum) &lt; <span class="built_in">abs</span>(rnum - target)) rnum = tmpsum;</span><br><span class="line">                    ++lb;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rnum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>ä»–çš„æ€è·¯ä¹Ÿæ˜¯æ’åºå, æ ¹æ®æœ‰é¡ºåºçš„å…ƒç´ è¿›è¡Œä¼˜åŒ–  </p>
<p>ä¸è¿‡æ˜¯æŒ‰ç…§é¦–ä½é€¼è¿‘çš„æ–¹å¼æ¥ä¼˜åŒ–, å¹¶ä¸”æ²¡æœ‰ä¸‘é™‹çš„forforfor (diediedie!!!)</p>
<p>ä»£ç å°‘äº†å¾ˆå¤š, ä½†æ˜¯ä¹Ÿæ›´åŠ ç®€æ´å’Œæ¸…æ™°äº†</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/17ZLetter_Combinations_of_a_phone_Number</title>
    <url>/2020/01/09/leetcode/17ZLetter_Combinations_of_a_phone_Number/</url>
    <content><![CDATA[<h3 id="Letter-combinations-of-a-phone-number"><a href="#Letter-combinations-of-a-phone-number" class="headerlink" title="Letter combinations of a phone number"></a>Letter combinations of a phone number</h3><p><img src="https://i.imgur.com/VLZKo4s.png" alt=""></p>
<p>ç»™ä¸€ä¸ªåŒ…å« 2-9 æ•´æ•°çš„å­—ç¬¦ä¸², è¿”å›æ‰€æœ‰å¯èƒ½çš„æ•°å­—èƒ½ä»£è¡¨çš„å­—æ¯ç»„åˆ  </p>
<h3 id="my-code"><a href="#my-code" class="headerlink" title="my code"></a>my code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; letterCombinations(<span class="built_in">string</span> digits) &#123;</span><br><span class="line">        <span class="keyword">if</span> (digits.empty()) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        doit(digits, &#123;&#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">doit</span><span class="params">(<span class="built_in">string</span> digits, <span class="built_in">string</span> <span class="keyword">const</span>&amp; str)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (digits.<span class="built_in">size</span>() == <span class="number">0</span>) &#123;</span><br><span class="line">            ret.emplace_back(str);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&amp; charset = dict[<span class="keyword">int</span>(digits[<span class="number">0</span>]) - <span class="number">48</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; charset.<span class="built_in">size</span>(); ++i) &#123;          </span><br><span class="line">            doit(&#123;digits.<span class="built_in">begin</span>() + <span class="number">1</span>, digits.<span class="built_in">end</span>()&#125;, str + charset[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">int</span>, <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&gt; dict = &#123;</span><br><span class="line">        &#123;<span class="number">2</span>, &#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">3</span>, &#123;<span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'f'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">4</span>, &#123;<span class="string">'g'</span>, <span class="string">'h'</span>, <span class="string">'i'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">5</span>, &#123;<span class="string">'j'</span>, <span class="string">'k'</span>, <span class="string">'l'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">6</span>, &#123;<span class="string">'m'</span>, <span class="string">'n'</span>, <span class="string">'o'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">7</span>, &#123;<span class="string">'p'</span>, <span class="string">'q'</span>, <span class="string">'r'</span>, <span class="string">'s'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">8</span>, &#123;<span class="string">'t'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>&#125;&#125;,</span><br><span class="line">        &#123;<span class="number">9</span>, &#123;<span class="string">'w'</span>, <span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'z'</span>&#125;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç®€å•åœ°å­˜å‚¨ä¸€ä¸ªæ˜ å°„, ç„¶åå¾ªç¯è°ƒç”¨, æ¯æ¬¡è·å–ä¸€ä¸ªå­—ç¬¦  </p>
<p>å› ä¸ºå¾ªç¯æ·±åº¦ä¸å¯æ§, ä»¥åŠä¸ºäº†ç®€å•æ˜“æ‡‚, æ‰€ä»¥é€‰æ‹©äº†é€’å½’, ä¸è¿‡è¿™ä¼šå¸¦æ¥é¢å¤–çš„æ ˆå¸§</p>
<p><img src="https://imgur.com/FnyQQQ1.png" alt=""></p>
<p>å†…å­˜å¼€é”€ä¸Šä¼šå¤šä¸å°‘, é€Ÿåº¦ä¸Šå·®åˆ«å€’æ˜¯ä¸å¤§  </p>
<h3 id="dalaoâ€™s-code"><a href="#dalaoâ€™s-code" class="headerlink" title="dalaoâ€™s code"></a>dalaoâ€™s code</h3><p>ç®€å•çœ‹äº†ä¸€ä¸‹, æ˜¯ç”¨ for å¾ªç¯å®ç°çš„  </p>
<p>å› ä¸ºæ—¶é—´ä¸Šå¹¶æ²¡æœ‰ä»€ä¹ˆå·®è·, åŸç†ä¹Ÿå¾ˆå¥½æ‡‚, è¿™æ¬¡å°±ä¸å…·ä½“è´´å‡ºæ¥äº†</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/190EReverseBits</title>
    <url>/2020/01/09/leetcode/190EReverseBits/</url>
    <content><![CDATA[<p><img src="https://imgur.com/194AzQQ.png" alt=""></p>
<p>åè½¬äºŒè¿›åˆ¶</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>æˆ‘é€‰çš„æ–¹æ³•æ˜¯ç›´æ¥è°ƒç”¨ bits.Reverse å‡½æ•°æ¥è§£å†³, å¦‚æœè‡ªå·±å†™çš„è¯, åº”è¯¥ä¼šå¾ªç¯è·å–æ¯ä¸€ä½, é‡æ–°æ„é€ ä¸€ä¸ªæ•°å­—</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseBits</span><span class="params">(num <span class="keyword">uint32</span>)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> bits.Reverse32(num)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><p>è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä¸€é“ easy çš„é¢˜ä¼šå•ç‹¬åšç¬”è®°çš„åŸå› , å› ä¸ºè¿™é“é¢˜çš„è§£æ³•å¾ˆæœ‰æ„æ€</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseBits</span><span class="params">(num <span class="keyword">uint32</span>)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">    constNums := []<span class="keyword">uint32</span>&#123;<span class="number">0xAAAAAAAA</span>, <span class="number">0x55555555</span>, <span class="number">0xCCCCCCCC</span>, <span class="number">0x33333333</span>, <span class="number">0xF0F0F0F0</span>, <span class="number">0x0F0F0F0F</span>, <span class="number">0xFF00FF00</span>, <span class="number">0x00FF00FF</span>, <span class="number">0xFFFF0000</span>, <span class="number">0x0000FFFF</span>&#125;</span><br><span class="line">    <span class="keyword">var</span> index, power <span class="keyword">uint32</span></span><br><span class="line">    <span class="keyword">for</span> index, power = <span class="number">0</span>, <span class="number">0</span>; index &lt;= <span class="number">8</span>; index, power = index+<span class="number">2</span>, power+<span class="number">1</span> &#123;</span><br><span class="line">        num = ((num &amp; constNums[index]) &gt;&gt; (<span class="number">1</span> &lt;&lt; power)) | ((num &amp; constNums[index+<span class="number">1</span>]) &lt;&lt; (<span class="number">1</span> &lt;&lt; power))</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> num</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¹çœ‹ä¹‹ä¸‹ç†è§£ä¸äº†, ç‰¹åˆ«æ˜¯å¾ªç¯ä¸­çš„é‚£å¥ä»£ç , å…ˆç»™ä¸ªä¾‹å­æ¥å±•ç¤ºä¸€ä¸‹ :</p>
<pre><code>åŸäºŒè¿›åˆ¶:       00000010100101000001111010011100
ç¬¬ä¸€æ¬¡å¾ªç¯å:       00000001011010000010110101101100
ç¬¬äºŒæ¬¡å¾ªç¯å:       00000100100100101000011110010011
ç¬¬ä¸‰æ¬¡å¾ªç¯å:       01000000001010010111100000111001
ç¬¬å››æ¬¡å¾ªç¯å:       00101001010000000011100101111000
ç¬¬äº”æ¬¡å¾ªç¯å:       00111001011110000010100101000000</code></pre><figure class="highlight go"><table><tr><td class="code"><pre><span class="line">((num &amp; constNums[index]) &gt;&gt; (<span class="number">1</span> &lt;&lt; power)) | ((num &amp; constNums[index+<span class="number">1</span>]) &lt;&lt; (<span class="number">1</span> &lt;&lt; power))</span><br></pre></td></tr></table></figure>

<p>ä»£ç çš„å«ä¹‰æ˜¯è¿™æ ·çš„(è¯¶â€¦ æˆ‘æƒ³æƒ³æ€ä¹ˆè§£é‡Šä¸€ä¸‹ = =)</p>
<p>emmm, å…ˆçœ‹ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­, é‚£ä¹ˆå°±èƒ½ç†è§£äº†, é¦–å…ˆ, å–äºŒè¿›åˆ¶ 01, åªæ‰§è¡Œä¸€æ¬¡å¾ªç¯, çœ‹çœ‹æ•ˆæœ</p>
<p>num &amp; constNums[index]  = 0, (num &amp; constNums[index+1]) = 1, power = 0, æ‰€ä»¥ç»“æœæ˜¯ 10, æˆ‘ä»¬å¾—åˆ°äº†åè½¬å­—ç¬¦ä¸²</p>
<p>é‚£ä¹ˆå†æ¥éš¾ç‚¹çš„ä¾‹å­, 1101, è¿™æ ·éœ€è¦æ‰§è¡Œä¸¤æ¬¡å¾ªç¯</p>
<p>num &amp; constNums[index]  = 1000,  (num &amp; constNums[index+1]) = 0101, power = 0, æ‰€ä»¥ç¬¬ä¸€æ¬¡å¾ªç¯çš„ç»“æœæ˜¯ 0100 | 1010 = 1110</p>
<p>num &amp; constNums[index]  = 1100, (num &amp; constNums[index+1]) = 0010, power = 1, æ‰€ä»¥ç»“æœæ˜¯ 0011 | 1000 = 1011</p>
<p>è¿™æ ·å¤§æ¦‚å°±èƒ½äº†è§£äº†å§, ç¬¬ä¸€æ¬¡å¾ªç¯æ˜¯ä¸¤ä½ä¸ºä¸€ç»„äº¤æ¢ä½ç½®, ç¬¬äºŒæ¬¡å¾ªç¯æ˜¯å››ä½ä¸ºä¸€ç»„äº¤æ¢ä½ç½®, æ‰€ä»¥ç¬¬ä¸€æ¬¡çš„äºŒè¿›åˆ¶æ˜¯ 0xAAAAAAAA, 0x55555555 ç±»ä¼¼ä¸ 101010â€¦ 010101â€¦ è¿™æ ·çš„, ä»–ä»¬çš„äºŒè¿›åˆ¶ä½æ˜¯ç›¸åçš„, åŒç†ç›´åˆ°è¾¾åˆ°è¶³å¤Ÿçš„ä½æ•°ä¸ºæ­¢, è¿™é“é¢˜çš„å¤æ‚åº¦æ˜¯ O(logn) çº§åˆ«çš„, å…¶ä¸­ s = æ•°å­—çš„ä½æ•°, s = 2 çš„ n æ¬¡æ–¹</p>
<p>çœŸæ˜¯ä¸ªä¸é”™çš„ç®—æ³• :)</p>
<p>è¿™ä¸ªç®—æ³•èƒ½è§åˆ° äºŒåˆ† å’Œ é€’å½’ çš„å½±å­, ç†è§£äº†å°±ä¼šéå¸¸ç®€å•</p>
<p>çœ‹äº† go å¯¹äºè¯¥ç®—æ³•çš„å®ç°, ä¹Ÿæ˜¯è¿™æ ·çš„</p>
<p>é¡ºä¾¿, çœ‹äº† go çš„æºç , å…¶å®å¥å­å¯ä»¥æ›´ç®€å• </p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line">constNums[index] &amp; num &gt;&gt; (<span class="number">1</span> &lt;&lt; power) | constNums[index+<span class="number">1</span>] &amp; num &lt;&lt; (<span class="number">1</span> &lt;&lt; power)</span><br></pre></td></tr></table></figure>

<p>æ•´ä¸ªä»£ç ä¹Ÿå¯ä»¥é‡æ„</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reverseBits</span><span class="params">(n <span class="keyword">uint32</span>)</span> <span class="title">uint32</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> m0 <span class="keyword">uint32</span> = <span class="number">0x55555555</span></span><br><span class="line">    <span class="keyword">var</span> m1 <span class="keyword">uint32</span> = <span class="number">0x33333333</span></span><br><span class="line">    <span class="keyword">var</span> m2 <span class="keyword">uint32</span> = <span class="number">0x0F0F0F0F</span></span><br><span class="line">    <span class="keyword">var</span> m3 <span class="keyword">uint32</span> = <span class="number">0x00FF00FF</span></span><br><span class="line"></span><br><span class="line">    n = n &gt;&gt; <span class="number">1</span> &amp; m0 | n &amp; m0 &lt;&lt; <span class="number">1</span></span><br><span class="line">    n = n &gt;&gt; <span class="number">2</span> &amp; m1 | n &amp; m1 &lt;&lt; <span class="number">2</span></span><br><span class="line">    n = n &gt;&gt; <span class="number">4</span> &amp; m2 | n &amp; m2 &lt;&lt; <span class="number">4</span></span><br><span class="line">    n = n &gt;&gt; <span class="number">8</span> &amp; m3 | n &amp; m3 &lt;&lt; <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> n &gt;&gt; <span class="number">16</span> | n &lt;&lt; <span class="number">16</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™åŸºæœ¬ä¸ go çš„ reverse32 æºç ä¸€è‡´, ä¸æ„§æ˜¯æºç å•Šâ€¦  </p>
<p>è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç è¿›ä¸€æ­¥å‡å°‘äº†å˜é‡å’Œå¸¸é‡, å…¶ä¸­é‚£ index æ‰€ä»£è¡¨çš„ä¸€å¯¹æœ¬å°±å¯ä»¥ç”¨ç§»ä½æ¥ä»£æ›¿</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/209MininumSizeSubarraySum</title>
    <url>/2020/01/09/leetcode/209MininumSizeSubarraySum/</url>
    <content><![CDATA[<h2 id="Minimun-Size-Subarray-Sum"><a href="#Minimun-Size-Subarray-Sum" class="headerlink" title="Minimun Size Subarray Sum"></a>Minimun Size Subarray Sum</h2><p><img src="https://imgur.com/HJmyh7Q.png" alt=""></p>
<p>ä¸æƒ³è§£é‡Šâ€¦</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>ç®€å•æ€è€ƒäº†ä¸€ä¸‹, ä»¥æ¯ä¸ªå…ƒç´ ä¸ºèµ·ç‚¹, å¾ªç¯å¾€å³æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„æ•° </p>
<p>æœ€ç»ˆåšæ¯”è¾ƒ, å°±å¯ä»¥å¾—å‡ºç­”æ¡ˆ</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minSubArrayLen</span><span class="params">(s <span class="keyword">int</span>, nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    size := <span class="built_in">len</span>(nums)</span><br><span class="line">    ret := size</span><br><span class="line">    <span class="keyword">var</span> sum <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span>(nums) &#123;</span><br><span class="line">        sum += v</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (sum &lt; s) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span>(nums) &#123;</span><br><span class="line">        sum = v</span><br><span class="line">        counter := <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i2 := i + <span class="number">1</span>; i2 &lt; size &amp;&amp; sum &lt; s; i2++ &#123;</span><br><span class="line">            sum += nums[i2]</span><br><span class="line">            counter++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sum &gt;= s &amp;&amp; counter &lt; ret &#123;</span><br><span class="line">            ret = counter</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„å¤æ‚åº¦å¤§æ¦‚æ˜¯ O(n2), åŒæ—¶ä¸ºäº†åŒºåˆ«ç‰¹æ®Šæƒ…å†µ, è¿˜åšäº†ä¸€æ¬¡â€¦ </p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minSubArrayLen</span><span class="params">(s <span class="keyword">int</span>, nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    size := <span class="built_in">len</span>(nums)</span><br><span class="line">    ret := size + <span class="number">1</span></span><br><span class="line">    start := <span class="number">0</span></span><br><span class="line">    <span class="keyword">var</span> sum <span class="keyword">int</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, v := <span class="keyword">range</span>(nums) &#123;</span><br><span class="line">        sum += v</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> sum &gt;= s &amp;&amp; sum - nums[start] &gt;= s &#123;</span><br><span class="line">            sum -= nums[start]</span><br><span class="line">            start++</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> sum &gt;= s &amp;&amp; i - start + <span class="number">1</span> &lt; ret &#123;</span><br><span class="line">            ret = i - start + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ret == size + <span class="number">1</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶å®è¿™æ˜¯æˆ‘å°†ç®—æ³•æ€æƒ³é‡å†™åçš„ä»£ç â€¦</p>
<p>ç®€å•æ¥è¯´, å°±æ˜¯å…ˆæ‰¾åˆ°åŒ¹é…çš„ sum, ç„¶åæ²¡åŠ ä¸€æ¬¡, å°±å°è¯•å‡å°‘å‰é¢çš„æ•°  </p>
<p>è¿™æ ·éå†ä¹‹å, å¾—åˆ°çš„æ•°åŒæ ·ä¹Ÿæ˜¯æœ€çŸ­çš„</p>
<p>(æˆ‘å¾ˆå¥½å¥‡æ²¡æœ‰æ˜¯å¦æ²¡æœ‰äººå¯¹æ•°çº§çš„è§£å†³æ–¹æ¡ˆâ€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/222CountCompleteTreeNodes</title>
    <url>/2020/01/09/leetcode/222CountCompleteTreeNodes/</url>
    <content><![CDATA[<h2 id="222-Count-Complete-Tree-Nodes"><a href="#222-Count-Complete-Tree-Nodes" class="headerlink" title="222. Count Complete Tree Nodes"></a>222. Count Complete Tree Nodes</h2><p><img src="https://imgur.com/7DA2TjB.png" alt=""></p>
<p>ç»Ÿè®¡ complete tree èŠ‚ç‚¹æ•°é‡</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>é¦–å…ˆè¯´è¯´æˆ‘çš„åšæ³•, æˆ‘é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨æ ˆæ¥ä¿å­˜å…¶æ•°æ®ç»“æ„, è·Ÿè¸ªè·¯å¾„, ä»å³è‡³å·¦, ç›´åˆ°æ‰¾åˆ°ä¸€æ¡èƒ½åˆ°è¾¾åº•å±‚çš„è·¯</p>
<p>first.  my idea  is use stack to save the data structure, trace the route, from right to left, until find a way to bottom node</p>
<p>(å‰äº›å¤©è¢«ä¸€ä¸ª 13 è¯´æˆ‘ leetcode ä»ä¸å†™æ³¨é‡Š, æˆ‘æ€¨å¿µåˆ°äº†ç°åœ¨ = =)</p>
<p>(I was told by a 13 the other day that i never write comments in leetcode. I remember it till now :(  )</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countNodes</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;pair&lt;TreeNode*, <span class="keyword">bool</span>&gt;&gt; nodes;</span><br><span class="line">        </span><br><span class="line">        TreeNode* <span class="built_in">cursor</span> = root;</span><br><span class="line">        <span class="keyword">int</span> ldeep = <span class="number">0</span>, rdeep = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">cursor</span>) &#123;</span><br><span class="line">            <span class="built_in">cursor</span> = <span class="built_in">cursor</span>-&gt;left;</span><br><span class="line">            ++ldeep;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cursor</span> = root;</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">cursor</span>) &#123;</span><br><span class="line">            <span class="comment">// 1 means next is a right node</span></span><br><span class="line">            nodes.push(make_pair(<span class="built_in">cursor</span>, <span class="number">1</span>));</span><br><span class="line">            <span class="built_in">cursor</span> = <span class="built_in">cursor</span>-&gt;right;</span><br><span class="line">            ++rdeep;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ret = (<span class="number">1</span> &lt;&lt; ldeep) - <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// is a full binary tree</span></span><br><span class="line">        <span class="keyword">if</span> (ldeep == rdeep) </span><br><span class="line">            <span class="keyword">return</span> ret;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> (!nodes.empty()) &#123;</span><br><span class="line">            <span class="built_in">cursor</span> = nodes.top().first;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">cursor</span>-&gt;right) --ret;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="built_in">cursor</span>-&gt;left) --ret;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">cursor</span>-&gt;left || <span class="built_in">cursor</span>-&gt;right)</span><br><span class="line">                <span class="keyword">return</span> ret;</span><br><span class="line">            </span><br><span class="line">            nodes.pop();</span><br><span class="line">            --rdeep;</span><br><span class="line">            <span class="comment">// current node is right node, so next node is left node</span></span><br><span class="line">            <span class="keyword">if</span> (!nodes.empty() &amp;&amp; nodes.top().second) &#123;</span><br><span class="line">                nodes.top().second = <span class="number">0</span>;</span><br><span class="line">                nodes.push(make_pair(nodes.top().first-&gt;left, <span class="number">1</span>));</span><br><span class="line">                ++rdeep;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// find next node with next node is right node</span></span><br><span class="line">            <span class="keyword">while</span> (!nodes.empty() &amp;&amp; !nodes.top().second) &#123;</span><br><span class="line">                nodes.pop();</span><br><span class="line">                --rdeep;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// means some errors occur</span></span><br><span class="line">            <span class="keyword">if</span> (nodes.empty()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">            nodes.top().second = <span class="number">0</span>;</span><br><span class="line">            <span class="built_in">cursor</span> = nodes.top().first-&gt;left;</span><br><span class="line">            <span class="keyword">while</span> (<span class="built_in">cursor</span>) &#123;</span><br><span class="line">                nodes.push(make_pair(<span class="built_in">cursor</span>, <span class="number">1</span>));</span><br><span class="line">                <span class="built_in">cursor</span> = <span class="built_in">cursor</span>-&gt;right;</span><br><span class="line">                ++rdeep;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// get the bottom element</span></span><br><span class="line">            <span class="keyword">if</span> (ldeep == rdeep) <span class="keyword">return</span> ret;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// means some errors occur</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æœ€ä¸ç†æƒ³çš„æƒ…å†µä¸‹, æœ€å·¦è¾¹åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹, ä¼šéå†æ‰æ‰€æœ‰èŠ‚ç‚¹ = =. stack å®¹é‡åº”è¯¥ä¸ä¼šè¶…è¿‡ 31 ä¸ªå…ƒç´ . </p>
<p>ä»£ç ä¸å¤Ÿæ•´æ´, ä¸å¤Ÿæ˜“æ‡‚. å‹‰å¼ºç®—ä¸ªè§£æ³•.</p>
<p><img src="https://imgur.com/ST4TQfP.png" alt=""></p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">is_high</span> <span class="params">(TreeNode* root, <span class="keyword">int</span> path, <span class="keyword">int</span> high)</span> </span>&#123;</span><br><span class="line">    high--;</span><br><span class="line">    <span class="keyword">while</span> (high &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">bool</span> flag = path &amp; (<span class="number">1</span> &lt;&lt; high);</span><br><span class="line">        <span class="keyword">if</span> (flag &amp;&amp; root-&gt;right) &#123;</span><br><span class="line">            root = root-&gt;right;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!flag &amp;&amp; root-&gt;left) &#123;</span><br><span class="line">            root = root-&gt;left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        high--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">countNodes</span> <span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> high = <span class="number">0</span>;</span><br><span class="line">        TreeNode* node = root-&gt;left;</span><br><span class="line">        <span class="keyword">while</span> (node) &#123;</span><br><span class="line">            high++;</span><br><span class="line">            node = node-&gt;left;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> first = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> last = <span class="number">1</span> &lt;&lt; high;</span><br><span class="line">        <span class="keyword">while</span> (first &lt; last) &#123;</span><br><span class="line">            <span class="keyword">int</span> mid = (first + last) / <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (is_high(root, mid, high)) &#123;</span><br><span class="line">                first = mid + <span class="number">1</span>;        </span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                last = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="number">1</span> &lt;&lt; high) - <span class="number">1</span> + last;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æœ€åçš„ return é‡Œé¢, ç”¨ first å’Œ last éƒ½å¯ä»¥, æˆ‘è§‰å¾— last è¯­ä¹‰å¯èƒ½æ›´å¥½, æ‰€ä»¥æ¢æˆäº† last.</p>
<p>on the end of return, use both first and last. i think â€˜lastâ€™ more make sence, so i use â€˜lastâ€™</p>
<p>ä»–çš„è®¡ç®—æ˜¯ full tree èŠ‚ç‚¹æ•° + åº•å±‚èŠ‚ç‚¹æ•°. ä»è¿™ä¸ªç®—æ³•ä¸­æˆ‘å­¦åˆ°äº†ä¸€äº›ä¸œè¥¿, äºŒè¿›åˆ¶å’Œ binary tree, çœŸçš„æœ‰å¾ˆå¤§å¯æ“ä½œç©ºé—´.</p>
<p>the algorithm is a number of full tree nodes plus bottom nodes. I study something from the algorithm. itâ€™s a lot of skill can use between binary system and binary tree.</p>
<p>åœ¨åˆ†æç®—æ³•å‰, æˆ‘å…ˆæ€»ç»“ä¸€ä¸‹æˆ‘ä»è¿™ä¸ªç®—æ³•ä¸­çœ‹åˆ°çš„è§„å¾‹. </p>
<p>before profiling this algorithm, summarize  some rules of complete tree that I saw in this algorithm</p>
<p>é¦–å…ˆ, å°†æ ‘èŠ‚ç‚¹æ’åº, root ä¸º 1, ä»å·¦åˆ°å³, ä»ä¸Šåˆ°ä¸‹,  ä¾æ¬¡é€’è¿›. å¾—åˆ°ç±»ä¼¼çš„å›¾ : </p>
<p>first, sort tree nodes. root is number 1, from left to right, up to down, get this map:</p>
<pre><code>                            1
            2                                3
    4                5                6                7
8(1)    9(2)    10(3)    11(4)    12(5)    13(6)    14(7)    15(8)</code></pre><p>å‡è®¾ä¸€ä¸ªæ•°, 5, å…¶äºŒè¿›åˆ¶ä¸º 101, å·²çŸ¥æ˜¯ binary tree, æ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹çš„ 2 å€å°±æ˜¯å½“å‰æ•°å­—å³ç§» 1 ä½, å³å°¾ç½® 0. æ‰€ä»¥ 0 ä»£è¡¨å‘å·¦ä¸‹å‰è¿›, 1 åˆ™ä»£è¡¨å‘å³ä¸‹å‰è¿›. åˆ†ä¸ºä¸¤ç§æƒ…å†µ.</p>
<p>assume a number, for example 5, itâ€™s binary expression is 101.</p>
<ol>
<li><p>å°†é¦–ä½çœ‹åšæ— æ•ˆä½, åˆ™ 101 = 01, ä»£è¡¨ä»æ ¹å‘å·¦-&gt;å‘å³, åˆ™å¾—åˆ°äº†æ•°å­— 5.</p>
<p>treat the first digit as an invalid bit. 101 means left -&gt; right. get the number 5.</p>
</li>
<li><p>å°†é¦–ä½çœ‹åšæœ‰æ•ˆä½, åˆ™ 101 = 101, ä»£è¡¨ä»æ ¹å‘å³-&gt;å‘å·¦-&gt;å‘å³, å¾—åˆ°æ•°å­— 13, è€Œè¿™ä¸ªæ•°å­—, åˆšå¥½æ˜¯åº•éƒ¨ä»å·¦å¾€å³çš„ç¬¬ 5 ä¸ªæ•°å­— + 1 = ç¬¬ 6 ä¸ªæ•°å­—. </p>
<p>treat the first digit as an valid bit. 101 means right -&gt; left -&gt; right. get the number 13. the number sorted by bottom level is the the original number plus one. </p>
<p>(ä¸ºä»€ä¹ˆå‘¢? ä¸ºä»€ä¹ˆåˆšå¥½æ˜¯ + 1? å› ä¸ºæ’å®šçš„, å› ä¸ºè¿™æ˜¯ complete tree, æ¯ä¸€å±‚åˆ°ä¸‹ä¸€å±‚çš„ç›¸å¯¹åº”é‚£ä¸ªæ•°çš„æ­¥æ•°éƒ½æ˜¯æ’å®šçš„. éƒ½æ˜¯ (2 &lt;&lt; n) - 1, è€Œ + 1 å°±åˆšå¥½æ˜¯ 2 &lt;&lt; n, è¿™å’Œåˆšæ‰å°†é¦–ä½çœ‹åšæœ‰æ•ˆä½å¯¹åº”ä¸Šäº†, å…¶å®å°†é¦–ä½çœ‹åšæœ‰æ•ˆä½ä¹Ÿå°±æ˜¯å¢åŠ äº† 2 &lt;&lt; n è€Œå·².)</p>
</li>
</ol>
<p>å°†ä¸€äº›è§„å¾‹æ€»ç»“å, å°±å˜ç®€å•äº†è®¸å¤š</p>
<p>after summarize some rules, things more simple. </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">while</span> (first &lt; last) &#123;</span><br><span class="line">    <span class="keyword">int</span> mid = (first + last) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (is_high(root, mid, high)) &#123;</span><br><span class="line">        first = mid + <span class="number">1</span>;        </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        last = mid;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™æ®µä»£ç å°±æ˜¯åœ¨é¦–ä½é—´ä¸æ–­é€¼è¿‘, æ±‚å¾—çš„æœ€å¤§çš„æ•°å­—, ä¹Ÿå°±æ˜¯æœ€åä¸€æ’. </p>
<p>this code just get more close between â€˜firstâ€™ and â€˜lastâ€™. get biggest number, also is the result.</p>
<p>is_high(root, mid, high) å®åˆ™æ˜¯åœ¨åˆ¤æ–­, æœ€åä¸€æ’æœ‰æ²¡æœ‰ mid + 1 è¿™ä¸ªæ•°å­—, å¦‚æœæœ‰, åˆ™ first = mid + 1, æ„å‘³ç€è¿™ä¸ªæ•°å­—æ˜¯å­˜åœ¨çš„, ç»§ç»­ä¸æ–­é€¼è¿‘. ç›´åˆ°æœ€å last == first, å› ä¸º first = mid + 1, è€Œ mid = (first + last) / 2, æ‰€ä»¥ first æœ€å¤§ä¸ä¼šè¶…è¿‡ last. </p>
<p>â€˜is_higtâ€™ judge is there a number â€˜mid + 1â€™. if is, then â€˜first = mid + 1â€™. means this number is exist.</p>
<p>æ‰€ä»¥è¿™ä¸ªè§£æ³•æ˜¯åˆ©ç”¨äº† complete tree çš„ç‰¹æ€§. ç›¸å½“ç®€æ´, ä¹Ÿæ²¡æœ‰ä½¿ç”¨é¢å¤–çš„ç©ºé—´, æ—¶é—´å¤æ‚åº¦æ˜¯ O(logn), å¾ˆä¸é”™çš„è§£æ³•.</p>
<p>Iâ€™m tiredâ€¦ :(     </p>
<p>thanks for browsing :)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/230KthSmallestElementInaBST</title>
    <url>/2020/01/09/leetcode/230KthSmallestElementInaBST/</url>
    <content><![CDATA[<h2 id="Kth-Smallest-Element-In-a-BST"><a href="#Kth-Smallest-Element-In-a-BST" class="headerlink" title="Kth Smallest Element In a BST"></a>Kth Smallest Element In a BST</h2><p><img src="https://imgur.com/bstQOJh.png" alt=""></p>
<p>æ‰¾åˆ°äºŒå‰æ ‘ä¸­, ç¬¬ n ä¸ªæœ€å°çš„èŠ‚ç‚¹</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>å¯ä»¥ä¸€æ­¥ä¸€æ­¥æ‰¾å®ƒçš„æœ€å°èŠ‚ç‚¹, è¿½è¸ªçš„é—®é¢˜, å¯ä»¥äº¤ç»™ stack</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">kthSmallest</span><span class="params">(root *TreeNode, k <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// if root == nil &#123;</span></span><br><span class="line">    <span class="comment">//     return 0</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    stack := []*TreeNode&#123;root&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> root.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">        stack = <span class="built_in">append</span>(stack, root.Left)</span><br><span class="line">        root = root.Left</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    pos := <span class="built_in">len</span>(stack) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> foot := <span class="number">1</span>; foot != k; foot++ &#123;</span><br><span class="line">        <span class="comment">// if cur.Right != nil then next is cur.Right.Left(bottom)</span></span><br><span class="line">        <span class="keyword">if</span> stack[pos].Right != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="comment">// i really need stack...</span></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(stack) &gt; pos + <span class="number">1</span> &#123;</span><br><span class="line">                stack[pos + <span class="number">1</span>] = stack[pos].Right</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                stack = <span class="built_in">append</span>(stack, stack[pos].Right)</span><br><span class="line">            &#125;</span><br><span class="line">            pos++</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> stack[pos].Left != <span class="literal">nil</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(stack) &gt; pos + <span class="number">1</span> &#123;</span><br><span class="line">                    stack[pos + <span class="number">1</span>] = stack[pos].Left</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    stack = <span class="built_in">append</span>(stack, stack[pos].Left)</span><br><span class="line">                &#125;</span><br><span class="line">                pos++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// if cur.Right == nil then next is last biger value</span></span><br><span class="line">            old := stack[pos].Val</span><br><span class="line"></span><br><span class="line">            <span class="comment">// hope BST don't have repetitive value... </span></span><br><span class="line">            <span class="keyword">for</span> stack[pos].Val &lt;= old &#123;</span><br><span class="line">                pos--</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> stack[pos].Val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥æ‰¾ä¸‹ä¸€èŠ‚ç‚¹ (next) å¯ä»¥è¿™ä¹ˆæè¿°:</p>
<p>å¦‚æœå½“å‰èŠ‚ç‚¹ (cur) æœ‰å³å­èŠ‚ç‚¹, åˆ™ next ä¸ºå³å­èŠ‚ç‚¹çš„å·¦æ ¹èŠ‚ç‚¹</p>
<p>å¦åˆ™, next ä¸ºä¸Šä¸€ä¸ªå¤§äºå½“å‰èŠ‚ç‚¹å€¼çš„èŠ‚ç‚¹</p>
<p>è¿™æ˜¯ç”¨é€’å½’æ¥å®ç°çš„, ä¸ºäº†è¿½è¸ª, ä½¿ç”¨äº† stack </p>
<p>(æˆ‘å¥½å¸Œæœ› go èƒ½æä¾›ä¸€ä¸ªæ ‡å‡†çš„ stack, è¿™æ ·ä»£ç å¯ä»¥æ›´åŠ ç®€æ´. æˆ–è®¸æ˜¯æä¾›äº†, ä½†æˆ‘ä¸çŸ¥é“?)</p>
<p><img src="https://imgur.com/2mIMNZl.png" alt=""></p>
<p>ä¸€æ¬¡æˆåŠŸ, çœŸå¥½</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">kthSmallest</span><span class="params">(root *TreeNode, k <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    res = <span class="number">0</span></span><br><span class="line">    helper(root,k,<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> res <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helper</span><span class="params">(root *TreeNode, k <span class="keyword">int</span>, i <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    cur := <span class="number">0</span> </span><br><span class="line">    <span class="keyword">if</span> root.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">        prev := helper(root.Left, k, i)</span><br><span class="line">        cur = prev + <span class="number">1</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        cur = i</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> cur == k &#123;</span><br><span class="line">        res = root.Val</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> root.Right != <span class="literal">nil</span> &amp;&amp; cur &lt; k &#123;</span><br><span class="line">        <span class="keyword">return</span> helper(root.Right, k, cur+<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cur</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>emm, ä»–ä½¿ç”¨äº†é€’å½’, ç”¨é€’å½’æ¥è¿½è¸ª, å¯ä»¥ä¸ç”¨æ˜¾å¼è¿½è¸ªæ•°æ®äº†, æŒºå¥½</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/25ZReverse_Nodes_in_k-Group</title>
    <url>/2020/01/09/leetcode/25ZReverse_Nodes_in_k-Group/</url>
    <content><![CDATA[<h3 id="25-Reverse-Nodes-in-k-Group"><a href="#25-Reverse-Nodes-in-k-Group" class="headerlink" title="25. Reverse Nodes in k-Group"></a>25. Reverse Nodes in k-Group</h3><p><img src="https://imgur.com/sancVDL.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªé“¾è¡¨, æ¯æ¬¡åè½¬é“¾è¡¨æ•°é‡ä¸ºkçš„èŠ‚ç‚¹, ç„¶åè¿”å›æ›´æ”¹åçš„é“¾è¡¨</p>
<p>kæ˜¯ä¸€ä¸ªæ­£æ•´æ•°, å°äºç­‰äºé“¾è¡¨çš„é•¿åº¦, å¦‚æœé“¾è¡¨çš„é•¿åº¦ä¸æ˜¯kçš„æ•´æ•°å€, æœ€åé—æ¼çš„èŠ‚ç‚¹ä¿æŒåŸæ ·</p>
<h3 id="my-code"><a href="#my-code" class="headerlink" title="my code"></a>my code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseKGroup</span><span class="params">(ListNode* head, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!head) <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        ListNode* ret = head;</span><br><span class="line">        <span class="keyword">while</span> (head &amp;&amp; head-&gt;next) &#123;</span><br><span class="line">            <span class="keyword">int</span> kt = k;</span><br><span class="line">            ListNode* headt = head;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec;</span><br><span class="line"></span><br><span class="line">            vec.push_back(headt-&gt;val);</span><br><span class="line">            <span class="keyword">while</span> (--kt &amp;&amp; head-&gt;next) &#123;</span><br><span class="line">                head = head-&gt;next;</span><br><span class="line">                vec.push_back(head-&gt;val);</span><br><span class="line">            &#125;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (kt) <span class="keyword">break</span>;</span><br><span class="line">            reverse(headt, vec);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(ListNode* head, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; vec)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::reverse_iterator it = vec.rbegin(); it != vec.rend(); ++it) &#123;</span><br><span class="line">            head-&gt;val = *it;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™é“é¢˜çš„æ€è·¯å¾ˆæ¸…æ™°, æ„Ÿè§‰ä¸åº”è¯¥æ˜¯hardéš¾åº¦çš„é¢˜  </p>
<p>ç®€å•åœ°å°†é“¾è¡¨æ¯ä¸€éƒ¨åˆ†åˆ†å¼€, ç„¶åè°ƒç”¨ååºå‡½æ•°å°±å¯ä»¥äº†</p>
<p>å¯ä»¥ä¼˜åŒ–çš„ç‚¹æ˜¯ while é‚£é‡Œ, ä»¥åŠæˆ‘å¯ä»¥ä¸ç”¨åœ¨ while ä¸­åˆ¤æ–­, reverse åº”è¯¥èƒ½å¤Ÿæ­£å¸¸å¤„ç†å…ƒç´ æ•°é‡ä¸åŒçš„æƒ…å†µ  </p>
<p>é‚£ä¹ˆæˆ‘åœ¨æœ€ååšä¸€æ¬¡åˆ¤æ–­, å°†æœ€åä¸€æ¬¡ä¸ç”¨ä¿®æ”¹çš„è¿˜åŸå°±å¯ä»¥äº†, è¿™æ ·å¯ä»¥çœå» while ä¸­çš„åˆ¤æ–­é€»è¾‘</p>
<p><img src="https://imgur.com/8QPzS1D.png" alt=""></p>
<p>é€Ÿåº¦ä¸Šæ¥è¯´è¿˜ç®—ä¸é”™, ä½†æ˜¯èµ„æºä½¿ç”¨ç‡ä¸Šå°±å¾ˆå ªå¿§äº†</p>
<h3 id="dalaoâ€™s-code"><a href="#dalaoâ€™s-code" class="headerlink" title="dalaoâ€™s code"></a>dalaoâ€™s code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverse</span><span class="params">(ListNode* first, ListNode* last)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ListNode* prev = last;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( first != last )</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">auto</span> tmp = first-&gt;next;</span><br><span class="line">            first-&gt;next = prev;</span><br><span class="line">            prev = first;</span><br><span class="line">            first = tmp;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseKGroup</span><span class="params">(ListNode* head, <span class="keyword">int</span> k)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> node=head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i &lt; k; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> ( ! node  )</span><br><span class="line">                <span class="keyword">return</span> head; <span class="comment">// nothing to do list too sort</span></span><br><span class="line">            node = node-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">auto</span> new_head = reverse( head, node);</span><br><span class="line">        head-&gt;next = reverseKGroup( node, k);</span><br><span class="line">        <span class="keyword">return</span> new_head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªåšæ³•å’Œæˆ‘çš„æƒ³æ³•åŸºæœ¬ç›¸åŒ, ä½†æ˜¯åœ¨ç»†èŠ‚ä¸Šçš„å¤„ç†å¾ˆå¥½</p>
<p>é¦–å…ˆ, ä»–é‡‡ç”¨çš„é€’å½’, è¿™æ ·ä»£ç æ›´åŠ ç®€æ´æ˜“æ‡‚</p>
<p>å…¶æ¬¡å¾ªç¯ä¸­æ˜¯æ›´æ”¹é“¾è¡¨çš„æŒ‡å‘, è€Œä¸æ˜¯èµ‹å€¼, è¿™æ ·åŠŸèƒ½æ€§æ›´å¼º</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/300LongestIncreasingSubsequence</title>
    <url>/2020/01/09/leetcode/300LongestIncreasingSubsequence/</url>
    <content><![CDATA[<h2 id="300-Longest-Increasing-Subsequence"><a href="#300-Longest-Increasing-Subsequence" class="headerlink" title="300 Longest Increasing Subsequence"></a>300 Longest Increasing Subsequence</h2><p><img src="https://imgur.com/Pn1zsFZ.png" alt=""></p>
<p>æ‰¾å‡ºæ•°ç»„ä¸­æœ€å¤§çš„å¢é•¿æ•°é‡</p>
<h3 id="my-solution-8ms-66-89"><a href="#my-solution-8ms-66-89" class="headerlink" title="my solution (8ms, 66.89%)"></a>my solution (8ms, 66.89%)</h3><p>emmâ€¦ è€ƒè™‘å°†æ¯ä¸€ä¸ªä¸‹é™çš„ slice è§†ä¸ºä¸€ä¸ªæ•°ç»„, å› ä¸ºè¿™äº›æ•°ç»„åªå¯èƒ½äº§ç”Ÿä¸€ä¸ªå€¼  </p>
<p>è€Œå†å°†è¿™äº› slice å¾ªç¯, æ¯æ¬¡ä»å½“å‰èŠ‚ç‚¹é€‰æ‹©æœ€å°çš„æ•°å­—, æ¯æ¬¡å‰è¿›æ—¶é€‰æ‹©ä¸€ä¸ªæœ€å°çš„æ¯”ä¸Šä¸€ä¸ªèŠ‚ç‚¹å¤§çš„æ•°å­—  </p>
<p>ç„¶åè®¡æ•°, ä¸€æ¬¡éå†ä¸‹æ¥å°±å¾—åˆ°äº†æœ€å¤§å¢é•¿åºåˆ—çš„é•¿åº¦</p>
<p>å¤æ‚åº¦æ˜¯ä¸€æ¬¡ O(n) çš„éå†  + åˆ‡ç‰‡ä¹‹åæ•°ç»„é•¿åº¦çš„éå†, æ¥è¿‘ O(n2)</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lengthOfLIS</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    stairs := [][]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    temp := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    prev := <span class="number">0x7fffffff</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">if</span> v &lt; prev &#123;</span><br><span class="line">            temp = <span class="built_in">append</span>(temp, v)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            sort.Ints(temp)</span><br><span class="line">            stairs = <span class="built_in">append</span>(stairs, temp)</span><br><span class="line">            temp = []<span class="keyword">int</span>&#123;v&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        prev = v</span><br><span class="line">    &#125;</span><br><span class="line">    sort.Ints(temp)</span><br><span class="line">    stairs = <span class="built_in">append</span>(stairs, temp)</span><br><span class="line"></span><br><span class="line">    size := <span class="built_in">len</span>(stairs)</span><br><span class="line">    count, ret := <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; size; i++ &#123;</span><br><span class="line">        prev = stairs[i][<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i2 := i + <span class="number">1</span>; i2 &lt; size; i2++ &#123;</span><br><span class="line">            ind, size2 := <span class="number">0</span>, <span class="built_in">len</span>(stairs[i2])</span><br><span class="line">            <span class="keyword">for</span> ind &lt; size2 &amp;&amp; stairs[i2][ind] &lt;= prev &#123;</span><br><span class="line">                ind++</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ind &gt;= size2 || stairs[i2][ind] &lt;= prev &#123;</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            &#125;</span><br><span class="line">            count++</span><br><span class="line">            prev = stairs[i2][ind]</span><br><span class="line">        &#125;</span><br><span class="line">        ret = max(ret, count)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ret &gt;= size - i &#123;</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        &#125;</span><br><span class="line">        count = <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>emmâ€¦ ä»£ç æœ‰ç‚¹é•¿</p>
<p><img src="https://imgur.com/AqBweht.png" alt=""></p>
<p>8ms é‚£ä¸ªæ˜¯æˆ‘åšçš„, 0 ä¸æ˜¯</p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">binsearch</span><span class="params">(stack []<span class="keyword">int</span>, x <span class="keyword">int</span>)</span> <span class="params">(r <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    l, r := <span class="number">0</span>, <span class="built_in">len</span>(stack)</span><br><span class="line">    <span class="keyword">for</span> l &lt; r &#123;</span><br><span class="line">        m := l + (r - l) / <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> stack[m] &gt;= x &#123;</span><br><span class="line">            r = m</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            l = m + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lengthOfLIS</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="params">(r <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    stack := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        r := binsearch(stack, num)</span><br><span class="line">        <span class="keyword">if</span> r &lt; <span class="number">0</span> &#123;</span><br><span class="line">            stack[<span class="number">0</span>] = num</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> r == <span class="built_in">len</span>(stack) &#123;</span><br><span class="line">            stack = <span class="built_in">append</span>(stack, num)</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            stack[r] = num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">len</span>(stack)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´å°±æ˜¯é€šè¿‡ä¸æ–­å°†æ•°ç»„æŒ‰ç…§å‡åºæ·»åŠ åˆ° slice é‡Œé¢  (æˆ‘å°†å…¶ç§°ä½œ slice, å› ä¸ºå®ƒçš„è¡Œä¸ºä¸å¤ªåƒ stack)</p>
<p>slice çš„å…ƒç´ åªæœ‰ä¸¤ç§æƒ…å†µä¼šå˜æ›´:  </p>
<p>è¦ä¹ˆæœ‰æ›´å°çš„å…ƒç´ è¦†ç›–, è¦ä¹ˆæ¯” slice ä¸­æ‰€æœ‰å…ƒç´ éƒ½å¤§, ç„¶å append</p>
<p>å› ä¸ºé¢˜ç›®è¦æ±‚çš„åªè¦é•¿åº¦, æ‰€ä»¥å³ä½¿ slice é‡Œé¢å…ƒç´ å¯èƒ½æ˜¯é”™è¯¯çš„, ä¹Ÿæ²¡å…³ç³», é•¿åº¦æ˜¯å¯¹çš„</p>
<p>è¿™æ ·çš„å¤æ‚åº¦æ˜¯ O(n), å…¶å®åŸç†è¿˜æ˜¯æŒºå®¹æ˜“ç†è§£çš„, ä¸ºä»€ä¹ˆæˆ‘å°±æ²¡æƒ³åˆ°å‘¢ = =</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/31ZNextPermutation</title>
    <url>/2020/01/09/leetcode/31ZNextPermutation/</url>
    <content><![CDATA[<h3 id="31-Next-Permutation"><a href="#31-Next-Permutation" class="headerlink" title="31 Next Permutation"></a>31 Next Permutation</h3><p><img src="https://imgur.com/bSdV2cb.png" alt=""></p>
<p>ç®€å•æ¥è¯´å°±æ˜¯æ‰¾ä¸‹ä¸€ä¸ªæ¯”å½“å‰æ•°å­—æ›´å¤§çš„æ•°, å¦‚æœæ²¡æœ‰, å°±é‡æ–°æ’åº</p>
<h3 id="my-code"><a href="#my-code" class="headerlink" title="my code"></a>my code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">nextPermutation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">size</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">int</span> i2 = nums[i - <span class="number">1</span>];</span><br><span class="line">                <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it = nums.<span class="built_in">end</span>();</span><br><span class="line">                <span class="keyword">while</span> ( ++i2 &lt; <span class="built_in">size</span> ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( ( it = <span class="built_in">find</span>(nums.<span class="built_in">begin</span>() + i + <span class="number">1</span>, nums.<span class="built_in">end</span>(), i2) ) != nums.<span class="built_in">end</span>() )</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ( it != nums.<span class="built_in">end</span>() ) &#123;</span><br><span class="line">                    *it ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                    nums[i - <span class="number">1</span>] ^= *it;</span><br><span class="line">                    *it ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nums[i] ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                    nums[i - <span class="number">1</span>] ^= nums[i];</span><br><span class="line">                    nums[i] ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                sort(nums.<span class="built_in">begin</span>() + i, nums.<span class="built_in">end</span>());</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> sort(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æ€è·¯å¾ˆç®€å•, ä»å³åˆ°å·¦æ‰¾åˆ°ç¬¬ä¸€ä¸ªâ€ä¸å’Œè°â€çš„ç‚¹B (è¯¥ç‚¹æ•°å­—æ¯”å‰é¢çš„æ•°å­—Aå¤§)  </p>
<p>ç„¶åæ‹¿A, ä»è¿™ä¸ªä¸å’Œè°çš„ç‚¹Bå¾€å³æ‰¾ä¸‹ä¸€ä¸ªæ¯”Aå¤§çš„æ•°, äº¤æ¢  </p>
<p>ä¹‹åé‡æ’åºBå³è¾¹çš„æ•°å­—(åŒ…æ‹¬B)</p>
<p><img src="https://imgur.com/rdDSHLJ.png" alt=""></p>
<p>emmmmâ€¦ ç»“æœä¸å¤ªå¥½å‘¢â€¦ </p>
<h3 id="dalaoâ€™s-code"><a href="#dalaoâ€™s-code" class="headerlink" title="dalaoâ€™s code"></a>dalaoâ€™s code</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="comment">// å¾ˆ 6 å•Š, è¿™é‡Œå®é™…æ˜¯ä¸€ä¸ªå€¼, å…¨å±€çš„ static å˜é‡, ä»–çš„æ‰§è¡Œä¼šåœ¨ main ä¹‹å‰ </span></span><br><span class="line"><span class="comment">// ä¼šæ±‚å€¼ lambda è¡¨è¾¾å¼ä¸­çš„å†…å®¹, è€Œå€¼å¹¶ä¸æ˜¯ä¸»è¦çš„ç›®çš„, ç”šè‡³ä¸æ˜¯ç›®çš„  </span></span><br><span class="line"><span class="comment">// ä»–æ˜¯æƒ³è°ƒç”¨å…¶ä¸­çš„åŠ é€Ÿæµæ“ä½œçš„å‡½æ•°, æ‰€ä»¥lambdaæœ€åæœ‰ä¸ª()è¿ç®—ç¬¦, æœç„¶æˆ‘æ˜¯æ¡å’¸é±¼...</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">nextPermutation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        next_permutation(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>()); <span class="comment">// emm. è¿™æ˜¯æ ‡å‡†åº“å‡½æ•°...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é‡Œé¢æœ‰ä¸€äº›æˆ‘çœ‹ä¸æ‡‚çš„ä¸œè¥¿, æ¶‰åŠåˆ° c++ çš„æµ</p>
<pre><code>ios::sync_with_stdio(false);    // æ˜¯å¦å…¼å®¹printf
cin.tie(nullptr);        // åœ¨æ¯ä¸€æ¬¡è¾“å…¥ä¹‹å‰, ä¸è¦è®©ä»–è°ƒç”¨ cout çš„ flushing</code></pre><p>ç½‘ä¸ŠæŸ¥äº†ä¸€ä¸‹, åŠ é€Ÿæµçš„è¾“å…¥è¾“å‡ºâ€¦</p>
<p><a href="http://www.hankcs.com/program/cpp/cin-tie-with-sync_with_stdio-acceleration-input-and-output.html" target="_blank" rel="noopener">http://www.hankcs.com/program/cpp/cin-tie-with-sync_with_stdio-acceleration-input-and-output.html</a></p>
<p><a href="https://www.geeksforgeeks.org/fast-io-for-competitive-programming/" target="_blank" rel="noopener">https://www.geeksforgeeks.org/fast-io-for-competitive-programming/</a></p>
<p>dalao å°±æ˜¯ dalaoâ€¦ </p>
<p>æˆ‘æ˜¯æ€ä¹ˆåœ¨ä¸çŸ¥é“è¿™ä¸€å¯¹å‡½æ•°çš„æƒ…å†µä¸‹æ´»åˆ°ä»Šå¤©çš„<img src="http://img.baidu.com/hi/jx2/j_0012.gif" alt="img"></p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/334IncreasingTripletSubsequence</title>
    <url>/2020/01/09/leetcode/334IncreasingTripletSubsequence/</url>
    <content><![CDATA[<h2 id="334-Increasing-Triplet-Subsequence"><a href="#334-Increasing-Triplet-Subsequence" class="headerlink" title="334 Increasing Triplet Subsequence"></a>334 Increasing Triplet Subsequence</h2><p><img src="https://imgur.com/InKKTPj.png" alt=""></p>
<p>æ‰¾å‡ºæ•°ç»„ä¸­æ˜¯å¦å­˜åœ¨nä¸ªè¿ç»­å¢é•¿æ•°åˆ—</p>
<h3 id="my-solution-0ms-100"><a href="#my-solution-0ms-100" class="headerlink" title="my solution (0ms, 100%)"></a>my solution (0ms, 100%)</h3><p>è¿™é“é¢˜çš„è§£æ³•æ¥è‡ªäºåœ¨åšå®Œå¦ä¸€é“é¢˜å, è§‚å¯Ÿæœ€ä½³ç®—æ³•æ—¶è·å¾—çš„æŠ€å·§</p>
<p>ç®€å•æ¥è¯´, è¿™å¯ä»¥ç”¨ä¸€ä¸ªå¯è¦†å†™çš„æ•°ç»„æ¥å®ç°</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increasingTriplet</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    vec := []<span class="keyword">int</span>&#123;<span class="number">1</span> &lt;&lt; <span class="number">63</span> - <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, v := <span class="keyword">range</span> nums &#123;</span><br><span class="line">        <span class="keyword">if</span> v &gt; vec[<span class="built_in">len</span>(vec) - <span class="number">1</span>] &#123;</span><br><span class="line">            vec = <span class="built_in">append</span>(vec, v)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(vec) &gt; <span class="number">2</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i, v2 := <span class="keyword">range</span> vec &#123;</span><br><span class="line">            <span class="keyword">if</span> v &lt;= v2 &#123;</span><br><span class="line">                vec[i] = v</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å› ä¸ºç­”æ¡ˆä»…ä»…éœ€è¦ä¸€ä¸ª bool å€¼, æ‰€ä»¥å¯ä»¥è¿™ä¹ˆåš  </p>
<p>ä¸è¿‡, æœ‰æ—¶å€™, vec çš„å€¼ä¼šæ˜¯é”™è¯¯çš„, åŒæ—¶è¿™ä¸ªè§£å¯ä»¥ç”¨äº n ä¸ªæ•°å­—, ä¹Ÿå¯ç”¨äºé€’å‡æ•°ç»„</p>
<p>(åŒæ—¶, å¦‚æœæˆ‘åœ¨è®¨è®ºä¸­, æ²¡æœ‰çœ‹åˆ°ç›¸åº”è¯­è¨€å®Œå…¨æ¯”æˆ‘å¥½çš„è§£æ³•, æˆ‘ä¼šå¼€å§‹åˆ†äº«è‡ªå·±çš„è§£æ³•)</p>
<p>(<a href="https://leetcode.com/problems/increasing-triplet-subsequence/discuss/298228/go-simple-solution-O(n)-100" target="_blank" rel="noopener">https://leetcode.com/problems/increasing-triplet-subsequence/discuss/298228/go-simple-solution-O(n)-100</a>)</p>
<p><img src="https://imgur.com/jg6NqJV.png" alt=""></p>
<p>å¼€å§‹æ²¡æƒ³åˆ°, å°è¯•äº†å‡ æ¬¡ä¹‹åæƒ³åˆ°çš„</p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">increasingTriplet</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    min1,min2:= <span class="number">2</span>&lt;&lt;<span class="number">32</span><span class="number">-1</span>,<span class="number">2</span>&lt;&lt;<span class="number">32</span><span class="number">-1</span></span><br><span class="line">    <span class="keyword">for</span> _,v:=<span class="keyword">range</span> nums&#123;</span><br><span class="line">        <span class="keyword">if</span> v&lt;=min1&#123;</span><br><span class="line">            min1=v</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> v&lt;=min2&#123;</span><br><span class="line">            min2=v</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>EHMâ€¦ æˆ‘å¥½åƒåˆæŠŠé—®é¢˜å¤æ‚åŒ–äº†â€¦  </p>
<p>ä¸è¿‡æ²¡å…³ç³», æˆ‘çš„è§£å¯ä»¥ç”¨äº n ä¸ªåºåˆ— (æˆ‘å¦‚æ­¤å®‰æ…°è‡ªå·±)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/338CountingBits</title>
    <url>/2020/01/09/leetcode/338CountingBits/</url>
    <content><![CDATA[<h2 id="338-Counting-Bits"><a href="#338-Counting-Bits" class="headerlink" title="338 Counting Bits"></a>338 Counting Bits</h2><p><img src="https://imgur.com/319pMc1.png" alt=""></p>
<p>ä¸æƒ³è§£é‡Š</p>
<h3 id="my-solution-æ²¡è„¸è¯´â€¦"><a href="#my-solution-æ²¡è„¸è¯´â€¦" class="headerlink" title="my solution  (æ²¡è„¸è¯´â€¦)"></a>my solution  (æ²¡è„¸è¯´â€¦)</h3><p>è¿™æ ·çš„ä¸œè¥¿å¿…å®šæœ‰è§„å¾‹, æ‰¾å‡ºæ¥å°±å¥½äº†</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countBits</span><span class="params">(num <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    ret := []<span class="keyword">int</span>&#123;<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line">    last := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">4</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, size := <span class="number">3</span>, <span class="number">16</span>; size &lt;= num; i++ &#123;</span><br><span class="line">        beg := size - size / <span class="number">4</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> beg + <span class="number">4</span> &lt;= size &#123;</span><br><span class="line">            last = <span class="built_in">append</span>(last[:], ret[beg:]...)</span><br><span class="line">            beg = beg + (size - beg) / <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        last = <span class="built_in">append</span>(last[:], []<span class="keyword">int</span>&#123;i, i + <span class="number">1</span>, i + <span class="number">1</span>, i + <span class="number">2</span>&#125;...)</span><br><span class="line">        ret = <span class="built_in">append</span>(ret[:], last[:]...)</span><br><span class="line">        size *= <span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ret = ret[:num + <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è§„å¾‹å¦‚ä¸‹, æ¯æ¬¡çš„å¢åŠ éƒ½æ˜¯ä¸Šæ¬¡çš„ä¸€åŠçš„é€’å½’ (æˆ‘ä¸çŸ¥é“æ€ä¹ˆè§£é‡Šè¿™ç§è§„å¾‹, æ„Ÿè§‰è¯­è¨€å¾ˆè‹ç™½â€¦)</p>
<pre><code>0,1,1,2,
1,2,2,3,
1,2,2,3, 2,3,3,4,
1,2,2,3, 2,3,3,4, 2,3,3,4, 3,4,4,5,
1,2,2,3, 2,3,3,4, 2,3,3,4, 3,4,4,5, 2,3,3,4, 3,4,4,5, 3,4,4,5, 2,3,3,4, 3,4,4,5, 4,5,5,6</code></pre><p>ä»”ç»†è§‚å¯Ÿä¸€ä¸‹å°±å‘ç°äº†</p>
<p>æˆ‘æœ¬æ¥ä»¥ä¸ºæˆ‘çš„è§£æ³•å¾ˆä¸é”™, è®¡ç®—æ¬¡æ•°å¾ˆå°‘, å‡ ä¹æ²¡æœ‰, å¤§éƒ¨åˆ†çš„è¿ç®—éƒ½æ˜¯ append, åº”è¯¥ä¼šå¾ˆå¿«, ç„¶è€Œâ€¦</p>
<p><img src="https://imgur.com/DpNioZ0.png" alt=""></p>
<p>é‚£ä¸ªå‡ åæ¯«ç§’çš„ä¸æ˜¯æˆ‘çš„, 800/900 çš„æ‰æ˜¯ = =</p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">countBits</span><span class="params">(num <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    result := <span class="built_in">make</span>([]<span class="keyword">int</span>, num+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">1</span>; i &lt;= num; i++ &#123;</span><br><span class="line">        result[i] = result[i &amp; (i<span class="number">-1</span>)] + <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»–æ˜¯é€šè¿‡è®¡ç®—å‡ºæ¥çš„, æ¯”æˆ‘å¥½åœ¨äº, ä»–ä¸ä¼šè®¡ç®—å¤šä½™çš„, ç„¶åéœ€è¦è£å‰ª</p>
<p>(BTW è¿™ä¸ªç®—æ³•ä¸æˆ‘åŸç®—æ³•çš„é€Ÿåº¦ç›¸å·®æ— å‡ , ä½†æ˜¯ç­‰ä»·çš„ C++ ä»£ç å´åªéœ€è¦å‡ åæ¯«ç§’)</p>
<p>(åŠ ä¸Š tie å’Œ sync_with_stdio, å¯èƒ½é€Ÿåº¦èƒ½æ›´å¿«, æˆ‘ä¸ç¦é™·å…¥äº†æ²‰æ€â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/377CombinationSumIV</title>
    <url>/2020/01/09/leetcode/377CombinationSumIV/</url>
    <content><![CDATA[<h2 id="Combination-Sum-IV"><a href="#Combination-Sum-IV" class="headerlink" title="Combination Sum IV"></a>Combination Sum IV</h2><p><img src="https://imgur.com/9bn22To.png" alt=""></p>
<p>æ‰¾å‡ºæ»¡è¶³æ¡ä»¶ç»„åˆçš„æ¬¡æ•°</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>æ²¡è„¸å†™å‡ºæ¥ </p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">combinationSum4</span><span class="params">(nums []<span class="keyword">int</span>, target <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> target &lt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    dp := <span class="built_in">make</span>([]<span class="keyword">int</span>, target+<span class="number">1</span>)</span><br><span class="line">    dp[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt;= target; i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> _, num := <span class="keyword">range</span> nums &#123;</span><br><span class="line">            <span class="keyword">if</span> i-num &gt;= <span class="number">0</span> &#123;</span><br><span class="line">                dp[i] += dp[i-num]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dp[target]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code>0 1 = 1
1 1 = 1
2 1 1 = 2
3 2 1 1 = 4
4 4 2 1 = 7</code></pre><p>ä¸å¤ªå¥½æè¿°è¿™ä¸ªè§„å¾‹, æœ‰ç‚¹ç±»ä¼¼äº â€œä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·â€, ç®€å•æ¥è¯´å°±æ˜¯ä¸€ä¸ªè¿­ä»£/åŒ…å«çš„è¿‡ç¨‹</p>
<p>æ¯”è¾ƒå…³é”®çš„åœ°æ–¹åœ¨äºå¾ªç¯ä¸­çš„ if (æ„Ÿè§‰æ˜¯åºŸè¯ = = )</p>
<p>æˆ‘æƒ³è¿‡, æ˜¯å¦ä¼šå‡ºç°ä¸€ç§æƒ…å†µ, è¿™ç§æƒ…å†µé€šè¿‡äº†åˆ¤æ–­, ä½†æ˜¯å®é™…ä¸Šä¸æ­£ç¡®  </p>
<p>æ¯”å¦‚ å½“ i = 3 çš„æ—¶å€™, num = 2, é€šè¿‡äº†åˆ¤æ–­, ä½†æ˜¯æ­¤æ—¶æ²¡æœ‰ 1 é‚£ä¹ˆå°±æ— æ³•ç»„æˆ 4 </p>
<p>è¿™ç§æƒ…å†µæˆç«‹ä¹ˆ? ç­”æ¡ˆæ˜¯å¦å®šçš„, å› ä¸º 2 ä¸­çš„æ¬¡æ•°å°±åŒ…å«äº†æœ‰ 1, å¦‚æœæ²¡æœ‰ 1, 2 ä¹Ÿå°†ä¼šæ˜¯ 0 </p>
<p>å‡è®¾ P(x) ä¸º x æ‰€åŒ…å«çš„æ¬¡æ•°, ä¸Šè¿°è§£æ³•å°±æ˜¯ P(x) = P(x - 1) + â€¦ + P(1) (ç­‰å¼å³ä¾§æ¯é¡¹å‚æ•°éƒ½ä½äºnumsä¸­)</p>
<p>(æ„Ÿè§‰è¶Šæè¶Šé»‘äº† - - )  </p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/32ZLongestValidParentheses</title>
    <url>/2020/01/09/leetcode/32ZLongestValidParentheses/</url>
    <content><![CDATA[<h3 id="Longest-Valid-Parentheses"><a href="#Longest-Valid-Parentheses" class="headerlink" title="Longest Valid Parentheses"></a>Longest Valid Parentheses</h3><p><img src="https://imgur.com/ErQh0hJ.png" alt=""></p>
<p>ä¸€ä¸ªåªåŒ…å«å­—ç¬¦ â€˜(â€˜ å’Œå­—ç¬¦ â€˜)â€™ çš„å­—ç¬¦ä¸², æ‰¾åˆ°æœ€é•¿çš„æœ‰æ•ˆæ‹¬å·å±‚æ•°</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>è¿™ä¸ªé—®é¢˜çš„æ ¸å¿ƒæ˜¯å¦‚ä½•çŸ¥é“, å“ªä¸ª â€˜)â€™ å’Œå“ªä¸ª â€˜(â€˜ åŒ¹é…  </p>
<p>è¿™ç§æƒ…å†µ, å¦‚æœç”¨æ ˆæ¥è§£å†³çš„è¯ä¼šç®€å•å¾ˆå¤š</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestValidParentheses</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">size</span> = s.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vecc;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">'('</span>) &#123;</span><br><span class="line">                vecc.push_back(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;    <span class="comment">// asume is )</span></span><br><span class="line">                <span class="keyword">if</span> (vecc.<span class="built_in">size</span>() &amp;&amp; s[vecc.back()] == <span class="string">'('</span>) &#123;</span><br><span class="line">                    s[i] = <span class="string">'0'</span>;</span><br><span class="line">                    s[vecc.back()] = <span class="string">'0'</span>;</span><br><span class="line">                    vecc.pop_back();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;  <span class="comment">// asume if (vecc.back() != '(') </span></span><br><span class="line">                    vecc.<span class="built_in">clear</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> ret = <span class="number">0</span>, now = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">'0'</span>)</span><br><span class="line">                ++now;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                ret = <span class="built_in">max</span>(now, ret);</span><br><span class="line">                now = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(now, ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘å¹¶æ²¡æœ‰æƒ³åˆ°ä¸€æ¬¡å¾ªç¯å¹¶æ‰¾åˆ°æœ€å¤§é•¿åº¦çš„åŠæ³•  </p>
<p>é‡‡ç”¨çš„æ˜¯ä¸€æ¬¡å¾ªç¯å°†æ‰€æœ‰èƒ½å¤Ÿåˆå¹¶çš„æ‹¬å·å…¨éƒ¨æ›¿æ¢, å†ç”¨ä¸€æ¬¡å¾ªç¯æ¥æ‰¾åˆ°å…¶ä¸­æœ€é•¿çš„åºåˆ—  </p>
<p><img src="https://imgur.com/8VYDL2H.png" alt=""></p>
<p>æ•ˆæœæ¯”æƒ³è±¡ä¸­çš„è¦å¥½, å¯èƒ½æ˜¯å½’åŠŸäºå¿«é€ŸIO  </p>
<h3 id="the-best-solution-4ms"><a href="#the-best-solution-4ms" class="headerlink" title="the best solution (4ms)"></a>the best solution (4ms)</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">static</span> <span class="keyword">int</span> _= []()</span><br><span class="line">&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();	<span class="comment">// åœ¨ hard éš¾åº¦çš„é¢˜é‡Œé¢, è¿™ä¸ªä¸œè¥¿é¢‘ç¹å‡ºç°</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestValidParentheses</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> maxLength = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; dp(s.<span class="built_in">size</span>());</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; s.<span class="built_in">size</span>(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åªå¤„ç†å½“å‰å€¼æ˜¯ ')' çš„æƒ…å†µ</span></span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">')'</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸Šä¸€ä¸ªå€¼æ˜¯ '('</span></span><br><span class="line">                <span class="keyword">if</span> (s[i - <span class="number">1</span>] == <span class="string">'('</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœå½“å‰ä¸‹æ ‡è¶…å‡ºäº† 2, æ„å‘³ç€å¯ä»¥åŠ ä¸Šä¹‹å‰çš„å®½åº¦</span></span><br><span class="line">                    <span class="keyword">if</span> (i &gt; <span class="number">2</span>)</span><br><span class="line">                        dp[i] = dp[i - <span class="number">2</span>] + <span class="number">2</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        <span class="comment">// å¦åˆ™å®½åº¦ç›´æ¥ä¸º 2 </span></span><br><span class="line">                        dp[i] = <span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœä¸Šä¸€ä¸ªå€¼æ˜¯ ')'</span></span><br><span class="line">                <span class="keyword">else</span> <span class="comment">// s[i-1] == ')'</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// æš‚æ—¶ä¿å­˜ä¸Šä¸€ä¸ªä¸‹æ ‡æ‰€è®°å½•çš„æ­¥æ•°</span></span><br><span class="line">                    <span class="keyword">int</span> prev = dp[i - <span class="number">1</span>];</span><br><span class="line">                    <span class="comment">// å…ˆåˆ¤æ–­ä¸‹æ ‡æ˜¯å¦æœ‰æ•ˆ, s[i - prev - 1] çš„å«ä¹‰æ˜¯</span></span><br><span class="line">                    <span class="comment">// å½“å‰ä¸‹æ ‡ å‡å» ä¸Šä¸€ä¸ªä¸‹æ ‡è®°å½•çš„å®½åº¦, é‚£ä¹ˆå°±æ¥åˆ°äº†è¿™ä¸ªå®½åº¦çš„èµ·å§‹ä½ç½®</span></span><br><span class="line">                    <span class="comment">// å†å‡å» 1, å°±å¾—åˆ°äº†è¿™ä¸ªå®½åº¦çš„ä¸Šä¸€ä¸ªå­—ç¬¦, å¦‚æœæ˜¯ '(' åˆ™ä»£è¡¨å®½åº¦å¯ä»¥ç»§ç»­å¢åŠ 2</span></span><br><span class="line">                    <span class="keyword">if</span> (i - prev - <span class="number">1</span> &gt;= <span class="number">0</span> &amp;&amp; s[i - prev - <span class="number">1</span>] == <span class="string">'('</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// å®½åº¦å¢åŠ äº† 2</span></span><br><span class="line">                        dp[i] = dp[i - <span class="number">1</span>] + <span class="number">2</span>;</span><br><span class="line">                        <span class="comment">// å†åˆ¤æ–­ä¸Šä¸€ä¸ªåŒºé—´çš„ç´¢å¼•å€¼æ˜¯å¦åˆæ³•</span></span><br><span class="line">                        <span class="keyword">if</span> (i - prev - <span class="number">2</span> &gt;= <span class="number">0</span>)</span><br><span class="line">                            <span class="comment">// åˆæ³•çš„è¯å°±å†åŠ ä¸Šä¸Šä¸€ä¸ªåŒºé—´çš„å®½åº¦</span></span><br><span class="line">                            dp[i] += dp[i - prev - <span class="number">2</span>];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> n : dp)</span><br><span class="line">            maxLength = <span class="built_in">max</span>(maxLength, n);</span><br><span class="line">        <span class="keyword">return</span> maxLength;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç®—æ³•ç»™äººçš„ç¬¬ä¸€æ„Ÿè§‰æ˜¯â€è„šå°â€, å¦‚æœä¸Šä¸€ä¸ªâ€è„šå°â€æœ‰æ•ˆ, å°±åŠ ä¸Šä»–, è¿™æ ·æ…¢æ…¢å¢åŠ </p>
<p>ä»–ä¹Ÿæ˜¯ç”±ä¸¤æ¬¡å¾ªç¯ç»„æˆ, ç¬¬ä¸€ä¸ªå¾ªç¯è®¡ç®—æ¯æ¬¡çš„æ­¥æ•°, ç¬¬äºŒæ¬¡å¾ªç¯æ‰¾åˆ°æœ€å¤§å€¼</p>
<p>è§„å¾‹æ€»ç»“åœ¨ä»£ç æ³¨é‡Š, å‡è®¾å­—ç¬¦ä¸²æ˜¯ â€œ()))()))()â€, é‚£ä¹ˆä»–çš„ dp å¯èƒ½æ˜¯ 0 2 0 0 0 2 0 0 0 2 </p>
<p>â€œ())(())()()()))â€ dp å¯èƒ½æ˜¯ 0 2 0 0 0 2 4 0 6 0 8 0 [10] 0 0</p>
<p>(çœ¼ç›æœ‰ç‚¹èŠ±â€¦ ä¸è¿‡åº”è¯¥æ²¡é”™)</p>
<p>å¤§æŠµæ¥è¯´:</p>
<ol>
<li>è·³è¿‡äº† â€˜(â€˜ çš„åˆ¤æ–­, è¿™ä¼šä½¿éœ€è¦å¤„ç†çš„æƒ…å†µå°‘ 1/2</li>
<li>èµ‹å€¼å°‘äº† 1/2, ä»–ä¸å¯¹ â€˜(â€˜ çš„ç´¢å¼•è¿›è¡Œè®¡ç®—</li>
</ol>
<p>emmmâ€¦ å­¦åˆ°äº†å¾ˆå¤š  </p>
<p>æ„Ÿè§‰â€è„šå°â€è¿™ä¸ªæ¦‚å¿µåœ¨å¾ˆå¤šç®—æ³•é‡Œé¢éƒ½çœ‹åˆ°è¿‡, ä¸€ä¸ªä¸ªç´¯åŠ å°†å¤æ‚çš„è®¡ç®—åˆ†ä¸ºäº†å¾ˆå¤šçš„å°è®¡ç®—</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/45ZJumpGameII</title>
    <url>/2020/01/09/leetcode/45ZJumpGameII/</url>
    <content><![CDATA[<h3 id="45-Jump-Game-II"><a href="#45-Jump-Game-II" class="headerlink" title="45. Jump Game II"></a>45. Jump Game II</h3><p><img src="https://imgur.com/i8ucDdk.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°çš„æ•°å­—, ä½ å¼€å§‹åœ¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªç´¢å¼•å¤„</p>
<p>æ¯ä¸€ä¸ªåœ¨æ•°ç»„ä¸­çš„å…ƒç´ ä»£è¡¨ä½ èƒ½å¤Ÿè·³è·ƒçš„æœ€å¤§è·ç¦»  </p>
<p>ä½ çš„ç›®æ ‡æ˜¯æ‰¾åˆ°åˆ°è¾¾æœ€åä¸€ä¸ªç´¢å¼•çš„æœ€å°è·³è·ƒæ•°</p>
<h3 id="my-code"><a href="#my-code" class="headerlink" title="my code"></a>my code</h3><p>è¦è¾¾åˆ°æœ€å°è·³è·ƒæ•°çš„è¯, é‚£ä¹ˆåªè¦ä¿è¯æ¯æ¬¡è·³è·ƒçš„è·ç¦»æ˜¯æœ€å¤§çš„å°±å¯ä»¥äº†</p>
<p>æ¯ä¸ªèŠ‚ç‚¹çš„è·³è·ƒè·ç¦»æ˜¯ èŠ‚ç‚¹è·ç¦»èµ·å§‹èŠ‚ç‚¹çš„è·ç¦» + èŠ‚ç‚¹è‡ªèº«å€¼</p>
<p>æ„Ÿè§‰æ¯”ä¸Šä¸€ä¸ª jump ç®€å•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> &lt;= <span class="number">1</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> route = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i + nums[i] &gt;= <span class="built_in">size</span> - <span class="number">1</span>)</span><br><span class="line">                <span class="keyword">return</span> ++route;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">int</span> maxn = nums[i] + nums[i + nums[i]];</span><br><span class="line">            <span class="keyword">int</span> <span class="built_in">step</span> = nums[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i2 = i + <span class="number">1</span>; i2 &lt;= (i + nums[i]); ++i2) &#123;</span><br><span class="line">                <span class="keyword">if</span> (i2 - i + nums[i2] &gt; maxn) &#123;</span><br><span class="line">                    maxn = i2 - i + nums[i2];</span><br><span class="line">                    <span class="built_in">step</span> = i2 - i;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i += <span class="built_in">step</span>;</span><br><span class="line">            ++route;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><img src="https://imgur.com/psf3MTs.png" alt=""></p>
<p>ç»“æœè¿˜è¡Œ, çœ‹ä¸€ä¸‹æœ€å¥½çš„ç®—æ³•</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">auto</span> fast_io = []() &#123;</span><br><span class="line"><span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;();	<span class="comment">// æˆ‘å·²ç»ä¸ä¼šè§åˆ°è¿™ä¸ªä¼šè§‰å¾—å¥‡æ€ªäº†!</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jump</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> n = nums.<span class="built_in">size</span>();</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans(n, n);</span><br><span class="line">        ans[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]+i &gt;= n<span class="number">-1</span>) ans[n<span class="number">-1</span>] = <span class="built_in">min</span>(ans[n<span class="number">-1</span>], ans[i]+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">int</span> temp = nums[i];</span><br><span class="line">                <span class="keyword">while</span> (temp &gt; <span class="number">0</span> &amp;&amp; ans[i+temp] &gt; ans[i]+<span class="number">1</span>) ans[i+(temp--)] = ans[i]+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¤§è‡´æƒ³æ³•ä¸Šå¥½åƒå·®ä¸å¤š</p>
<p>çœ‹ä¸å¤ªæ‡‚, ä½†æ˜¯æˆ‘æ„Ÿè§‰å¥½åƒå·®ä¸å¤š  </p>
<p>å®ƒå¤šäº†ä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•°ç»„, å¹¶ä¸”å¾ªç¯æ˜¯çº¿æ€§ n </p>
<p>(æˆ‘æ²¡æœ‰ä½¿ç”¨æ•°ç»„, å¹¶ä¸”å¾ªç¯æ˜¯ä»¥ step ä¸ºè·ç¦», å”¯ä¸€ä¼šåœ¨é€Ÿåº¦ä¸Šå†³èƒœè´Ÿçš„åº”è¯¥æ˜¯æˆ‘for ä¸­çš„ for å’Œä»–forä¸­çš„whileå¯¹æ¯”, ä»–çš„whileå¯ä»¥æå‰é€€å‡ºçš„, ç»¼åˆæ¥è¯´, æˆ‘è§‰å¾—è¿™æ¬¡æˆ‘çš„ç®—æ³•ä¸è¾“ä»–! (æœ‰ç‚¹è†¨èƒ€ :) â€¦ ) )</p>
<p>æˆ‘å°†å‰é¢çš„ fast_io æ·»åŠ è¿›æˆ‘çš„ä»£ç å, ä¹Ÿè¾¾åˆ°äº†æœ€å¥½çš„é€Ÿåº¦</p>
<p><img src="https://imgur.com/s4fSkM2.png" alt=""></p>
<p>emmm, é‚£å°±ä¸èŠ±æ—¶é—´ç ”ç©¶ä»–çš„ç®—æ³•äº†~</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/46ZPermutations</title>
    <url>/2020/01/09/leetcode/46ZPermutations/</url>
    <content><![CDATA[<h3 id="46ZPermutations"><a href="#46ZPermutations" class="headerlink" title="46ZPermutations"></a>46ZPermutations</h3><p><img src="https://imgur.com/qKQUxju.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„é›†åˆ, è¿”å›æ‰€æœ‰çš„æ•°ç»„æ’åˆ—å¯èƒ½</p>
<h3 id="my-solution-16ms"><a href="#my-solution-16ms" class="headerlink" title="my solution (16ms)"></a>my solution (16ms)</h3><p>å¦‚æœå•çº¯æƒ³è¦åšå‡ºæ¥, å¾ˆç®€å•, é€’å½’å°±å®Œäº‹äº†</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; permute(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; v) &#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = v.<span class="built_in">size</span>(); </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">1</span>) <span class="keyword">return</span> &#123;v&#125;;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// asume size &gt;= 2;</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; temp = v;</span><br><span class="line">            temp.erase(temp.<span class="built_in">begin</span>() + i);</span><br><span class="line"></span><br><span class="line">            permute_do(&#123;v[i]&#125;, temp);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">permute_do</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; curv, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = v.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">1</span>) &#123;</span><br><span class="line">            ret.push_back(curv);</span><br><span class="line">            ret.back().push_back(v.front());</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tempV = v;</span><br><span class="line">            tempV.erase(tempV.<span class="built_in">begin</span>() + i);</span><br><span class="line">            <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; tempCurv = curv;</span><br><span class="line">            tempCurv.push_back(v[i]);</span><br><span class="line"></span><br><span class="line">            permute_do(tempCurv, tempV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å†…å­˜ä½¿ç”¨ç‡åº”è¯¥å¾ˆé«˜, å› ä¸ºæ¯ä¸€æ¬¡é€’å½’éƒ½ä¼šé‡æ–°åˆ›å»ºä¸´æ—¶å¯¹è±¡  </p>
<p>ä½†æ˜¯æƒ³ä¸åˆ°ä»€ä¹ˆå¥½çš„æ–¹å¼åœ¨ä¸å½±å“é€Ÿåº¦çš„æƒ…å†µä¸‹è§£å†³è¿™ä¸ªé—®é¢˜â€¦</p>
<p><img src="https://imgur.com/pu5YhhK.png" alt=""></p>
<p>emmm, å†…å­˜ä½¿ç”¨æœç„¶å¾ˆé«˜â€¦  </p>
<p>(è¿™ä¸ªé—®é¢˜æ˜¯å‡ ä¸ªæœˆä¹‹å‰å°è¯•è¿‡çš„, è¯•äº† 3 æ¬¡æ²¡æœ‰æˆåŠŸ, ä»Šå¤©ä¸€æ¬¡å°±æˆåŠŸäº†, </p>
<p>è€Œä¸”è§£é¢˜çš„æ—¶é—´ä¹ŸæŒºçŸ­çš„, çœ‹æ¥è¿›æ­¥è¿˜ä¸é”™)</p>
<h3 id="the-best-solution-14ms"><a href="#the-best-solution-14ms" class="headerlink" title="the best solution (14ms)"></a>the best solution (14ms)</h3><p>çœ‹ä¸€ä¸‹æœ€å¥½çš„ç®—æ³•æ˜¯æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜çš„</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; permute(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;num) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; result;</span><br><span class="line"></span><br><span class="line">        permuteRecursive(num, <span class="number">0</span>, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// permute num[begin..end]</span></span><br><span class="line">    <span class="comment">// invariant: num[0..begin-1] have been fixed/permuted</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">permuteRecursive</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;num, <span class="keyword">int</span> <span class="built_in">begin</span>, <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; &amp;result)</span>	</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">begin</span> &gt;= num.<span class="built_in">size</span>()) &#123;</span><br><span class="line">            <span class="comment">// one permutation instance</span></span><br><span class="line">            result.push_back(num);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">begin</span>; i &lt; num.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            swap(num[<span class="built_in">begin</span>], num[i]);</span><br><span class="line">            permuteRecursive(num, <span class="built_in">begin</span> + <span class="number">1</span>, result);</span><br><span class="line">            <span class="comment">// reset</span></span><br><span class="line">            swap(num[<span class="built_in">begin</span>], num[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»–å°† permute ä¸­çš„å¾ªç¯åˆå¹¶åˆ°äº† permuteRecursive é‡Œé¢  </p>
<p>æ ¸å¿ƒåœ¨äº swap, é€šè¿‡äº¤æ¢, è¿™æ · result å°±å§‹ç»ˆåªæœ‰ä¸€ä¸ª, å–è€Œä»£ä¹‹çš„æ˜¯å¤šäº†ä¸€ä¸ª int å‚æ•°ä¼ é€’</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/47ZPermutaionsII</title>
    <url>/2020/01/09/leetcode/47ZPermutaionsII/</url>
    <content><![CDATA[<h3 id="Permutaions-II"><a href="#Permutaions-II" class="headerlink" title="Permutaions II"></a>Permutaions II</h3><p><img src="https://imgur.com/afcpZbV.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªæ•°ç»„, è¿”å›æ•°ç»„ä¸­æ‰€æœ‰ä¸é‡å¤çš„åºåˆ—</p>
<h3 id="my-solutions-108-gt-24ms"><a href="#my-solutions-108-gt-24ms" class="headerlink" title="my solutions (108 -&gt; 24ms)"></a>my solutions (108 -&gt; 24ms)</h3><p>ä¸€å¼€å§‹æˆ‘çš„æƒ³æ³•æ˜¯, æŒ‰ç…§ 46 é¢˜çš„è§£æ³•, ç„¶åç”¨ set è‡ªåŠ¨å»é‡</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; permuteUnique(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; v) &#123;</span><br><span class="line">        <span class="built_in">size</span> = v.<span class="built_in">size</span>(); </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">1</span>) <span class="keyword">return</span> &#123;v&#125;;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        permuteUnique_do(v, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> &#123; ret.<span class="built_in">begin</span>(), ret.<span class="built_in">end</span>() &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">permuteUnique_do</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; curv, <span class="keyword">int</span> <span class="built_in">begin</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">begin</span> &gt;= <span class="built_in">size</span>) &#123;</span><br><span class="line">            ret.insert(ret.<span class="built_in">begin</span>(), curv);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">begin</span>; i &lt; <span class="built_in">size</span>; ++i) &#123;</span><br><span class="line">            swap(curv[i], curv[<span class="built_in">begin</span>]);</span><br><span class="line">            permuteUnique_do(curv, <span class="built_in">begin</span> + <span class="number">1</span>);</span><br><span class="line">            swap(curv[i], curv[<span class="built_in">begin</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">set</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret;</span><br><span class="line">    <span class="keyword">size_t</span> <span class="built_in">size</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯è¿™å¾—åˆ°äº† 108 ms çš„ç­”æ¡ˆ, æˆ‘æ€ç´¢äº†ä¸€ä¸‹, é€Ÿåº¦çš„ç“¶é¢ˆåœ¨äº: </p>
<p>æˆ‘å¯¹å¤šä¸ªæ•°åšäº†åŒæ ·çš„æ“ä½œ, ä½†æœ€åå°†ä»–ä»¬å…¶ä¸­çš„å¤§éƒ¨åˆ†éƒ½æŠ›å¼ƒäº†  </p>
<p>è¦ç»“å±€è¿™ç§é—®é¢˜, éœ€è¦ä»æºå¤´å…¥æ‰‹, åœ¨æ“ä½œä¹‹å‰, å°±å°†è¿™äº›æ•°æ®è·³è¿‡  </p>
<p>ä¸è¿‡æˆ‘æš‚æ—¶æ²¡æœ‰ä»€ä¹ˆå¥½çš„æƒ³æ³•, çœ‹äº†ä¸€ä¸‹æœ€å¥½çš„ç­”æ¡ˆ  </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; permuteUnique(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res;</span><br><span class="line">        sort(nums.<span class="built_in">begin</span>(),nums.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            res.push_back(nums);</span><br><span class="line">        &#125;<span class="keyword">while</span>(next_permutation(nums.<span class="built_in">begin</span>(), nums.<span class="built_in">end</span>()));</span><br><span class="line">        res.erase(unique(res.<span class="built_in">begin</span>(),res.<span class="built_in">end</span>()),res.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>emmm, ä»–åˆç”¨äº†æ ‡å‡†åº“  </p>
<p>æœ¬æ¥æƒ³ç€è¿™é“é¢˜å°±è¿™æ ·ç®—äº†, ä½†æ˜¯çªç„¶æƒ³åˆ°, è¿™å¥½åƒå’Œ 31 é¢˜å¾ˆç±»ä¼¼â€¦  </p>
<p>ç„¶åæˆ‘æ”¹è‰¯äº†ä¸€ä¸‹ç®—æ³•</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; permuteUnique(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; v) &#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = v.<span class="built_in">size</span>(); </span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">1</span>) <span class="keyword">return</span> &#123;v&#125;;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">0</span>) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        sort( v.<span class="built_in">begin</span>(), v.<span class="built_in">end</span>() );</span><br><span class="line">        ret.push_back(v);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( nextPermutation(v) ) &#123;</span><br><span class="line">            ret.push_back(v);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">nextPermutation</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = nums.<span class="built_in">size</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="built_in">size</span> - <span class="number">1</span>; i &gt; <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt; nums[i - <span class="number">1</span>]) &#123;</span><br><span class="line">                <span class="keyword">int</span> i2 = nums[i - <span class="number">1</span>];</span><br><span class="line">                <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::iterator it = nums.<span class="built_in">end</span>();</span><br><span class="line">                <span class="keyword">while</span> ( ++i2 &lt; <span class="built_in">size</span> ) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ( ( it = <span class="built_in">find</span>(nums.<span class="built_in">begin</span>() + i + <span class="number">1</span>, nums.<span class="built_in">end</span>(), i2) ) != nums.<span class="built_in">end</span>() )</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> ( it != nums.<span class="built_in">end</span>() ) &#123;</span><br><span class="line">                    *it ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                    nums[i - <span class="number">1</span>] ^= *it;</span><br><span class="line">                    *it ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    nums[i] ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                    nums[i - <span class="number">1</span>] ^= nums[i];</span><br><span class="line">                    nums[i] ^= nums[i - <span class="number">1</span>];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                sort(nums.<span class="built_in">begin</span>() + i, nums.<span class="built_in">end</span>());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å½¢çŠ¶å’Œ the best solution ç±»ä¼¼, ä½†æ˜¯è¿‡ç¨‹æˆ‘è‡ªå·±å®ç°äº†, æ¢æˆäº†æˆ‘åœ¨ 31 é¢˜ä¸­çš„è§£æ³•  </p>
<p><img src="https://imgur.com/O8YEq7O.png" alt=""></p>
<p>æœ€å, æˆ‘å¾—åˆ°äº†ä»…æ¬¡äºæœ€å¥½ç­”æ¡ˆçš„é€Ÿåº¦</p>
<p>(æ ‡å‡†åº“è¿˜æ˜¯æ²¡åŠæ³•æ¯”å¾—è¿‡çš„, æˆ‘ä»€ä¹ˆæ—¶å€™èƒ½å†™å‡ºæ ‡å‡†åº“ä¸€æ ·æ¼‚äº®çš„ä»£ç å‘¢?)</p>
<p>(PS: æˆ‘æ˜¯ä¸æ˜¯æ”¹æŠ½ä¸€éƒ¨åˆ†æ—¶é—´å»åˆ†æä¸€ä¸‹æ ‡å‡†åº“çš„ä¸œè¥¿?)</p>
<p>(ä¸€å¼€å§‹çš„ 236 æ˜¯æˆ‘æœªå°†å‚æ•°ä»¥å¼•ç”¨ä¼ é€’)</p>
<p>(åé¢çš„ 32 æ˜¯æˆ‘å°† size æ¢æˆäº†ç±»å˜é‡, ä½†æ˜¯æ—¶é—´å¢åŠ äº†, çœ‹æ¥å¯¹äºç»å¸¸è®¿é—®çš„å˜é‡, è¿˜æ˜¯å±€éƒ¨å˜é‡å¥½)  </p>
<p>(PS: æˆ‘ä¸æ˜¯åˆ†æè¿‡è¿™äº›ä¸œè¥¿ä¹ˆ, ä¸ºä»€ä¹ˆä¼šçŠ¯è¿™ç§é”™â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/59ZSpiralMatrixII</title>
    <url>/2020/01/09/leetcode/59ZSpiralMatrixII/</url>
    <content><![CDATA[<h3 id="Spiral-Matrix-II"><a href="#Spiral-Matrix-II" class="headerlink" title="Spiral Matrix II"></a>Spiral Matrix II</h3><p><img src="https://imgur.com/6FsdN4f.png" alt=""></p>
<p>æ²¡ä»€ä¹ˆå¥½è¯´çš„, æ—‹è½¬å¡«å……Nå®«æ ¼</p>
<h3 id="my-solution-4ms"><a href="#my-solution-4ms" class="headerlink" title="my solution (4ms)"></a>my solution (4ms)</h3><p>å¯ä»¥ç”¨ä¸€ä¸ª while + 4ä¸ªfor æ¥åš, è¿™æ ·æ˜¯æœ€ç›´è§‚, æœ€å¥½ç†è§£çš„  </p>
<p>ä½†æ˜¯ä¸å¤ªæƒ³è¿™æ ·, æ„Ÿè§‰å¤ªä¸‘é™‹äº†â€¦ æ‰€ä»¥æƒ³äº†ä¸€ä¸‹åŠæ³•åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å®ç°å®ƒ</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; generateMatrix(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret( n, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(n, <span class="number">0</span>) );</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">step</span> &#123; &#123;<span class="number">1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">1</span>&#125;, &#123;<span class="number">-1</span>, <span class="number">0</span>&#125;, &#123;<span class="number">0</span>, <span class="number">-1</span>&#125; &#125;;</span><br><span class="line">        <span class="keyword">int</span> type = <span class="number">0</span>, count = <span class="number">0</span>, xstep = <span class="number">0</span>, ystep = <span class="number">0</span>;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> nums = <span class="number">1</span>, <span class="built_in">end</span> = n * n; nums &lt;= <span class="built_in">end</span>; ) &#123;</span><br><span class="line">            ret[ystep][xstep] = nums++;</span><br><span class="line"></span><br><span class="line">            xstep += <span class="built_in">step</span>[type][<span class="number">0</span>];</span><br><span class="line">            ystep += <span class="built_in">step</span>[type][<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">            count = ++count &gt;= (n - <span class="number">1</span>) ? count - n + <span class="number">1</span> : count;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                type = ++type % <span class="number">4</span>;</span><br><span class="line">                <span class="keyword">if</span> (type == <span class="number">0</span>) &#123;</span><br><span class="line">                    n -= <span class="number">2</span>;</span><br><span class="line">                    xstep += <span class="number">1</span>;</span><br><span class="line">                    ystep += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å‰è¿›æœ‰4ä¸ªæ–¹å‘, æ¯æ¬¡çš„ä½ç§»æ˜¯ä¸€å®šçš„, è€Œä¸”æ˜¯æŒ‰ç…§å¾ªç¯æ¥åšä½ç§»  </p>
<p>æ‰€ä»¥ç”¨äº†å–ä½™å’Œæ•°ç»„æ¥ç¡®å®šæ¯ä¸€æ¬¡çš„ä½ç§»æ˜¯æ­£ç¡®çš„</p>
<p>ç„¶åæ˜¯å°†æ¯ä¸ªæ–¹å‘çš„æ­¥æ•°çœ‹åšåŒä¸€ä¸ªå€¼, æ‰€ä»¥æ±‚å–æ­¥æ•°åœ¨ä¹‹å‰  </p>
<p>æ¯”å¦‚ n = 3: </p>
<pre><code>[ 1, 2, 3 ],
[ 8, 9, 4 ],
[ 7, 6, 5 ]</code></pre><p>åˆ™æ˜¯æŒ‰ç…§ 1, 2   3, 4 â€¦ ( (4 * n - 1) )è¿™æ ·çš„æ¦‚å¿µæ¥å‰è¿›, ä½†æ˜¯é—®é¢˜åœ¨äº</p>
<p>å¦‚æœå°†è®¡ç®—æ­¥æ•°çš„æ“ä½œæ”¾åˆ°äº†æœ€å, é‚£ä¹ˆ 3 å°±ä¼šè¢«é”™è¯¯è®¡ç®—, æ‰€ä»¥ä¿å­˜äº†ä¸€ä¸‹æœ€åä¸€æ¬¡è¶Šç•Œå‰çš„å€¼</p>
<p>(æˆ‘éšçº¦æ„Ÿè§‰è¿™é‡Œåº”è¯¥èƒ½å¤Ÿä¼˜åŒ–, æ¯•ç«Ÿè¿™æ ·å†™å‡ºæ¥çš„ä»£ç ä¸æ˜“ç†è§£)</p>
<p><img src="https://imgur.com/IJDHb1y.png" alt=""></p>
<p>ç»“æœæ²¡ä»€ä¹ˆå¥½è¯´çš„</p>
<h3 id="the-best-solution-4ms"><a href="#the-best-solution-4ms" class="headerlink" title="the best solution (4ms)"></a>the best solution (4ms)</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; generateMatrix(<span class="keyword">int</span> n) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; result(n,<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(n));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            result[<span class="number">0</span>][<span class="number">0</span>] = n;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> top = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> bottom = n<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> right = n<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> index = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(top&lt;=bottom)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=left;i&lt;=right;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                result[top][i]=index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i=top+<span class="number">1</span>;i&lt;bottom;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                result[i][right]=index;</span><br><span class="line">                index++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(top&lt;bottom)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=right;i&gt;=left;i--)</span><br><span class="line">                &#123;</span><br><span class="line">                   result[bottom][i]=index;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(left&lt;right)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> i=bottom<span class="number">-1</span>;i&gt;top;i--)</span><br><span class="line">                &#123;</span><br><span class="line">                    result[i][left]=index;</span><br><span class="line">                    index++;</span><br><span class="line">                &#125; </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">            top++;</span><br><span class="line">            bottom--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä¸å–œæ¬¢ä¸‘é™‹çš„ while for for for for :(  , å°±ä¸åˆ†æäº†</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/56ZMergeIntervals</title>
    <url>/2020/01/09/leetcode/56ZMergeIntervals/</url>
    <content><![CDATA[<h3 id="Merge-Intervals"><a href="#Merge-Intervals" class="headerlink" title="Merge Intervals"></a>Merge Intervals</h3><p><img src="https://imgur.com/EpONkBi.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªåŒºé—´çš„é›†åˆ, åˆå¹¶æ‰€æœ‰é‡å¤çš„åŒºé—´</p>
<h3 id="my-solution-12ms"><a href="#my-solution-12ms" class="headerlink" title="my solution (12ms)"></a>my solution (12ms)</h3><p>å¯ä»¥é€šè¿‡é‡æ–°æ’åºçš„å½¢å¼æ¥ä¸€æ­¥æ­¥åˆå¹¶, æ¯”å¦‚:</p>
<p>start:     1 2 8  15</p>
<p>end:      3 6 10 18</p>
<p>å…¶ä¸­ start å’Œ end æ˜¯ç»æ’åºåçš„æ•°ç»„  </p>
<p>ä» 1 å¼€å§‹, å¦‚æœæ¥ä¸‹æ¥çš„å¼€å§‹ä¸‹æ ‡å°äºå½“å‰çš„ç»“æŸä¸‹æ ‡ (2 &lt; 3)  </p>
<p>é‚£ä¹ˆ, å°±å¯ä»¥åˆå¹¶, ç»§ç»­å¯¹æ¯”ä¸‹ä¸€ä¸ª. (8 &lt; 6) ä¸æˆç«‹, é‚£ä¹ˆç¬¬ä¸€ä¸ªåŒºé—´å°±å‡ºç°äº†, 1-6  </p>
<p>æ¥ä¸‹æ¥ä» 8 å¼€å§‹, ç»§ç»­ä»¥ä¸Šæ­¥éª¤, ç›´è‡³æ•°ç»„å°¾éƒ¨, è¿™æ ·ç®—æ³•çš„å¤æ‚åº¦å°±æ˜¯ O(n)  </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for an interval.</span></span><br><span class="line"><span class="comment"> * struct Interval &#123;</span></span><br><span class="line"><span class="comment"> *     int start;</span></span><br><span class="line"><span class="comment"> *     int end;</span></span><br><span class="line"><span class="comment"> *     Interval() : start(0), end(0) &#123;&#125;</span></span><br><span class="line"><span class="comment"> *     Interval(int s, int e) : start(s), end(e) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []() &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;Interval&gt; merge(<span class="built_in">vector</span>&lt;Interval&gt;&amp; intervals) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; start;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="built_in">end</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;Interval&gt; ret;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; it : intervals) &#123;</span><br><span class="line">            start.push_back(it.start);</span><br><span class="line">            <span class="built_in">end</span>.push_back(it.<span class="built_in">end</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sort(start.<span class="built_in">begin</span>(), start.<span class="built_in">end</span>());</span><br><span class="line">        sort(<span class="built_in">end</span>.<span class="built_in">begin</span>(), <span class="built_in">end</span>.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">size_t</span> <span class="built_in">size</span> = start.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">size</span>; ) &#123;</span><br><span class="line">            <span class="keyword">int</span> ti = i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i++; ;) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= <span class="built_in">size</span> || i &gt;= <span class="built_in">size</span>) &#123;	<span class="comment">// è¿™é‡Œåº”è¯¥å¯ä»¥å°‘åˆ¤æ–­ j çš„å€¼</span></span><br><span class="line">                    ret.push_back( &#123;start[ti], <span class="built_in">end</span>.back()&#125; );</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (start[i] &lt;= <span class="built_in">end</span>[j]) &#123;</span><br><span class="line">                    ++i, ++j;</span><br><span class="line">                &#125; </span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    ret.push_back( &#123;start[ti], <span class="built_in">end</span>[j]&#125; );</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»£ç å¦‚ä¸Š, åº”è¯¥è¿˜æœ‰å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ (æ¯”å¦‚è¯´å¤–å›´ for å¾ªç¯, ä»–ä»…ä»…å°±æ˜¯ä¸€ä¸ªä¿ç•™ i çš„ä½œç”¨)</p>
<p><img src="https://imgur.com/57NGf4L.png" alt=""></p>
<p>ç»“æœè¿˜ä¸é”™</p>
<h3 id="the-best-solution-8ms"><a href="#the-best-solution-8ms" class="headerlink" title="the best solution (8ms)"></a>the best solution (8ms)</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = []()&#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Interval&gt; merge(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Interval&gt;&amp; Intervals) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">int</span> IntervalNum = Intervals.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (IntervalNum &lt; <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> Intervals;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::sort(Intervals.<span class="built_in">begin</span>(), Intervals.<span class="built_in">end</span>(), </span><br><span class="line">                  [](<span class="keyword">const</span> Interval &amp;A, <span class="keyword">const</span> Interval &amp;B) &#123;</span><br><span class="line">                      <span class="keyword">return</span> A.start &lt; B.start;</span><br><span class="line">                  &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;Interval&gt; Merged &#123;Intervals[<span class="number">0</span>]&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; IntervalNum; ++i) &#123;</span><br><span class="line">            <span class="keyword">const</span> Interval &amp;Curr = Intervals[i];</span><br><span class="line">            Interval &amp;LastMerged = Merged.back();</span><br><span class="line">            <span class="comment">// å®Œå…¨è¢«å†…å«çš„åŒºé—´ä¼šè¢«è·³è¿‡</span></span><br><span class="line">            <span class="keyword">if</span> (Curr.<span class="built_in">end</span> &lt;= LastMerged.<span class="built_in">end</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">			<span class="comment">// æ›´æ–°åŒºé—´çš„æœ€å¤§å€¼</span></span><br><span class="line">            <span class="keyword">if</span> (Curr.start &lt;= LastMerged.<span class="built_in">end</span>)</span><br><span class="line">                LastMerged.<span class="built_in">end</span> = Curr.<span class="built_in">end</span>;</span><br><span class="line">            <span class="keyword">else</span>	<span class="comment">// ä¸‹ä¸€ä¸ªåŒºé—´å®Œå…¨ä¸åœ¨å½“å‰åŒºé—´å†…, ä¸èƒ½åˆå¹¶. å‹å…¥å½“å‰åŒºé—´, ç»§ç»­æ‰§è¡Œ</span></span><br><span class="line">                Merged.push_back(Curr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> Merged;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä»–çš„æ’åºæ˜¯ç›´æ¥åœ¨ Intervals è¿›è¡Œ, å¹¶ä¸”åªæ¯”å¯¹ start  (ä¹Ÿæ˜¯, æˆ‘å¥½åƒåšäº†å¤šä½™çš„æ¯”å¯¹)</p>
<p>æƒ³æ³•å¤§è‡´æ˜¯ä¸€æ ·çš„, ä½†æ˜¯ç»†èŠ‚ä¸å¤Ÿå¥½</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/62ZUnuquePaths</title>
    <url>/2020/01/09/leetcode/62ZUnuquePaths/</url>
    <content><![CDATA[<h3 id="Unique-Paths"><a href="#Unique-Paths" class="headerlink" title="Unique Paths"></a>Unique Paths</h3><p><img src="https://imgur.com/GNf4ByW.png" alt=""></p>
<p>æ‰¾åˆ°ä¸é‡å¤çš„èƒ½åˆ°è¾¾ç›®æ ‡çš„è·¯å¾„æ•°</p>
<h3 id="my-solution-8ms"><a href="#my-solution-8ms" class="headerlink" title="my solution (8ms)"></a>my solution (8ms)</h3><p>å…¸å‹çš„å¯ä»¥ç”¨é€’å½’è§£å†³çš„é—®é¢˜</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        _m = m;</span><br><span class="line">        _n = n;</span><br><span class="line">        _cx = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        uniquePaths_do(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _cx;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">uniquePaths_do</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (m == _m &amp;&amp; n == _n) &#123;</span><br><span class="line">            ++_cx;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m + <span class="number">1</span> &lt;= _m)</span><br><span class="line">            uniquePaths_do(m + <span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">if</span> (n + <span class="number">1</span> &lt;= _n)</span><br><span class="line">            uniquePaths_do(m, n + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _m;</span><br><span class="line">    <span class="keyword">int</span> _n;</span><br><span class="line">    <span class="keyword">int</span> _cx;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç»“æœè¶…æ—¶äº†, æƒ³äº†ä¸€ä¸‹:</p>
<pre><code>            11
     21            12
  31   22        22   13
41 32 32 23    32 23 23 14</code></pre><p>è¿™æ ·å­çš„è¯, å¤§å¤šæ•°çš„è¿­ä»£éƒ½ä¼šé‡å¤</p>
<p>æ‰€ä»¥æ›´æ”¹äº†ä¸€ä¸‹ä»£ç :</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        _m = m;</span><br><span class="line">        _n = n;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> uniquePaths_do(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">uniquePaths_do</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> p = make_pair(m, n);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (road[p] != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> road[p];</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (m == _m &amp;&amp; n == _n) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (m + <span class="number">1</span> &lt;= _m)</span><br><span class="line">            l = uniquePaths_do(m + <span class="number">1</span>, n);</span><br><span class="line">        <span class="keyword">if</span> (n + <span class="number">1</span> &lt;= _n)</span><br><span class="line">            r = uniquePaths_do(m, n + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (road[p] == <span class="number">0</span>) &#123;</span><br><span class="line">            road[p] = l + r;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> l + r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> _m;</span><br><span class="line">    <span class="keyword">int</span> _n;</span><br><span class="line">    <span class="built_in">map</span> &lt;pair&lt;<span class="keyword">int</span>, <span class="keyword">int</span>&gt;, <span class="keyword">int</span>&gt; road;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>é€šè¿‡ä¿å­˜çš„å½¢å¼æ¥å»æ‰ä¸€äº›å¯ä»¥é‡ç”¨çš„è®¡ç®—, è™½ç„¶è¿‡äº†, ä½†æ˜¯æ•ˆæœä¸ç†æƒ³</p>
<p><img src="https://imgur.com/jVV30Mn.png" alt=""></p>
<p>emmâ€¦ æˆ‘æ²¡æœ‰å†ä»æ ‘ä¸­èƒ½æ€»ç»“å‡ºä»€ä¹ˆå¥½çš„è§„å¾‹â€¦</p>
<h3 id="the-best-solution"><a href="#the-best-solution" class="headerlink" title="the best solution"></a>the best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">uniquePaths</span><span class="params">(<span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; path(m, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(n, <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = m - <span class="number">2</span>; i &gt;= <span class="number">0</span>; i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j = n - <span class="number">2</span>; j &gt;= <span class="number">0</span>; j--)&#123;</span><br><span class="line">                path[i][j] = path[i + <span class="number">1</span>][j] + path[i][j + <span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> path[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç®€æ´åˆé«˜æ•ˆ, çœŸæ˜¯ä¸ªæ¼‚äº®çš„å°ä¸œè¥¿</p>
<p>æ€è·¯æ˜¯è¿™æ ·çš„:</p>
<pre><code>1 1 1
3 2 1

1 1 1
3 2 1
6 3 1</code></pre><p>ä¸Šè¿°åˆ†åˆ«æ˜¯ 3, 2 å’Œ 3, 3 çš„æƒ…å†µ, å‡è®¾ rebot åœ¨å·¦ä¸‹è§’, star åœ¨å³ä¸Šè§’(æœ¬è´¨ä¸Šä¸ä¼šæœ‰ä»€ä¹ˆæ”¹å˜, åªæ˜¯æ¢äº†æ–¹å‘)</p>
<p>ä» star å¼€å§‹å¾€åé€€, æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„æ¬¡æ•°éƒ½æ˜¯ä»–çš„ ä¸ŠèŠ‚ç‚¹æ¬¡æ•° + å³èŠ‚ç‚¹æ¬¡æ•° ç›´åˆ°å¾ªç¯ç»“æŸ  </p>
<p>æœ€åçš„å·¦ä¸‹è§’å°±æ˜¯ rebot çš„æ¬¡æ•°  </p>
<p>è¿™æ ·çš„ç®—æ³•å¤æ‚åº¦æ˜¯ O(n)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/820SortEncodingofWords</title>
    <url>/2020/01/09/leetcode/820SortEncodingofWords/</url>
    <content><![CDATA[<h2 id="820-Short-Encoding-of-Words"><a href="#820-Short-Encoding-of-Words" class="headerlink" title="820 Short Encoding of Words"></a>820 Short Encoding of Words</h2><p><img src="https://imgur.com/ycGcntf.png" alt=""></p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution = ="></a>my solution = =</h3><p>ä¸€å¼€å§‹å…ˆè¯•ç€ç”¨ O(n2) çš„æ–¹æ³•, ä¹‹åç”¨ O(n), ä½†æ˜¯æ—¶é—´ä¾æ—§å¾ˆé•¿</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minimumLengthEncoding</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        sort(words.<span class="built_in">begin</span>(), words.<span class="built_in">end</span>(), [](<span class="built_in">string</span> &amp;str1, <span class="built_in">string</span> &amp;str2) &#123;</span><br><span class="line">            <span class="keyword">return</span> str1.<span class="built_in">size</span>() &gt; str2.<span class="built_in">size</span>();</span><br><span class="line">        &#125;);</span><br><span class="line">           </span><br><span class="line">        <span class="built_in">string</span> str;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; words.<span class="built_in">size</span>(); i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( str.<span class="built_in">find</span>(words[i] + <span class="string">'#'</span>) == <span class="built_in">string</span>::npos ) &#123;</span><br><span class="line">                str.append(words[i] + <span class="string">'#'</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> str.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”è¿™ä¸ªä»£ç ä¹‹å‰è¿˜è¸©äº†ä¸ªå‘ : <a href="https://www.boost.org/sgi/stl/StrictWeakOrdering.html" target="_blank" rel="noopener">https://www.boost.org/sgi/stl/StrictWeakOrdering.html</a></p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">minimumLengthEncoding</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; words)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">string</span>&amp; s : words) &#123;</span><br><span class="line">            reverse(s.<span class="built_in">begin</span>(), s.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        sort(words.<span class="built_in">begin</span>(), words.<span class="built_in">end</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> length = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> ((i + <span class="number">1</span>) &gt;= words.<span class="built_in">size</span>()) &#123;</span><br><span class="line">                length += words[i].length() + <span class="number">1</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (words[i+<span class="number">1</span>].compare(<span class="number">0</span>, words[i].length(), words[i]) != <span class="number">0</span>) &#123;</span><br><span class="line">                length += words[i].length() + <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>emâ€¦ é€»è¾‘æŒºç®€å•çš„ </p>
<p>ååºå­—ç¬¦ä¸², å­—å…¸åºæ’åº, åå†ç›´æ¥ compare</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/77ZCombinations</title>
    <url>/2020/01/09/leetcode/77ZCombinations/</url>
    <content><![CDATA[<h3 id="Combinations"><a href="#Combinations" class="headerlink" title="Combinations"></a>Combinations</h3><p><img src="https://imgur.com/UHtnUvF.png" alt=""></p>
<p>æ‰¾åˆ° n ä¸­æ‰€æœ‰ é•¿åº¦ä¸º k çš„ä¸é‡å¤çš„ç»„åˆ</p>
<h3 id="my-solution-60ms-top-99-97"><a href="#my-solution-60ms-top-99-97" class="headerlink" title="my solution (60ms, top 99.97%)"></a>my solution (60ms, top 99.97%)</h3><p>é€šè¿‡é—®é¢˜ä»£æ¢, å¯ä»¥è½¬æ¢æˆä¸€ç§å¾ˆå¥½ç†è§£å¹¶æ˜“äºç¼–å†™çš„é—®é¢˜  </p>
<p>å°†é—®é¢˜çœ‹åš <strong>æ‰¾å‡ºèŒƒå›´ n ä¸­æ‰€æœ‰æ»¡è¶³ p(x) çš„æ•´æ•° x</strong></p>
<p>(å’Œ 31. Next Permutation ç±»ä¼¼, æˆ‘æ˜¯ä»ä¸­å¾—åˆ°çš„å¯å‘)</p>
<p>å…¶ä¸­ x ä¸€å¼€å§‹ä¸º  âˆ‘k &lt;&lt; (n - k); [k=1], å³ n = 4, x = 1234</p>
<pre><code>n = 4, k = 2
1 2 3 4
[1,2],
[1,3],
[1,4],
[2,3],
[2,4],
[3,4],

n = 4, k = 3
1 2 3 4
[1,2,3],
[1,2,4],
[1,3,4],
[2,3,4]</code></pre><p>ä»–ä»¬éƒ½æŒ‰ç…§ä¸€å®šè§„å¾‹, æ»¡è¶³ä¸‹ä¸€ä¸ªæ•°æ¯”ä¸Šä¸€ä¸ªæ•°å¤§</p>
<p>è¿™ä¸ªè§„åˆ™ p(x) ç”¨è¯­è¨€æè¿°, å°±æ˜¯:</p>
<pre><code>ä»åå¾€å‰æ‰¾ä¸€ä¸ªå½“å‰ä¸‹æ ‡å°äºå½“å‰ä¸‹æ ‡çš„æœ€å¤§å€¼çš„æ•°
å¦‚æœæ‰¾åˆ°äº†, å½“å‰ä¸‹æ ‡å­˜å‚¨çš„å€¼è‡ªå¢, åç»­ä¸‹æ ‡ä»¥å½“å‰ä¸‹æ ‡ä¸ºåŸºå‡†, é¡ºåº +1
å¦‚æœæ²¡æ‰¾åˆ°, è¿”å›æ‰€æœ‰å·²æ‰¾åˆ°çš„</code></pre><p>ä»£ç æè¿°å¦‚ä¸‹:</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; combine(<span class="keyword">int</span> n, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (k &gt; n) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">        _n = n, _k = k;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= k; ++i) &#123;</span><br><span class="line">            _cur.push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; ret;</span><br><span class="line">        ret.emplace_back(_cur);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            getNextNums();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_cur.<span class="built_in">size</span>() != <span class="number">0</span>)</span><br><span class="line">                ret.emplace_back(_cur);</span><br><span class="line">            <span class="keyword">else</span> </span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getNextNums</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = _k - <span class="number">1</span>; i &gt;= <span class="number">0</span>; --i) &#123;</span><br><span class="line">            <span class="keyword">if</span> ( _cur[i] &lt; _n - _k + i + <span class="number">1</span> ) &#123;</span><br><span class="line">                _cur[i] += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = i + <span class="number">1</span>, s = _cur[i] + <span class="number">1</span>; j &lt; _k; ++j) </span><br><span class="line">                    _cur[j] = s++;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        _cur.<span class="built_in">clear</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; _cur;</span><br><span class="line">    <span class="keyword">int</span> _n, _k;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>combine å’Œ getNextNums çš„é€»è¾‘éƒ½ç›¸å½“ç®€å•, å†™èµ·æ¥å¾ˆå®¹æ˜“</p>
<p><img src="https://imgur.com/rQ2ZGIM.png" alt=""></p>
<h3 id="best-solution-56ms"><a href="#best-solution-56ms" class="headerlink" title="best solution (56ms)"></a>best solution (56ms)</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">combine</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; &amp;result, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;item, <span class="keyword">int</span> beg, <span class="keyword">int</span> <span class="built_in">end</span>, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> k = item.<span class="built_in">size</span>() - index;</span><br><span class="line">        <span class="keyword">if</span> (k == <span class="number">0</span>) &#123;</span><br><span class="line">            result.push_back(item);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = beg; i &lt;= <span class="built_in">end</span> - k + <span class="number">1</span>; ++i) &#123;</span><br><span class="line">            item[index] = i;</span><br><span class="line">            combine(result, item, i + <span class="number">1</span>, <span class="built_in">end</span>, index + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; combine(<span class="keyword">int</span> n, <span class="keyword">int</span> k) &#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">0</span> || k &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; item(k);</span><br><span class="line">        item[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        combine(result, item, <span class="number">1</span>, n, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>emmm, å¥½å¥‡æ€ªå•Š, é€»è¾‘ä¸Šæ¥è¯´æƒ³çš„éƒ½æ˜¯ä¸€æ ·çš„, ä¸ºä»€ä¹ˆä»–å°‘ 4ms å‘¢â€¦ ( æˆ–è®¸æ˜¯å› ä¸ºé€šè¿‡ this æŒ‡é’ˆè·å–å˜é‡çš„é”…? )</p>
<p>ä»–ç”¨é€’å½’çš„å½¢å¼æ¥å®ç°, æ¯æ¬¡é€’å½’ä¸­ä¼šä»å½“å‰èµ·å§‹ç´¢å¼•å¾ªç¯åˆ°ç»“æŸç´¢å¼•</p>
<p>å½“æ•°ç»„çš„é•¿åº¦åˆ°è¾¾ k çš„æ—¶å€™, å°±è¿”å›  </p>
<p>å€¼å¾—ä¸€æçš„æ˜¯, ä»–ç”¨ç´¢å¼•çš„å½¢å¼é¿å…äº†é‚£ä¸ªä¼šè¢«å¤šæ¬¡ä¿®æ”¹çš„ item ä»¥å€¼å½¢å¼ä¼ é€’  </p>
<p>(æˆ‘æ”¾å¼ƒä½¿ç”¨é€’å½’çš„ä¸€éƒ¨åˆ†åŸå› å°±æ˜¯å› ä¸ºæš‚æ—¶æƒ³ä¸åˆ°ä»€ä¹ˆæ–¹æ³•é¿å…é‚£ä¸ªä¸´æ—¶çš„æ•°ç»„, åŸæ¥è¿˜å¯ä»¥è¿™æ ·â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/92ReverseLinkedListII</title>
    <url>/2020/01/09/leetcode/92ReverseLinkedListII/</url>
    <content><![CDATA[<h2 id="Reverse-Linked-List-II"><a href="#Reverse-Linked-List-II" class="headerlink" title="Reverse Linked List II"></a>Reverse Linked List II</h2><p><img src="https://imgur.com/qHJVvfn.png" alt=""></p>
<p>ç»™å®šä¸€ä¸ªå•å‘é“¾è¡¨, æŒ‰ç…§è·ç¦» m, n æ—‹è½¬å•å‘é“¾è¡¨</p>
<h3 id="my-solution-4ms-100"><a href="#my-solution-4ms-100" class="headerlink" title="my solution (4ms, 100%)"></a>my solution (4ms, 100%)</h3><p>å…¶å®è¿™ä¸ªé¢˜æ²¡ä»€ä¹ˆå¥½å†™çš„, ä¸»è¦æ˜¯è¿™ä¸ªé¢˜ä¹‹å‰åšè¿‡.</p>
<p>å½“æ—¶çš„ä»£ç é‡å¾ˆå¤§ä¸è¯´, æœ€åè¿˜æ²¡åšå‡ºæ¥â€¦  </p>
<h4 id="old-solution"><a href="#old-solution" class="headerlink" title="old solution"></a>old solution</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">moth</span><span class="params">(ListNode* head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (m == n)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">// don't need replace</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">replace_far</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pmptrv-&gt;next = pn;</span><br><span class="line">        pm-&gt;next = pnnext;</span><br><span class="line">        pnptrv-&gt;next = pm;</span><br><span class="line">        pn-&gt;next = pmnext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">replace_close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        pmptrv ? pmptrv-&gt;next = pn : <span class="literal">nullptr</span>;</span><br><span class="line">        pm-&gt;next = pnnext;</span><br><span class="line">        pn-&gt;next = pm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">setpoint</span><span class="params">(ListNode* pcursor, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; ; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == m - <span class="number">1</span>) </span><br><span class="line">                pmptrv = pcursor;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == m) </span><br><span class="line">                pm = pcursor;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == m + <span class="number">1</span>) &#123;</span><br><span class="line">                pmnext = pcursor;</span><br><span class="line">                <span class="keyword">if</span> (i == n - <span class="number">1</span>)</span><br><span class="line">                    pnptrv = pcursor;</span><br><span class="line">                <span class="keyword">if</span> (i == n)</span><br><span class="line">                    pn = pcursor;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == n - <span class="number">1</span>)</span><br><span class="line">                pnptrv = pcursor;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == n) </span><br><span class="line">                pn = pcursor;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (i == n + <span class="number">1</span>) </span><br><span class="line">                pnnext = pcursor;</span><br><span class="line"></span><br><span class="line">            pcursor = pcursor-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (!pcursor)</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseBetween</span><span class="params">(ListNode* head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (moth(head, m, n)) </span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ListNode* pcursor = head;</span></span><br><span class="line">        setpoint(head, m, n);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (n - m &gt;= <span class="number">2</span>)</span><br><span class="line">            replace_far();</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (n - m == <span class="number">1</span>)</span><br><span class="line">            replace_close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (m == <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">return</span> pn;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    ListNode* pm = <span class="literal">nullptr</span>;</span><br><span class="line">    ListNode* pn = <span class="literal">nullptr</span>;</span><br><span class="line">    ListNode* pmptrv = <span class="literal">nullptr</span>;</span><br><span class="line">    ListNode* pmnext = <span class="literal">nullptr</span>;</span><br><span class="line">    ListNode* pnptrv = <span class="literal">nullptr</span>;</span><br><span class="line">    ListNode* pnnext = <span class="literal">nullptr</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>â€¦  å¤©çŸ¥é“æˆ‘ 4 ä¸ªæœˆå‰è„‘å­é‡Œé¢è£…çš„æ˜¯ä»€ä¹ˆ, ä¼šå†™å‡ºè¿™æ ·çš„ä»£ç . </p>
<p>å…³é”®æ˜¯é”™äº†åå‡ æ¬¡, ç„¶åè¿˜æ˜¯æ²¡åšå‡ºæ¥â€¦</p>
<h4 id="new-solution"><a href="#new-solution" class="headerlink" title="new solution"></a>new solution</h4><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">reverseBetween</span><span class="params">(ListNode* head, <span class="keyword">int</span> m, <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (m == n || head == <span class="literal">nullptr</span>) </span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line"></span><br><span class="line">        <span class="function">ListNode <span class="title">temp</span><span class="params">(<span class="number">-1</span>)</span></span>;</span><br><span class="line">        temp.next = head;</span><br><span class="line">        ListNode* p1 = &amp;temp;</span><br><span class="line">        ListNode* sta;</span><br><span class="line">        <span class="keyword">int</span> ax = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (++ax &gt;= m) &#123;</span><br><span class="line">                sta = p1;</span><br><span class="line">                p1 = p1-&gt;next;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            p1 = p1-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        ListNode* prev = p1;</span><br><span class="line">        ListNode* cur = p1-&gt;next;</span><br><span class="line">        ListNode* <span class="built_in">end</span> = p1;</span><br><span class="line">        <span class="keyword">while</span> (ax++ &lt; n) &#123;</span><br><span class="line">            ListNode* sav = cur-&gt;next;</span><br><span class="line">            cur-&gt;next = prev;</span><br><span class="line">            prev = cur;</span><br><span class="line">            cur = sav;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        sta-&gt;next = prev;</span><br><span class="line">        <span class="built_in">end</span>-&gt;next = cur;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> temp.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>æˆ‘é‡‡ç”¨äº†å¤šæ”¾ç½®ä¸€ä¸ªå¤´ç»“ç‚¹çš„æ–¹å¼æ¥å¤„ç†å¤´ç»“ç‚¹ä¹Ÿä¼šè¢«æ—‹è½¬çš„æƒ…å†µ</p>
<p>å…ˆæ‰¾åˆ° m çš„ä½ç½®, ç„¶åé¡ºåºæ—‹è½¬è‡³ n çš„ä½ç½®, æœ€åå°†å¤´å°¾è¡”æ¥ä¸€ä¸‹</p>
<p><img src="https://imgur.com/SgupRQT.png" alt=""></p>
<p>æœ€åçš„å‡ æ¬¡æ˜¯æˆ‘çš„å°è¯•, ä¸€å¼€å§‹çš„æ—¶å€™æ˜¯ 8ms, ä½†æ˜¯æˆ‘è§‚å¯Ÿäº† best solution, å‘ç°åŒºåˆ«ä¸å¤§  </p>
<p>é‚åˆå°è¯•äº†ä¸€ä¸‹, ç„¶åæ˜¯ 4ms, ä½†æ˜¯æœ‰æ—¶å€™ä¸ç¨³å®š, æ€»ä¹‹åœ¨ 4ms - 8ms ä¹‹é—´è·³ (= =â€¦)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/94BinaryTreeInorderTraversal</title>
    <url>/2020/01/09/leetcode/94BinaryTreeInorderTraversal/</url>
    <content><![CDATA[<h2 id="Binary-Tree-Inorder-Traversal"><a href="#Binary-Tree-Inorder-Traversal" class="headerlink" title="Binary Tree Inorder Traversal"></a>Binary Tree Inorder Traversal</h2><p><img src="https://imgur.com/vlChItp.png" alt=""></p>
<p>è¿™ä¸ªé—®é¢˜ç”¨é€’å½’éå¸¸å¥½è§£å†³, ä½†æ˜¯ä½œè€…è¦æ±‚ä½¿ç”¨è¿­ä»£</p>
<p>è¿™æ˜¯ä¸€ä¸ªä»¥è¿­ä»£å®ç°å­æ ‘éå†çš„åšæ³•, å€¼å¾—åšä¸€ä¸‹ç¬”è®°</p>
<h3 id="my-solution"><a href="#my-solution" class="headerlink" title="my solution"></a>my solution</h3><p>ä¸€å¼€å§‹æˆ‘æ²¡çœ‹åˆ° follow up, ç„¶åç”¨é€’å½’è§£å†³äº†  </p>
<p>ä¹‹åçœ‹åˆ°çš„æ—¶å€™æ²¡ä»€ä¹ˆå¥½çš„æ€è·¯</p>
<p>(æœ‰éƒ¨åˆ†æ˜¯å—äº†ç­”æ¡ˆçš„å½±å“, å› ä¸ºè¿™æ—¶å€™æˆ‘å·²ç»è§£å†³äº†, å¯ä»¥çœ‹åˆ«äººçš„ç­”æ¡ˆäº†)</p>
<p>(ä¸å¾—ä¸è¯´ç­”æ¡ˆçœŸæ˜¯å®³äººå•Šâ€¦  å¦‚æœæˆ‘ç‹¬ç«‹æ€è€ƒçš„è¯, èŠ±ä¸€éƒ¨åˆ†æ—¶é—´ä¹Ÿèƒ½æƒ³é€šçš„)</p>
<p>åé¢å€Ÿé‰´äº†ç­”æ¡ˆçš„æ€æƒ³, è‡ªå·±å®ç°äº†, æ‰€ä»¥è¿™é‡Œå°±ä¸è´´å‡ºæ¥äº†</p>
<h3 id="best-solution-4ms"><a href="#best-solution-4ms" class="headerlink" title="best solution (4ms)"></a>best solution (4ms)</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; inorderTraversal(TreeNode* root) &#123;</span><br><span class="line">        TreeNode *curr; </span><br><span class="line">        <span class="built_in">stack</span>&lt;TreeNode*&gt; st; </span><br><span class="line">        curr = root;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res; </span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ( !st.empty() || curr )&#123;</span><br><span class="line">            <span class="keyword">while</span> ( curr ) &#123; st.push(curr); curr = curr-&gt;left; &#125;</span><br><span class="line">            curr = st.top();</span><br><span class="line">            st.pop();</span><br><span class="line">            res.push_back(curr-&gt;val);</span><br><span class="line">            curr=curr-&gt;right;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ç®€å•æ¥è¯´</p>
<ol>
<li>éå†æ‰€æœ‰å·¦å­æ ‘</li>
<li>è·å¾—æ ˆé¡¶, å­˜å€¼, ç„¶åä»¥å…¶å³å­æ ‘ç»§ç»­éå†</li>
</ol>
<p>é‡å¤ä»¥ä¸Šæ­¥éª¤, å¾ˆç®€å•å§ (ä½†æ˜¯æˆ‘å½“æ—¶ä¸ºä»€ä¹ˆæ²¡æœ‰æƒ³å‡ºæ¥å‘¢ ? â€¦)</p>
<p>ä»¥åŒæ ·çš„é€»è¾‘, å¯ä»¥å®ç° leftorder, rightorder </p>
<p>(å¦‚æœæ²¡è®°é”™çš„è¯, åº”è¯¥æ˜¯è¿™ä¹ˆå«çš„, è€Œä¸”å¦‚æœæ²¡ä¼°è®¡é”™çš„è¯, åº”è¯¥å¯ä»¥)</p>
]]></content>
  </entry>
  <entry>
    <title>leetcode/116PopulatingNextRightPointersInEachNode</title>
    <url>/2020/01/09/leetcode/116PopulatingNextRightPointersInEachNode/</url>
    <content><![CDATA[<h2 id="Populating-Next-Right-Pointers-in-Each-Node"><a href="#Populating-Next-Right-Pointers-in-Each-Node" class="headerlink" title="Populating Next Right Pointers in Each Node"></a>Populating Next Right Pointers in Each Node</h2><p><img src="https://imgur.com/db5dxSr.png" alt=""></p>
<p>ç»™äº†ä¸€ä¸ªå®Œç¾çš„äºŒå‰æ ‘, å¡«å……å…¶nextèŠ‚ç‚¹</p>
<h3 id="my-solution-60ms-90-37"><a href="#my-solution-60ms-90-37" class="headerlink" title="my solution (60ms, 90.37%)"></a>my solution (60ms, 90.37%)</h3><p>è¿™é“é¢˜æˆ‘ç»™å‡ºäº†ä¸¤ç§æ–¹æ¡ˆ, é€’å½’å’Œè¿­ä»£  </p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">int</span> _ = [] () &#123;</span><br><span class="line">    ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125; ();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// Node* connect(Node* root) &#123;</span></span><br><span class="line">    <span class="comment">//     if (!root)</span></span><br><span class="line">    <span class="comment">//         return root;</span></span><br><span class="line">    <span class="comment">//     </span></span><br><span class="line">    <span class="comment">//     vector&lt;Node*&gt; lev;</span></span><br><span class="line">    <span class="comment">//     lev.push_back(root);</span></span><br><span class="line">    <span class="comment">//     </span></span><br><span class="line">    <span class="comment">//     while ( !lev.empty() ) &#123;</span></span><br><span class="line">    <span class="comment">//         vector&lt;Node*&gt; nlev;</span></span><br><span class="line">    <span class="comment">//         int size = lev.size();</span></span><br><span class="line">    <span class="comment">//         </span></span><br><span class="line">    <span class="comment">//         int i = 0, i2 = 1;</span></span><br><span class="line">    <span class="comment">//         for (; i2 &lt; size; ++i, ++i2) &#123;</span></span><br><span class="line">    <span class="comment">//             lev[i]-&gt;next = lev[i2];</span></span><br><span class="line">    <span class="comment">//             if ( lev[i]-&gt;left ) &#123;</span></span><br><span class="line">    <span class="comment">//                 nlev.push_back( lev[i]-&gt;left );</span></span><br><span class="line">    <span class="comment">//                 nlev.push_back( lev[i]-&gt;right );</span></span><br><span class="line">    <span class="comment">//             &#125;</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//         lev[i]-&gt;next = nullptr;</span></span><br><span class="line">    <span class="comment">//         if ( lev[i]-&gt;left ) &#123;</span></span><br><span class="line">    <span class="comment">//             nlev.push_back( lev[i]-&gt;left );</span></span><br><span class="line">    <span class="comment">//             nlev.push_back( lev[i]-&gt;right );</span></span><br><span class="line">    <span class="comment">//         &#125;</span></span><br><span class="line">    <span class="comment">//         </span></span><br><span class="line">    <span class="comment">//         swap(lev, nlev);</span></span><br><span class="line">    <span class="comment">//     &#125;</span></span><br><span class="line">    <span class="comment">//     </span></span><br><span class="line">    <span class="comment">//     return root;</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">connect</span><span class="params">(Node* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!root) <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">        connect_two(root-&gt;left, root-&gt;right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">connect_two</span><span class="params">(Node* left, Node* right)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!left) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        left-&gt;next = right;</span><br><span class="line">        <span class="keyword">if</span> (left-&gt;left)</span><br><span class="line">            connect_two(left-&gt;left, left-&gt;right);</span><br><span class="line">            connect_two(left-&gt;right, right-&gt;left);</span><br><span class="line">            connect_two(right-&gt;left, right-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>å¯¹äºè¿­ä»£, æˆ‘å°†æ¯ä¸€çº§çš„å…ƒç´ éƒ½ä¿ç•™, ç„¶åç”¨ä½œä¸‹ä¸€æ¬¡è¿­ä»£ </p>
<p>é€’å½’çš„è¯, å› ä¸ºå¦‚æœåªæ˜¯å•èŠ‚ç‚¹ä¼ å‚, å§‹ç»ˆä¼šé¢ä¸´æœ‰ç¼éš™çš„æƒ…å†µ, æ‰€ä»¥ç”¨åŒèŠ‚ç‚¹ä¼ å‚</p>
<p>é€’å½’çš„ä»£ç æ›´åŠ ç®€æ´, æˆ‘æ¨èä½¿ç”¨é€’å½’</p>
<p><img src="https://imgur.com/DbsUtql.png" alt=""></p>
<p>emmmmâ€¦ é€Ÿåº¦ä¸Šè¿˜å¥½, ä½†æ˜¯å†…å­˜ä¸Šå°±å¾ˆä¸èƒ½æ¥å—äº†</p>
<p>(æˆ‘å¾ˆå¥½å¥‡, ä»£ç é‡å·²ç»å¾ˆå°‘äº†, è€Œä¸”é€’å½’ä¸­ä¹Ÿä¸ä¼šäº§ç”Ÿå¤šä½™çš„æ“ä½œ)</p>
<p>(éš¾é“æ˜¯åœ¨ perfect binary tree ä¸Šèƒ½æœ‰ä»€ä¹ˆç»šä¸½çš„æ“ä½œä¹ˆ?)</p>
<h3 id="best-solution"><a href="#best-solution" class="headerlink" title="best solution"></a>best solution</h3><figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">connect</span><span class="params">(TreeLinkNode *root)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">queue</span>&lt;TreeLinkNode*&gt; q;</span><br><span class="line">    <span class="keyword">if</span> (!root)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    q.push(root);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (!q.empty())&#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">size</span> = q.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">size</span>--)&#123;</span><br><span class="line">            TreeLinkNode* c = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">size</span> == <span class="number">0</span>)&#123;</span><br><span class="line">                c-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                c-&gt;next = q.front();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (c-&gt;left)&#123;</span><br><span class="line">                q.push(c-&gt;left);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (c-&gt;right)&#123;</span><br><span class="line">                q.push(c-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å“¦å“¦å“¦, ç”¨çš„æ˜¯è¿­ä»£çš„æ–¹å¼, åªä¸è¿‡ä»–ç”¨äº†é˜Ÿåˆ—</p>
<p>è€Œä¸”ç”¨äº†size, è¿™æ ·ä¹Ÿå°±ä¸éœ€è¦ä¸€ä¸ªæ–°çš„å®¹å™¨äº†, å¾ˆä¸é”™ -v-  </p>
<p>ä¸è¿‡æ—¢ç„¶é¢˜è¯´äº†æ˜¯ perfect binary tree, è€Œä¸”nexté»˜è®¤ä¸ºç©º, é‚£ä¹ˆå¯ä»¥ç¨å¾®æ”¹è‰¯ä¸€ä¸‹</p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="function">Node* <span class="title">connect</span><span class="params">(Node* root)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!root) <span class="keyword">return</span> root;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">queue</span>&lt;Node*&gt; q;</span><br><span class="line">    q.push(root);</span><br><span class="line">    <span class="keyword">while</span>( !q.empty() ) &#123;</span><br><span class="line">        <span class="keyword">int</span> <span class="built_in">size</span> = q.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">size</span>--) &#123;</span><br><span class="line">            Node* cur = q.front();</span><br><span class="line">            q.pop();</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">size</span>)</span><br><span class="line">                cur-&gt;next = q.front();</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (cur-&gt;left) &#123;</span><br><span class="line">                q.push(cur-&gt;left);</span><br><span class="line">                q.push(cur-&gt;right);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»†èŠ‚åœ¨äº:</p>
<ol>
<li>å¦‚æœæ˜¯ç©ºèŠ‚ç‚¹, å°‘äº†ä¸€ä¸ªç©º queue çš„åˆ†é…æ—¶é—´</li>
<li>ä¸ç”¨å†å»èµ‹å€¼ nullptr äº†</li>
<li>å°‘äº†ä¸€ä¸ª cur-&gt;right çš„åˆ¤æ–­, å› ä¸ºé¢˜ç›®è¯´äº†æ˜¯ perfect binary tree</li>
</ol>
<p>PS: æˆ‘æœ€åç”¨è¿™ä¸ªç­”æ¡ˆå†è¯•äº†ä¸€æ¬¡, å‘ç°ç»“æœå’Œæˆ‘ç”¨é€’å½’çš„ç»“æœç›¸å·®æ— å‡ â€¦</p>
<p>å¯èƒ½è¿™æ˜¯å¢åŠ äº†æµ‹è¯•ç”¨ä¾‹æˆ–è€…æ”¹äº†é¢˜çš„ç»“æœ? æ¯•ç«Ÿ TreeLinkNode å˜ä¸ºäº† Node</p>
]]></content>
  </entry>
</search>
