<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†åœ¨ä½¿ç”¨ hexo deploy è¾“å…¥ç”¨æˆ·å&#x2F;å¯†ç , æˆ–å…¶ä»–ç‰¹æ®Šéœ€è¦è¾“å…¥å¯†ç çš„åœºåˆ, backspace æ€»æ˜¯è¢«å½“ä½œå¯†ç çš„ä¸€éƒ¨åˆ†. è¿™å¯ä»¥ç†è§£, å› ä¸ºè¿™ä¸ªæœ¬èº«å°±æ˜¯ä¸€ç§æŒ‰é”®, åªä¸è¿‡å¤§å¤šæ•°æ—¶å€™è¢«èµ‹äºˆäº†åˆ é™¤å­—ç¬¦çš„åŠŸèƒ½. å¤„äºå¥½å¥‡, æœç´¢äº†ä¸€ä¸‹ç›¸å…³èµ„æ–™ Backspace is traded as part of password when I use â€˜hexoâ€™">
<meta property="og:type" content="article">
<meta property="og:title" content="other&#x2F;somethingAboutBackspace">
<meta property="og:url" content="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/index.html">
<meta property="og:site_name" content="cas&#39;s website">
<meta property="og:description" content="å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†åœ¨ä½¿ç”¨ hexo deploy è¾“å…¥ç”¨æˆ·å&#x2F;å¯†ç , æˆ–å…¶ä»–ç‰¹æ®Šéœ€è¦è¾“å…¥å¯†ç çš„åœºåˆ, backspace æ€»æ˜¯è¢«å½“ä½œå¯†ç çš„ä¸€éƒ¨åˆ†. è¿™å¯ä»¥ç†è§£, å› ä¸ºè¿™ä¸ªæœ¬èº«å°±æ˜¯ä¸€ç§æŒ‰é”®, åªä¸è¿‡å¤§å¤šæ•°æ—¶å€™è¢«èµ‹äºˆäº†åˆ é™¤å­—ç¬¦çš„åŠŸèƒ½. å¤„äºå¥½å¥‡, æœç´¢äº†ä¸€ä¸‹ç›¸å…³èµ„æ–™ Backspace is traded as part of password when I use â€˜hexoâ€™">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case1.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case2.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case3.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case4.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/linuxprocess.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/exampleterm.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/examplediagram.png">
<meta property="article:published_time" content="2020-03-10T09:04:42.000Z">
<meta property="article:modified_time" content="2020-03-10T09:04:42.000Z">
<meta property="article:author" content="cas">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.linusakesson.net/programming/tty/case1.png">

<link rel="canonical" href="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>other/somethingAboutBackspace | cas's website</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">cas's website</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">casyup.me@outlook.com</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cas">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cas's website">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          other/somethingAboutBackspace
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-10 17:04:42" itemprop="dateCreated datePublished" datetime="2020-03-10T17:04:42+08:00">2020-03-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="å…³äº-backspace-æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†"><a href="#å…³äº-backspace-æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†" class="headerlink" title="å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†"></a>å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†</h1><p>åœ¨ä½¿ç”¨ hexo deploy è¾“å…¥ç”¨æˆ·å/å¯†ç , æˆ–å…¶ä»–ç‰¹æ®Šéœ€è¦è¾“å…¥å¯†ç çš„åœºåˆ, backspace æ€»æ˜¯è¢«å½“ä½œå¯†ç çš„ä¸€éƒ¨åˆ†.</p>
<p>è¿™å¯ä»¥ç†è§£, å› ä¸ºè¿™ä¸ªæœ¬èº«å°±æ˜¯ä¸€ç§æŒ‰é”®, åªä¸è¿‡å¤§å¤šæ•°æ—¶å€™è¢«èµ‹äºˆäº†åˆ é™¤å­—ç¬¦çš„åŠŸèƒ½.</p>
<p>å¤„äºå¥½å¥‡, æœç´¢äº†ä¸€ä¸‹ç›¸å…³èµ„æ–™</p>
<p>Backspace is traded as part of password when I use â€˜hexoâ€™ and other spacial situation that I need to enter password.</p>
<p>I can understand this because â€˜backspaceâ€™ is also a normal key that traded as a function in some special situation .</p>
<a id="more"></a>



<h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><p>from <a href="https://unix.stackexchange.com/questions/50493/clear-erase-a-mistyped-invisible-password-on-a-shell-terminal-in-linux" target="_blank" rel="noopener">stackExchange</a></p>
<p>Characters like Ctrl+L are handled by the <strong>application</strong>. In the case of entering input into the shell, like <code>bash</code>, it clears the screen. Some applications, like <code>emacs</code>, use it to redraw the screen and/or recenter the cursor.</p>
<p>C+L éƒ½è¢«åº”ç”¨æ‰€ç®¡ç†. åœ¨è¾“å…¥æ—¶, æ¯”å¦‚ bash. å°†ä¼šæ¸…å±. </p>
<p>Characters like Ctrl+U at a password prompt are handled by the <a href="http://en.wikipedia.org/wiki/Line_discipline" target="_blank" rel="noopener"><strong>TTY line discipline</strong></a>. Theyâ€™ll work any time the input terminal is in the â€œcanonicalâ€ line-editing mode, which is what mode your programs are in while youâ€™re entering a password. In this mode, itâ€™s the Linux kernel itself that is interpreting these characters. You can see what functions are assigned to which keys in the output of <code>stty -a</code>:</p>
<p>C+Uè¢«å½“ä½œå¯†ç æç¤º, ç”± TTY line discipline ç®¡ç†. å½“è¾“å…¥å¯†ç , è¿›å…¥è¡Œç¼–è¾‘æ¨¡å¼æ—¶, å°±ä¼šè¢«å…¶ç®¡ç†. linux å†…æ ¸è§£é‡Šè¿™äº›å­—ç¬¦, å¯ä»¥é€šè¿‡ <code>stty -a</code> æŒ‡ä»¤æŸ¥çœ‹ä¸€äº›ç‰¹æ®Šçš„é”®è¢«èµ‹äºˆçš„åŠŸèƒ½.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">speed 38400 baud; rows 45; columns 128; line &#x3D; 0;</span><br><span class="line">intr &#x3D; ^C; quit &#x3D; ^\; erase &#x3D; ^?; kill &#x3D; ^U; eof &#x3D; ^D; eol &#x3D; &lt;undef&gt;; eol2 &#x3D; &lt;undef&gt;; swtch &#x3D; &lt;undef&gt;; start &#x3D; ^Q; stop &#x3D; ^S;</span><br><span class="line">susp &#x3D; ^Z; rprnt &#x3D; ^R; werase &#x3D; ^W; lnext &#x3D; ^V; flush &#x3D; ^O; min &#x3D; 1; time &#x3D; 0;</span><br><span class="line">-parenb -parodd cs8 -hupcl -cstopb cread -clocal -crtscts</span><br><span class="line">-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8</span><br><span class="line">opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0</span><br><span class="line">isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke</span><br></pre></td></tr></table></figure>

<p>Here, you can see that Ctrl+U is tied to <code>kill</code>, which (according to the <a href="http://linux.die.net/man/1/stty" target="_blank" rel="noopener">stty man page</a>) will â€œerase the current lineâ€. You could also use <code>stty</code> to change this mapping:</p>
<p>é€šè¿‡ stty çš„ man æ‰‹å†Œå¯ä»¥æŸ¥çœ‹è¿™äº›æŒ‡ä»¤çš„æ„ä¹‰(çœ‹åˆ°é‡Œé¢çš„C+Säº†å§, æœ‰æ—¶å€™ windows ä¹ æƒ¯æ€§ä¿å­˜å¸¦åˆ° linux çš„ä¸‹åœºå°±æ˜¯ â€˜æ­»æœºâ€™ ğŸ“´)  (æˆ‘ç†è§£ stty ä¸­çš„ s å¯èƒ½æ˜¯ soft çš„æ„æ€)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stty kill ^E   # make ctrl-e erase the line</span><br></pre></td></tr></table></figure>

<p><a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">This page</a> has a lot of great information about the TTY layer if youâ€™re interested.</p>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="å…³äº-line-discipline"><a href="#å…³äº-line-discipline" class="headerlink" title="å…³äº line discipline"></a>å…³äº line discipline</h3><p>from <a href="">wiki</a></p>
<p>A <strong>line discipline</strong> (<strong>LDISC</strong>) is a layer in the <a href="https://en.wikipedia.org/wiki/Computer_terminal" target="_blank" rel="noopener">terminal</a> subsystem in some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-1" target="_blank" rel="noopener">[1]</a> The terminal subsystem consists of three layers: the upper layer to provide the <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">character device</a> interface, the lower hardware driver to communicate with the hardware or <a href="https://en.wikipedia.org/wiki/Pseudo_terminal" target="_blank" rel="noopener">pseudo terminal</a>, and the middle line discipline to implement behavior common to terminal devices.</p>
<p>LDISC æ—¶ä¸€ä¸ªç±» UNIX ç³»ç»Ÿç»ˆç«¯çš„å­ç³»ç»Ÿä¸­çš„ä¸€å±‚. å…¶å®Œæ•´ä¸ºä¸‰å±‚, é¡¶å±‚æä¾›ä¸€ä¸ªå­—ç¬¦è®¾å¤‡ç•Œé¢. ä¸‹å±‚ç¡¬ä»¶é©±åŠ¨ä¸ç¡¬ä»¶/ä¼ªç»ˆç«¯äº¤äº’. ä¸­å±‚ â€˜line disciplineâ€™ å®ç°å¸¸è§çš„è¡Œä¸ºç»™ç»ˆç«¯è®¾å¤‡(æˆ‘ç†è§£è¿™ä¸ªè¡Œä¸ºå¯èƒ½æ˜¯æ™®é€šå­—ç¬¦çš„å›æ˜¾ä»¥åŠç‰¹æ®Šå­—ç¬¦çš„è§£é‡Š)</p>
<p>The line discipline glues the low level device driver code with the high level generic interface routines (such as read(2), write(2) and <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a>(2)), and is responsible for implementing the semantics associated with the device.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-2" target="_blank" rel="noopener">[2]</a> The policy is separated from the device driver so that the same serial hardware driver can be used by devices that require different data handling.</p>
<p>â€˜line disciplineâ€™ å°†åº•å±‚é©±åŠ¨è®¾å¤‡ä»£ç å’Œé«˜å±‚æ³›å‹ç•Œé¢ç†è§£ç²˜åˆåœ¨ä¸€èµ·. å…¶å®ç°äº†ä¸è®¾å¤‡ç›¸å…³çš„è¯­ä¹‰. ä¸åŒçš„è®¾å¤‡é©±åŠ¨æœ‰ä¸åŒçš„ç­–ç•¥. ä»¥ç”¨äºåŒæ ·çš„ç¡¬ä»¶é©±åŠ¨èƒ½è¢«éœ€è¦ä¸åŒæ•°æ®ç®¡ç†çš„è®¾å¤‡æ‰€ä½¿ç”¨.</p>
<p>For example, the standard line discipline processes the data it receives from the hardware driver and from applications writing to the device according to the requirements of a terminal on a <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> system. On input, it handles special characters such as the interrupt character (typically <a href="https://en.wikipedia.org/wiki/Control-C" target="_blank" rel="noopener">Control-C</a>) and the erase and kill characters (typically <a href="https://en.wikipedia.org/wiki/Backspace" target="_blank" rel="noopener">backspace</a> or <a href="https://en.wikipedia.org/wiki/Delete_key" target="_blank" rel="noopener">delete</a>, and Control-U, respectively) and, on output, it replaces all the <a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> characters with a <a href="https://en.wikipedia.org/wiki/Carriage_return" target="_blank" rel="noopener">CR</a>/<a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> sequence.</p>
<p>æ¯”å¦‚: æ ‡å‡† â€˜line disciplineâ€™ ç¨‹åºå¤„ç†æ¥è‡ªç¡¬ä»¶é©±åŠ¨å’Œå¼•ç”¨çš„æ•°æ®. æ ¹æ®ç³»ç»Ÿç»ˆç«¯çš„éœ€æ±‚å†™å…¥åˆ°è®¾å¤‡. åœ¨è¾“å…¥ä¸­, å…¶ç®¡ç†å¦‚ä¸­æ–­å­—ç¬¦çš„ç‰¹æ®Šå­—ç¬¦, å®ç°å“åº”åŠŸèƒ½. åœ¨è¾“å…¥ä¸­, å°†æ¢è¡Œç¬¦è¡¨ç°ä¸ºæ¢è¡Œ.</p>
<p>Some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems use <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">STREAMS</a> to implement line disciplines.</p>
<p>(è¿™é‡Œæåˆ°äº†æµ, å…³äº <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">wiki</a> ä¸­å¯¹äº æµçš„è§£é‡Š: a stream is a chain of <a href="https://en.wikipedia.org/wiki/Coroutine" target="_blank" rel="noopener">coroutines</a> that <a href="https://en.wikipedia.org/wiki/Message_passing" target="_blank" rel="noopener">pass messages</a> between a program and a device driver (or between a pair of programs). æµæ˜¯ä¸¤è€…é—´ä¼ é€’ä¿¡æ¯çš„ååŒé“¾.)</p>
<h3 id="å…³äº-character-device"><a href="#å…³äº-character-device" class="headerlink" title="å…³äº character device"></a>å…³äº character device</h3><p>from <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">wiki</a></p>
<p>In <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> <a href="https://en.wikipedia.org/wiki/Operating_systems" target="_blank" rel="noopener">operating systems</a>, a <strong>device file</strong> or <strong>special file</strong> is an <a href="https://en.wikipedia.org/wiki/Interface_(computer_science)" target="_blank" rel="noopener">interface</a> to a <a href="https://en.wikipedia.org/wiki/Device_driver" target="_blank" rel="noopener">device driver</a> that appears in a <a href="https://en.wikipedia.org/wiki/File_system" target="_blank" rel="noopener">file system</a> as if it were an ordinary <a href="https://en.wikipedia.org/wiki/Computer_file" target="_blank" rel="noopener">file</a>. </p>
<p>è®¾å¤‡æ–‡ä»¶åˆç§°ç‰¹æ®Šæ–‡ä»¶, æ˜¯ä¸€ä¸ªè®¾å¤‡é©±åŠ¨çš„æ¥å£, ä»–èƒ½è¢«å½“ä½œä¸€ä¸ªæ™®é€šæ–‡ä»¶ä¸€æ ·æ‰§è¡Œ.</p>
<h4 id="Character-devices"><a href="#Character-devices" class="headerlink" title="Character devices"></a>Character devices</h4><p><em>Character special files</em> or <em>character devices</em> provide unbuffered, direct access to the hardware device. They do not necessarily allow programs to read or write single characters at a time; that is up to the device in question. The character device for a hard disk, for example, will normally require that all reads and writes are aligned to block boundaries and most certainly will not allow reading a single byte.</p>
<p>å­—ç¬¦ç‰¹æ®Šæ–‡ä»¶/å­—ç¬¦è®¾å¤‡æä¾›äº†æ— ç¼“å†², ç›´æ¥è®¿é—®ç¡¬ä»¶è®¾å¤‡. ç¡¬ç›˜ä¸Šçš„å­—ç¬¦è®¾å¤‡, é€šå¸¸éœ€è¦æ‰€æœ‰çš„è¯»å–å’Œå†™å…¥å¯¹å…¶å—è¾¹ç•Œ. ä¸å…è®¸è¯»å–å•ä¸ªå­—èŠ‚.</p>
<p>Character devices are sometimes known as <em>raw devices</em> to avoid the confusion surrounding the fact that a character device for a piece of block-based hardware will typically require programs to read and write aligned blocks.</p>
<h4 id="Block-devices"><a href="#Block-devices" class="headerlink" title="Block devices"></a>Block devices</h4><p><em>Block special files</em> or <em>block devices</em> provide buffered access to hardware devices, and provide some abstraction from their specifics.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-5" target="_blank" rel="noopener">[5]</a> Unlike character devices, block devices will always allow the programmer to read or write a block of any size (including single characters/bytes) and any alignment. The downside is that because block devices are buffered, the programmer does not know how long it will take before written data is passed from the kernelâ€™s buffers to the actual device, or indeed in what order two separate writes will arrive at the physical device. Additionally, if the same hardware exposes both character and block devices, there is a risk of data corruption due to clients using the character device being unaware of changes made in the buffers of the block device.</p>
<p>å—ç‰¹æ®Šæ–‡ä»¶/å—è®¾å¤‡æä¾›äº†å¸¦ç¼“å†²çš„ç¡¬ä»¶è®¾å¤‡è®¿é—®. åŒæ—¶è¿˜æä¾›äº†ä¸€äº›æŠ½è±¡. ä¸å­—ç¬¦è®¾å¤‡ä¸åŒçš„æ˜¯, å—è®¾å¤‡æ€»æ˜¯å…è®¸ç¨‹åºè¯»å–/å†™å…¥ä»»æ„å¤§å°ä»»æ„å¯¹å…¶çš„å— ( è¿™ä¸å‘ğŸ‘¨ğŸâ€¦ è¿™ä¸æ˜¯åº”è¯¥æ˜¯ä¸Šé¢é‚£ç§çš„å®šä¹‰ä¹ˆ, æ‰€ä»¥è¯´, å†å²é”™è¯¯å•Šâ€¦ ). å› ä¸ºå—è®¾å¤‡æ˜¯å¸¦ç¼“å†²çš„, ä¸çŸ¥ä½•æ—¶æ•°æ®ä¼šè¢«å†™å…¥. ä¹Ÿä¸çŸ¥å¤šä¸ªä¸åŒçš„å†™å…¥è€…è°å…ˆå†™å…¥. </p>
<p>Most systems create both block and character devices to represent hardware like hard disks. FreeBSD and Linux notably do not; the former has removed support for block devices,<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-6" target="_blank" rel="noopener">[6]</a> while the latter creates only block devices. In Linux, to get a character device for a disk one must use the â€œrawâ€ driver, though one can get the same effect as opening a character device by opening the block device with the Linux-specific <code>O_DIRECT</code> flag.</p>
<p>linux ä¸­å¯ä»¥é€šè¿‡æ‰“å¼€å—è®¾å¤‡æ—¶æŒ‡å®š O_DIRECT æ ‡è¯†æ¥æ¨¡æ‹Ÿå­—ç¬¦è®¾å¤‡.</p>
<h4 id="Pseudo-devices"><a href="#Pseudo-devices" class="headerlink" title="Pseudo-devices"></a>Pseudo-devices</h4><p>Device nodes on Unix-like systems do not necessarily have to correspond to <a href="https://en.wikipedia.org/wiki/Physical_device" target="_blank" rel="noopener">physical devices</a>. Nodes that lack this correspondence form the group of <em>pseudo-devices</em>. They provide various functions handled by the operating system. Some of the most commonly used (character-based) pseudo-devices include:</p>
<p>ç±» Unix ç³»ç»Ÿçš„è®¾å¤‡èŠ‚ç‚¹ä¸å¿…ç¬¦åˆç‰©ç†è®¾å¤‡, ç¼ºå¤±è¿™æ ·æ¡ä»¶çš„è®¾å¤‡ç»„æˆäº†ä¼ªè®¾å¤‡. å®ƒä»¬æä¾›äº†ç”±æ“ä½œç³»ç»Ÿç®¡ç†çš„å„ç§åŠŸèƒ½. </p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/null" target="_blank" rel="noopener">/dev/null</a> â€“ accepts and discards all input written to it; provides an <a href="https://en.wikipedia.org/wiki/End-of-file" target="_blank" rel="noopener">end-of-file</a> indication when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/zero" target="_blank" rel="noopener">/dev/zero</a> â€“ accepts and discards all input written to it; produces a continuous stream of <a href="https://en.wikipedia.org/wiki/Null_character" target="_blank" rel="noopener">null characters</a> (zero-value bytes) as output when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/full" target="_blank" rel="noopener">/dev/full</a> â€“ produces a continuous stream of null characters (zero-value bytes) as output when read from, and generates an <a href="https://en.wikipedia.org/wiki/Errno.h" target="_blank" rel="noopener">ENOSPC</a> (â€œdisk fullâ€) error when attempting to write to it.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/random" target="_blank" rel="noopener">/dev/random</a> â€“ produces bytes generated by the kernelâ€™s <a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator" target="_blank" rel="noopener">cryptographically secure pseudorandom number generator</a>. Its exact behavior varies by implementation, and sometimes variants such as /dev/urandom or /dev/arandom are also provided.</li>
</ul>
<p>Additionally, BSD-specific pseudo-devices with an <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a> interface may also include:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/pf" target="_blank" rel="noopener">/dev/pf</a> â€“ allows userland processes to control <a href="https://en.wikipedia.org/wiki/PF_(firewall)" target="_blank" rel="noopener">PF</a> through an ioctl interface.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/bio" target="_blank" rel="noopener">/dev/bio</a> â€“ provides ioctl access to devices otherwise not found as /dev nodes, used by <a href="https://en.wikipedia.org/wiki/Bioctl" target="_blank" rel="noopener">bioctl</a> to implement <a href="https://en.wikipedia.org/wiki/RAID" target="_blank" rel="noopener">RAID</a> management in <a href="https://en.wikipedia.org/wiki/OpenBSD" target="_blank" rel="noopener">OpenBSD</a> and <a href="https://en.wikipedia.org/wiki/NetBSD" target="_blank" rel="noopener">NetBSD</a>.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/sysmon" target="_blank" rel="noopener">/dev/sysmon</a> â€“ used by NetBSDâ€™s <a href="https://en.wikipedia.org/wiki/Envsys" target="_blank" rel="noopener">sysmon_envsys</a> framework for <a href="https://en.wikipedia.org/wiki/System_monitor" target="_blank" rel="noopener">hardware monitoring</a>, accessed in the userland through <a href="https://en.wikipedia.org/wiki/Proplib(3)" target="_blank" rel="noopener">proplib(3)</a> by the envstat utility.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-envstat-7" target="_blank" rel="noopener">[7]</a></li>
</ul>
<p>(PS: å½“æˆ‘çœ‹åˆ° /dev/full çš„æ—¶å€™, çªç„¶æœ‰äº† ( â€µâ–½â€²)ÏˆğŸ˜ˆ æƒ³æ³•, /dev/null æ˜¯ç©ºæ–‡ä»¶, ç»å¸¸ç”¨äºæ¸…ç©ºæ–‡ä»¶, æ¯”å¦‚ â€œcat /dev/null &gt; fileâ€. é‚£ä¹ˆ full å‘¢? é‚£å½“ç„¶æ˜¯æ¥å¡«å……æ–‡ä»¶çš„å§? æ¬¸ æ˜¯ä¸æ˜¯èƒ½å’ŒæŸä¸ªä¸œè¥¿è”ç³»åœ¨ä¸€èµ·? æ˜¯çš„, åˆ åº“ğŸ˜±â€¦ å¦‚æœæˆ‘æŠŠä¸œè¥¿åˆ äº†ä¹‹å, å†ä½¿ç”¨è¿™ä¸ªä¸œè¥¿æ¥å¡«å……æ— ç”¨æ•°æ®, é‚£ä¹ˆæ˜¯å¦æ„å‘³ç€å¦‚æœæˆ‘æŠŠç£ç›˜å¼„æ»¡, è‡³å°‘é€šè¿‡ç£ç›˜è‡ªèº«æ¢å¤æ•°æ®çš„æ–¹æ³•æ— æ³•ä½¿ç”¨äº†å‘¢? </p>
<p>å¯¹æ­¤æˆ‘è¿›è¡Œäº†å°æµ‹è¯•(å½“ç„¶åœ¨æˆ‘çš„ä¸»æœºä¸Šâ€¦), å®ƒé¦–å…ˆä¼¼ä¹å—æœ€å¤§æ–‡ä»¶å¤§å°é™åˆ¶, å¯ä»¥é€šè¿‡ â€˜getconf FILESIZEBITSâ€™ è·å¾—. è·å¾—çš„å•ä½å› è¯¥æ˜¯ä»¥ GB è®¡ç®—çš„. æˆ‘ä½¿ç”¨çš„ä¸»æœºæ˜¯ 64GB, å‡è®¾ç£ç›˜æ˜¯ 1TB, é‚£ä¹ˆè‡³å°‘éœ€è¦ 20 ä¸ªå¹¶å‘çš„æŒ‡ä»¤æ‰èƒ½å¡«æ»¡, ä¼¼ä¹ä¸å¤ªéš¾ğŸ˜Š. å¥½äº†, å°±å…ˆç ”ç©¶åˆ°è¿™é‡Œ)</p>
<h3 id="å…³äº-TTY"><a href="#å…³äº-TTY" class="headerlink" title="å…³äº TTY"></a>å…³äº TTY</h3><p>from <a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">document</a> </p>
<h4 id="The-use-cases"><a href="#The-use-cases" class="headerlink" title="The use cases"></a>The use cases</h4><p><img src="http://www.linusakesson.net/programming/tty/case1.png" alt="Diagram"></p>
<p>A user types at a terminal (a physical teletype). This terminal is connected through a pair of wires to a <em>UART</em> (Universal Asynchronous Receiver and Transmitter) on the computer. The operating system contains a <em>UART driver</em> which manages the physical transmission of bytes, including parity checks and flow control. In a naive system, the UART driver would then deliver the incoming bytes directly to some application process. But such an approach would lack the following essential features:</p>
<p>ç”¨æˆ·åœ¨ç»ˆç«¯(ä¸€ä¸ªç‰©ç†ç”µä¼ æ‰“å­—æœº)è¾“å…¥. ç»ˆç«¯å’Œ UART(é€šç”¨å¼‚æ­¥æ¥æ”¶ä¼ é€’)é©±åŠ¨(ç®¡ç†ç‰©ç†å­—èŠ‚ä¼ è¾“, åŒ…æ‹¬ parity æ£€æµ‹å’Œæµæ§åˆ¶) ç”±ä¸€å¯¹ç”µçº¿è¿æ¥. åœ¨åŸå§‹çš„ç³»ç»Ÿä¸­, UART ä¼šç›´æ¥å°†è¾“å…¥è¾“å…¥é€’é€åˆ°åº”ç”¨ç¨‹åºä¸­. è¿™ä¼šç¼ºå¤±ä¸€äº›é‡è¦çš„ç‰¹æ€§.</p>
<p><strong>Line editing.</strong> Most users make mistakes while typing, so a backspace key is often useful. This could of course be implemented by the applications themselves, but in accordance with the UNIX design philosophy, applications should be kept as simple as possible. So as a convenience, the operating system provides an editing buffer and some rudimentary editing commands (backspace, erase word, clear line, reprint), which are enabled by default inside the <em>line discipline</em>. Advanced applications may disable these features by putting the line discipline in <em>raw</em> mode instead of the default <em>cooked</em> (or <em>canonical</em>) mode. Most interactive applications (editors, mail user agents, shells, all programs relying on <code>curses</code> or <code>readline</code>) run in raw mode, and handle all the line editing commands themselves. The line discipline also contains options for character echoing and automatic conversion between carriage returns and linefeeds. Think of it as a primitive kernel-level <code>sed(1)</code>, if you like.</p>
<p>è¾“å…¥æ•°æ®é”™è¯¯æ—¶, ç»å¸¸éœ€è¦ä½¿ç”¨ backspace é”®. è¿™å½“ç„¶å¯ä»¥ç”±åº”ç”¨è‡ªèº«å®ç°. ä½†æ˜¯æ ¹æ® UNIX è®¾è®¡çš„ç†å¿µ, åº”ç”¨åº”è¯¥å°½å¯èƒ½ç®€æ´. æ‰€ä»¥ä¸ºäº†ç®€ä¾¿èµ·è§, æ“ä½œç³»ç»Ÿæä¾›äº†ç¼–è¾‘ç¼“å†²å’Œä¸€äº›åŸºæœ¬çš„ç¼–è¾‘å‘½ä»¤(backspace, ease word, clear line, reprint) åœ¨ line discipline ä¸­é»˜è®¤å¯ç”¨. å…¶ä»–é«˜çº§åº”ç”¨å¯èƒ½é€šè¿‡å°†å…¶ç½®äºåŸå§‹æ¨¡å¼å–æ¶ˆè¿™äº›ç‰¹æ€§. å¤§å¤šäº¤äº’åº”ç”¨(ç¼–è¾‘å™¨, ç”¨æˆ·é‚®ä»¶ä»£ç†, shell, æ‰€æœ‰ä¾èµ–äº curses/ readline çš„åº”ç”¨ç¨‹åº) è¿è¡ŒäºåŸå§‹æ¨¡å¼. è‡ªè¡Œç®¡ç†è¡Œç¼–è¾‘å‘½ä»¤. line discipline è¿˜åŒ…å«å­—ç¬¦å›æ˜¾å’Œè‡ªåŠ¨è½¬æ¢å›è½¦å’Œæ¢è¡Œ. </p>
<p><strong>Session management.</strong> The user probably wants to run several programs simultaneously, and interact with them one at a time. If a program goes into an endless loop, the user may want to kill it or suspend it. Programs that are started in the background should be able to execute until they try to write to the terminal, at which point they should be suspended. Likewise, user input should be directed to the foreground program only. The operating system implements these features in the <em>TTY driver</em> (<code>drivers/char/tty_io.c</code>).</p>
<p>ç”¨æˆ·å½“ç„¶å¸Œæœ›åŒæ—¶è¿è¡Œå¤šä¸ªç¨‹åºå¹¶å¯ä»¥ä¸å…¶äº¤äº’. å¦‚æœç¨‹åºé™·å…¥æ­»å¾ªç¯. ç”¨æˆ·å¸Œæœ›èƒ½æš‚åœ/å…³é—­å®ƒ. ç¨‹åºåœ¨è¿›å…¥åå°ååº”å½“ä¾æ—§èƒ½è¿è¡Œ, ç›´åˆ°å®ƒå°è¯•å‘ç»ˆç«¯å†™å…¥. ç”¨æˆ·è¾“å…¥åº”å½“ä»…ç›´æ¥å‘é€ç»™å‰ç«¯ç¨‹åº. æ“ä½œç³»ç»Ÿå°†è¿™äº›ç‰¹æ€§å®ç°åœ¨äº† TTY é©±åŠ¨ä¸­.</p>
<p>An operating system process is â€œaliveâ€ (has an <em>execution context</em>), which means that it can perform actions. The TTY driver is not alive; in object oriented terminology, the TTY driver is a passive object. It has some data fields and some methods, but the only way it can actually do something is when one of its methods gets called from the context of a process or a kernel interrupt handler. The line discipline is likewise a passive entity.</p>
<p>ä¸€ä¸ªç¨‹åºæ˜¯â€™æ´»è·ƒçš„â€™ æ„å‘³ç€å®ƒèƒ½æ‰§è¡Œæ“ä½œ. TTY é©±åŠ¨å¹¶ä¸æ˜¯, å®ƒæ˜¯è¢«åŠ¨å¯¹è±¡. å®ƒæ‹¥æœ‰ä¸€äº›æ•°æ®å­—æ®µå’Œæ–¹æ³•. ä»…å½“å…¶æ–¹æ³•è¢«è¿›ç¨‹/å†…æ ¸ä¸­å¤„ç†ç¨‹åºçš„ä¸Šä¸‹æ–‡è°ƒç”¨çš„æ—¶å€™æ‰èƒ½åšäº‹. (å°±åƒä¸€ä¸ªåº“ä¸€æ ·)</p>
<p>Together, a particular triplet of UART driver, line discipline instance and TTY driver may be referred to as a <em>TTY device</em>, or sometimes just TTY. A user process can affect the behaviour of any TTY device by manipulating the corresponding device file under <code>/dev</code>. Write permissions to the device file are required, so when a user logs in on a particular TTY, that user must become the owner of the device file. This is traditionally done by the <code>login(1)</code> program, which runs with root privileges.</p>
<p>åˆåœ¨ä¸€èµ·, ä¸€ä¸ªç‰¹å®šçš„ä¸‰é‡: UART é©±åŠ¨, line discipline å®ä¾‹, å’Œ TTY é©±åŠ¨. ç»Ÿç§°ä¸º TTY é©±åŠ¨. æˆ–è€…æœ‰æ—¶ç›´æ¥ç§°ä¸º TTY. ç”¨æˆ·è¿›ç¨‹å¯ä»¥é€šè¿‡å¯¹ /dev ä¸‹çš„è®¾å¤‡æ–‡ä»¶çš„ç®¡ç†æ¥æ”¹å˜ä»»æ„ TTY è®¾å¤‡çš„è¡Œä¸º. è¿™éœ€è¦å¯¹äºè®¾å¤‡æ–‡ä»¶çš„å†™æƒé™, æ‰€ä»¥å½“ç”¨æˆ·ç™»å½•ç‰¹å®šçš„ TTY æ—¶, ç”¨æˆ·å¿…é¡»ç§°ä¸ºè¿™ä¸ªè®¾å¤‡æ–‡ä»¶çš„æ‰€æœ‰è€…. è¿™é€šå¸¸ç”±è¿è¡Œæ—¶å¸¦æœ‰ root æƒé™ login ç¨‹åºæ¥å®ç°.</p>
<p>The physical line in the previous diagram could of course be a long-distance phone line:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case2.png" alt="Diagram"></p>
<p>This does not change much, except that the system now has to handle a modem hangup situation as well.</p>
<p>Letâ€™s move on to a typical desktop system. This is how the Linux console works:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case3.png" alt="Diagram"></p>
<p>The TTY driver and line discipline behave just like in the previous examples, but there is no UART or physical terminal involved anymore. Instead, a video terminal (a complex state machine including a <em>frame buffer</em> of characters and graphical character attributes) is emulated in software, and rendered to a VGA display.</p>
<p>å½“æ•°æ®è¾“å…¥æ—¶, ä¼šé€šè¿‡ä¸€ç³»åˆ—çš„äº¤æ¢æœ€ç»ˆç”± TTY å‘ç»™è¿›ç¨‹, è€Œå½“æ•°æ®è¾“å‡ºæ—¶, ä¼šåŸè·¯ (ä½†ä» terminal emulator å¼€å§‹åˆ†å¼€) å‘é€ç»™è¾“å‡ºè®¾å¤‡ (æ˜¾ç¤ºå±â€¦)</p>
<p>The console subsystem is somewhat rigid. Things get more flexible (and abstract) if we move the terminal emulation into userland. This is how <code>xterm(1)</code> and its clones work:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case4.png" alt="Diagram"></p>
<p>To facilitate moving the terminal emulation into userland, while still keeping the TTY subsystem (session management and line discipline) intact, the <em>pseudo terminal</em> or <em>pty</em> was invented. And as you may have guessed, things get even more complicated when you start running pseudo terminals inside pseudo terminals, Ã  la <code>screen(1)</code> or <code>ssh(1)</code>.</p>
<p>è¿™é‡Œæœ‰ä¸»ä» TTY, ä¼ªç»ˆç«¯. è¿™é‡Œä½œè€…æåˆ°äº† ssh. æˆ‘æŸ¥äº†ä¸€ä¸‹ PTY ç›¸å…³çš„ä¸œè¥¿, å‘ç°äº† å…³äº ssh â€˜-tâ€™ å’Œ â€˜-Tâ€™ é€‰é¡¹çš„è¯´æ˜. å°±æœ‰äº† <a href="https://security.stackexchange.com/questions/107933/what-exactly-does-ssh-t-userdomain-verify-do" target="_blank" rel="noopener">stackExchange</a> å’Œ <a href="https://stackoverflow.com/questions/42505339/why-use-t-with-ssh" target="_blank" rel="noopener">stackOverflow</a> çš„è§£é‡Š. </p>
<p>-T: è¿™ä¸ªé€‰é¡¹ä¸ç”Ÿäº§ PTY, ç»ˆç«¯è¿è¡Œäºæœ¬åœ°, è¿™æˆ–è®¸å°±æ˜¯ PTY(pseudo) ä¸ºä»€ä¹ˆå« PTY çš„åŸå› . github çš„ ssh ä¹Ÿæ˜¯å¸¦ -T é€‰é¡¹çš„, å› ä¸ºå¦‚æœä¸ºæ¯ä¸ªç”¨æˆ·æä¾›ä¸€ä¸ª tty çš„è¯â€¦ </p>
<p>Now letâ€™s take a step back and see how all of this fits into the process model.</p>
<h4 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h4><p>A Linux process can be in one of the following states:</p>
<p><img src="http://www.linusakesson.net/programming/tty/linuxprocess.png" alt="Process states"></p>
<table>
<thead>
<tr>
<th>R</th>
<th>Running or runnable (on run queue)</th>
</tr>
</thead>
<tbody><tr>
<td>D</td>
<td>Uninterruptible sleep (waiting for some event)</td>
</tr>
<tr>
<td>S</td>
<td>Interruptible sleep (waiting for some event or signal)</td>
</tr>
<tr>
<td>T</td>
<td>Stopped, either by a job control signal or because it is being traced by a debugger.</td>
</tr>
<tr>
<td>Z</td>
<td>Zombie process, terminated but not yet reaped by its parent.</td>
</tr>
</tbody></table>
<p>(PS: çœ‹åˆ°è¿™é‡Œçš„æ—¶å€™, æˆ‘æœ‰ç‚¹é—å¿˜ ps çš„ç»†èŠ‚äº†, å»çœ‹äº†çœ‹ ps çš„è¯´æ˜. ç„¶åæ˜ç™½äº†ä¹‹å‰æœ‰æ¬¡é¢è¯•çš„äº‹æƒ…äº†. å½“æ—¶æˆ‘è¿˜å¾ˆå¥½å¥‡ä¸ºä»€ä¹ˆä¼šæœ‰äººåœ¨æˆ‘å›ç­”äº†æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹çš„å‘½ä»¤è¡Œåå†é—®æˆ‘ä¸€æ¬¡. æˆ‘å½“æ—¶ç­”çš„æ—¶ ps -axu (-aux?) éƒ½æ˜¯ä¸å¯¹çš„. è€Œåè€…æ›´æ˜¯å¤§é”™ç‰¹é”™. æˆ‘æœ€åˆéœ€è¦è¿™æ¡æŒ‡ä»¤æ—¶, ä»…ä»…åªæ˜¯åœ¨ç½‘ä¸ŠæŸ¥äº†ä¸‹(è¯¯å¯¼æˆ‘, å¯æ¶å•Šâ€¦) ç„¶åå°±å…¨ä¿¡äº†, ä¹‹åå°±åªæ˜¯ç„äº†ä¸€çœ¼ man æ‰‹å†Œ. å¹¶æœªè¿‡å¤šåœ¨æ„. è¿™æ€åº¦éå¸¸æœ‰é—®é¢˜, åŒ…æ‹¬ä¹‹å‰çš„ä¸€ä¸ª C++ ç©ºå¯¹è±¡, æˆ‘ç»™å®ƒèµ‹å€¼æ—¶ä¾æ—§ä¼šå‡ºé”™, æˆ‘è¿˜å¥½å¥‡ä¸ºä»€ä¹ˆ, å› ä¸ºæˆ‘æ ¹æœ¬æ²¡ä»”ç»†æƒ³è¿‡ææ„çš„é—®é¢˜. ä½œä¸ºä¸€ä¸ªæŠ€æœ¯äººå‘˜, æˆ‘æ„Ÿè§‰å¾ˆç¾æ„§. åŒ…æ‹¬è¿™æ¬¡çš„ç¬”è®°, å¦‚æœä¸æ˜¯å¤„äºå¥½å¥‡, ä¹Ÿä¸ä¼šç‰µæ‰¯å‡ºè¿™ä¹ˆå¤šä¸œè¥¿æ¥, å­¦ä¹ æ˜¯ä¸€ä¸ªè¶Šå­¦è¶Šå°‘çš„è¿‡ç¨‹. æˆ‘åº”å½“æ—¶åˆ»è¿™æ ·è­¦é†’è‡ªå·±.)</p>
<p>By running <code>ps l</code>, you can see which processes are running, and which are sleeping. If a process is sleeping, the <code>WCHAN</code> column (â€œwait channelâ€, the name of the wait queue) will tell you what kernel event the process is waiting for.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ps l</span><br><span class="line">F   UID   PID  PPID PRI  NI    VSZ   RSS WCHAN  STAT TTY        TIME COMMAND</span><br><span class="line">0   500  5942  5928  15   0  12916  1460 wait   Ss   pts&#x2F;14     0:00 -&#x2F;bin&#x2F;bash</span><br><span class="line">0   500 12235  5942  15   0  21004  3572 wait   S+   pts&#x2F;14     0:01 vim index.php</span><br><span class="line">0   500 12580 12235  15   0   8080  1440 wait   S+   pts&#x2F;14     0:00 &#x2F;bin&#x2F;bash -c (ps l) &gt;&#x2F;tmp&#x2F;v727757&#x2F;1 2&gt;&amp;1</span><br><span class="line">0   500 12581 12580  15   0   4412   824 -      R+   pts&#x2F;14     0:00 ps l</span><br></pre></td></tr></table></figure>

<p>The â€œ<code>wait</code>â€œ wait queue corresponds to the <code>wait(2)</code> syscall, so these processes will be moved to the running state whenever thereâ€™s a state change in one of their child processes. There are two sleeping states: Interruptible sleep and uninterruptible sleep. Interruptible sleep (the most common case) means that while the process is part of a wait queue, it may actually also be moved to the running state when a signal is sent to it. If you look inside the kernel source code, you will find that any kernel code which is waiting for an event must check if a signal is pending after schedule() returns, and abort the syscall in that case.</p>
<p>æœ‰å¯ä¸­æ–­å’Œä¸å¯ä¸­æ–­ç¡çœ . ä¸­æ–­ç¡çœ æ„å‘³ç€å¦‚æœè¿›ç¨‹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­, é‚£ä¹ˆå…¶å¯ä»¥åœ¨ä¿¡å·å‘é€ç»™å®ƒæ—¶æ›´æ–°ä¸ºè¿è¡Œæ€. ä»»ä½•ç­‰å¾…äº‹ä»¶çš„å†…æ ¸ä»£ç éƒ½å¿…é¡»åœ¨è°ƒåº¦è¿”å›åæ£€æŸ¥ä¿¡å·æŒ‚èµ·.</p>
<p>In the <code>ps</code> listing above, the <code>STAT</code> column displays the current state of each process. The same column may also contain one or more attributes, or flags:</p>
<table>
<thead>
<tr>
<th>s</th>
<th>This process is a session leader.</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>This process is part of a foreground process group.</td>
</tr>
</tbody></table>
<p>These attributes are used for job control.</p>
<h3 id="Jobs-and-sessions"><a href="#Jobs-and-sessions" class="headerlink" title="Jobs and sessions"></a>Jobs and sessions</h3><p>Job control is what happens when you press <code>^Z</code> to suspend a program, or when you start a program in the background using <code>&amp;</code>. A job is the same as a process group. Internal shell commands like <code>jobs</code>, <code>fg</code> and <code>bg</code> can be used to manipulate the existing jobs within a <em>session</em>. Each session is managed by a <em>session leader</em>, the shell, which is cooperating tightly with the kernel using a complex protocol of signals and system calls.</p>
<p>The following example illustrates the relationship between processes, jobs and sessions:</p>
<p>å·¥ä½œç®¡ç†åœ¨æŒ‰ä¸‹ C+Z æŒ‚èµ·ç¨‹åºæˆ–ä½¿ç”¨ &amp; ä½¿ç¨‹åºåå°æ‰§è¡Œæ—¶å‘ç”Ÿ. ä¸€ä¸ªå·¥ä½œå°±æ˜¯ä¸€ä¸ªç»è¿›ç¨‹ç»„. linux æä¾›äº† jobs, fg, bg åœ¨ä¼šè¯ä¸­ç®¡ç†ç°æœ‰å·¥ä½œ. æ¯ä¸ªç»˜ç”»éƒ½ç”±ä¸€ä¸ªä¼šè¯ leader ç®¡ç†. shell , å’Œå†…æ ¸ç»ç”±å¤æ‚çš„ä¿¡å·å’Œç³»ç»Ÿè°ƒç”¨åè®®å¯†åˆ‡åˆä½œ. </p>
<p>(PS: å…³äº <a href="https://en.wikipedia.org/wiki/Process_group" target="_blank" rel="noopener">process group</a> , ç®€å•æ¥è¯´å°±æ˜¯ä¸€ç»„è¿›ç¨‹, è€Œä¼šè¯æ˜¯ä¸€ç»„è¿›ç¨‹ç»„)</p>
<h4 id="The-following-shell-interactionsâ€¦"><a href="#The-following-shell-interactionsâ€¦" class="headerlink" title="The following shell interactionsâ€¦"></a>The following shell interactionsâ€¦</h4><p><img src="http://www.linusakesson.net/programming/tty/exampleterm.png" alt="Screenshot"></p>
<h4 id="â€¦correspond-to-these-processesâ€¦"><a href="#â€¦correspond-to-these-processesâ€¦" class="headerlink" title="â€¦correspond to these processesâ€¦"></a>â€¦correspond to these processesâ€¦</h4><p><img src="http://www.linusakesson.net/programming/tty/examplediagram.png" alt="Table"></p>
<h4 id="â€¦and-these-kernel-structures"><a href="#â€¦and-these-kernel-structures" class="headerlink" title="â€¦and these kernel structures."></a>â€¦and these kernel structures.</h4><ul>
<li><p>TTY Driver (/dev/pts/0).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Size: 45x13</span><br><span class="line">  Controlling process group: (101)</span><br><span class="line">Foreground process group: (103)</span><br><span class="line">  UART configuration (ignored, since this is an xterm):</span><br><span class="line">    Baud rate, parity, word length and much more.</span><br><span class="line">  Line discipline configuration:</span><br><span class="line">    cooked&#x2F;raw mode, linefeed correction,</span><br><span class="line">    meaning of interrupt characters etc.</span><br><span class="line">  Line discipline state:</span><br><span class="line">    edit buffer (currently empty),</span><br><span class="line">    cursor position within buffer etc.</span><br></pre></td></tr></table></figure>
</li>
<li><p>pipe0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Readable end (connected to PID 104 as file descriptor 0)</span><br><span class="line">Writable end (connected to PID 103 as file descriptor 1)</span><br><span class="line">Buffer</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The basic idea is that every pipeline is a job, because every process in a pipeline should be manipulated (stopped, resumed, killed) simultaneously. Thatâ€™s why <code>kill(2)</code> allows you to send signals to entire process groups. By default, <code>fork(2)</code> places a newly created child process in the same process group as its parent, so that e.g. a <code>^C</code> from the keyboard will affect both parent and child. But the shell, as part of its session leader duties, creates a new process group every time it launches a pipeline.</p>
<p>åŸºç¡€çš„æƒ³æ³•æ˜¯æ¯ä¸ªç®¡é“éƒ½æ˜¯ä¸€ä¸ªå·¥ä½œ. å› ä¸ºæ¯ä¸ªç®¡é“ä¸­çš„è¿›ç¨‹éƒ½éœ€è¦è¢«åŒæ—¶ç®¡ç†. é»˜è®¤åœ¨ä½¿ç”¨ fork æ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°å­ç¨‹åºåˆ°åŒæ ·çš„è¿›ç¨‹ç»„ä¸­, å°±å’Œå®ƒçš„çˆ¶è¿›ç¨‹ä¸€æ ·. æ‰€ä»¥ C+C ä¼šå½±å“çˆ¶å­è¿›ç¨‹, ä½†æ˜¯ shell ä½œä¸ºä¼šè¯ leader, å½“åˆ›å»ºä¸€ä¸ªæ–°çš„ç®¡é“çš„æ—¶å€™, å°†ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„.</p>
<p>The TTY driver keeps track of the foreground process group id, but only in a passive way. The session leader has to update this information explicitly when necessary. Similarly, the TTY driver keeps track of the size of the connected terminal, but this information has to be updated explicitly, by the terminal emulator or even by the user.</p>
<p>TTY è¢«åŠ¨æŒç»­è·Ÿè¸ªå‰å°ç¨‹åºç»„ id. ä¼šè¯ leader å¿…é¡»åœ¨å¿…è¦æ—¶æ›´æ–°è¿™äº›ä¿¡æ¯(è°ƒç”¨?). åŒæ ·çš„, TTY é©±åŠ¨æŒç»­è·Ÿè¸ªå·²è¿æ¥ç»ˆç«¯å¤§å°.</p>
<p>As you can see in the diagram above, several processes have <code>/dev/pts/0</code> attached to their standard input. But only the foreground job (the <code>ls | sort</code> pipeline) will receive input from the TTY. Likewise, only the foreground job will be allowed to write to the TTY device (in the default configuration). If the cat process were to attempt to write to the TTY, the kernel would suspend it using a signal.</p>
<p>(æˆ‘ä¹Ÿæ²¡æƒ³åˆ°å› ä¸ºä¸€ä¸ªå¥½å¥‡èƒ½ç‰µæ‰¯è¿™äº›ä¸œè¥¿å‡ºæ¥â€¦)</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/06/leetcode/NextGreaterElementII/" rel="prev" title="leetcode/NextGreaterElementII">
      <i class="fa fa-chevron-left"></i> leetcode/NextGreaterElementII
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/11/other/aboutProcess/" rel="next" title="other/aboutProcess">
      other/aboutProcess <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#å…³äº-backspace-æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†"><span class="nav-number">1.</span> <span class="nav-text">å…³äº backspace æ˜¯å¯†ç çš„ä¸€éƒ¨åˆ†</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#solution"><span class="nav-number">1.1.</span> <span class="nav-text">solution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#other"><span class="nav-number">1.2.</span> <span class="nav-text">other</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å…³äº-line-discipline"><span class="nav-number">1.2.1.</span> <span class="nav-text">å…³äº line discipline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…³äº-character-device"><span class="nav-number">1.2.2.</span> <span class="nav-text">å…³äº character device</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Character-devices"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">Character devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Block-devices"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">Block devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pseudo-devices"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">Pseudo-devices</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…³äº-TTY"><span class="nav-number">1.2.3.</span> <span class="nav-text">å…³äº TTY</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-use-cases"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">The use cases</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Processes"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">Processes</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jobs-and-sessions"><span class="nav-number">1.2.4.</span> <span class="nav-text">Jobs and sessions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-following-shell-interactionsâ€¦"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">The following shell interactionsâ€¦</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#â€¦correspond-to-these-processesâ€¦"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">â€¦correspond to these processesâ€¦</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#â€¦and-these-kernel-structures"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">â€¦and these kernel structures.</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">cas</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">102</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cas</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme â€“ <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
