<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    hostname: new URL('http://yoursite.com').hostname,
    root: '/',
    scheme: 'Muse',
    version: '7.7.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    comments: {"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}
  };
</script>

  <meta name="description" content="关于 backspace 是密码的一部分在使用 hexo deploy 输入用户名&#x2F;密码, 或其他特殊需要输入密码的场合, backspace 总是被当作密码的一部分. 这可以理解, 因为这个本身就是一种按键, 只不过大多数时候被赋予了删除字符的功能. 处于好奇, 搜索了一下相关资料 Backspace is traded as part of password when I use ‘hexo’">
<meta property="og:type" content="article">
<meta property="og:title" content="other&#x2F;somethingAboutBackspace">
<meta property="og:url" content="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/index.html">
<meta property="og:site_name" content="cas&#39;s website">
<meta property="og:description" content="关于 backspace 是密码的一部分在使用 hexo deploy 输入用户名&#x2F;密码, 或其他特殊需要输入密码的场合, backspace 总是被当作密码的一部分. 这可以理解, 因为这个本身就是一种按键, 只不过大多数时候被赋予了删除字符的功能. 处于好奇, 搜索了一下相关资料 Backspace is traded as part of password when I use ‘hexo’">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case1.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case2.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case3.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/case4.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/linuxprocess.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/exampleterm.png">
<meta property="og:image" content="http://www.linusakesson.net/programming/tty/examplediagram.png">
<meta property="article:published_time" content="2020-03-10T09:04:42.000Z">
<meta property="article:modified_time" content="2020-03-10T09:04:42.000Z">
<meta property="article:author" content="cas">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://www.linusakesson.net/programming/tty/case1.png">

<link rel="canonical" href="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true
  };
</script>

  <title>other/somethingAboutBackspace | cas's website</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">cas's website</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">casyup.me@outlook.com</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="Searching..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="en">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/03/10/other/somethingAboutBackspace/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="cas">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="cas's website">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          other/somethingAboutBackspace
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2020-03-10 17:04:42" itemprop="dateCreated datePublished" datetime="2020-03-10T17:04:42+08:00">2020-03-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="关于-backspace-是密码的一部分"><a href="#关于-backspace-是密码的一部分" class="headerlink" title="关于 backspace 是密码的一部分"></a>关于 backspace 是密码的一部分</h1><p>在使用 hexo deploy 输入用户名/密码, 或其他特殊需要输入密码的场合, backspace 总是被当作密码的一部分.</p>
<p>这可以理解, 因为这个本身就是一种按键, 只不过大多数时候被赋予了删除字符的功能.</p>
<p>处于好奇, 搜索了一下相关资料</p>
<p>Backspace is traded as part of password when I use ‘hexo’ and other spacial situation that I need to enter password.</p>
<p>I can understand this because ‘backspace’ is also a normal key that traded as a function in some special situation .</p>
<a id="more"></a>



<h2 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h2><p>from <a href="https://unix.stackexchange.com/questions/50493/clear-erase-a-mistyped-invisible-password-on-a-shell-terminal-in-linux" target="_blank" rel="noopener">stackExchange</a></p>
<p>Characters like Ctrl+L are handled by the <strong>application</strong>. In the case of entering input into the shell, like <code>bash</code>, it clears the screen. Some applications, like <code>emacs</code>, use it to redraw the screen and/or recenter the cursor.</p>
<p>C+L 都被应用所管理. 在输入时, 比如 bash. 将会清屏. </p>
<p>Characters like Ctrl+U at a password prompt are handled by the <a href="http://en.wikipedia.org/wiki/Line_discipline" target="_blank" rel="noopener"><strong>TTY line discipline</strong></a>. They’ll work any time the input terminal is in the “canonical” line-editing mode, which is what mode your programs are in while you’re entering a password. In this mode, it’s the Linux kernel itself that is interpreting these characters. You can see what functions are assigned to which keys in the output of <code>stty -a</code>:</p>
<p>C+U被当作密码提示, 由 TTY line discipline 管理. 当输入密码, 进入行编辑模式时, 就会被其管理. linux 内核解释这些字符, 可以通过 <code>stty -a</code> 指令查看一些特殊的键被赋予的功能.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">speed 38400 baud; rows 45; columns 128; line &#x3D; 0;</span><br><span class="line">intr &#x3D; ^C; quit &#x3D; ^\; erase &#x3D; ^?; kill &#x3D; ^U; eof &#x3D; ^D; eol &#x3D; &lt;undef&gt;; eol2 &#x3D; &lt;undef&gt;; swtch &#x3D; &lt;undef&gt;; start &#x3D; ^Q; stop &#x3D; ^S;</span><br><span class="line">susp &#x3D; ^Z; rprnt &#x3D; ^R; werase &#x3D; ^W; lnext &#x3D; ^V; flush &#x3D; ^O; min &#x3D; 1; time &#x3D; 0;</span><br><span class="line">-parenb -parodd cs8 -hupcl -cstopb cread -clocal -crtscts</span><br><span class="line">-ignbrk -brkint -ignpar -parmrk -inpck -istrip -inlcr -igncr icrnl ixon -ixoff -iuclc -ixany -imaxbel iutf8</span><br><span class="line">opost -olcuc -ocrnl onlcr -onocr -onlret -ofill -ofdel nl0 cr0 tab0 bs0 vt0 ff0</span><br><span class="line">isig icanon iexten echo echoe echok -echonl -noflsh -xcase -tostop -echoprt echoctl echoke</span><br></pre></td></tr></table></figure>

<p>Here, you can see that Ctrl+U is tied to <code>kill</code>, which (according to the <a href="http://linux.die.net/man/1/stty" target="_blank" rel="noopener">stty man page</a>) will “erase the current line”. You could also use <code>stty</code> to change this mapping:</p>
<p>通过 stty 的 man 手册可以查看这些指令的意义(看到里面的C+S了吧, 有时候 windows 习惯性保存带到 linux 的下场就是 ‘死机’ 📴)  (我理解 stty 中的 s 可能是 soft 的意思)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stty kill ^E   # make ctrl-e erase the line</span><br></pre></td></tr></table></figure>

<p><a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">This page</a> has a lot of great information about the TTY layer if you’re interested.</p>
<h2 id="other"><a href="#other" class="headerlink" title="other"></a>other</h2><h3 id="关于-line-discipline"><a href="#关于-line-discipline" class="headerlink" title="关于 line discipline"></a>关于 line discipline</h3><p>from <a href="">wiki</a></p>
<p>A <strong>line discipline</strong> (<strong>LDISC</strong>) is a layer in the <a href="https://en.wikipedia.org/wiki/Computer_terminal" target="_blank" rel="noopener">terminal</a> subsystem in some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-1" target="_blank" rel="noopener">[1]</a> The terminal subsystem consists of three layers: the upper layer to provide the <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">character device</a> interface, the lower hardware driver to communicate with the hardware or <a href="https://en.wikipedia.org/wiki/Pseudo_terminal" target="_blank" rel="noopener">pseudo terminal</a>, and the middle line discipline to implement behavior common to terminal devices.</p>
<p>LDISC 时一个类 UNIX 系统终端的子系统中的一层. 其完整为三层, 顶层提供一个字符设备界面. 下层硬件驱动与硬件/伪终端交互. 中层 ‘line discipline’ 实现常见的行为给终端设备(我理解这个行为可能是普通字符的回显以及特殊字符的解释)</p>
<p>The line discipline glues the low level device driver code with the high level generic interface routines (such as read(2), write(2) and <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a>(2)), and is responsible for implementing the semantics associated with the device.<a href="https://en.wikipedia.org/wiki/Line_discipline#cite_note-2" target="_blank" rel="noopener">[2]</a> The policy is separated from the device driver so that the same serial hardware driver can be used by devices that require different data handling.</p>
<p>‘line discipline’ 将底层驱动设备代码和高层泛型界面理解粘合在一起. 其实现了与设备相关的语义. 不同的设备驱动有不同的策略. 以用于同样的硬件驱动能被需要不同数据管理的设备所使用.</p>
<p>For example, the standard line discipline processes the data it receives from the hardware driver and from applications writing to the device according to the requirements of a terminal on a <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> system. On input, it handles special characters such as the interrupt character (typically <a href="https://en.wikipedia.org/wiki/Control-C" target="_blank" rel="noopener">Control-C</a>) and the erase and kill characters (typically <a href="https://en.wikipedia.org/wiki/Backspace" target="_blank" rel="noopener">backspace</a> or <a href="https://en.wikipedia.org/wiki/Delete_key" target="_blank" rel="noopener">delete</a>, and Control-U, respectively) and, on output, it replaces all the <a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> characters with a <a href="https://en.wikipedia.org/wiki/Carriage_return" target="_blank" rel="noopener">CR</a>/<a href="https://en.wikipedia.org/wiki/Linefeed" target="_blank" rel="noopener">LF</a> sequence.</p>
<p>比如: 标准 ‘line discipline’ 程序处理来自硬件驱动和引用的数据. 根据系统终端的需求写入到设备. 在输入中, 其管理如中断字符的特殊字符, 实现响应功能. 在输入中, 将换行符表现为换行.</p>
<p>Some <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> systems use <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">STREAMS</a> to implement line disciplines.</p>
<p>(这里提到了流, 关于 <a href="https://en.wikipedia.org/wiki/STREAMS" target="_blank" rel="noopener">wiki</a> 中对于 流的解释: a stream is a chain of <a href="https://en.wikipedia.org/wiki/Coroutine" target="_blank" rel="noopener">coroutines</a> that <a href="https://en.wikipedia.org/wiki/Message_passing" target="_blank" rel="noopener">pass messages</a> between a program and a device driver (or between a pair of programs). 流是两者间传递信息的协同链.)</p>
<h3 id="关于-character-device"><a href="#关于-character-device" class="headerlink" title="关于 character device"></a>关于 character device</h3><p>from <a href="https://en.wikipedia.org/wiki/Device_node#Character_devices" target="_blank" rel="noopener">wiki</a></p>
<p>In <a href="https://en.wikipedia.org/wiki/Unix-like" target="_blank" rel="noopener">Unix-like</a> <a href="https://en.wikipedia.org/wiki/Operating_systems" target="_blank" rel="noopener">operating systems</a>, a <strong>device file</strong> or <strong>special file</strong> is an <a href="https://en.wikipedia.org/wiki/Interface_(computer_science)" target="_blank" rel="noopener">interface</a> to a <a href="https://en.wikipedia.org/wiki/Device_driver" target="_blank" rel="noopener">device driver</a> that appears in a <a href="https://en.wikipedia.org/wiki/File_system" target="_blank" rel="noopener">file system</a> as if it were an ordinary <a href="https://en.wikipedia.org/wiki/Computer_file" target="_blank" rel="noopener">file</a>. </p>
<p>设备文件又称特殊文件, 是一个设备驱动的接口, 他能被当作一个普通文件一样执行.</p>
<h4 id="Character-devices"><a href="#Character-devices" class="headerlink" title="Character devices"></a>Character devices</h4><p><em>Character special files</em> or <em>character devices</em> provide unbuffered, direct access to the hardware device. They do not necessarily allow programs to read or write single characters at a time; that is up to the device in question. The character device for a hard disk, for example, will normally require that all reads and writes are aligned to block boundaries and most certainly will not allow reading a single byte.</p>
<p>字符特殊文件/字符设备提供了无缓冲, 直接访问硬件设备. 硬盘上的字符设备, 通常需要所有的读取和写入对其块边界. 不允许读取单个字节.</p>
<p>Character devices are sometimes known as <em>raw devices</em> to avoid the confusion surrounding the fact that a character device for a piece of block-based hardware will typically require programs to read and write aligned blocks.</p>
<h4 id="Block-devices"><a href="#Block-devices" class="headerlink" title="Block devices"></a>Block devices</h4><p><em>Block special files</em> or <em>block devices</em> provide buffered access to hardware devices, and provide some abstraction from their specifics.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-5" target="_blank" rel="noopener">[5]</a> Unlike character devices, block devices will always allow the programmer to read or write a block of any size (including single characters/bytes) and any alignment. The downside is that because block devices are buffered, the programmer does not know how long it will take before written data is passed from the kernel’s buffers to the actual device, or indeed in what order two separate writes will arrive at the physical device. Additionally, if the same hardware exposes both character and block devices, there is a risk of data corruption due to clients using the character device being unaware of changes made in the buffers of the block device.</p>
<p>块特殊文件/块设备提供了带缓冲的硬件设备访问. 同时还提供了一些抽象. 与字符设备不同的是, 块设备总是允许程序读取/写入任意大小任意对其的块 ( 这不坑👨🐎… 这不是应该是上面那种的定义么, 所以说, 历史错误啊… ). 因为块设备是带缓冲的, 不知何时数据会被写入. 也不知多个不同的写入者谁先写入. </p>
<p>Most systems create both block and character devices to represent hardware like hard disks. FreeBSD and Linux notably do not; the former has removed support for block devices,<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-6" target="_blank" rel="noopener">[6]</a> while the latter creates only block devices. In Linux, to get a character device for a disk one must use the “raw” driver, though one can get the same effect as opening a character device by opening the block device with the Linux-specific <code>O_DIRECT</code> flag.</p>
<p>linux 中可以通过打开块设备时指定 O_DIRECT 标识来模拟字符设备.</p>
<h4 id="Pseudo-devices"><a href="#Pseudo-devices" class="headerlink" title="Pseudo-devices"></a>Pseudo-devices</h4><p>Device nodes on Unix-like systems do not necessarily have to correspond to <a href="https://en.wikipedia.org/wiki/Physical_device" target="_blank" rel="noopener">physical devices</a>. Nodes that lack this correspondence form the group of <em>pseudo-devices</em>. They provide various functions handled by the operating system. Some of the most commonly used (character-based) pseudo-devices include:</p>
<p>类 Unix 系统的设备节点不必符合物理设备, 缺失这样条件的设备组成了伪设备. 它们提供了由操作系统管理的各种功能. </p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/null" target="_blank" rel="noopener">/dev/null</a> – accepts and discards all input written to it; provides an <a href="https://en.wikipedia.org/wiki/End-of-file" target="_blank" rel="noopener">end-of-file</a> indication when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/zero" target="_blank" rel="noopener">/dev/zero</a> – accepts and discards all input written to it; produces a continuous stream of <a href="https://en.wikipedia.org/wiki/Null_character" target="_blank" rel="noopener">null characters</a> (zero-value bytes) as output when read from.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/full" target="_blank" rel="noopener">/dev/full</a> – produces a continuous stream of null characters (zero-value bytes) as output when read from, and generates an <a href="https://en.wikipedia.org/wiki/Errno.h" target="_blank" rel="noopener">ENOSPC</a> (“disk full”) error when attempting to write to it.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/random" target="_blank" rel="noopener">/dev/random</a> – produces bytes generated by the kernel’s <a href="https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator" target="_blank" rel="noopener">cryptographically secure pseudorandom number generator</a>. Its exact behavior varies by implementation, and sometimes variants such as /dev/urandom or /dev/arandom are also provided.</li>
</ul>
<p>Additionally, BSD-specific pseudo-devices with an <a href="https://en.wikipedia.org/wiki/Ioctl" target="_blank" rel="noopener">ioctl</a> interface may also include:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki//dev/pf" target="_blank" rel="noopener">/dev/pf</a> – allows userland processes to control <a href="https://en.wikipedia.org/wiki/PF_(firewall)" target="_blank" rel="noopener">PF</a> through an ioctl interface.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/bio" target="_blank" rel="noopener">/dev/bio</a> – provides ioctl access to devices otherwise not found as /dev nodes, used by <a href="https://en.wikipedia.org/wiki/Bioctl" target="_blank" rel="noopener">bioctl</a> to implement <a href="https://en.wikipedia.org/wiki/RAID" target="_blank" rel="noopener">RAID</a> management in <a href="https://en.wikipedia.org/wiki/OpenBSD" target="_blank" rel="noopener">OpenBSD</a> and <a href="https://en.wikipedia.org/wiki/NetBSD" target="_blank" rel="noopener">NetBSD</a>.</li>
<li><a href="https://en.wikipedia.org/wiki//dev/sysmon" target="_blank" rel="noopener">/dev/sysmon</a> – used by NetBSD’s <a href="https://en.wikipedia.org/wiki/Envsys" target="_blank" rel="noopener">sysmon_envsys</a> framework for <a href="https://en.wikipedia.org/wiki/System_monitor" target="_blank" rel="noopener">hardware monitoring</a>, accessed in the userland through <a href="https://en.wikipedia.org/wiki/Proplib(3)" target="_blank" rel="noopener">proplib(3)</a> by the envstat utility.<a href="https://en.wikipedia.org/wiki/Device_file#cite_note-envstat-7" target="_blank" rel="noopener">[7]</a></li>
</ul>
<p>(PS: 当我看到 /dev/full 的时候, 突然有了 ( ‵▽′)ψ😈 想法, /dev/null 是空文件, 经常用于清空文件, 比如 “cat /dev/null &gt; file”. 那么 full 呢? 那当然是来填充文件的吧? 欸 是不是能和某个东西联系在一起? 是的, 删库😱… 如果我把东西删了之后, 再使用这个东西来填充无用数据, 那么是否意味着如果我把磁盘弄满, 至少通过磁盘自身恢复数据的方法无法使用了呢? </p>
<p>对此我进行了小测试(当然在我的主机上…), 它首先似乎受最大文件大小限制, 可以通过 ‘getconf FILESIZEBITS’ 获得. 获得的单位因该是以 GB 计算的. 我使用的主机是 64GB, 假设磁盘是 1TB, 那么至少需要 20 个并发的指令才能填满, 似乎不太难😊. 好了, 就先研究到这里)</p>
<h3 id="关于-TTY"><a href="#关于-TTY" class="headerlink" title="关于 TTY"></a>关于 TTY</h3><p>from <a href="http://www.linusakesson.net/programming/tty/index.php" target="_blank" rel="noopener">document</a> </p>
<h4 id="The-use-cases"><a href="#The-use-cases" class="headerlink" title="The use cases"></a>The use cases</h4><p><img src="http://www.linusakesson.net/programming/tty/case1.png" alt="Diagram"></p>
<p>A user types at a terminal (a physical teletype). This terminal is connected through a pair of wires to a <em>UART</em> (Universal Asynchronous Receiver and Transmitter) on the computer. The operating system contains a <em>UART driver</em> which manages the physical transmission of bytes, including parity checks and flow control. In a naive system, the UART driver would then deliver the incoming bytes directly to some application process. But such an approach would lack the following essential features:</p>
<p>用户在终端(一个物理电传打字机)输入. 终端和 UART(通用异步接收传递)驱动(管理物理字节传输, 包括 parity 检测和流控制) 由一对电线连接. 在原始的系统中, UART 会直接将输入输入递送到应用程序中. 这会缺失一些重要的特性.</p>
<p><strong>Line editing.</strong> Most users make mistakes while typing, so a backspace key is often useful. This could of course be implemented by the applications themselves, but in accordance with the UNIX design philosophy, applications should be kept as simple as possible. So as a convenience, the operating system provides an editing buffer and some rudimentary editing commands (backspace, erase word, clear line, reprint), which are enabled by default inside the <em>line discipline</em>. Advanced applications may disable these features by putting the line discipline in <em>raw</em> mode instead of the default <em>cooked</em> (or <em>canonical</em>) mode. Most interactive applications (editors, mail user agents, shells, all programs relying on <code>curses</code> or <code>readline</code>) run in raw mode, and handle all the line editing commands themselves. The line discipline also contains options for character echoing and automatic conversion between carriage returns and linefeeds. Think of it as a primitive kernel-level <code>sed(1)</code>, if you like.</p>
<p>输入数据错误时, 经常需要使用 backspace 键. 这当然可以由应用自身实现. 但是根据 UNIX 设计的理念, 应用应该尽可能简洁. 所以为了简便起见, 操作系统提供了编辑缓冲和一些基本的编辑命令(backspace, ease word, clear line, reprint) 在 line discipline 中默认启用. 其他高级应用可能通过将其置于原始模式取消这些特性. 大多交互应用(编辑器, 用户邮件代理, shell, 所有依赖于 curses/ readline 的应用程序) 运行于原始模式. 自行管理行编辑命令. line discipline 还包含字符回显和自动转换回车和换行. </p>
<p><strong>Session management.</strong> The user probably wants to run several programs simultaneously, and interact with them one at a time. If a program goes into an endless loop, the user may want to kill it or suspend it. Programs that are started in the background should be able to execute until they try to write to the terminal, at which point they should be suspended. Likewise, user input should be directed to the foreground program only. The operating system implements these features in the <em>TTY driver</em> (<code>drivers/char/tty_io.c</code>).</p>
<p>用户当然希望同时运行多个程序并可以与其交互. 如果程序陷入死循环. 用户希望能暂停/关闭它. 程序在进入后台后应当依旧能运行, 直到它尝试向终端写入. 用户输入应当仅直接发送给前端程序. 操作系统将这些特性实现在了 TTY 驱动中.</p>
<p>An operating system process is “alive” (has an <em>execution context</em>), which means that it can perform actions. The TTY driver is not alive; in object oriented terminology, the TTY driver is a passive object. It has some data fields and some methods, but the only way it can actually do something is when one of its methods gets called from the context of a process or a kernel interrupt handler. The line discipline is likewise a passive entity.</p>
<p>一个程序是’活跃的’ 意味着它能执行操作. TTY 驱动并不是, 它是被动对象. 它拥有一些数据字段和方法. 仅当其方法被进程/内核中处理程序的上下文调用的时候才能做事. (就像一个库一样)</p>
<p>Together, a particular triplet of UART driver, line discipline instance and TTY driver may be referred to as a <em>TTY device</em>, or sometimes just TTY. A user process can affect the behaviour of any TTY device by manipulating the corresponding device file under <code>/dev</code>. Write permissions to the device file are required, so when a user logs in on a particular TTY, that user must become the owner of the device file. This is traditionally done by the <code>login(1)</code> program, which runs with root privileges.</p>
<p>合在一起, 一个特定的三重: UART 驱动, line discipline 实例, 和 TTY 驱动. 统称为 TTY 驱动. 或者有时直接称为 TTY. 用户进程可以通过对 /dev 下的设备文件的管理来改变任意 TTY 设备的行为. 这需要对于设备文件的写权限, 所以当用户登录特定的 TTY 时, 用户必须称为这个设备文件的所有者. 这通常由运行时带有 root 权限 login 程序来实现.</p>
<p>The physical line in the previous diagram could of course be a long-distance phone line:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case2.png" alt="Diagram"></p>
<p>This does not change much, except that the system now has to handle a modem hangup situation as well.</p>
<p>Let’s move on to a typical desktop system. This is how the Linux console works:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case3.png" alt="Diagram"></p>
<p>The TTY driver and line discipline behave just like in the previous examples, but there is no UART or physical terminal involved anymore. Instead, a video terminal (a complex state machine including a <em>frame buffer</em> of characters and graphical character attributes) is emulated in software, and rendered to a VGA display.</p>
<p>当数据输入时, 会通过一系列的交换最终由 TTY 发给进程, 而当数据输出时, 会原路 (但从 terminal emulator 开始分开) 发送给输出设备 (显示屏…)</p>
<p>The console subsystem is somewhat rigid. Things get more flexible (and abstract) if we move the terminal emulation into userland. This is how <code>xterm(1)</code> and its clones work:</p>
<p><img src="http://www.linusakesson.net/programming/tty/case4.png" alt="Diagram"></p>
<p>To facilitate moving the terminal emulation into userland, while still keeping the TTY subsystem (session management and line discipline) intact, the <em>pseudo terminal</em> or <em>pty</em> was invented. And as you may have guessed, things get even more complicated when you start running pseudo terminals inside pseudo terminals, à la <code>screen(1)</code> or <code>ssh(1)</code>.</p>
<p>这里有主从 TTY, 伪终端. 这里作者提到了 ssh. 我查了一下 PTY 相关的东西, 发现了 关于 ssh ‘-t’ 和 ‘-T’ 选项的说明. 就有了 <a href="https://security.stackexchange.com/questions/107933/what-exactly-does-ssh-t-userdomain-verify-do" target="_blank" rel="noopener">stackExchange</a> 和 <a href="https://stackoverflow.com/questions/42505339/why-use-t-with-ssh" target="_blank" rel="noopener">stackOverflow</a> 的解释. </p>
<p>-T: 这个选项不生产 PTY, 终端运行于本地, 这或许就是 PTY(pseudo) 为什么叫 PTY 的原因. github 的 ssh 也是带 -T 选项的, 因为如果为每个用户提供一个 tty 的话… </p>
<p>Now let’s take a step back and see how all of this fits into the process model.</p>
<h4 id="Processes"><a href="#Processes" class="headerlink" title="Processes"></a>Processes</h4><p>A Linux process can be in one of the following states:</p>
<p><img src="http://www.linusakesson.net/programming/tty/linuxprocess.png" alt="Process states"></p>
<table>
<thead>
<tr>
<th>R</th>
<th>Running or runnable (on run queue)</th>
</tr>
</thead>
<tbody><tr>
<td>D</td>
<td>Uninterruptible sleep (waiting for some event)</td>
</tr>
<tr>
<td>S</td>
<td>Interruptible sleep (waiting for some event or signal)</td>
</tr>
<tr>
<td>T</td>
<td>Stopped, either by a job control signal or because it is being traced by a debugger.</td>
</tr>
<tr>
<td>Z</td>
<td>Zombie process, terminated but not yet reaped by its parent.</td>
</tr>
</tbody></table>
<p>(PS: 看到这里的时候, 我有点遗忘 ps 的细节了, 去看了看 ps 的说明. 然后明白了之前有次面试的事情了. 当时我还很好奇为什么会有人在我回答了查看所有进程的命令行后再问我一次. 我当时答的时 ps -axu (-aux?) 都是不对的. 而后者更是大错特错. 我最初需要这条指令时, 仅仅只是在网上查了下(误导我, 可恶啊…) 然后就全信了, 之后就只是瞄了一眼 man 手册. 并未过多在意. 这态度非常有问题, 包括之前的一个 C++ 空对象, 我给它赋值时依旧会出错, 我还好奇为什么, 因为我根本没仔细想过析构的问题. 作为一个技术人员, 我感觉很羞愧. 包括这次的笔记, 如果不是处于好奇, 也不会牵扯出这么多东西来, 学习是一个越学越少的过程. 我应当时刻这样警醒自己.)</p>
<p>By running <code>ps l</code>, you can see which processes are running, and which are sleeping. If a process is sleeping, the <code>WCHAN</code> column (“wait channel”, the name of the wait queue) will tell you what kernel event the process is waiting for.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ps l</span><br><span class="line">F   UID   PID  PPID PRI  NI    VSZ   RSS WCHAN  STAT TTY        TIME COMMAND</span><br><span class="line">0   500  5942  5928  15   0  12916  1460 wait   Ss   pts&#x2F;14     0:00 -&#x2F;bin&#x2F;bash</span><br><span class="line">0   500 12235  5942  15   0  21004  3572 wait   S+   pts&#x2F;14     0:01 vim index.php</span><br><span class="line">0   500 12580 12235  15   0   8080  1440 wait   S+   pts&#x2F;14     0:00 &#x2F;bin&#x2F;bash -c (ps l) &gt;&#x2F;tmp&#x2F;v727757&#x2F;1 2&gt;&amp;1</span><br><span class="line">0   500 12581 12580  15   0   4412   824 -      R+   pts&#x2F;14     0:00 ps l</span><br></pre></td></tr></table></figure>

<p>The “<code>wait</code>“ wait queue corresponds to the <code>wait(2)</code> syscall, so these processes will be moved to the running state whenever there’s a state change in one of their child processes. There are two sleeping states: Interruptible sleep and uninterruptible sleep. Interruptible sleep (the most common case) means that while the process is part of a wait queue, it may actually also be moved to the running state when a signal is sent to it. If you look inside the kernel source code, you will find that any kernel code which is waiting for an event must check if a signal is pending after schedule() returns, and abort the syscall in that case.</p>
<p>有可中断和不可中断睡眠. 中断睡眠意味着如果进程在等待队列中, 那么其可以在信号发送给它时更新为运行态. 任何等待事件的内核代码都必须在调度返回后检查信号挂起.</p>
<p>In the <code>ps</code> listing above, the <code>STAT</code> column displays the current state of each process. The same column may also contain one or more attributes, or flags:</p>
<table>
<thead>
<tr>
<th>s</th>
<th>This process is a session leader.</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>This process is part of a foreground process group.</td>
</tr>
</tbody></table>
<p>These attributes are used for job control.</p>
<h3 id="Jobs-and-sessions"><a href="#Jobs-and-sessions" class="headerlink" title="Jobs and sessions"></a>Jobs and sessions</h3><p>Job control is what happens when you press <code>^Z</code> to suspend a program, or when you start a program in the background using <code>&amp;</code>. A job is the same as a process group. Internal shell commands like <code>jobs</code>, <code>fg</code> and <code>bg</code> can be used to manipulate the existing jobs within a <em>session</em>. Each session is managed by a <em>session leader</em>, the shell, which is cooperating tightly with the kernel using a complex protocol of signals and system calls.</p>
<p>The following example illustrates the relationship between processes, jobs and sessions:</p>
<p>工作管理在按下 C+Z 挂起程序或使用 &amp; 使程序后台执行时发生. 一个工作就是一个经进程组. linux 提供了 jobs, fg, bg 在会话中管理现有工作. 每个绘画都由一个会话 leader 管理. shell , 和内核经由复杂的信号和系统调用协议密切合作. </p>
<p>(PS: 关于 <a href="https://en.wikipedia.org/wiki/Process_group" target="_blank" rel="noopener">process group</a> , 简单来说就是一组进程, 而会话是一组进程组)</p>
<h4 id="The-following-shell-interactions…"><a href="#The-following-shell-interactions…" class="headerlink" title="The following shell interactions…"></a>The following shell interactions…</h4><p><img src="http://www.linusakesson.net/programming/tty/exampleterm.png" alt="Screenshot"></p>
<h4 id="…correspond-to-these-processes…"><a href="#…correspond-to-these-processes…" class="headerlink" title="…correspond to these processes…"></a>…correspond to these processes…</h4><p><img src="http://www.linusakesson.net/programming/tty/examplediagram.png" alt="Table"></p>
<h4 id="…and-these-kernel-structures"><a href="#…and-these-kernel-structures" class="headerlink" title="…and these kernel structures."></a>…and these kernel structures.</h4><ul>
<li><p>TTY Driver (/dev/pts/0).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Size: 45x13</span><br><span class="line">  Controlling process group: (101)</span><br><span class="line">Foreground process group: (103)</span><br><span class="line">  UART configuration (ignored, since this is an xterm):</span><br><span class="line">    Baud rate, parity, word length and much more.</span><br><span class="line">  Line discipline configuration:</span><br><span class="line">    cooked&#x2F;raw mode, linefeed correction,</span><br><span class="line">    meaning of interrupt characters etc.</span><br><span class="line">  Line discipline state:</span><br><span class="line">    edit buffer (currently empty),</span><br><span class="line">    cursor position within buffer etc.</span><br></pre></td></tr></table></figure>
</li>
<li><p>pipe0</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Readable end (connected to PID 104 as file descriptor 0)</span><br><span class="line">Writable end (connected to PID 103 as file descriptor 1)</span><br><span class="line">Buffer</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>The basic idea is that every pipeline is a job, because every process in a pipeline should be manipulated (stopped, resumed, killed) simultaneously. That’s why <code>kill(2)</code> allows you to send signals to entire process groups. By default, <code>fork(2)</code> places a newly created child process in the same process group as its parent, so that e.g. a <code>^C</code> from the keyboard will affect both parent and child. But the shell, as part of its session leader duties, creates a new process group every time it launches a pipeline.</p>
<p>基础的想法是每个管道都是一个工作. 因为每个管道中的进程都需要被同时管理. 默认在使用 fork 时会创建一个新子程序到同样的进程组中, 就和它的父进程一样. 所以 C+C 会影响父子进程, 但是 shell 作为会话 leader, 当创建一个新的管道的时候, 将会创建一个新的进程组.</p>
<p>The TTY driver keeps track of the foreground process group id, but only in a passive way. The session leader has to update this information explicitly when necessary. Similarly, the TTY driver keeps track of the size of the connected terminal, but this information has to be updated explicitly, by the terminal emulator or even by the user.</p>
<p>TTY 被动持续跟踪前台程序组 id. 会话 leader 必须在必要时更新这些信息(调用?). 同样的, TTY 驱动持续跟踪已连接终端大小.</p>
<p>As you can see in the diagram above, several processes have <code>/dev/pts/0</code> attached to their standard input. But only the foreground job (the <code>ls | sort</code> pipeline) will receive input from the TTY. Likewise, only the foreground job will be allowed to write to the TTY device (in the default configuration). If the cat process were to attempt to write to the TTY, the kernel would suspend it using a signal.</p>
<p>(我也没想到因为一个好奇能牵扯这些东西出来…)</p>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/03/06/leetcode/NextGreaterElementII/" rel="prev" title="leetcode/NextGreaterElementII">
      <i class="fa fa-chevron-left"></i> leetcode/NextGreaterElementII
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/03/11/other/aboutProcess/" rel="next" title="other/aboutProcess">
      other/aboutProcess <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#关于-backspace-是密码的一部分"><span class="nav-number">1.</span> <span class="nav-text">关于 backspace 是密码的一部分</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#solution"><span class="nav-number">1.1.</span> <span class="nav-text">solution</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#other"><span class="nav-number">1.2.</span> <span class="nav-text">other</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#关于-line-discipline"><span class="nav-number">1.2.1.</span> <span class="nav-text">关于 line discipline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于-character-device"><span class="nav-number">1.2.2.</span> <span class="nav-text">关于 character device</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Character-devices"><span class="nav-number">1.2.2.1.</span> <span class="nav-text">Character devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Block-devices"><span class="nav-number">1.2.2.2.</span> <span class="nav-text">Block devices</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Pseudo-devices"><span class="nav-number">1.2.2.3.</span> <span class="nav-text">Pseudo-devices</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于-TTY"><span class="nav-number">1.2.3.</span> <span class="nav-text">关于 TTY</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-use-cases"><span class="nav-number">1.2.3.1.</span> <span class="nav-text">The use cases</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Processes"><span class="nav-number">1.2.3.2.</span> <span class="nav-text">Processes</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Jobs-and-sessions"><span class="nav-number">1.2.4.</span> <span class="nav-text">Jobs and sessions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#The-following-shell-interactions…"><span class="nav-number">1.2.4.1.</span> <span class="nav-text">The following shell interactions…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#…correspond-to-these-processes…"><span class="nav-number">1.2.4.2.</span> <span class="nav-text">…correspond to these processes…</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#…and-these-kernel-structures"><span class="nav-number">1.2.4.3.</span> <span class="nav-text">…and these kernel structures.</span></a></li></ol></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">cas</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">102</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cas</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v4.2.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">Theme – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.7.0
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
